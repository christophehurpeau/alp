{"version":3,"file":"index-browsermodern.es.js","sources":["../src/index.ts"],"sourcesContent":["import 'pob-babel';\nimport type { Context, Middleware, HtmlError } from 'alp-types';\nimport ErrorHtmlRenderer from 'error-html';\nimport { Logger } from 'nightingale-logger';\n\nconst logger = new Logger('alp:errors');\nconst errorHtmlRenderer = __DEV__ ? new ErrorHtmlRenderer() : undefined;\n\nconst createErrorInstanceIfNeeded = (\n  err: Error | string | undefined | null | HtmlError | unknown,\n): Error | HtmlError => {\n  if (!err) return new Error('Unknown error');\n  if (typeof err === 'string') return new Error(err);\n  if (err instanceof Error) return err;\n  return err as Error;\n};\n\nconst errorMiddleware: Middleware = async function (ctx: Context, next) {\n  try {\n    await next();\n  } catch (err: Error | unknown) {\n    const errInstance: Error | HtmlError = createErrorInstanceIfNeeded(err);\n\n    ctx.status = (errInstance as HtmlError).status\n      ? (errInstance as HtmlError).status\n      : 500;\n\n    logger.error(errInstance);\n\n    if (errorHtmlRenderer) {\n      ctx.body = errorHtmlRenderer.render(errInstance);\n    } else if ((errInstance as HtmlError).expose) {\n      ctx.body = errInstance.message;\n    } else {\n      throw errInstance;\n    }\n  }\n};\n\nexport default errorMiddleware;\n"],"names":["logger","Logger","errorHtmlRenderer","__DEV__","ErrorHtmlRenderer","undefined","createErrorInstanceIfNeeded","err","Error","errorMiddleware","ctx","next","errInstance","status","error","body","render","expose","message"],"mappings":";;;AAKA,MAAMA,MAAM,GAAG,IAAIC,MAAJ,CAAW,YAAX,CAAf;AACA,MAAMC,iBAAiB,GAAGC,0CAAU,IAAIC,iBAAJ,EAAH,GAA6BC,SAA9D;;AAEA,MAAMC,2BAA2B,GAC/BC,GADkC,IAEZ;AACtB,MAAI,CAACA,GAAL,EAAU,OAAO,IAAIC,KAAJ,CAAU,eAAV,CAAP;AACV,MAAI,OAAOD,GAAP,KAAe,QAAnB,EAA6B,OAAO,IAAIC,KAAJ,CAAUD,GAAV,CAAP;AAC7B,MAAIA,GAAG,YAAYC,KAAnB,EAA0B,OAAOD,GAAP;AAC1B,SAAOA,GAAP;AACD,CAPD;;MASME,eAA2B,GAAG,gBAAgBC,GAAhB,EAA8BC,IAA9B,EAAoC;AACtE,MAAI;AACF,UAAMA,IAAI,EAAV;AACD,GAFD,CAEE,OAAOJ,GAAP,EAA6B;AAC7B,UAAMK,WAA8B,GAAGN,2BAA2B,CAACC,GAAD,CAAlE;AAEAG,IAAAA,GAAG,CAACG,MAAJ,GAAcD,WAAD,CAA2BC,MAA3B,GACRD,WAAD,CAA2BC,MADlB,GAET,GAFJ;AAIAb,IAAAA,MAAM,CAACc,KAAP,CAAaF,WAAb;;AAEA,QAAIV,iBAAJ,EAAuB;AACrBQ,MAAAA,GAAG,CAACK,IAAJ,GAAWb,iBAAiB,CAACc,MAAlB,CAAyBJ,WAAzB,CAAX;AACD,KAFD,MAEO,IAAKA,WAAD,CAA2BK,MAA/B,EAAuC;AAC5CP,MAAAA,GAAG,CAACK,IAAJ,GAAWH,WAAW,CAACM,OAAvB;AACD,KAFM,MAEA;AACL,YAAMN,WAAN;AACD;AACF;AACF;;;;"}