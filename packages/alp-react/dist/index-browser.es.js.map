{"version":3,"file":"index-browser.es.js","sources":["../src/createAlpAppWrapper.tsx","../src/contexts/LoadingFallbackContext.ts","../src/module/AlpModule.tsx","../src/module/SuspenseWrapper.tsx","../src/layout/Body.tsx","../src/layout/AppContainer.tsx","../src/browser.ts"],"sourcesContent":["import type { Context } from 'alp-types';\nimport type {\n  ComponentClass,\n  ErrorInfo,\n  ReactChild,\n  ReactElement,\n} from 'react';\nimport { Component } from 'react';\nimport ReactAlpContext from 'react-alp-context';\n\ndeclare global {\n  interface Window {\n    Sentry?: { captureException: (error: Error, extra: unknown) => void };\n  }\n}\n\n// eslint-disable-next-line @typescript-eslint/no-empty-interface\ninterface AlpAppProps {}\n\ninterface AlpAppState {\n  error: null | Error;\n}\n\nexport default function createAlpAppWrapper(\n  app: ReactChild,\n  context: Context,\n): ComponentClass<AlpAppProps, AlpAppState> {\n  return class AlpAppWrapper extends Component<AlpAppProps, AlpAppState> {\n    state = {\n      error: null,\n    };\n\n    componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n      console.error(error, errorInfo);\n      if (window.Sentry) {\n        window.Sentry.captureException(error, {\n          contexts: {\n            react: {\n              componentStack: errorInfo.componentStack,\n            },\n          },\n        });\n      }\n    }\n\n    render(): ReactElement {\n      if (this.state.error) return <div>An unexpected error occured</div>;\n      return (\n        <ReactAlpContext.Provider value={context}>\n          {app}\n        </ReactAlpContext.Provider>\n      );\n    }\n  };\n}\n","import type { ReactNode } from 'react';\nimport { createContext } from 'react';\n\nexport default createContext<NonNullable<ReactNode>>('Loading...');\n","import { POB_TARGET } from 'pob-babel';\nimport type { ReactElement, ReactNode } from 'react';\nimport { Suspense, useContext } from 'react';\nimport LoadingFallbackContext from '../contexts/LoadingFallbackContext';\n\nexport interface AlpModuleProps {\n  children: ReactNode;\n}\n\nfunction AlpModuleNode(props: AlpModuleProps): ReactElement {\n  return props.children as ReactElement;\n}\n\nfunction AlpModuleBrowser(props: AlpModuleProps): ReactElement {\n  const loadingFallback = useContext(LoadingFallbackContext);\n  return <Suspense fallback={loadingFallback}>{props.children}</Suspense>;\n}\n\nexport default POB_TARGET === 'node' ? AlpModuleNode : AlpModuleBrowser;\n","import { POB_TARGET } from 'pob-babel';\nimport type { ReactElement, ReactNode } from 'react';\nimport { Suspense, useContext } from 'react';\nimport LoadingFallbackContext from '../contexts/LoadingFallbackContext';\n\ninterface SuspenseWrapperProps {\n  children: ReactNode;\n}\n\nfunction NodeSuspenseWrapper({ children }: SuspenseWrapperProps): ReactElement {\n  return children as unknown as ReactElement;\n}\n\nfunction BrowserSuspenseWrapper({\n  children,\n}: SuspenseWrapperProps): ReactElement {\n  const loader = useContext(LoadingFallbackContext);\n  return <Suspense fallback={loader}>{children}</Suspense>;\n}\n\nexport default POB_TARGET === 'node'\n  ? NodeSuspenseWrapper\n  : BrowserSuspenseWrapper;\n","import type { ReactElement, ReactNode } from 'react';\n\nexport interface BodyProps {\n  children: ReactNode;\n}\n\nexport default function Body({ children }: BodyProps): ReactElement<'div'> {\n  return <div>{children}</div>;\n}\n","import type { ReactElement } from 'react';\nimport type React from 'react';\n\nexport interface AppContainerProps {\n  children: React.ReactNode;\n}\n\nexport default function AppContainer({\n  children,\n}: AppContainerProps): ReactElement {\n  return children as ReactElement;\n}\n","import type { BrowserApplication, ContextSanitizedState } from 'alp-types';\nimport contentLoaded from 'content-loaded';\nimport { Logger } from 'nightingale-logger';\nimport type { ElementType } from 'react';\nimport React from 'react';\nimport { hydrate } from 'react-dom';\nimport createAlpAppWrapper from './createAlpAppWrapper';\n\nexport { default as Helmet } from 'react-helmet';\nexport { default as AlpModule } from './module/AlpModule';\nexport { default as SuspenseWrapper } from './module/SuspenseWrapper';\nexport { default as Body } from './layout/Body';\nexport { default as AppContainer } from './layout/AppContainer';\nexport { default as LoadingFallbackContext } from './contexts/LoadingFallbackContext';\n\nconst logger = new Logger('alp:react');\n\ndeclare global {\n  interface Window {\n    __INITIAL_DATA__?: {\n      sanitizedState?: ContextSanitizedState;\n    };\n  }\n}\n\nexport default function alpReactBrowser(app: BrowserApplication) {\n  return async function renderApp(\n    App: ElementType<Record<string, never>>,\n  ): Promise<void> {\n    const initialData = window.__INITIAL_DATA__ || {};\n    const ctx = app.createContext();\n    if (initialData.sanitizedState) {\n      ctx.sanitizedState = initialData.sanitizedState;\n    }\n\n    logger.success('render called');\n    const WrappedApp = createAlpAppWrapper(React.createElement(App), ctx);\n    const appElement = React.createElement(WrappedApp);\n\n    await contentLoaded();\n    // const container =\n    hydrate(appElement, document.getElementById('react-app'));\n    logger.success('rendered');\n\n    // container.updateSanitizedState({ loading: false });\n  };\n}\n"],"names":["createAlpAppWrapper","app","context","state","error","componentDidCatch","errorInfo","console","window","Sentry","captureException","contexts","react","componentStack","render","_jsx","Component","createContext","AlpModuleBrowser","props","loadingFallback","useContext","LoadingFallbackContext","children","BrowserSuspenseWrapper","loader","Body","AppContainer","logger","Logger","alpReactBrowser","App","initialData","__INITIAL_DATA__","ctx","sanitizedState","success","WrappedApp","React","createElement","appElement","contentLoaded","hydrate","document","getElementById","renderApp"],"mappings":";;;;;;;;;;;AAuBe,SAASA,mBAAT,CACbC,GADa,EAEbC,OAFa,EAG6B;AAC1C,EAAA,oBAAA,UAAA,UAAA,EAAA;AAAA,IAAA,cAAA,CAAA,aAAA,EAAA,UAAA,CAAA,CAAA;;AAAA,IAAA,SAAA,aAAA,GAAA;AAAA,MAAA,IAAA,KAAA,EAAA,IAAA,EAAA,IAAA,EAAA,IAAA,CAAA;;AAAA,MAAA,KAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAAA,IAAA,GAAA,IAAA,KAAA,CAAA,IAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;AAAA,QAAA,IAAA,CAAA,IAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAAA,OAAA;;AAAA,MAAA,KAAA,GAAA,UAAA,CAAA,IAAA,CAAA,KAAA,CAAA,UAAA,EAAA,CAAA,IAAA,CAAA,CAAA,MAAA,CAAA,IAAA,CAAA,CAAA,IAAA,IAAA,CAAA;AAAA,MAAA,KAAA,CACEC,KADF,GACU;AACNC,QAAAA,KAAK,EAAE,IAAA;OAFX,CAAA;AAAA,MAAA,OAAA,KAAA,CAAA;AAAA,KAAA;;AAAA,IAAA,IAAA,MAAA,GAAA,aAAA,CAAA,SAAA,CAAA;;AAAA,IAAA,MAAA,CAKEC,iBALF,GAKE,SAAA,iBAAA,CAAkBD,KAAlB,EAAgCE,SAAhC,EAA4D;AAC1DC,MAAAA,OAAO,CAACH,KAAR,CAAcA,KAAd,EAAqBE,SAArB,CAAA,CAAA;;MACA,IAAIE,MAAM,CAACC,MAAX,EAAmB;AACjBD,QAAAA,MAAM,CAACC,MAAP,CAAcC,gBAAd,CAA+BN,KAA/B,EAAsC;AACpCO,UAAAA,QAAQ,EAAE;AACRC,YAAAA,KAAK,EAAE;cACLC,cAAc,EAAEP,SAAS,CAACO,cAAAA;AADrB,aAAA;AADC,WAAA;SADZ,CAAA,CAAA;AAOD,OAAA;KAfL,CAAA;;IAAA,MAkBEC,CAAAA,MAlBF,GAkBE,SAAuB,MAAA,GAAA;AACrB,MAAA,IAAI,IAAKX,CAAAA,KAAL,CAAWC,KAAf,EAAsB,oBAAOW,GAAA,CAAA,KAAA,EAAA;AAAA,QAAA,QAAA,EAAA,6BAAA;OAAP,CAAA,CAAA;MACtB,oBACEA,GAAA,CAAC,eAAD,CAAiB,QAAjB,EAAA;AAA0B,QAAA,KAAK,EAAEb,OAAjC;QAAA,QACGD,EAAAA,GAAAA;OAFL,CAAA,CAAA;KApBJ,CAAA;;AAAA,IAAA,OAAA,aAAA,CAAA;AAAA,GAAA,CAAmCe,SAAnC,CAAA,CAAA;AA2BD;;ACnDD,6BAAeC,aAAAA,aAAa,CAAyB,YAAzB,CAA5B;;ACUA,SAASC,gBAAT,CAA0BC,KAA1B,EAA+D;AAC7D,EAAA,IAAMC,eAAe,GAAGC,UAAU,CAACC,sBAAD,CAAlC,CAAA;AACA,EAAA,oBAAOP,IAAC,QAAD,EAAA;AAAU,IAAA,QAAQ,EAAEK,eAApB;AAAA,IAAA,QAAA,EAAsCD,KAAK,CAACI,QAAAA;GAAnD,CAAA,CAAA;AACD;;ACHD,SAASC,sBAAT,CAEuC,KAAA,EAAA;EAAA,IADrCD,QACqC,SADrCA,QACqC,CAAA;AACrC,EAAA,IAAME,MAAM,GAAGJ,UAAU,CAACC,sBAAD,CAAzB,CAAA;AACA,EAAA,oBAAOP,IAAC,QAAD,EAAA;AAAU,IAAA,QAAQ,EAAEU,MAApB;IAAA,QAA6BF,EAAAA,QAAAA;GAApC,CAAA,CAAA;AACD;;ACZc,SAASG,IAAT,CAA4D,IAAA,EAAA;EAAA,IAA5CH,QAA4C,QAA5CA,QAA4C,CAAA;EACzE,oBAAOR,GAAA,CAAA,KAAA,EAAA;IAAA,QAAMQ,EAAAA,QAAAA;GAAb,CAAA,CAAA;AACD;;ACDc,SAASI,YAAT,CAEqB,IAAA,EAAA;EAAA,IADlCJ,QACkC,QADlCA,QACkC,CAAA;AAClC,EAAA,OAAOA,QAAP,CAAA;AACD;;ACID,IAAMK,MAAM,GAAG,IAAIC,MAAJ,CAAW,WAAX,CAAf,CAAA;AAUe,SAASC,eAAT,CAAyB7B,GAAzB,EAAkD;AAC/D,EAAA,oBAAA,YAAA;AAAA,IAAA,IAAA,UAAA,GAAA,iBAAA,eAAA,mBAAA,CAAA,IAAA,CAAO,iBACL8B,GADK,EAAA;AAAA,MAAA,IAAA,WAAA,EAAA,GAAA,EAAA,UAAA,EAAA,UAAA,CAAA;AAAA,MAAA,OAAA,mBAAA,CAAA,IAAA,CAAA,SAAA,QAAA,CAAA,QAAA,EAAA;AAAA,QAAA,OAAA,CAAA,EAAA;AAAA,UAAA,QAAA,QAAA,CAAA,IAAA,GAAA,QAAA,CAAA,IAAA;AAAA,YAAA,KAAA,CAAA;AAGCC,cAAAA,WAHD,GAGexB,MAAM,CAACyB,gBAAP,IAA2B,EAH1C,CAAA;AAICC,cAAAA,GAJD,GAIOjC,GAAG,CAACgB,aAAJ,EAJP,CAAA;;cAKL,IAAIe,WAAW,CAACG,cAAhB,EAAgC;AAC9BD,gBAAAA,GAAG,CAACC,cAAJ,GAAqBH,WAAW,CAACG,cAAjC,CAAA;AACD,eAAA;;cAEDP,MAAM,CAACQ,OAAP,CAAe,eAAf,CAAA,CAAA;cACMC,UAVD,GAUcrC,mBAAmB,eAACsC,KAAK,CAACC,aAAN,CAAoBR,GAApB,CAAD,EAA2BG,GAA3B,CAVjC,CAAA;AAWCM,cAAAA,UAXD,gBAWcF,KAAK,CAACC,aAAN,CAAoBF,UAApB,CAXd,CAAA;AAAA,cAAA,QAAA,CAAA,IAAA,GAAA,CAAA,CAAA;AAAA,cAAA,OAaCI,aAAa,EAbd,CAAA;;AAAA,YAAA,KAAA,CAAA;AAcL;cACAC,OAAO,CAACF,UAAD,EAAaG,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAAb,CAAP,CAAA;AACAhB,cAAAA,MAAM,CAACQ,OAAP,CAAe,UAAf,EAhBK;;AAAA,YAAA,KAAA,EAAA,CAAA;AAAA,YAAA,KAAA,KAAA;AAAA,cAAA,OAAA,QAAA,CAAA,IAAA,EAAA,CAAA;AAAA,WAAA;AAAA,SAAA;AAAA,OAAA,EAAA,OAAA,CAAA,CAAA;KAAP,CAAA,CAAA,CAAA;;AAAA,IAAA,OAAA,SAAsBS,SAAtB,GAAA;AAAA,MAAA,OAAA,UAAA,CAAA,KAAA,CAAA,IAAA,EAAA,SAAA,CAAA,CAAA;AAAA,KAAA,CAAA;AAAA,GAAA,EAAA,CAAA;AAoBD;;;;"}