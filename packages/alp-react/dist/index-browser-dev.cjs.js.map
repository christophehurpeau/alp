{"version":3,"file":"index-browser-dev.cjs.js","sources":["../src/createAlpAppWrapper.tsx","../src/module/AlpModule.tsx","../src/layout/Body.tsx","../src/layout/AppContainer.tsx","../src/browser.ts"],"sourcesContent":["import React, { Component, ReactChild } from 'react';\nimport { Context } from 'alp-types';\nimport ReactAlpContext, { AppStateContext } from 'react-alp-context';\n\ndeclare global {\n  interface Window {\n    Raven: any;\n  }\n}\n\ninterface AlpAppProps {}\ninterface AlpAppState {\n  error: null | Error;\n  appState: any;\n}\n\nexport default (app: ReactChild, context: Context) =>\n  class AlpAppWrapper extends Component<AlpAppProps, AlpAppState> {\n    state = {\n      error: null,\n      appState: context.sanitizedState,\n    };\n\n    componentDidCatch(error: Error, errorInfo: any) {\n      this.setState({ error });\n      console.error(error, errorInfo);\n      if (window.Raven)\n        window.Raven.captureException(error, { extra: errorInfo });\n    }\n\n    updateSanitizedState(patchState: any) {\n      this.setState((prevState) => ({\n        appState: { ...prevState.appState, patchState },\n      }));\n    }\n\n    render() {\n      if (this.state.error) return <div>An unexpected error occured</div>;\n      return (\n        <ReactAlpContext.Provider value={context}>\n          <AppStateContext.Provider value={this.state.appState}>\n            {app}\n          </AppStateContext.Provider>\n        </ReactAlpContext.Provider>\n      );\n    }\n  };\n","import { Component, ReactNode } from 'react';\n\nexport interface Props {\n  children: ReactNode;\n}\n\nexport default class AlpModule<T extends Props> extends Component<T> {\n  render(): ReactNode {\n    return this.props.children;\n  }\n}\n","import React, { ReactElement, ReactNode } from 'react';\n\nexport interface Props {\n  children: ReactNode;\n}\n\nexport default ({ children }: Props): ReactElement<'div'> => (\n  <div>{children}</div>\n);\n","import * as React from 'react';\n\nexport interface Props {\n  children: React.ReactNode;\n}\n\nexport default ({ children }: Props) => <div>{children}</div>;\n","import contentLoaded from 'content-loaded';\nimport React from 'react';\nimport { hydrate } from 'react-dom';\nimport Logger from 'nightingale-logger';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { BrowserApplication } from 'alp-types';\nimport createAlpAppWrapper from './createAlpAppWrapper';\n\nexport { default as Helmet } from 'react-helmet';\nexport { default as AlpModule } from './module/AlpModule';\nexport { default as Body } from './layout/Body';\nexport { default as AppContainer } from './layout/AppContainer';\n\nconst logger = new Logger('alp:react');\n\ndeclare global {\n  interface Window {\n    __INITIAL_DATA__: any;\n  }\n}\n\nexport default (app: BrowserApplication) =>\n  // loading: (state: number = 0, action: ReduxActionType) => {\n  //   if (action.meta && action.meta.loading !== undefined) {\n  //     return state + (action.meta.loading ? 1 : -1);\n  //   }\n  //   return state;\n  // },\n  async function renderApp(App: React.ReactType<{}>) {\n    const initialData = window.__INITIAL_DATA__ || {};\n    const ctx = app.createContext();\n    if (initialData.sanitizedState) {\n      ctx.sanitizedState = initialData.sanitizedState;\n    }\n\n    logger.success('render called');\n    const WrappedApp = createAlpAppWrapper(React.createElement(App), ctx);\n    const appElement = React.createElement(WrappedApp);\n\n    await contentLoaded();\n    const container = hydrate(appElement, document.getElementById('react-app'));\n    logger.success('rendered');\n\n    // container.updateSanitizedState({ loading: false });\n  };\n"],"names":["app","context","state","error","appState","sanitizedState","componentDidCatch","errorInfo","setState","console","window","Raven","captureException","extra","updateSanitizedState","patchState","prevState","render","React","ReactAlpContext","AppStateContext","Component","AlpModule","props","children","React.createElement","logger","Logger","App","initialData","__INITIAL_DATA__","ctx","createContext","success","WrappedApp","createAlpAppWrapper","createElement","appElement","contentLoaded","hydrate","document","getElementById","renderApp"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,AAgBA,2BAAe,UAACA,GAAD,EAAkBC,OAAlB;;;;;;;;;;;;;;;;YAEXC,KAFW,GAEH;QACNC,KAAK,EAAE,IADD;QAENC,QAAQ,EAAEH,OAAO,CAACI;OAJT;;;;;;WAOXC,iBAPW,8BAOOH,KAPP,EAOqBI,SAPrB,EAOqC;WACzCC,QAAL,CAAc;QAAEL,KAAK,EAALA;OAAhB;MACAM,OAAO,CAACN,KAAR,CAAcA,KAAd,EAAqBI,SAArB;UACIG,MAAM,CAACC,KAAX,EACED,MAAM,CAACC,KAAP,CAAaC,gBAAb,CAA8BT,KAA9B,EAAqC;QAAEU,KAAK,EAAEN;OAA9C;KAXO;;WAcXO,oBAdW,iCAcUC,UAdV,EAc2B;WAC/BP,QAAL,CAAc,UAACQ,SAAD;eAAgB;UAC5BZ,QAAQ,eAAOY,SAAS,CAACZ,QAAjB;YAA2BW,UAAU,EAAVA;;SADvB;OAAd;KAfS;;WAoBXE,MApBW,qBAoBF;UACH,KAAKf,KAAL,CAAWC,KAAf,EAAsB,OAAOe;;;;;;uCAAP;aAEpBA,6BAACC,wBAAD,CAAiB,QAAjB;QAA0B,KAAK,EAAElB,OAAjC;;;;;;SACEiB,6BAACE,+BAAD,CAAiB,QAAjB;QAA0B,KAAK,EAAE,KAAKlB,KAAL,CAAWE,QAA5C;;;;;;SACGJ,GADH,CADF,CADF;KAtBS;;;IACeqB,eADf;CAAf;;ICVqBC;;;;;;;;;;;SACnBL,2BAAoB;WACX,KAAKM,KAAL,CAAWC,QAAlB;;;;EAFoDH;;;ACNxD,AAMA,YAAe;MAAGG,QAAH,QAAGA,QAAH;SACbN;;;;;;KAAMM,QAAN,CADa;CAAf;;;ACNA,AAMA,oBAAe;MAAGA,QAAH,QAAGA,QAAH;SAAyBC;;;;;;KAAMD,QAAN,CAAzB;CAAf;;ACOA,IAAME,MAAM,GAAG,IAAIC,MAAJ,CAAW,WAAX,CAAf;AAQA,eAAe,UAAC3B,GAAD;;;;;;;;;;;;8BAOb,iBAAyB4B,GAAzB;;;;;;gBACQC,WADR,GACsBnB,MAAM,CAACoB,gBAAP,IAA2B,EADjD;gBAEQC,GAFR,GAEc/B,GAAG,CAACgC,aAAJ,EAFd;;oBAGMH,WAAW,CAACxB,cAAhB,EAAgC;kBAC9B0B,GAAG,CAAC1B,cAAJ,GAAqBwB,WAAW,CAACxB,cAAjC;;;gBAGFqB,MAAM,CAACO,OAAP,CAAe,eAAf;gBACMC,UARR,GAQqBC,mBAAmB,CAACjB,cAAK,CAACkB,aAAN,CAAoBR,GAApB,CAAD,EAA2BG,GAA3B,CARxC;gBASQM,UATR,GASqBnB,cAAK,CAACkB,aAAN,CAAoBF,UAApB,CATrB;;uBAWQI,aAAa,EAXrB;;;gBAYoBC,gBAAO,CAACF,UAAD,EAAaG,QAAQ,CAACC,cAAT,CAAwB,WAAxB,CAAb,CAZ3B;gBAaEf,MAAM,CAACO,OAAP,CAAe,UAAf,EAbF;;;;;;;;OAPa;;sBAOES,SAPF;;;;;CAAf;;;;;;;;"}