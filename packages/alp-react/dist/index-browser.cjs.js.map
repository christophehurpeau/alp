{"version":3,"file":"index-browser.cjs.js","sources":["../src/createAlpAppWrapper.tsx","../src/contexts/LoadingFallbackContext.ts","../src/module/AlpModule.tsx","../src/module/SuspenseWrapper.tsx","../src/layout/Body.tsx","../src/layout/AppContainer.tsx","../src/browser.ts"],"sourcesContent":["import React, { Component, ReactChild } from 'react';\nimport { Context } from 'alp-types';\nimport ReactAlpContext from 'react-alp-context';\n\ndeclare global {\n  interface Window {\n    Raven: any;\n  }\n}\n\ninterface AlpAppProps {}\n\ninterface AlpAppState {\n  error: null | Error;\n  appState: any;\n}\n\nexport default function createAlpAppWrapper(app: ReactChild, context: Context) {\n  return class AlpAppWrapper extends Component<AlpAppProps, AlpAppState> {\n    state = {\n      error: null,\n      appState: context.sanitizedState,\n    };\n\n    componentDidCatch(error: Error, errorInfo: any) {\n      console.error(error, errorInfo);\n      if (window.Raven) {\n        window.Raven.captureException(error, { extra: errorInfo });\n      }\n    }\n\n    render() {\n      if (this.state.error) return <div>An unexpected error occured</div>;\n      return (\n        <ReactAlpContext.Provider value={context}>\n          {app}\n        </ReactAlpContext.Provider>\n      );\n    }\n  };\n}\n","import { createContext, ReactNode } from 'react';\n\nexport default createContext<NonNullable<ReactNode>>('Loading...');\n","import { POB_TARGET } from 'pob-babel';\nimport React, { ReactElement, ReactNode, Suspense, useContext } from 'react';\nimport LoadingFallbackContext from '../contexts/LoadingFallbackContext';\n\nexport interface AlpModuleProps {\n  children: ReactNode;\n}\n\nfunction AlpModuleNode(props: AlpModuleProps): ReactElement {\n  return <>{props.children}</>;\n}\n\nfunction AlpModuleBrowser(props: AlpModuleProps): ReactElement {\n  const loadingFallback = useContext(LoadingFallbackContext);\n  return <Suspense fallback={loadingFallback}>{props.children}</Suspense>;\n}\n\nexport default POB_TARGET === 'node' ? AlpModuleNode : AlpModuleBrowser;\n","import { POB_TARGET } from 'pob-babel';\nimport React, { Suspense, ReactNode, useContext } from 'react';\nimport LoadingFallbackContext from '../contexts/LoadingFallbackContext';\n\ninterface SuspenseWrapperProps {\n  children: ReactNode;\n}\n\nfunction NodeSuspenseWrapper({ children }: SuspenseWrapperProps) {\n  return children;\n}\n\nfunction BrowserSuspenseWrapper({ children }: SuspenseWrapperProps) {\n  const loader = useContext(LoadingFallbackContext);\n  return <Suspense fallback={loader}>{children}</Suspense>;\n}\n\nexport default POB_TARGET === 'node'\n  ? NodeSuspenseWrapper\n  : BrowserSuspenseWrapper;\n","import React, { ReactElement, ReactNode } from 'react';\n\nexport interface BodyProps {\n  children: ReactNode;\n}\n\nexport default function Body({ children }: BodyProps): ReactElement<'div'> {\n  return <div>{children}</div>;\n}\n","import React, { ReactElement } from 'react';\n\nexport interface AppContainerProps {\n  children: React.ReactNode;\n}\n\nexport default function AppContainer({\n  children,\n}: AppContainerProps): ReactElement {\n  return <>{children}</>;\n}\n","import contentLoaded from 'content-loaded';\nimport React, { ElementType } from 'react';\nimport { hydrate } from 'react-dom';\nimport Logger from 'nightingale-logger';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport { BrowserApplication } from 'alp-types';\nimport createAlpAppWrapper from './createAlpAppWrapper';\n\nexport { default as Helmet } from 'react-helmet';\nexport { default as AlpModule } from './module/AlpModule';\nexport { default as SuspenseWrapper } from './module/SuspenseWrapper';\nexport { default as Body } from './layout/Body';\nexport { default as AppContainer } from './layout/AppContainer';\nexport { default as LoadingFallbackContext } from './contexts/LoadingFallbackContext';\n\nconst logger = new Logger('alp:react');\n\ndeclare global {\n  interface Window {\n    __INITIAL_DATA__: any;\n  }\n}\n\nexport default function alpReactBrowser(app: BrowserApplication) {\n  return async function renderApp(App: ElementType<{}>) {\n    // eslint-disable-next-line no-underscore-dangle\n    const initialData = window.__INITIAL_DATA__ || {};\n    const ctx = app.createContext();\n    if (initialData.sanitizedState) {\n      ctx.sanitizedState = initialData.sanitizedState;\n    }\n\n    logger.success('render called');\n    const WrappedApp = createAlpAppWrapper(React.createElement(App), ctx);\n    const appElement = React.createElement(WrappedApp);\n\n    await contentLoaded();\n    // const container =\n    hydrate(appElement, document.getElementById('react-app'));\n    logger.success('rendered');\n\n    // container.updateSanitizedState({ loading: false });\n  };\n}\n"],"names":["createAlpAppWrapper","app","context","state","error","appState","sanitizedState","componentDidCatch","errorInfo","console","window","Raven","captureException","extra","render","React","Component","createContext","AlpModuleBrowser","props","loadingFallback","useContext","LoadingFallbackContext","Suspense","children","BrowserSuspenseWrapper","loader","Body","AppContainer","logger","Logger","alpReactBrowser","App","initialData","__INITIAL_DATA__","ctx","success","WrappedApp","createElement","appElement","contentLoaded","hydrate","document","getElementById","renderApp"],"mappings":"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"}