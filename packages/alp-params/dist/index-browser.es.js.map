{"version":3,"file":"index-browser.es.js","sources":["../src/ParamValueValidator.ts","../src/ParamValueStringValidator.ts","../src/ParamValidator.ts","../src/ParamValidatorValid.ts","../src/index.ts"],"sourcesContent":["import type { ParamValidator } from './ParamValidator';\n\nexport default class ParamValueValidator<T> {\n  readonly validator: ParamValidator;\n\n  readonly name: string;\n\n  readonly value: T;\n\n  constructor(validator: ParamValidator, name: string, value: T) {\n    this.validator = validator;\n    this.name = name;\n    this.value = value;\n  }\n\n  _error(key: string): void {\n    this.validator._error(this.name, key, this.value);\n  }\n}\n","import ParamValueValidator from './ParamValueValidator';\n\nexport default class ParamValueStringValidator<\n  T extends string = string,\n> extends ParamValueValidator<T | undefined | null> {\n  notEmpty(): ParamValueValidator<T> {\n    if (this.value == null || this.value.trim() === '') {\n      this._error('notEmpty');\n    }\n\n    return this as ParamValueValidator<T>;\n  }\n}\n","import type { Context } from 'alp-types';\nimport ParamValueStringValidator from './ParamValueStringValidator';\n\nexport type Errors = Record<string, any>;\n\nexport class ParamValidator {\n  context: Context;\n\n  _errors?: Errors;\n\n  constructor(context: Context) {\n    this.context = context;\n  }\n\n  _error(name: string, key: string, value: unknown): void {\n    if (!this._errors) {\n      this._errors = {};\n    }\n\n    this._errors[name] = { error: key, value };\n  }\n\n  getErrors(): Errors | undefined {\n    return this._errors;\n  }\n\n  hasErrors(): boolean {\n    return this._errors !== undefined;\n  }\n\n  isValid(): boolean {\n    return this._errors === undefined;\n  }\n\n  string(name: string): ParamValueStringValidator {\n    return new ParamValueStringValidator(this, name, this.context.param(name));\n  }\n  /* int(name, position) {\n   return new ParamValueIntValidator(this, name, this.context.param(name, position));\n   }\n   model(modelName, name) {\n   name = name || S.string.lcFirst(modelName);\n   console.log('paramvalidator model', modelName, M[modelName]);\n   let data = this.context.getOrPostParam(name);\n   return new ParamValueModelValidator(this, name, !data ? null : new M[modelName](data));\n   } */\n}\n","import { ParamValidator } from './ParamValidator';\n\nexport default class ParamValidatorValid extends ParamValidator {\n  _error(): void {\n    this.context.throw(404, 'Invalid params', { validator: this });\n  }\n}\n","import type { Context, ApplicationInCreation } from 'alp-types';\nimport 'alp-router';\nimport { defineLazyProperty } from 'object-properties';\nimport { ParamValidator } from './ParamValidator';\nimport ParamValidatorValid from './ParamValidatorValid';\n\nexport { ParamValidator } from './ParamValidator';\n\ndeclare module 'alp-types' {\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  interface Context {\n    params: ParamValidator;\n    validParams: ParamValidator;\n    param: (name: string) => string | undefined;\n    namedParam: (name: string) => string | undefined;\n    otherParam: (position: number) => string | undefined;\n    paramGET: (name: string) => string | undefined;\n    paramGETorPOST: <T>(name: string) => T | undefined;\n  }\n}\n\nexport default function alpParams(app: ApplicationInCreation): void {\n  Object.assign(app.context, {\n    param(this: Context, name: string): string | undefined {\n      return this.namedParam(name) || this.paramGET(name);\n    },\n\n    namedParam(this: Context, name: string): string | undefined {\n      const namedParams = this.route.namedParams;\n      return namedParams?.get(name);\n    },\n\n    otherParam(this: Context, position: number): string | undefined {\n      const otherParams = this.route.otherParams;\n      return otherParams && otherParams[position - 1];\n    },\n\n    paramGET(this: Context, name: string): string | undefined {\n      const searchParams = this.request.searchParams;\n      return searchParams.get(name) ?? undefined;\n    },\n\n    paramGETorPOST<T>(this: Context, name: string): T | undefined {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-return\n      return this.body[name] !== undefined\n        ? // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          this.body[name]\n        : this.paramGET(name);\n    },\n  });\n\n  defineLazyProperty(\n    app.request,\n    'searchParams',\n    function (this: Context['request']): URLSearchParams {\n      return new URLSearchParams(this.search);\n    },\n  );\n\n  defineLazyProperty(\n    app.context,\n    'params',\n    function (this: Context): ParamValidator {\n      return new ParamValidator(this);\n    },\n  );\n\n  defineLazyProperty(\n    app.context,\n    'validParams',\n    function (this: Context): ParamValidatorValid {\n      return new ParamValidatorValid(this);\n    },\n  );\n}\n"],"names":["ParamValueValidator","validator","name","value","_proto","prototype","_error","key","ParamValueStringValidator","_ParamValueValidator","_inheritsLoose","apply","arguments","notEmpty","trim","ParamValidator","context","_errors","error","getErrors","hasErrors","undefined","isValid","string","param","ParamValidatorValid","_ParamValidator","throw","alpParams","app","Object","assign","namedParam","paramGET","namedParams","route","get","otherParam","position","otherParams","_searchParams$get","searchParams","request","paramGETorPOST","body","defineLazyProperty","URLSearchParams","search"],"mappings":"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"}