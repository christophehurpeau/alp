{"version":3,"file":"index-browser.es.js","sources":["../src/ParamValueValidator.ts","../src/ParamValueStringValidator.ts","../src/ParamValidator.ts","../src/ParamValidatorValid.ts","../src/index.ts"],"sourcesContent":["import type { ParamValidator } from './ParamValidator';\n\nexport default class ParamValueValidator<T> {\n  readonly validator: ParamValidator;\n\n  readonly name: string;\n\n  readonly value: T;\n\n  constructor(validator: ParamValidator, name: string, value: T) {\n    this.validator = validator;\n    this.name = name;\n    this.value = value;\n  }\n\n  _error(key: string): void {\n    this.validator._error(this.name, key, this.value);\n  }\n}\n","import ParamValueValidator from './ParamValueValidator';\n\nexport default class ParamValueStringValidator<\n  T extends string = string,\n> extends ParamValueValidator<T | undefined | null> {\n  notEmpty(): ParamValueValidator<T> {\n    if (this.value == null || this.value.trim() === '') {\n      this._error('notEmpty');\n    }\n\n    return this as ParamValueValidator<T>;\n  }\n}\n","import type { Context } from 'alp-types';\nimport ParamValueStringValidator from './ParamValueStringValidator';\n\nexport type Errors = Record<string, any>;\n\nexport class ParamValidator {\n  context: Context;\n\n  _errors?: Errors;\n\n  constructor(context: Context) {\n    this.context = context;\n  }\n\n  _error(name: string, key: string, value: unknown): void {\n    if (!this._errors) {\n      this._errors = {};\n    }\n\n    this._errors[name] = { error: key, value };\n  }\n\n  getErrors(): Errors | undefined {\n    return this._errors;\n  }\n\n  hasErrors(): boolean {\n    return this._errors !== undefined;\n  }\n\n  isValid(): boolean {\n    return this._errors === undefined;\n  }\n\n  string(name: string): ParamValueStringValidator {\n    return new ParamValueStringValidator(this, name, this.context.param(name));\n  }\n  /* int(name, position) {\n   return new ParamValueIntValidator(this, name, this.context.param(name, position));\n   }\n   model(modelName, name) {\n   name = name || S.string.lcFirst(modelName);\n   console.log('paramvalidator model', modelName, M[modelName]);\n   let data = this.context.getOrPostParam(name);\n   return new ParamValueModelValidator(this, name, !data ? null : new M[modelName](data));\n   } */\n}\n","import { ParamValidator } from './ParamValidator';\n\nexport default class ParamValidatorValid extends ParamValidator {\n  _error(): void {\n    this.context.throw(404, 'Invalid params', { validator: this });\n  }\n}\n","import type { Context, ApplicationInCreation } from 'alp-types';\nimport 'alp-router';\nimport { defineLazyProperty } from 'object-properties';\nimport { ParamValidator } from './ParamValidator';\nimport ParamValidatorValid from './ParamValidatorValid';\n\nexport { ParamValidator } from './ParamValidator';\n\ndeclare module 'alp-types' {\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  interface Context {\n    params: ParamValidator;\n    validParams: ParamValidator;\n    param: (name: string) => string | undefined;\n    namedParam: (name: string) => string | undefined;\n    otherParam: (position: number) => string | undefined;\n    paramGET: (name: string) => string | undefined;\n    paramGETorPOST: <T>(name: string) => T | undefined;\n  }\n}\n\nexport default function alpParams(app: ApplicationInCreation): void {\n  Object.assign(app.context, {\n    param(this: Context, name: string): string | undefined {\n      return this.namedParam(name) || this.paramGET(name);\n    },\n\n    namedParam(this: Context, name: string): string | undefined {\n      const namedParams = this.route.namedParams;\n      return namedParams?.get(name);\n    },\n\n    otherParam(this: Context, position: number): string | undefined {\n      const otherParams = this.route.otherParams;\n      return otherParams && otherParams[position - 1];\n    },\n\n    paramGET(this: Context, name: string): string | undefined {\n      const searchParams = this.request.searchParams;\n      return searchParams.get(name) ?? undefined;\n    },\n\n    paramGETorPOST<T>(this: Context, name: string): T | undefined {\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-return\n      return this.body[name] !== undefined\n        ? // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n          this.body[name]\n        : this.paramGET(name);\n    },\n  });\n\n  defineLazyProperty(\n    app.request,\n    'searchParams',\n    function (this: Context['request']): URLSearchParams {\n      return new URLSearchParams(this.search);\n    },\n  );\n\n  defineLazyProperty(\n    app.context,\n    'params',\n    function (this: Context): ParamValidator {\n      return new ParamValidator(this);\n    },\n  );\n\n  defineLazyProperty(\n    app.context,\n    'validParams',\n    function (this: Context): ParamValidatorValid {\n      return new ParamValidatorValid(this);\n    },\n  );\n}\n"],"names":["ParamValueValidator","validator","name","value","_error","key","ParamValueStringValidator","notEmpty","trim","ParamValidator","context","_errors","error","getErrors","hasErrors","undefined","isValid","string","param","ParamValidatorValid","alpParams","app","Object","assign","namedParam","paramGET","namedParams","route","get","otherParam","position","otherParams","searchParams","request","paramGETorPOST","body","defineLazyProperty","URLSearchParams","search"],"mappings":"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"}