{"version":3,"file":"index-browser.cjs.js","sources":["../src/ParamValueValidator.ts","../src/ParamValueStringValidator.ts","../src/ParamValidator.ts","../src/ParamValidatorValid.ts","../src/index.ts"],"sourcesContent":["import ParamValidator from './ParamValidator';\n\nexport default class ParamValueValidator {\n  validator: ParamValidator;\n\n  name: string;\n\n  value: any;\n\n  constructor(validator: ParamValidator, name: string, value: any) {\n    this.validator = validator;\n    this.name = name;\n    this.value = value;\n  }\n\n  _error(key: string) {\n    this.validator._error(this.name, key, this.value);\n  }\n}\n","import ParamValueValidator from './ParamValueValidator';\n\nexport default class ParamValueStringValidator extends ParamValueValidator {\n  notEmpty(): this {\n    if (this.value == null || this.value.trim() === '') {\n      this._error('notEmpty');\n    }\n\n    return this;\n  }\n}\n","import { Context } from 'alp-types';\nimport ParamValueStringValidator from './ParamValueStringValidator';\n\nexport interface Errors {\n  [key: string]: any;\n}\n\nexport default class ParamValidator {\n  context: Context;\n\n  _errors?: Errors;\n\n  constructor(context: Context) {\n    this.context = context;\n  }\n\n  _error(name: string, key: string, value: any): void {\n    if (!this._errors) {\n      this._errors = {};\n    }\n\n    this._errors[name] = { error: key, value };\n  }\n\n  getErrors(): Errors | undefined {\n    return this._errors;\n  }\n\n  hasErrors(): boolean {\n    return this._errors !== undefined;\n  }\n\n  isValid(): boolean {\n    return this._errors === undefined;\n  }\n\n  string(name: string): ParamValueStringValidator {\n    return new ParamValueStringValidator(this, name, this.context.param(name));\n  }\n  /* int(name, position) {\n   return new ParamValueIntValidator(this, name, this.context.param(name, position));\n   }\n   model(modelName, name) {\n   name = name || S.string.lcFirst(modelName);\n   console.log('paramvalidator model', modelName, M[modelName]);\n   let data = this.context.getOrPostParam(name);\n   return new ParamValueModelValidator(this, name, !data ? null : new M[modelName](data));\n   } */\n}\n","import ParamValidator from './ParamValidator';\n\nexport default class ParamValidatorValid extends ParamValidator {\n  _error(): void {\n    this.context.throw(404, 'Invalid params', { validator: this });\n  }\n}\n","import { defineLazyProperty } from 'object-properties';\nimport { Context, NodeApplicationInCreation } from 'alp-types';\nimport ParamValidator from './ParamValidator';\nimport ParamValidatorValid from './ParamValidatorValid';\n\nexport { ParamValidator };\n\nexport default function alpParams(app: NodeApplicationInCreation) {\n  Object.assign(app.context, {\n    param(name: string): string | undefined {\n      return this.namedParam(name) || this.paramGET(name);\n    },\n\n    namedParam(this: Context, name: string): string | undefined {\n      const namedParams = this.route.namedParams;\n      return namedParams && namedParams.get(name);\n    },\n\n    otherParam(this: Context, position: number): string | undefined {\n      const otherParams = this.route.otherParams;\n      return otherParams && otherParams[position - 1];\n    },\n\n    paramGET(this: Context, name: string): string | undefined {\n      const query = this.query;\n      return query && query[name];\n    },\n\n    paramGETorPOST(this: Context, name: string): any | undefined {\n      return this.body[name] !== undefined ? this.body[name] : this.query[name];\n    },\n  });\n\n  defineLazyProperty(app.context, 'params', function(\n    this: Context,\n  ): ParamValidator {\n    return new ParamValidator(this);\n  });\n\n  defineLazyProperty(app.context, 'validParams', function(\n    this: Context,\n  ): ParamValidatorValid {\n    return new ParamValidatorValid(this);\n  });\n}\n"],"names":["ParamValueValidator","validator","name","value","_error","key","ParamValueStringValidator","notEmpty","trim","ParamValidator","context","_errors","error","getErrors","hasErrors","undefined","isValid","string","param","ParamValidatorValid","throw","alpParams","app","Object","assign","namedParam","paramGET","namedParams","route","get","otherParam","position","otherParams","query","paramGETorPOST","body","defineLazyProperty"],"mappings":";;;;;;;;;;;;IAEqBA;;;+BAOPC,SAAZ,EAAuCC,IAAvC,EAAqDC,KAArD,EAAiE;SAC1DF,SAAL,GAAiBA,SAAjB;SACKC,IAAL,GAAYA,IAAZ;SACKC,KAAL,GAAaA,KAAb;;;;;SAGFC,SAAA,gBAAOC,GAAP,EAAoB;SACbJ,SAAL,CAAeG,MAAf,CAAsB,KAAKF,IAA3B,EAAiCG,GAAjC,EAAsC,KAAKF,KAA3C;;;;;;ICdiBG;;;;;;;;;;;SACnBC,WAAA,oBAAiB;QACX,KAAKJ,KAAL,IAAc,IAAd,IAAsB,KAAKA,KAAL,CAAWK,IAAX,OAAsB,EAAhD,EAAoD;WAC7CJ,MAAL,CAAY,UAAZ;;;WAGK,IAAP;;;;EANmDJ;;ICKlCS;;;0BAKPC,OAAZ,EAA8B;SACvBA,OAAL,GAAeA,OAAf;;;;;SAGFN,SAAA,gBAAOF,IAAP,EAAqBG,GAArB,EAAkCF,KAAlC,EAAoD;QAC9C,CAAC,KAAKQ,OAAV,EAAmB;WACZA,OAAL,GAAe,EAAf;;;SAGGA,OAAL,CAAaT,IAAb,IAAqB;MAAEU,KAAK,EAAEP,GAAT;MAAcF,KAAK,EAALA;KAAnC;;;SAGFU,YAAA,qBAAgC;WACvB,KAAKF,OAAZ;;;SAGFG,YAAA,qBAAqB;WACZ,KAAKH,OAAL,KAAiBI,SAAxB;;;SAGFC,UAAA,mBAAmB;WACV,KAAKL,OAAL,KAAiBI,SAAxB;;;SAGFE,SAAA,gBAAOf,IAAP,EAAgD;WACvC,IAAII,yBAAJ,CAA8B,IAA9B,EAAoCJ,IAApC,EAA0C,KAAKQ,OAAL,CAAaQ,KAAb,CAAmBhB,IAAnB,CAA1C,CAAP;;;;;;;;;;;;;;;;ICnCiBiB;;;;;;;;;;;SACnBf,SAAA,kBAAe;SACRM,OAAL,CAAaU,KAAb,CAAmB,GAAnB,EAAwB,gBAAxB,EAA0C;MAAEnB,SAAS,EAAE;KAAvD;;;;EAF6CQ;;ACKlC,SAASY,SAAT,CAAmBC,GAAnB,EAAmD;EAChEC,MAAM,CAACC,MAAP,CAAcF,GAAG,CAACZ,OAAlB,EAA2B;IACzBQ,KADyB,iBACnBhB,IADmB,EACe;aAC/B,KAAKuB,UAAL,CAAgBvB,IAAhB,KAAyB,KAAKwB,QAAL,CAAcxB,IAAd,CAAhC;KAFuB;IAKzBuB,UALyB,sBAKCvB,IALD,EAKmC;UACpDyB,WAAW,GAAG,KAAKC,KAAL,CAAWD,WAA/B;aACOA,WAAW,IAAIA,WAAW,CAACE,GAAZ,CAAgB3B,IAAhB,CAAtB;KAPuB;IAUzB4B,UAVyB,sBAUCC,QAVD,EAUuC;UACxDC,WAAW,GAAG,KAAKJ,KAAL,CAAWI,WAA/B;aACOA,WAAW,IAAIA,WAAW,CAACD,QAAQ,GAAG,CAAZ,CAAjC;KAZuB;IAezBL,QAfyB,oBAeDxB,IAfC,EAeiC;UAClD+B,KAAK,GAAG,KAAKA,KAAnB;aACOA,KAAK,IAAIA,KAAK,CAAC/B,IAAD,CAArB;KAjBuB;IAoBzBgC,cApByB,0BAoBKhC,IApBL,EAoBoC;aACpD,KAAKiC,IAAL,CAAUjC,IAAV,MAAoBa,SAApB,GAAgC,KAAKoB,IAAL,CAAUjC,IAAV,CAAhC,GAAkD,KAAK+B,KAAL,CAAW/B,IAAX,CAAzD;;GArBJ;EAyBAkC,mCAAkB,CAACd,GAAG,CAACZ,OAAL,EAAc,QAAd,EAAwB,YAExB;WACT,IAAID,cAAJ,CAAmB,IAAnB,CAAP;GAHgB,CAAlB;EAMA2B,mCAAkB,CAACd,GAAG,CAACZ,OAAL,EAAc,aAAd,EAA6B,YAExB;WACd,IAAIS,mBAAJ,CAAwB,IAAxB,CAAP;GAHgB,CAAlB;;;;;;"}