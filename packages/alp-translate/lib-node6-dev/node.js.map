{"version":3,"sources":["../src/node.js"],"names":["alpTranslate","logger","dirname","replace","app","Object","assign","context","t","key","args","msg","translations","get","language","warn","format","Map","config","forEach","loadConfigSync","set"],"mappings":";;;;;kBAKwBA,Y;;;;;;AALxB;;;;AACA;;;;;;AAEA,MAAMC,SAAS,gCAAW,eAAX,CAAf;;AAEe,SAASD,YAAT,CAAsBE,OAAtB,EAA+B;AAC5CA,YAAUA,QAAQC,OAAR,CAAgB,MAAhB,EAAwB,GAAxB,CAAV;AACA,SAAOC,OAAO;AACZC,WAAOC,MAAP,CAAcF,IAAIG,OAAlB,EAA2B;AACzBC,QAAEC,GAAF,EAAeC,IAAf,EAAsC;AAAA,gBAApCD,GAAoC;;AAAA,gBAAvBC,IAAuB;;AAAA;AACpC,gBAAMC,MAAMP,IAAIQ,YAAJ,CAAiBC,GAAjB,CAAqB,KAAKC,QAA1B,EAAoCD,GAApC,CAAwCJ,GAAxC,CAAZ;AACA,cAAI,CAACE,GAAL,EAAU;AACRV,mBAAOc,IAAP,CAAY,aAAZ,EAA2B,EAAED,UAAU,KAAKA,QAAjB,EAA2BL,GAA3B,EAA3B;AACA,mBAAOA,GAAP;AACD;;AAED,iBAAOE,IAAIK,MAAJ,CAAWN,IAAX,CAAP;AAPoC;AAQrC;AATwB,KAA3B;;AAYAN,QAAIQ,YAAJ,GAAmB,IAAIK,GAAJ,EAAnB;AACAb,QAAIc,MAAJ,CAAWL,GAAX,CAAe,oBAAf,EAAqCM,OAArC,CAA6CL,YAAY;AACvD,YAAMF,eAAeR,IAAIc,MAAJ,CAAWE,cAAX,CAA0BlB,UAAUY,QAApC,CAArB;AACAV,UAAIQ,YAAJ,CAAiBS,GAAjB,CAAqBP,QAArB,EAA+B,oBAAKF,YAAL,EAAmBE,QAAnB,CAA/B;AACD,KAHD;AAID,GAlBD;AAmBD","file":"node.js","sourcesContent":["import Logger from 'nightingale-logger';\nimport load from './load';\n\nconst logger = new Logger('alp.translate');\n\nexport default function alpTranslate(dirname) {\n  dirname = dirname.replace(/\\/*$/, '/');\n  return app => {\n    Object.assign(app.context, {\n      t(key: string, args: ?Object): string {\n        const msg = app.translations.get(this.language).get(key);\n        if (!msg) {\n          logger.warn('invalid msg', { language: this.language, key });\n          return key;\n        }\n\n        return msg.format(args);\n      },\n    });\n\n    app.translations = new Map();\n    app.config.get('availableLanguages').forEach(language => {\n      const translations = app.config.loadConfigSync(dirname + language);\n      app.translations.set(language, load(translations, language));\n    });\n  };\n}\n"]}