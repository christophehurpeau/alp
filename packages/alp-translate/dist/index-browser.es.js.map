{"version":3,"file":"index-browser.es.js","sources":["../src/load.ts","../src/browser.ts"],"sourcesContent":["import IntlMessageFormatDefault from 'intl-messageformat';\n\n// eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\nconst IntlMessageFormat: typeof IntlMessageFormatDefault =\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  (IntlMessageFormatDefault as any).default || IntlMessageFormatDefault;\n\nexport type Translations = ReadonlyMap<string, IntlMessageFormatDefault>;\n\nexport default function load(\n  translations: ReadonlyMap<string, unknown>,\n  language: string,\n): Translations {\n  const result = new Map();\n\n  (function loadMap(map, prefix) {\n    map.forEach((value: any, key) => {\n      if (typeof value === 'object') {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        loadMap(value, `${prefix}${key}.`);\n        return;\n      }\n\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      result.set(`${prefix}${key}`, new IntlMessageFormat(value, language));\n    });\n  })(translations, '');\n\n  return result;\n}\n","import type { BrowserApplicationInCreation, Context } from 'alp-types';\nimport load from './load';\n\ntype Args = Record<string, any>;\n\ndeclare module 'alp-types' {\n  interface BaseContext {\n    language: string;\n    t: (id: string, args: Args) => string;\n  }\n  // eslint-disable-next-line @typescript-eslint/no-shadow,  @typescript-eslint/no-empty-interface\n  interface Context {}\n}\n\nexport default function alpTranslate(\n  dirname: string,\n): (app: BrowserApplicationInCreation) => Promise<void> {\n  dirname = dirname.replace(/\\/*$/, '/');\n  return async (app: BrowserApplicationInCreation): Promise<void> => {\n    const language = app.context.language;\n\n    const map = await app.loadConfig(dirname + language);\n    const translations = load(map, language);\n\n    Object.assign(app.context, {\n      t(this: Context, key: string, args?: Record<string, any>): string {\n        const msg = translations.get(key);\n        if (!msg) return key;\n        return msg.format(args) as string;\n      },\n    });\n  };\n}\n"],"names":["IntlMessageFormat","IntlMessageFormatDefault","default","load","translations","language","result","Map","loadMap","map","prefix","forEach","value","key","set","alpTranslate","dirname","replace","_ref","_asyncToGenerator","_regeneratorRuntime","mark","_callee","app","wrap","_callee$","_context","prev","next","context","loadConfig","sent","Object","assign","t","args","msg","get","format","stop","apply","arguments"],"mappings":";;;;AAEA;AACA,IAAMA,iBAAkD;AACtD;AACCC,wBAAwB,CAASC,OAAO,IAAID,wBAAwB,CAAA;AAIxD,SAASE,IAAIA,CAC1BC,YAA0C,EAC1CC,QAAgB,EACF;AACd,EAAA,IAAMC,MAAM,GAAG,IAAIC,GAAG,EAAE,CAAA;AAExB,EAAA,CAAC,SAASC,OAAOA,CAACC,GAAG,EAAEC,MAAM,EAAE;AAC7BD,IAAAA,GAAG,CAACE,OAAO,CAAC,UAACC,KAAU,EAAEC,GAAG,EAAK;AAC/B,MAAA,IAAI,OAAOD,KAAK,KAAK,QAAQ,EAAE;AAC7B;AACAJ,QAAAA,OAAO,CAACI,KAAK,EAAA,EAAA,GAAKF,MAAM,GAAGG,GAAG,MAAG,CAAC,CAAA;AAClC,QAAA,OAAA;AACF,OAAA;;AAEA;AACAP,MAAAA,MAAM,CAACQ,GAAG,CAAIJ,EAAAA,GAAAA,MAAM,GAAGG,GAAG,EAAI,IAAIb,iBAAiB,CAACY,KAAK,EAAEP,QAAQ,CAAC,CAAC,CAAA;AACvE,KAAC,CAAC,CAAA;AACJ,GAAC,EAAED,YAAY,EAAE,EAAE,CAAC,CAAA;AAEpB,EAAA,OAAOE,MAAM,CAAA;AACf;;ACfe,SAASS,YAAYA,CAClCC,OAAe,EACuC;EACtDA,OAAO,GAAGA,OAAO,CAACC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;AACtC,EAAA,oBAAA,YAAA;IAAA,IAAAC,IAAA,GAAAC,iBAAA,eAAAC,mBAAA,CAAAC,IAAA,CAAO,SAAAC,OAAAA,CAAOC,GAAiC,EAAA;AAAA,MAAA,IAAAlB,QAAA,EAAAI,GAAA,EAAAL,YAAA,CAAA;AAAA,MAAA,OAAAgB,mBAAA,CAAAI,IAAA,CAAA,SAAAC,SAAAC,QAAA,EAAA;AAAA,QAAA,OAAA,CAAA,EAAA,QAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;AAAA,UAAA,KAAA,CAAA;AACvCvB,YAAAA,QAAQ,GAAGkB,GAAG,CAACM,OAAO,CAACxB,QAAQ,CAAA;AAAAqB,YAAAA,QAAA,CAAAE,IAAA,GAAA,CAAA,CAAA;AAAA,YAAA,OAEnBL,GAAG,CAACO,UAAU,CAACd,OAAO,GAAGX,QAAQ,CAAC,CAAA;AAAA,UAAA,KAAA,CAAA;YAA9CI,GAAG,GAAAiB,QAAA,CAAAK,IAAA,CAAA;AACH3B,YAAAA,YAAY,GAAGD,IAAI,CAACM,GAAG,EAAEJ,QAAQ,CAAC,CAAA;AAExC2B,YAAAA,MAAM,CAACC,MAAM,CAACV,GAAG,CAACM,OAAO,EAAE;AACzBK,cAAAA,CAAC,EAAAA,SAAAA,CAAAA,CAAgBrB,GAAW,EAAEsB,IAA0B,EAAU;AAChE,gBAAA,IAAMC,GAAG,GAAGhC,YAAY,CAACiC,GAAG,CAACxB,GAAG,CAAC,CAAA;AACjC,gBAAA,IAAI,CAACuB,GAAG,EAAE,OAAOvB,GAAG,CAAA;AACpB,gBAAA,OAAOuB,GAAG,CAACE,MAAM,CAACH,IAAI,CAAC,CAAA;AACzB,eAAA;AACF,aAAC,CAAC,CAAA;AAAC,UAAA,KAAA,CAAA,CAAA;AAAA,UAAA,KAAA,KAAA;YAAA,OAAAT,QAAA,CAAAa,IAAA,EAAA,CAAA;AAAA,SAAA;AAAA,OAAA,EAAAjB,OAAA,CAAA,CAAA;KACJ,CAAA,CAAA,CAAA;AAAA,IAAA,OAAA,YAAA;AAAA,MAAA,OAAAJ,IAAA,CAAAsB,KAAA,CAAA,IAAA,EAAAC,SAAA,CAAA,CAAA;AAAA,KAAA,CAAA;AAAA,GAAA,EAAA,CAAA;AACH;;;;"}