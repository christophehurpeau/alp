{"version":3,"file":"index-node8-dev.cjs.js","sources":["../src/load.js","../src/index.js"],"sourcesContent":["import IntlMessageFormat from 'intl-messageformat';\n\nexport default function load(\n  translations: Map<string, any>,\n  language: string,\n): Map<string, IntlMessageFormat> {\n  const result = new Map();\n\n  (function loadMap(map, prefix) {\n    map.forEach((value, key) => {\n      if (typeof value === 'object') {\n        return loadMap(value, `${prefix}${key}.`);\n      }\n\n      result.set(`${prefix}${key}`, new IntlMessageFormat(value, language));\n    });\n  })(translations, '');\n\n  return result;\n}\n","import Logger from 'nightingale-logger/src';\nimport load from './load';\n\nconst logger = new Logger('alp:translate');\n\nexport default function alpTranslate(dirname: string) {\n  dirname = dirname.replace(/\\/*$/, '/');\n  return app => {\n    Object.assign(app.context, {\n      t(key: string, args: ?Object): string {\n        const msg = app.translations.get(this.language).get(key);\n        if (!msg) {\n          logger.warn('invalid msg', { language: this.language, key });\n          return key;\n        }\n\n        return msg.format(args);\n      },\n    });\n\n    app.translations = new Map();\n    app.config.get('availableLanguages').forEach((language: string) => {\n      const translations = app.config.loadConfigSync(dirname + language);\n      app.translations.set(language, load(translations, language));\n    });\n  };\n}\n"],"names":["load","translations","language","t","result","Map","loadMap","map","prefix","forEach","value","key","set","IntlMessageFormat","logger","Logger","alpTranslate","dirname","replace","app","assign","context","args","msg","get","warn","format","config","loadConfigSync"],"mappings":";;;;;;;;AAEe,SAASA,IAAT,CACbC,YADa,EAEbC,QAFa,EAGmB;0BAFpBC,cAAMA,WAAN,EAAcA,QAAd,CAEoB;;sBADxBA,WACwB;;gCAA/BA,cAAIA,WAAJ,EAAYA,yBAAZ,CAA+B;;;;;QAC1BC,SAAS,IAAIC,GAAJ,EAAf;;GAEC,SAASC,OAAT,CAAiBC,GAAjB,EAAsBC,MAAtB,EAA8B;QACzBC,OAAJ,CAAY,CAACC,KAAD,EAAQC,GAAR,KAAgB;UACtB,OAAOD,KAAP,KAAiB,QAArB,EAA+B;eACtBJ,QAAQI,KAAR,EAAgB,GAAEF,MAAO,GAAEG,GAAI,GAA/B,CAAP;;;aAGKC,GAAP,CAAY,GAAEJ,MAAO,GAAEG,GAAI,EAA3B,EAA8B,IAAIE,iBAAJ,CAAsBH,KAAtB,EAA6BR,QAA7B,CAA9B;KALF;GADF,EAQGD,YARH,EAQiB,EARjB;;4BAUOG,MAAP;;;ACfF,MAAMU,SAAS,IAAIC,MAAJ,CAAW,eAAX,CAAf;;AAEA,AAAe,SAASC,YAAT,CAAsBC,OAAtB,EAAuC;qBAAV,WAAU;;;;gCAC1CA,QAAQC,OAAR,CAAgB,MAAhB,EAAwB,GAAxB,CAAV;SACOC,OAAO;WACLC,MAAP,CAAcD,IAAIE,OAAlB,EAA2B;QACvBV,GAAF,EAAeW,IAAf,EAAsC;uBAAjC,WAAiC;;wBAAnB,YAAG,WAAH,CAAmB;;sCAAP,WAAO;;;;;;cAC9BC,MAAMJ,IAAIlB,YAAJ,CAAiBuB,GAAjB,CAAqB,KAAKtB,QAA1B,EAAoCsB,GAApC,CAAwCb,GAAxC,CAAZ;YACI,CAACY,GAAL,EAAU;iBACDE,IAAP,CAAY,aAAZ,EAA2B,EAAEvB,UAAU,KAAKA,QAAjB,EAA2BS,GAA3B,EAA3B;oCACOA,GAAP;;;kCAGKY,IAAIG,MAAJ,CAAWJ,IAAX,CAAP;;KARJ;;QAYIrB,YAAJ,GAAmB,IAAII,GAAJ,EAAnB;QACIsB,MAAJ,CAAWH,GAAX,CAAe,oBAAf,EAAqCf,OAArC,CAA8CP,QAAD,IAAsB;0BAAb,WAAa;;;;YAC3DD,eAAekB,IAAIQ,MAAJ,CAAWC,cAAX,CAA0BX,UAAUf,QAApC,CAArB;UACID,YAAJ,CAAiBW,GAAjB,CAAqBV,QAArB,EAA+BF,KAAKC,YAAL,EAAmBC,QAAnB,CAA/B;KAFF;GAdF;;;;;"}