{"version":3,"sources":["../src/index.js"],"names":["Logger","load","logger","alpTranslate","dirname","replace","Object","assign","app","context","t","key","args","msg","translations","get","language","format","warn","Map","config","forEach","loadConfigSync","set"],"mappings":"AAAA,OAAOA,MAAP;AACA,OAAOC,IAAP,MAAiB,QAAjB;;;AAEA,MAAMC,SAAS,IAAIF,MAAJ,CAAW,eAAX,CAAf;;AAEA,eAAe,SAASG,YAAT,CAAsBC,OAAtB,EAAuC;AAAA,qBAAV,WAAU;;AAEpD,4DADAA,8BAAUA,QAAQC,OAAR,CAAgB,MAAhB,EAAwB,GAAxB,CAAV,CACA,EAAO,eAAO;AACZC,WAAOC,MAAP,CAAcC,IAAIC,OAAlB,EAA2B;AACzBC,QAAEC,GAAF,EAAeC,IAAf,EAAsC;AAAA,uBAAjC,WAAiC;;AAAA,wBAAnB,YAAG,WAAH,CAAmB;;AAAA,sCAAP,WAAO;;AAAA;;AACpC,cAAMC,MAAML,IAAIM,YAAJ,CAAiBC,GAAjB,CAAqB,KAAKC,QAA1B,EAAoCD,GAApC,CAAwCJ,GAAxC,CAAZ;AADoC,eAE/BE,GAF+B,sBAO7BA,IAAII,MAAJ,CAAWL,IAAX,CAP6B,KAGlCV,OAAOgB,IAAP,CAAY,aAAZ,EAA2B,EAAEF,UAAU,KAAKA,QAAjB,EAA2BL,GAA3B,EAA3B,CAHkC,qBAI3BA,GAJ2B;AAQrC;AATwB,KAA3B,CADY,EAaZH,IAAIM,YAAJ,GAAmB,IAAIK,GAAJ,EAbP,EAcZX,IAAIY,MAAJ,CAAWL,GAAX,CAAe,oBAAf,EAAqCM,OAArC,CAA6C,oBAAY;AACvD,YAAMP,eAAeN,IAAIY,MAAJ,CAAWE,cAAX,CAA0BlB,UAAUY,QAApC,CAArB;AACAR,UAAIM,YAAJ,CAAiBS,GAAjB,CAAqBP,QAArB,EAA+Bf,KAAKa,YAAL,EAAmBE,QAAnB,CAA/B,CAFuD;AAGxD,KAHD,CAdY;AAkBb,GAlBD;AAmBD","file":"index.js","sourcesContent":["import Logger from 'nightingale-logger/src';\nimport load from './load';\n\nconst logger = new Logger('alp:translate');\n\nexport default function alpTranslate(dirname: string) {\n  dirname = dirname.replace(/\\/*$/, '/');\n  return app => {\n    Object.assign(app.context, {\n      t(key: string, args: ?Object): string {\n        const msg = app.translations.get(this.language).get(key);\n        if (!msg) {\n          logger.warn('invalid msg', { language: this.language, key });\n          return key;\n        }\n\n        return msg.format(args);\n      },\n    });\n\n    app.translations = new Map();\n    app.config.get('availableLanguages').forEach(language => {\n      const translations = app.config.loadConfigSync(dirname + language);\n      app.translations.set(language, load(translations, language));\n    });\n  };\n}\n"]}