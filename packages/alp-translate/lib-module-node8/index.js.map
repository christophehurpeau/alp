{"version":3,"sources":["../src/index.js"],"names":["Logger","load","logger","alpTranslate","dirname","replace","app","Object","assign","context","t","key","args","msg","translations","get","language","format","warn","Map","config","forEach","loadConfigSync","set"],"mappings":"AAAA,OAAOA,MAAP;AACA,OAAOC,IAAP,MAAiB,QAAjB;;AAEA,MAAMC,SAAS,IAAIF,MAAJ,CAAW,eAAX,CAAf;;AAEA,eAAe,SAASG,YAAT,CAAsBC,OAAtB,EAAuC;AAEpD,SADAA,UAAUA,QAAQC,OAAR,CAAgB,MAAhB,EAAwB,GAAxB,CACV,EAAOC,OAAO;AACZC,WAAOC,MAAP,CAAcF,IAAIG,OAAlB,EAA2B;AACzBC,QAAEC,GAAF,EAAeC,IAAf,EAAsC;AACpC,cAAMC,MAAMP,IAAIQ,YAAJ,CAAiBC,GAAjB,CAAqB,KAAKC,QAA1B,EAAoCD,GAApC,CAAwCJ,GAAxC,CAAZ;AADoC,eAE/BE,GAF+B,GAO7BA,IAAII,MAAJ,CAAWL,IAAX,CAP6B,IAGlCV,OAAOgB,IAAP,CAAY,aAAZ,EAA2B,EAAEF,UAAU,KAAKA,QAAjB,EAA2BL,GAA3B,EAA3B,CAHkC,EAI3BA,GAJ2B;AAQrC;AATwB,KAA3B,CADY,EAaZL,IAAIQ,YAAJ,GAAmB,IAAIK,GAAJ,EAbP,EAcZb,IAAIc,MAAJ,CAAWL,GAAX,CAAe,oBAAf,EAAqCM,OAArC,CAA6CL,YAAY;AACvD,YAAMF,eAAeR,IAAIc,MAAJ,CAAWE,cAAX,CAA0BlB,UAAUY,QAApC,CAArB;AACAV,UAAIQ,YAAJ,CAAiBS,GAAjB,CAAqBP,QAArB,EAA+Bf,KAAKa,YAAL,EAAmBE,QAAnB,CAA/B,CAFuD;AAGxD,KAHD,CAdY;AAkBb,GAlBD;AAmBD","file":"index.js","sourcesContent":["import Logger from 'nightingale-logger/src';\nimport load from './load';\n\nconst logger = new Logger('alp:translate');\n\nexport default function alpTranslate(dirname: string) {\n  dirname = dirname.replace(/\\/*$/, '/');\n  return app => {\n    Object.assign(app.context, {\n      t(key: string, args: ?Object): string {\n        const msg = app.translations.get(this.language).get(key);\n        if (!msg) {\n          logger.warn('invalid msg', { language: this.language, key });\n          return key;\n        }\n\n        return msg.format(args);\n      },\n    });\n\n    app.translations = new Map();\n    app.config.get('availableLanguages').forEach(language => {\n      const translations = app.config.loadConfigSync(dirname + language);\n      app.translations.set(language, load(translations, language));\n    });\n  };\n}\n"]}