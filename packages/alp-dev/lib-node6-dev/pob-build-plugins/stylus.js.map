{"version":3,"sources":["../../src/pob-build-plugins/stylus.js"],"names":["module","exports","extension","destExtension","transform","content","src","relative","fileName","startsWith","Promise","resolve","reject","toString","set","comment","render","err","css","generateScopedName","getJSON","cssFileName","json","code","JSON","stringify","process","from","catch"],"mappings":";;AAAA;;AACA;;;;AACA;;;;AACA;;;;;;AAEAA,OAAOC,OAAP,GAAiB;AACfC,aAAW,MADI;AAEf;AACAC,iBAAe,SAHA;;AAKfC,YAAUC,OAAV,QAAsC;AAAA,QAAjBC,GAAiB,QAAjBA,GAAiB;AAAA,QAAZC,QAAY,QAAZA,QAAY;;AACpC,UAAMC,WAAW,oBAASD,QAAT,CAAjB;AACA,QAAIC,SAASC,UAAT,CAAoB,GAApB,CAAJ,EAA8B;AAC9B,WAAO,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AACtC,4BAAOP,QAAQQ,QAAR,EAAP,EACGC,GADH,CACO,UADP,EACmBR,GADnB,EAEGQ,GAFH,CAEO,WAFP,EAEoB,EAAEC,SAAS,IAAX,EAFpB,EAGGC,MAHH,CAGU,CAACC,GAAD,EAAMC,GAAN,KAAc;AACpB,YAAID,GAAJ,EAAS,OAAOL,OAAOK,GAAP,CAAP;;AAET,+BAAQ,CACN,8BAAe;AACbE,8BAAoB,mCADP;AAEbC,kBAAQC,WAAR,EAAqBC,IAArB,EAA2B;AACzBX,oBAAQ,EAAEY,MAAO,qBAAmBC,KAAKC,SAAL,CAAeH,IAAf,CAAqB,GAAjD,EAAR;AACD;AAJY,SAAf,CADM,CAAR,EAOGI,OAPH,CAOWR,GAPX,EAOgB,EAAES,MAAMrB,GAAR,EAPhB,EAQGsB,KARH,CAQSX,OAAOL,OAAOK,GAAP,CARhB;AASD,OAfH;AAgBD,KAjBM,CAAP;AAkBD;AA1Bc,CAAjB;;AA8BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"stylus.js","sourcesContent":["import { basename } from 'path';\nimport stylus from 'stylus';\nimport postcss from 'postcss';\nimport postcssModules from 'postcss-modules';\n\nmodule.exports = {\n  extension: 'styl',\n  // destExtension: 'css',\n  destExtension: 'styl.js',\n\n  transform(content, { src, relative }) {\n    const fileName = basename(relative);\n    if (fileName.startsWith('_')) return;\n    return new Promise((resolve, reject) => {\n      stylus(content.toString())\n        .set('filename', src)\n        .set('sourcemap', { comment: true })\n        .render((err, css) => {\n          if (err) return reject(err);\n\n          postcss([\n            postcssModules({\n              generateScopedName: '[name]__[local]___[hash:base64:5]',\n              getJSON(cssFileName, json) {\n                resolve({ code: `module.exports = ${JSON.stringify(json)}` });\n              },\n            }),\n          ]).process(css, { from: src })\n            .catch(err => reject(err));\n        });\n    });\n  },\n};\n\n\n// const style = stylus(content.toString())\n//   .set('filename', src)\n//   .set('sourcemap', { comment: true });\n//\n// style.render((err, css) => {\n//   if (err) return reject(err);\n//\n//   resolve({ code: css, map: style.sourcemap });\n// });\n"]}