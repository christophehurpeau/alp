{"version":3,"sources":["../../src/webpack/createPobpackConfig.js"],"names":["target","production","env","process","NODE_ENV","hmr","includeModules","paths","build","entries","key","path","resolveLoaderModules","join","__dirname","babel","minified","comments","presets","modules","useBuiltIns","targets","plugins","assert","annotate","replacements","BROWSER","NODEJS","SERVER","MODERN_BROWSERS","filter","Boolean","moduleRules","themeFile","test","loader","require","resolve","options","emitFile","limit","name","outputPath","publicPath","url","replace","filename","booleans","builtIns","consecutiveAdds","deadcode","evaluate","flipComparisons","guards","infinity","mangle","memberExpressions","mergeVars","numericLiterals","propertyLiterals","regexpConstructors","removeConsole","removeDebugger","removeUndefined","simplify","simplifyComparisons","typeConstructors","undefinedToVoid","UglifyJsPlugin","compress","warnings","sourceMap","defines","PRODUCTION"],"mappings":"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","file":"createPobpackConfig.js","sourcesContent":["import path from 'path';\nimport presetPob from 'babel-preset-pob';\nimport presetPobReact from 'babel-preset-pob-react';\nimport presetPobStages from 'babel-preset-pob-stages';\nimport presetEnv from 'babel-preset-env';\nimport { buildPreset as presetModernBrowsers } from 'babel-preset-modern-browsers';\nimport presetLatestNode from 'babel-preset-latest-node';\nimport presetOptimizations from 'babel-preset-optimizations';\nimport pluginDiscardModuleReference from 'babel-plugin-discard-module-references';\nimport pluginFlowRuntime from 'babel-plugin-flow-runtime';\nimport { createModuleRule, createExtractPlugin } from 'ynnub/webpack-config';\nimport ExtractTextPlugin from 'extract-text-webpack-plugin';\nimport BabiliPlugin from 'babili-webpack-plugin';\nimport { optimize } from 'webpack';\nimport autoprefixer from 'autoprefixer';\n\ntype TargetType = 'node' | 'modern-browser' | 'browser';\n\nexport default (target: TargetType, production: ?boolean = false) => ({\n  env: process.env.NODE_ENV,\n  hmr: !production,\n\n  includeModules: ['ynnub', 'react-alp-login'],\n\n  paths: {\n    build: target === 'node' ? 'build' : 'public',\n  },\n\n  entries: [\n    {\n      // eslint-disable-next-line no-nested-ternary\n      key: target === 'node' ? 'index' : target === 'browser' ? 'es5' : 'modern-browsers',\n      path: target === 'node' ? 'index.server.js' : 'index.browser.js',\n    },\n  ],\n\n  resolveLoaderModules: [path.join(__dirname, '../..', 'node_modules'), 'node_modules'],\n\n  babel: {\n    minified: target !== 'node' && production,\n    comments: !(target !== 'node' && production),\n\n    // preset order is last to first, so we reverse it for clarity.\n    presets: [\n      // add react preset with jsx\n      [presetPobReact, { production }],\n      // add stage-1 to stage-3 features\n      presetPobStages,\n      // pob preset: flow, import `src`, export default function name, replacements\n      [\n        presetPob,\n        {\n          production,\n          replacements: {\n            BROWSER: target !== 'node',\n            NODEJS: target === 'node',\n            SERVER: target === 'node',\n            MODERN_BROWSERS: target === 'modern-browser',\n          },\n        },\n      ],\n      // optimizations: remove dead-code\n      presetOptimizations,\n      // flow runtime\n      !production && {\n        plugins: [\n          [\n            pluginFlowRuntime,\n            {\n              assert: true,\n              annotate: false,\n            },\n          ],\n        ],\n      },\n      // discard unused imports (like production-only or node-only imports)\n      { plugins: [pluginDiscardModuleReference] },\n      // transpile for browser\n      target === 'modern-browser' && [presetModernBrowsers, { modules: false }],\n      target === 'browser' && [\n        presetEnv,\n        {\n          modules: false,\n          useBuiltIns: true,\n          targets: [\n            '>1%',\n            'not ie < 9', // react doesn't support ie < 9\n          ],\n        },\n      ],\n\n      target === 'node' && [\n        presetLatestNode,\n        {\n          modules: false,\n          target: 8.3,\n        },\n      ],\n    ]\n      .reverse()\n      .filter(Boolean),\n    plugins: [],\n  },\n\n  moduleRules: [\n    // SCSS RULE\n    createModuleRule(ExtractTextPlugin, {\n      production,\n      themeFile: './src/theme.scss',\n      plugins: [autoprefixer],\n    }),\n\n    // IMG RULE\n    {\n      test: /\\.(png|jpg|jpeg|gif|svg)$/,\n      loader: require.resolve('url-loader'),\n      options: {\n        emitFile: target === 'node', // only write file if node\n        limit: 1000,\n        name: 'images/[hash].[ext]',\n        outputPath: '../public/', // because it's node who is writing the file, node is in build/\n        publicPath: url => url.replace(/^..\\/public\\//, ''),\n      },\n    },\n  ],\n\n  plugins: [\n    createExtractPlugin(ExtractTextPlugin, {\n      // disable: target === 'node',\n      // eslint-disable-next-line no-nested-ternary\n      filename: `${target === 'node'\n        ? 'server'\n        : target === 'browser' ? 'es5' : 'modern-browsers'}.css`,\n    }),\n\n    target !== 'node' &&\n      production &&\n      new BabiliPlugin({\n        booleans: true,\n        builtIns: false,\n        consecutiveAdds: true,\n        deadcode: true,\n        evaluate: true,\n        flipComparisons: true,\n        guards: true,\n        infinity: false,\n        mangle: true,\n        memberExpressions: true,\n        mergeVars: false,\n        numericLiterals: true,\n        propertyLiterals: true,\n        regexpConstructors: true,\n        removeConsole: false,\n        removeDebugger: true,\n        removeUndefined: true,\n        replace: false,\n        simplify: true,\n        simplifyComparisons: true,\n        typeConstructors: true,\n        undefinedToVoid: false,\n      }),\n\n    target === 'browser' &&\n      production &&\n      new optimize.UglifyJsPlugin({\n        compress: {\n          warnings: false,\n        },\n        sourceMap: !production,\n      }),\n    // TODO https://github.com/NekR/offline-plugin\n  ].filter(Boolean),\n\n  defines: {\n    BROWSER: target !== 'node',\n    SERVER: target === 'node',\n    NODEJS: target === 'node',\n    PRODUCTION: production,\n    MODERN_BROWSERS: target === 'modern-browser',\n  },\n});\n"]}