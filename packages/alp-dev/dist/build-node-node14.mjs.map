{"version":3,"file":"build-node-node14.mjs","sources":["../src/pobpack/utils/createOptions.ts","../src/pobpack/utils/createAppWebpackConfig.ts","../src/pobpack/utils/FriendlyErrorsWebpackPlugin.ts","../src/pobpack/utils/createPobpackCompiler.ts","../src/pobpack/utils/webpack/createModuleConfig.ts","../src/pobpack/utils/webpack/createPluginsConfig.ts","../src/pobpack/utils/webpack/createResolveConfig.ts","../src/pobpack/node/createNodeWebpackConfig.ts","../src/pobpack/node/index.ts","../src/webpack/css-module-rules.ts","../src/webpack/createPobpackConfig.ts","../src/webpack/node.ts","../src/build-node.ts"],"sourcesContent":["/* eslint-disable complexity */\nimport type { Options } from '../types';\n\nexport default function createOptions(options: Partial<Options>): Options {\n  return {\n    aliases: options.aliases || {},\n    babel: options.babel || {},\n    defines: options.defines || {},\n    entries: options.entries || ['index'],\n    serviceWorkerEntry:\n      options.serviceWorkerEntry === undefined\n        ? 'service-worker'\n        : options.serviceWorkerEntry,\n    env: options.env || process.env.NODE_ENV,\n    hmr: options.hmr,\n    allowlistExternalExtensions: options.allowlistExternalExtensions || [],\n    includePaths: options.includePaths || [],\n    moduleRules: options.moduleRules,\n    jsModuleRules: options.jsModuleRules,\n    paths: { src: 'src', build: 'build', ...options.paths },\n    plugins: options.plugins || [],\n    prependPlugins: options.prependPlugins || [],\n    resolveLoaderModules: options.resolveLoaderModules,\n    typescript: options.typescript || false,\n    webpackPrefixPackageFields: options.webpackPrefixPackageFields || [],\n  };\n}\n","import { existsSync } from 'fs';\nimport { resolve } from 'path';\nimport type { Options, FilledWebpackConfiguration } from '../types';\nimport createOptions from './createOptions';\n\nexport type CreateWebpackConfig = (\n  options: Options,\n) => FilledWebpackConfiguration;\n\nexport type CreateWebpackConfigPartialOptions = (\n  options: Partial<Options>,\n) => FilledWebpackConfiguration;\n\nexport type AppWebpackConfigCreator = (\n  createWebpackConfig: CreateWebpackConfigPartialOptions,\n  options: Partial<Options>,\n) => FilledWebpackConfiguration;\n\nexport function createAppWebpackConfig(\n  createWebpackConfig: CreateWebpackConfig,\n): CreateWebpackConfigPartialOptions {\n  const wrapCreateWebpackConfig: CreateWebpackConfigPartialOptions = (\n    options,\n  ) => createWebpackConfig(createOptions(options));\n\n  return (options: Partial<Options>): FilledWebpackConfiguration => {\n    const appWebpackConfigPath = resolve('createAppWebpackConfig.js');\n    if (existsSync(appWebpackConfigPath)) {\n      throw new Error('createAppWebpackConfig.js is no longer supported');\n      // console.info('Using app createAppWebpackConfig.js');\n      // // eslint-disable-next-line import/no-dynamic-require, @typescript-eslint/no-var-requires, @typescript-eslint/no-unsafe-assignment\n      // const appWebpackConfigCreator: AppWebpackConfigCreator = require(appWebpackConfigPath);\n      // if (typeof appWebpackConfigCreator !== 'function') {\n      //   console.error(\n      //     'app createAppWebpackConfig.js should export a function\\n' +\n      //       'module.exports = function (config, options) { ... }',\n      //   );\n      // }\n\n      // options = createOptions(options);\n      // const config = appWebpackConfigCreator(wrapCreateWebpackConfig, options);\n\n      // if (typeof config !== 'object') {\n      //   console.error(\n      //     'app createAppWebpackConfig.js should return the config\\n' +\n      //       'function (config, options) { return config(options); }',\n      //   );\n      // }\n\n      // return config;\n    } else {\n      return wrapCreateWebpackConfig(options);\n    }\n  };\n}\n","/* eslint-disable no-console */\n\nimport { addConfig, levels } from 'nightingale';\nimport { ConsoleHandler } from 'nightingale-console';\nimport { Logger } from 'nightingale-logger';\nimport formatWebpackMessages from 'react-dev-utils/formatWebpackMessages.js';\nimport type { Compiler } from 'webpack';\n\nexport interface Options {\n  bundleName: string;\n  successMessage?: string;\n}\n\naddConfig({ key: 'pobpack-utils', handler: new ConsoleHandler(levels.INFO) });\nconst logger = new Logger('pobpack-utils', 'pobpack');\n\nconst pluginName = 'pobpack/FriendlyErrorsWebpackPlugin';\n\nexport default class FriendlyErrorsWebpackPlugin {\n  logger: Logger;\n\n  bundleName: string;\n\n  successMessage?: string;\n\n  constructor(options: Options) {\n    this.bundleName = options.bundleName;\n    this.successMessage = options.successMessage;\n    this.logger = logger.context({ bundleName: options.bundleName });\n  }\n\n  apply(compiler: Compiler): void {\n    // webpack is recompiling\n    compiler.hooks.invalid.tap(pluginName, () => {\n      this.logger.info('Compiling...');\n    });\n\n    // compilation done\n    compiler.hooks.done.tap(pluginName, (stats) => {\n      const messages = formatWebpackMessages(stats.toJson({}));\n      // const messages = stats.toJson({}, true);\n\n      if (messages.errors.length > 0) {\n        if (process.send) {\n          process.send({\n            type: 'failed-to-compile',\n            errors: messages.errors.join('\\n'),\n            bundleName: this.bundleName,\n          });\n        } else {\n          this.logger.critical('Failed to compile.');\n          console.log();\n          messages.errors.forEach((message: string) => {\n            console.log(message);\n            console.log();\n          });\n        }\n        return;\n      }\n\n      if (process.send) process.send('ready');\n\n      if (messages.warnings.length > 0) {\n        if (process.send) {\n          process.send({\n            type: 'compiled-with-arnings',\n            warnings: messages.warnings.join('\\n'),\n            bundleName: this.bundleName,\n          });\n        } else {\n          this.logger.critical('Compiled with warnings.');\n          console.log();\n          messages.warnings.forEach((message: string) => {\n            console.log(message);\n            console.log();\n          });\n        }\n      }\n\n      if (process.send) {\n        process.send({\n          type: 'compiled-successfully',\n          bundleName: this.bundleName,\n        });\n      } else {\n        this.logger.success('Compiled successfully!');\n        if (this.successMessage) {\n          console.log(this.successMessage);\n        }\n      }\n    });\n  }\n}\n","import { execSync } from 'child_process';\nimport { promisify } from 'util';\nimport type { Stats } from 'webpack';\nimport webpack from 'webpack';\nimport type {\n  PobpackCompiler,\n  CreateCompilerOptions,\n  FilledWebpackConfiguration,\n} from '../types';\nimport FriendlyErrorsWebpackPlugin from './FriendlyErrorsWebpackPlugin';\n\nconst buildThrowOnError = (stats?: Stats): Stats | undefined => {\n  if (!stats) return stats;\n  if (!stats.hasErrors()) {\n    return stats;\n  }\n\n  throw new Error(stats.toString({}));\n};\n\nexport function createPobpackCompiler(\n  bundleName: string,\n  webpackConfig: FilledWebpackConfiguration,\n  { successMessage }: CreateCompilerOptions = {},\n): PobpackCompiler {\n  const compiler = webpack(webpackConfig);\n\n  // human-readable error messages\n  new FriendlyErrorsWebpackPlugin({ bundleName, successMessage }).apply(\n    compiler,\n  );\n\n  const promisifyRun: () => Promise<Stats | undefined> = promisify(\n    compiler.run.bind(compiler),\n  );\n\n  return {\n    compiler,\n    webpackConfig,\n    clean: (): undefined => {\n      if (webpackConfig.output?.path) {\n        execSync(`rm -Rf ${webpackConfig.output.path}`);\n      }\n      return undefined;\n    },\n    run: (): Promise<Stats | undefined> =>\n      promisifyRun().then(buildThrowOnError),\n    watch: (callback: (stats?: Stats) => unknown) =>\n      compiler.watch({}, (err?: Error | null, stats?: Stats): void => {\n        if (err || !stats) return;\n        if (stats.hasErrors()) return;\n        buildThrowOnError(stats);\n        callback(stats);\n      }),\n  };\n}\n","import { resolve } from 'path';\nimport type { Configuration } from 'webpack';\nimport type { Options } from '../../types';\n\nconst resolveDependency = (dependency: string): string => dependency; // TODO require.resolve(path)\n\nexport default function createModuleConfig(\n  options: Options,\n): NonNullable<Configuration['module']> {\n  return {\n    strictExportPresence: true,\n\n    rules: [\n      // tsx? / jsx?\n      {\n        test: options.typescript ? /\\.(mjs|[jt]sx?)$/ : /\\.(mjs|jsx?)$/,\n        include: [resolve(options.paths.src!), ...options.includePaths],\n        rules: [\n          {\n            loader: resolveDependency('babel-loader'),\n            options: {\n              babelrc: false,\n              configFile: false,\n              cacheDirectory: true,\n              ...options.babel,\n            },\n          },\n          ...(options.jsModuleRules || []),\n        ],\n      },\n\n      // other rules\n      ...(options.moduleRules || []),\n    ],\n  };\n}\n","import { URL } from 'url';\nimport CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin';\nimport type { Configuration } from 'webpack';\nimport webpack from 'webpack';\nimport type { Options } from '../../types';\n\nconst ExcludesFalsy = Boolean as unknown as <T>(\n  x: T | boolean | null | undefined,\n) => x is T;\n\nconst DEV_CONST = '__DEV__';\n\nexport default function createPluginsConfig(\n  options: Options,\n): NonNullable<Configuration['plugins']> {\n  const plugins: unknown[] = [\n    ...(options.prependPlugins || []),\n\n    // enforces the entire path of all required modules match the exact case\n    // of the actual path on disk. Using this plugin helps alleviate cases\n    // for developers working on case insensitive systems like OSX.\n    options.env !== 'production' && new CaseSensitivePathsPlugin(),\n\n    new webpack.DefinePlugin({\n      'process.env.NODE_ENV': JSON.stringify(options.env),\n      [DEV_CONST]: JSON.stringify(options.env !== 'production'),\n      ...options.defines,\n    }),\n\n    /* replace object-assign ponyfill to use native implementation */\n\n    // Array.isArray\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/isarray\\/index.js$/,\n      new URL('../replacements/Array.isArray.cjs', import.meta.url).pathname,\n    ),\n\n    // Object.assign\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/(object-assign|extend-shallow)\\/index.js$/,\n      new URL('../replacements/Object.assign.cjs', import.meta.url).pathname,\n    ),\n\n    // Object.setPrototypeOf\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/setprototypeof\\/index.js$/,\n      new URL(\n        '../replacements/Object.setPrototypeOf.cjs',\n        import.meta.url,\n      ).pathname,\n    ),\n\n    // Promise\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/any-promise\\/index.js$/,\n      new URL('../replacements/Promise.cjs', import.meta.url).pathname,\n    ),\n\n    // String.prototype.repeat\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/repeat-string\\/index.js$/,\n      new URL(\n        '../replacements/String.prototype.repeat.cjs',\n        import.meta.url,\n      ).pathname,\n    ),\n\n    // Symbol.observable\n    // https://github.com/tc39/proposal-observable\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/observable\n    // new webpack.NormalModuleReplacementPlugin(\n    //   /.*\\/node_modules\\/symbol-observable\\/es\\/ponyfill.js$/,\n    //   new URL('../replacements/Symbol.observable.js', import.meta.url).pathname,\n    // ),\n\n    ...options.plugins,\n  ];\n\n  return plugins.filter(ExcludesFalsy) as NonNullable<Configuration['plugins']>;\n}\n","/* eslint-disable complexity */\nimport { resolve } from 'path';\nimport type { Configuration } from 'webpack';\nimport type { Options } from '../../types';\n\nconst ExcludesFalsy = Boolean as unknown as <T>(\n  x: T | boolean | null | undefined,\n) => x is T;\n\nexport default function createResolveConfig(\n  modulePrefixPackageFields: string[],\n  conditionNames: string[],\n  options: Options,\n  targetAliases?: Options['aliases'],\n): NonNullable<Configuration['resolve']> {\n  return {\n    // https://github.com/DefinitelyTyped/DefinitelyTyped/pull/25209\n    // cacheWithContext: false,\n\n    modules: ['node_modules', resolve('src')],\n    extensions: [\n      options.typescript && '.ts',\n      options.typescript && '.tsx',\n      '.mjs',\n      '.js',\n      '.jsx',\n    ].filter(ExcludesFalsy),\n\n    conditionNames: [\n      ...conditionNames,\n      options.env !== 'production' ? 'development' : undefined,\n      'import',\n    ].filter(ExcludesFalsy),\n\n    mainFields: [\n      // eslint-disable-next-line unicorn/prefer-spread\n      ...([] as (string | false)[]).concat(\n        ...modulePrefixPackageFields.map(\n          (prefix: string): (string | false)[] => [\n            options.env !== 'production' && `module:${prefix}-dev`,\n            `module:${prefix}`,\n            // old `webpack:` syntax\n            options.env !== 'production' && `webpack:${prefix}-dev`,\n            `webpack:${prefix}`,\n          ],\n        ),\n      ),\n\n      options.env !== 'production' && 'module-dev',\n      'module',\n      // old webpack: syntax\n      options.env !== 'production' && 'webpack:main-dev',\n      'webpack:main',\n\n      ...(!modulePrefixPackageFields.includes('browser')\n        ? []\n        : [\n            // Browser builds\n            options.env !== 'production' && 'browser-dev',\n            'browser',\n          ]),\n      options.env !== 'production' && 'main-dev',\n      'main',\n    ].filter(ExcludesFalsy),\n\n    aliasFields: [\n      // eslint-disable-next-line unicorn/prefer-spread\n      ...([] as (string | false)[]).concat(\n        ...modulePrefixPackageFields.map(\n          (prefix: string): (string | false)[] => [\n            options.env !== 'production' && `module:aliases-${prefix}-dev`,\n            `module:aliases-${prefix}`,\n\n            // old webpack: syntax\n            options.env !== 'production' && `webpack:aliases-${prefix}-dev`,\n            `webpack:aliases-${prefix}`,\n          ],\n        ),\n      ),\n\n      options.env !== 'production' && 'module:aliases-dev',\n      'module:aliases',\n\n      // old webpack: syntax\n      options.env !== 'production' && 'webpack:aliases-dev',\n      'webpack:aliases',\n      'webpack',\n      modulePrefixPackageFields.includes('browser') &&\n        options.env !== 'production' &&\n        'browser-dev',\n      modulePrefixPackageFields.includes('browser') && 'browser',\n    ].filter(ExcludesFalsy),\n\n    alias: { ...options.aliases, ...targetAliases },\n  };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport { URL } from 'url';\nimport type { Configuration } from 'webpack';\nimport type { Options as NodeExternalsOptions } from 'webpack-node-externals';\nimport nodeExternals from 'webpack-node-externals';\nimport type {\n  ConfigEntry,\n  Options,\n  FilledWebpackConfiguration,\n} from '../types';\nimport {\n  webpack,\n  createModuleConfig,\n  createPluginsConfig,\n  createResolveConfig,\n} from '../utils';\n\nconst ExcludesFalsy = Boolean as any as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nconst createExternals = (\n  options: Options,\n): NonNullable<Configuration['externals']> => {\n  const baseOptions: NodeExternalsOptions = {\n    // @ts-expect-error module is valid but as an experiment\n    importType: 'module',\n    modulesFromFile: false,\n    allowlist: [\n      new URL('../node-hot.mjs', import.meta.url).pathname,\n      // TODO remove this when exports is added in these libs\n      'react/jsx-runtime',\n      'react/jsx-dev-runtime',\n      ...(options.allowlistExternalExtensions\n        ? [new RegExp(`(${options.allowlistExternalExtensions.join('|')})$`)]\n        : []),\n    ],\n  };\n\n  const nodeModulesPaths: string[] = [];\n  let p = process.cwd();\n  do {\n    const nodeModulesCurrentPath = path.join(p, 'node_modules');\n    if (fs.existsSync(nodeModulesCurrentPath)) {\n      nodeModulesPaths.push(nodeModulesCurrentPath);\n    }\n    p = path.dirname(p);\n  } while (p !== '/');\n\n  return nodeModulesPaths.map((nodeModulesPath) =>\n    nodeExternals({ ...baseOptions, modulesDir: nodeModulesPath }),\n  );\n};\n\nexport function createNodeWebpackConfig(\n  options: Options,\n): FilledWebpackConfiguration {\n  return {\n    // production or development\n    mode: options.env === 'production' ? 'production' : 'development',\n\n    // Don't attempt to continue if there are any errors.\n    bail: options.env === 'production',\n\n    // Target node\n    target: 'node14',\n\n    // get right stack traces\n    devtool: 'source-map',\n\n    infrastructureLogging: {\n      level: 'none',\n    },\n\n    optimization: {\n      nodeEnv: false, // see createPluginsConfig\n      emitOnErrors: false,\n      minimize: false,\n    },\n\n    // don't bundle node_modules dependencies\n    externalsPresets: { node: true },\n    externals: createExternals(options),\n\n    // use cache\n    cache: options.hmr,\n\n    // bundle size is not relevant for node\n    performance: {\n      hints: false,\n    },\n\n    resolveLoader: {\n      modules: options.resolveLoaderModules || ['node_modules'],\n    },\n\n    resolve: createResolveConfig(\n      ['node'],\n      ['node', options.env === 'production' ? 'production' : 'development'],\n      {\n        ...options,\n        babel: options.babel,\n      },\n      {\n        // TODO remove this when exports is added in these libs\n        'react/jsx-dev-runtime$': 'react/jsx-dev-runtime.js',\n        'react/jsx-runtime$': 'react/jsx-runtime.js',\n      },\n    ),\n\n    // eslint-disable-next-line unicorn/no-array-reduce, unicorn/prefer-object-from-entries\n    entry: options.entries.reduce(\n      (entries: Record<string, string[]>, entry: ConfigEntry) => {\n        if (typeof entry === 'string') entry = { key: entry, path: entry };\n        entries[entry.key] = [\n          options.hmr\n            ? new URL('../node-hot.mjs', import.meta.url).pathname\n            : undefined,\n          path.join(path.resolve(options.paths.src!), entry.path),\n        ].filter(ExcludesFalsy);\n        return entries;\n      },\n      {},\n    ),\n\n    experiments: {\n      outputModule: true,\n    },\n\n    output: {\n      filename: '[name].mjs',\n      path: path.resolve(options.paths.build!),\n      libraryTarget: 'module',\n      devtoolModuleFilenameTemplate: '[absolute-resource-path]',\n    },\n\n    module: createModuleConfig(options),\n\n    plugins: [\n      options.hmr && new webpack.HotModuleReplacementPlugin(),\n      ...createPluginsConfig(options),\n    ].filter(ExcludesFalsy),\n  };\n}\n","import { join } from 'path';\nimport debounce from 'debounce';\nimport type { Daemon } from 'springbokjs-daemon';\nimport createDaemon from 'springbokjs-daemon';\nimport type { Stats, Watching } from 'webpack';\nimport type {\n  CreateCompilerOptions,\n  Options,\n  PobpackCompiler,\n  WatchCallback,\n} from '../types';\nimport { createAppWebpackConfig } from '../utils/createAppWebpackConfig';\nimport { createPobpackCompiler } from '../utils/createPobpackCompiler';\nimport { createNodeWebpackConfig } from './createNodeWebpackConfig';\n\nexport const createAppNodeCompiler = (\n  options: Partial<Options>,\n  compilerOptions?: CreateCompilerOptions,\n): PobpackCompiler =>\n  createPobpackCompiler(\n    'node',\n    createAppWebpackConfig(createNodeWebpackConfig)(options),\n    compilerOptions,\n  );\n\nexport const build = (options = {}): Promise<Stats | undefined> => {\n  if (!process.env.NODE_ENV) process.env.NODE_ENV = 'production';\n  const compiler = createAppNodeCompiler({ ...options, hmr: false });\n  compiler.clean();\n  return compiler.run();\n};\n\nexport const watch = (\n  options: Partial<Options>,\n  callback: WatchCallback,\n): PobpackCompiler => {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n  const compiler = createAppNodeCompiler({ ...options, hmr: true });\n  compiler.clean();\n  compiler.watch(callback);\n  return compiler;\n};\n\nexport interface RunOptions {\n  nodeArgs?: (string | number)[];\n  args?: (string | number)[];\n  cwd?: string;\n  displayName?: string;\n  key?: string;\n}\n\nexport const watchAndRunCompiler = (\n  compiler: PobpackCompiler,\n  options: RunOptions = {},\n): Pick<Watching, 'close' | 'invalidate'> => {\n  let daemon: Daemon;\n  let hadError = false;\n  const debounceRestart = debounce(() => {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    daemon.restart();\n  }, 1000);\n  const daemonStop = (): void => {\n    debounceRestart.clear();\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    daemon.stop();\n  };\n  const watchingCompiler = compiler.watch((stats) => {\n    const hasErrors = stats ? stats.hasErrors() : false;\n\n    if (hasErrors) {\n      hadError = true;\n      return;\n    }\n\n    if (!daemon) {\n      daemon = createDaemon({\n        key: options.key || 'pobpack-node',\n        displayName: options.displayName,\n        cwd: options.cwd,\n        args: [\n          ...(options.nodeArgs || []),\n          join(\n            // eslint-disable-next-line @typescript-eslint/prefer-optional-chain\n            (compiler.webpackConfig.output &&\n              compiler.webpackConfig.output.path) ||\n              '',\n            'index.mjs',\n          ),\n          ...(options.args || []),\n        ],\n        // autoRestart: true,\n      });\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      daemon.start();\n      process.on('exit', daemonStop);\n    } else if (daemon.hasExited()) {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      daemon.start();\n    } else if (hadError) {\n      debounceRestart();\n    } else {\n      // already started, send a signal to ask hot reload\n      try {\n        daemon.sendSIGUSR2();\n      } catch {\n        debounceRestart();\n      }\n    }\n    hadError = false;\n  });\n\n  return {\n    invalidate: () => {\n      watchingCompiler.invalidate();\n    },\n    close: (callback) => {\n      if (daemon) {\n        daemonStop();\n        process.off('exit', daemonStop);\n      }\n      watchingCompiler.close(callback);\n    },\n  };\n};\n","import type { RuleSetUseItem, RuleSetRule } from 'webpack';\n\ntype Target = 'node' | 'modern-browser' | 'browser';\n\nexport interface CreateCssUseOptions {\n  target: Target;\n  extractLoader: RuleSetUseItem;\n  plugins: any[];\n  production: boolean;\n  otherLoaders?: RuleSetUseItem[];\n}\n\nexport interface CreateModuleRulesOptions {\n  target: Target;\n  extractLoader: RuleSetUseItem;\n  plugins: any[];\n  production: boolean;\n}\n\nexport interface StylesCacheGroups {\n  name: 'styles';\n  test: RegExp;\n  chunks: 'all';\n  enforce: true;\n}\n\ntype CreateCssModuleUseFn = (options: CreateCssUseOptions) => RuleSetUseItem[];\n\nconst ExcludesFalsy = Boolean as any as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nconst resolveDependency = (dependency: string): string => dependency; // TODO require.resolve(path)\nconst resolveLoader = (loader: string): string => resolveDependency(loader);\n\nconst cssLoaderOptions = function (\n  importLoaders: number,\n  production: boolean,\n  targetIsNode: boolean,\n): any {\n  return {\n    sourceMap: !production,\n    modules: global\n      ? false\n      : {\n          exportOnlyLocals: targetIsNode,\n          localIdentName: production\n            ? '[hash:base64]'\n            : '[name]__[local]___[hash:base64:5]',\n        },\n    importLoaders,\n  };\n};\n\nexport const createCssUse: CreateCssModuleUseFn = function ({\n  target,\n  extractLoader,\n  plugins,\n  production,\n  otherLoaders = [],\n}) {\n  if (target === 'node') {\n    return [{ loader: resolveLoader('ignore-loader') }];\n  }\n\n  return [\n    extractLoader,\n    {\n      loader: resolveLoader('css-loader'),\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      options: cssLoaderOptions(otherLoaders.length + 1, production, false),\n    },\n    {\n      loader: resolveLoader('postcss-loader'),\n      options: {\n        sourceMap: !production,\n        postcssOptions: {\n          ident: 'postcss',\n          plugins,\n        },\n      },\n    },\n    ...otherLoaders,\n  ].filter(ExcludesFalsy);\n};\n\nexport const createCssRule = function (\n  options: CreateCssUseOptions,\n): RuleSetRule {\n  return {\n    test: /\\.css$/,\n    sideEffects: true,\n    use: createCssUse(options),\n  };\n};\n\nconst fileExtensions = ['css'];\n\nexport const stylesCacheGroups = {\n  name: 'styles',\n  test: new RegExp(`\\\\.+(${[...fileExtensions].join('|')})$`),\n  chunks: 'all',\n  enforce: true,\n};\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, complexity, max-lines */\n\nimport fs from 'fs';\nimport path from 'path';\nimport autoprefixer from 'autoprefixer';\nimport MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport webpack from 'webpack';\nimport type { Options } from '../pobpack/types';\nimport { createCssRule, createCssUse } from './css-module-rules';\n\nconst resolveDependency = (dependency: string): string => dependency; // TODO require.resolve(path)\n\n// stylesCacheGroups\n\ntype TargetType = 'node' | 'modern-browser' | 'browser';\n\nconst ExcludesFalsy = Boolean as any as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nexport default function createPobpackConfig(\n  target: TargetType,\n  production = false,\n): Partial<Options> {\n  const pkg = JSON.parse(\n    // eslint-disable-next-line unicorn/prefer-json-parse-buffer\n    fs.readFileSync(path.resolve('package.json'), 'utf-8'),\n  );\n  const deps = pkg.dependencies || {};\n  const devdeps = pkg.devDependencies || {};\n\n  const hasAntd = !!deps.antd;\n\n  if (deps.antd) {\n    if (!devdeps.less) {\n      throw new Error('less missing: yarn add --dev less');\n    }\n  }\n\n  return {\n    env: process.env.NODE_ENV,\n    hmr: !production,\n    typescript: true,\n\n    allowlistExternalExtensions: [\n      'png',\n      'jpg',\n      'jpeg',\n      'gif',\n      'svg',\n      'scss',\n      'css',\n    ],\n\n    paths: {\n      build: target === 'node' ? 'build' : 'public',\n    },\n\n    entries: [\n      {\n        key:\n          target === 'node'\n            ? 'index'\n            : target === 'browser'\n            ? 'es5'\n            : 'modern-browsers',\n        path: target === 'node' ? 'index.server.ts' : 'index.browser.ts',\n      },\n    ],\n\n    resolveLoaderModules: ['node_modules'],\n\n    babel: {\n      minified: target !== 'node' && production,\n      comments: !(target !== 'node' && production),\n\n      presets: [\n        // add react preset with jsx\n        [\n          resolveDependency('@babel/preset-react'),\n          { development: !production, useBuiltIns: true, runtime: 'automatic' },\n        ],\n        // pob preset: flow, import `src`, export default function name, replacements, exnext features, ...\n        [\n          resolveDependency('babel-preset-pob-env'),\n          {\n            resolvePreset: (preset: string): string =>\n              resolveDependency(preset),\n            typescript: true,\n            optimizations: true,\n            target: target === 'node' ? 'node' : 'browser',\n            version:\n              target === 'node'\n                ? '14'\n                : target === 'modern-browser'\n                ? 'modern'\n                : undefined,\n            loose: true,\n            modules: false,\n          },\n        ],\n        // linaria support\n        [resolveDependency('@linaria/babel-preset'), {}],\n      ],\n      plugins: [\n        hasAntd && [\n          resolveDependency('babel-plugin-import'),\n          {\n            libraryName: 'antd',\n            libraryDirectory: target === 'node' ? 'lib' : 'es',\n            style: target !== 'node',\n          },\n        ],\n      ].filter(ExcludesFalsy),\n    },\n\n    jsModuleRules: [\n      {\n        loader: resolveDependency('@linaria/webpack5-loader'),\n        options: {\n          sourceMap: !production,\n          babelOptions: {\n            presets: ['@babel/preset-typescript'],\n          },\n        },\n      },\n    ],\n\n    moduleRules: [\n      // CSS RULE\n      createCssRule({\n        target,\n        extractLoader: {\n          loader: MiniCssExtractPlugin.loader,\n          options: {\n            emit: target !== 'node',\n          },\n        },\n        production,\n        plugins: [autoprefixer],\n      }),\n\n      // LESS RULE (antd)\n      {\n        test: /\\.less$/,\n        use: createCssUse({\n          target,\n          extractLoader: {\n            loader: MiniCssExtractPlugin.loader,\n            options: {\n              emit: target !== 'node',\n              publicPath: '../..',\n            },\n          },\n          production,\n          plugins: [autoprefixer],\n          otherLoaders: [\n            {\n              loader: resolveDependency('less-loader'),\n              options: {\n                javascriptEnabled: true,\n                // modifyVars: path.resolve('./src/less-modifyVars.js'),\n              },\n            },\n            {\n              loader: resolveDependency('less-modify-var-loader'),\n              options: {\n                filePath: path.resolve('./src/theme.less'),\n              },\n            },\n          ],\n        }),\n      },\n\n      // IMG RULE\n      {\n        test: /\\.(png|jpg|jpeg|gif|svg)$/,\n        type: 'asset',\n        parser: {\n          dataUrlCondition: {\n            maxSize: 1024, // 1kb\n          },\n        },\n      },\n    ],\n\n    // TODO https://github.com/zeit/next.js/blob/7d78c3b64185d6d6417f1af9cde4a69d32b18cc6/packages/next/build/webpack.js\n    // optimization: {\n    //   minimizer:\n    //     target === 'browser' ? [new OptimizeCssAssetsPlugin()] : undefined,\n    //   splitChunks: {\n    //     cacheGroups: {\n    //       styles: stylesCacheGroups,\n    //     },\n    //   },\n    // },\n\n    plugins: [\n      new MiniCssExtractPlugin({\n        experimentalUseImportModule: true,\n        filename: `${\n          target === 'node'\n            ? 'server'\n            : target === 'browser'\n            ? 'es5'\n            : 'modern-browsers'\n        }.css`, // [name].[contenthash:8].css\n        chunkFilename: 'css/[name].[contenthash:8].chunk.css',\n        runtime: false, // target !== 'node',\n      }),\n\n      process.send &&\n        new webpack.ProgressPlugin(\n          (percentage: number, message: string): void => {\n            process.send!({\n              type: 'webpack-progress',\n              percentage,\n              message,\n            });\n          },\n        ),\n\n      // TODO https://github.com/NekR/offline-plugin\n    ].filter(ExcludesFalsy),\n  };\n}\n","import path from 'path';\nimport type { Watching } from 'webpack';\nimport { createAppNodeCompiler, watchAndRunCompiler } from '../pobpack/node';\nimport type { PobpackCompiler } from '../pobpack/types';\nimport createPobpackConfig from './createPobpackConfig';\n\nexport const createNodeCompiler = (production: boolean): PobpackCompiler =>\n  createAppNodeCompiler(createPobpackConfig('node', production), {\n    progressBar: false,\n  });\n\nexport const watchAndRun = (\n  nodeCompiler: PobpackCompiler,\n  port: string | number,\n): Pick<Watching, 'close' | 'invalidate'> =>\n  watchAndRunCompiler(nodeCompiler, {\n    key: 'alp-dev:node:watchAndRun',\n    displayName: 'node:watchAndRun',\n    nodeArgs: ['--enable-source-maps'],\n    args: ['--trace-warnings', '--port', port, '--version', Date.now()],\n    cwd: path.resolve('.'),\n  });\n","import { createNodeCompiler } from './webpack/node';\n\nconst nodeCompiler = createNodeCompiler(process.env.NODE_ENV !== 'development');\n\n// eslint-disable-next-line @typescript-eslint/no-floating-promises\nnodeCompiler.run();\n"],"names":["createOptions","options","aliases","babel","defines","entries","serviceWorkerEntry","undefined","env","process","NODE_ENV","hmr","allowlistExternalExtensions","includePaths","moduleRules","jsModuleRules","paths","src","build","plugins","prependPlugins","resolveLoaderModules","typescript","webpackPrefixPackageFields","createAppWebpackConfig","createWebpackConfig","wrapCreateWebpackConfig","appWebpackConfigPath","resolve","existsSync","Error","addConfig","key","handler","ConsoleHandler","levels","INFO","logger","Logger","pluginName","FriendlyErrorsWebpackPlugin","constructor","bundleName","successMessage","context","apply","compiler","hooks","invalid","tap","info","done","stats","messages","formatWebpackMessages","toJson","errors","length","send","type","join","critical","console","log","forEach","message","warnings","success","buildThrowOnError","hasErrors","toString","createPobpackCompiler","webpackConfig","webpack","promisifyRun","promisify","run","bind","clean","output","path","execSync","then","watch","callback","err","resolveDependency","dependency","createModuleConfig","strictExportPresence","rules","test","include","loader","babelrc","configFile","cacheDirectory","ExcludesFalsy","Boolean","DEV_CONST","createPluginsConfig","CaseSensitivePathsPlugin","DefinePlugin","JSON","stringify","NormalModuleReplacementPlugin","URL","import","meta","url","pathname","filter","createResolveConfig","modulePrefixPackageFields","conditionNames","targetAliases","modules","extensions","mainFields","concat","map","prefix","includes","aliasFields","alias","createExternals","baseOptions","importType","modulesFromFile","allowlist","RegExp","nodeModulesPaths","p","cwd","nodeModulesCurrentPath","fs","push","dirname","nodeModulesPath","nodeExternals","modulesDir","createNodeWebpackConfig","mode","bail","target","devtool","infrastructureLogging","level","optimization","nodeEnv","emitOnErrors","minimize","externalsPresets","node","externals","cache","performance","hints","resolveLoader","entry","reduce","experiments","outputModule","filename","libraryTarget","devtoolModuleFilenameTemplate","module","HotModuleReplacementPlugin","createAppNodeCompiler","compilerOptions","cssLoaderOptions","importLoaders","production","targetIsNode","sourceMap","global","exportOnlyLocals","localIdentName","createCssUse","extractLoader","otherLoaders","postcssOptions","ident","createCssRule","sideEffects","use","createPobpackConfig","pkg","parse","readFileSync","deps","dependencies","devdeps","devDependencies","hasAntd","antd","less","minified","comments","presets","development","useBuiltIns","runtime","resolvePreset","preset","optimizations","version","loose","libraryName","libraryDirectory","style","babelOptions","MiniCssExtractPlugin","emit","autoprefixer","publicPath","javascriptEnabled","filePath","parser","dataUrlCondition","maxSize","experimentalUseImportModule","chunkFilename","ProgressPlugin","percentage","createNodeCompiler","progressBar","nodeCompiler"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AAGe,SAASA,aAAT,CAAuBC,OAAvB,EAA2D;AACxE,SAAO;AACLC,IAAAA,OAAO,EAAED,OAAO,CAACC,OAAR,IAAmB,EADvB;AAELC,IAAAA,KAAK,EAAEF,OAAO,CAACE,KAAR,IAAiB,EAFnB;AAGLC,IAAAA,OAAO,EAAEH,OAAO,CAACG,OAAR,IAAmB,EAHvB;AAILC,IAAAA,OAAO,EAAEJ,OAAO,CAACI,OAAR,IAAmB,CAAC,OAAD,CAJvB;AAKLC,IAAAA,kBAAkB,EAChBL,OAAO,CAACK,kBAAR,KAA+BC,SAA/B,GACI,gBADJ,GAEIN,OAAO,CAACK,kBART;AASLE,IAAAA,GAAG,EAAEP,OAAO,CAACO,GAAR,IAAeC,OAAO,CAACD,GAAR,CAAYE,QAT3B;AAULC,IAAAA,GAAG,EAAEV,OAAO,CAACU,GAVR;AAWLC,IAAAA,2BAA2B,EAAEX,OAAO,CAACW,2BAAR,IAAuC,EAX/D;AAYLC,IAAAA,YAAY,EAAEZ,OAAO,CAACY,YAAR,IAAwB,EAZjC;AAaLC,IAAAA,WAAW,EAAEb,OAAO,CAACa,WAbhB;AAcLC,IAAAA,aAAa,EAAEd,OAAO,CAACc,aAdlB;AAeLC,IAAAA,KAAK,EAAE;AAAEC,MAAAA,GAAG,EAAE,KAAP;AAAcC,MAAAA,KAAK,EAAE,OAArB;AAA8B,SAAGjB,OAAO,CAACe;AAAzC,KAfF;AAgBLG,IAAAA,OAAO,EAAElB,OAAO,CAACkB,OAAR,IAAmB,EAhBvB;AAiBLC,IAAAA,cAAc,EAAEnB,OAAO,CAACmB,cAAR,IAA0B,EAjBrC;AAkBLC,IAAAA,oBAAoB,EAAEpB,OAAO,CAACoB,oBAlBzB;AAmBLC,IAAAA,UAAU,EAAErB,OAAO,CAACqB,UAAR,IAAsB,KAnB7B;AAoBLC,IAAAA,0BAA0B,EAAEtB,OAAO,CAACsB,0BAAR,IAAsC;AApB7D,GAAP;AAsBD;;ACRM,SAASC,sBAAT,CACLC,mBADK,EAE8B;AACnC,QAAMC,uBAA0D,GAC9DzB,OADiE,IAE9DwB,mBAAmB,CAACzB,aAAa,CAACC,OAAD,CAAd,CAFxB;;AAIA,SAAQA,OAAD,IAA2D;AAChE,UAAM0B,oBAAoB,GAAGC,OAAO,CAAC,2BAAD,CAApC;;AACA,QAAIC,UAAU,CAACF,oBAAD,CAAd,EAAsC;AACpC,YAAM,IAAIG,KAAJ,CAAU,kDAAV,CAAN,CADoC;AAGpC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACD,KAvBD,MAuBO;AACL,aAAOJ,uBAAuB,CAACzB,OAAD,CAA9B;AACD;AACF,GA5BD;AA6BD;;ACtDD;AAaA8B,SAAS,CAAC;AAAEC,EAAAA,GAAG,EAAE,eAAP;AAAwBC,EAAAA,OAAO,EAAE,IAAIC,cAAJ,CAAmBC,MAAM,CAACC,IAA1B;AAAjC,CAAD,CAAT;AACA,MAAMC,MAAM,GAAG,IAAIC,MAAJ,CAAW,eAAX,EAA4B,SAA5B,CAAf;AAEA,MAAMC,UAAU,GAAG,qCAAnB;AAEe,MAAMC,2BAAN,CAAkC;AAO/CC,EAAAA,WAAW,CAACxC,OAAD,EAAmB;AAC5B,SAAKyC,UAAL,GAAkBzC,OAAO,CAACyC,UAA1B;AACA,SAAKC,cAAL,GAAsB1C,OAAO,CAAC0C,cAA9B;AACA,SAAKN,MAAL,GAAcA,MAAM,CAACO,OAAP,CAAe;AAAEF,MAAAA,UAAU,EAAEzC,OAAO,CAACyC;AAAtB,KAAf,CAAd;AACD;;AAEDG,EAAAA,KAAK,CAACC,QAAD,EAA2B;AAC9B;AACAA,IAAAA,QAAQ,CAACC,KAAT,CAAeC,OAAf,CAAuBC,GAAvB,CAA2BV,UAA3B,EAAuC,MAAM;AAC3C,WAAKF,MAAL,CAAYa,IAAZ,CAAiB,cAAjB;AACD,KAFD,EAF8B;;AAO9BJ,IAAAA,QAAQ,CAACC,KAAT,CAAeI,IAAf,CAAoBF,GAApB,CAAwBV,UAAxB,EAAqCa,KAAD,IAAW;AAC7C,YAAMC,QAAQ,GAAGC,qBAAqB,CAACF,KAAK,CAACG,MAAN,CAAa,EAAb,CAAD,CAAtC,CAD6C;;AAI7C,UAAIF,QAAQ,CAACG,MAAT,CAAgBC,MAAhB,GAAyB,CAA7B,EAAgC;AAC9B,YAAIhD,OAAO,CAACiD,IAAZ,EAAkB;AAChBjD,UAAAA,OAAO,CAACiD,IAAR,CAAa;AACXC,YAAAA,IAAI,EAAE,mBADK;AAEXH,YAAAA,MAAM,EAAEH,QAAQ,CAACG,MAAT,CAAgBI,IAAhB,CAAqB,IAArB,CAFG;AAGXlB,YAAAA,UAAU,EAAE,KAAKA;AAHN,WAAb;AAKD,SAND,MAMO;AACL,eAAKL,MAAL,CAAYwB,QAAZ,CAAqB,oBAArB;AACAC,UAAAA,OAAO,CAACC,GAAR;AACAV,UAAAA,QAAQ,CAACG,MAAT,CAAgBQ,OAAhB,CAAyBC,OAAD,IAAqB;AAC3CH,YAAAA,OAAO,CAACC,GAAR,CAAYE,OAAZ;AACAH,YAAAA,OAAO,CAACC,GAAR;AACD,WAHD;AAID;;AACD;AACD;;AAED,UAAItD,OAAO,CAACiD,IAAZ,EAAkBjD,OAAO,CAACiD,IAAR,CAAa,OAAb;;AAElB,UAAIL,QAAQ,CAACa,QAAT,CAAkBT,MAAlB,GAA2B,CAA/B,EAAkC;AAChC,YAAIhD,OAAO,CAACiD,IAAZ,EAAkB;AAChBjD,UAAAA,OAAO,CAACiD,IAAR,CAAa;AACXC,YAAAA,IAAI,EAAE,uBADK;AAEXO,YAAAA,QAAQ,EAAEb,QAAQ,CAACa,QAAT,CAAkBN,IAAlB,CAAuB,IAAvB,CAFC;AAGXlB,YAAAA,UAAU,EAAE,KAAKA;AAHN,WAAb;AAKD,SAND,MAMO;AACL,eAAKL,MAAL,CAAYwB,QAAZ,CAAqB,yBAArB;AACAC,UAAAA,OAAO,CAACC,GAAR;AACAV,UAAAA,QAAQ,CAACa,QAAT,CAAkBF,OAAlB,CAA2BC,OAAD,IAAqB;AAC7CH,YAAAA,OAAO,CAACC,GAAR,CAAYE,OAAZ;AACAH,YAAAA,OAAO,CAACC,GAAR;AACD,WAHD;AAID;AACF;;AAED,UAAItD,OAAO,CAACiD,IAAZ,EAAkB;AAChBjD,QAAAA,OAAO,CAACiD,IAAR,CAAa;AACXC,UAAAA,IAAI,EAAE,uBADK;AAEXjB,UAAAA,UAAU,EAAE,KAAKA;AAFN,SAAb;AAID,OALD,MAKO;AACL,aAAKL,MAAL,CAAY8B,OAAZ,CAAoB,wBAApB;;AACA,YAAI,KAAKxB,cAAT,EAAyB;AACvBmB,UAAAA,OAAO,CAACC,GAAR,CAAY,KAAKpB,cAAjB;AACD;AACF;AACF,KApDD;AAqDD;;AAzE8C;;ACPjD,MAAMyB,iBAAiB,GAAIhB,KAAD,IAAsC;AAC9D,MAAI,CAACA,KAAL,EAAY,OAAOA,KAAP;;AACZ,MAAI,CAACA,KAAK,CAACiB,SAAN,EAAL,EAAwB;AACtB,WAAOjB,KAAP;AACD;;AAED,QAAM,IAAItB,KAAJ,CAAUsB,KAAK,CAACkB,QAAN,CAAe,EAAf,CAAV,CAAN;AACD,CAPD;;AASO,SAASC,qBAAT,CACL7B,UADK,EAEL8B,aAFK,EAGL;AAAE7B,EAAAA;AAAF,IAA4C,EAHvC,EAIY;AACjB,QAAMG,QAAQ,GAAG2B,OAAO,CAACD,aAAD,CAAxB,CADiB;;AAIjB,MAAIhC,2BAAJ,CAAgC;AAAEE,IAAAA,UAAF;AAAcC,IAAAA;AAAd,GAAhC,EAAgEE,KAAhE,CACEC,QADF;AAIA,QAAM4B,YAA8C,GAAGC,SAAS,CAC9D7B,QAAQ,CAAC8B,GAAT,CAAaC,IAAb,CAAkB/B,QAAlB,CAD8D,CAAhE;AAIA,SAAO;AACLA,IAAAA,QADK;AAEL0B,IAAAA,aAFK;AAGLM,IAAAA,KAAK,EAAE,MAAiB;AACtB,UAAIN,aAAa,CAACO,MAAd,EAAsBC,IAA1B,EAAgC;AAC9BC,QAAAA,QAAQ,CAAE,UAAST,aAAa,CAACO,MAAd,CAAqBC,IAAK,EAArC,CAAR;AACD;;AACD,aAAOzE,SAAP;AACD,KARI;AASLqE,IAAAA,GAAG,EAAE,MACHF,YAAY,GAAGQ,IAAf,CAAoBd,iBAApB,CAVG;AAWLe,IAAAA,KAAK,EAAGC,QAAD,IACLtC,QAAQ,CAACqC,KAAT,CAAe,EAAf,EAAmB,CAACE,GAAD,EAAqBjC,KAArB,KAA6C;AAC9D,UAAIiC,GAAG,IAAI,CAACjC,KAAZ,EAAmB;AACnB,UAAIA,KAAK,CAACiB,SAAN,EAAJ,EAAuB;AACvBD,MAAAA,iBAAiB,CAAChB,KAAD,CAAjB;AACAgC,MAAAA,QAAQ,CAAChC,KAAD,CAAR;AACD,KALD;AAZG,GAAP;AAmBD;;ACnDD,MAAMkC,mBAAiB,GAAIC,UAAD,IAAgCA,UAA1D;;;AAEe,SAASC,kBAAT,CACbvF,OADa,EAEyB;AACtC,SAAO;AACLwF,IAAAA,oBAAoB,EAAE,IADjB;AAGLC,IAAAA,KAAK,EAAE;AAEL;AACEC,MAAAA,IAAI,EAAE1F,OAAO,CAACqB,UAAR,GAAqB,kBAArB,GAA0C,eADlD;AAEEsE,MAAAA,OAAO,EAAE,CAAChE,OAAO,CAAC3B,OAAO,CAACe,KAAR,CAAcC,GAAf,CAAR,EAA8B,GAAGhB,OAAO,CAACY,YAAzC,CAFX;AAGE6E,MAAAA,KAAK,EAAE,CACL;AACEG,QAAAA,MAAM,EAAEP,mBAAiB,CAAC,cAAD,CAD3B;AAEErF,QAAAA,OAAO,EAAE;AACP6F,UAAAA,OAAO,EAAE,KADF;AAEPC,UAAAA,UAAU,EAAE,KAFL;AAGPC,UAAAA,cAAc,EAAE,IAHT;AAIP,aAAG/F,OAAO,CAACE;AAJJ;AAFX,OADK,EAUL,IAAIF,OAAO,CAACc,aAAR,IAAyB,EAA7B,CAVK;AAHT,KAFK;AAoBL,QAAId,OAAO,CAACa,WAAR,IAAuB,EAA3B,CApBK;AAHF,GAAP;AA0BD;;AC7BD,MAAMmF,eAAa,GAAGC,OAAtB;AAIA,MAAMC,SAAS,GAAG,yCAAlB;AAEe,SAASC,mBAAT,CACbnG,OADa,EAE0B;AACvC,QAAMkB,OAAkB,GAAG,CACzB,IAAIlB,OAAO,CAACmB,cAAR,IAA0B,EAA9B,CADyB;AAIzB;AACA;AACAnB,EAAAA,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,IAAI6F,wBAAJ,EANP,EAQzB,IAAI5B,OAAO,CAAC6B,YAAZ,CAAyB;AACvB,4BAAwBC,IAAI,CAACC,SAAL,CAAevG,OAAO,CAACO,GAAvB,CADD;AAEvB,KAAC2F,SAAD,GAAaI,IAAI,CAACC,SAAL,CAAevG,OAAO,CAACO,GAAR,KAAgB,YAA/B,CAFU;AAGvB,OAAGP,OAAO,CAACG;AAHY,GAAzB,CARyB;AAczB;AAEA;AACA,MAAIqE,OAAO,CAACgC,6BAAZ,CACE,sCADF,EAEE,IAAIC,GAAJ,CAAQ,mCAAR,EAA6CC,MAAM,CAACC,IAAP,CAAYC,GAAzD,EAA8DC,QAFhE,CAjByB;AAuBzB,MAAIrC,OAAO,CAACgC,6BAAZ,CACE,6DADF,EAEE,IAAIC,GAAJ,CAAQ,mCAAR,EAA6CC,MAAM,CAACC,IAAP,CAAYC,GAAzD,EAA8DC,QAFhE,CAvByB;AA6BzB,MAAIrC,OAAO,CAACgC,6BAAZ,CACE,6CADF,EAEE,IAAIC,GAAJ,CACE,2CADF,EAEEC,MAAM,CAACC,IAAP,CAAYC,GAFd,EAGEC,QALJ,CA7ByB;AAsCzB,MAAIrC,OAAO,CAACgC,6BAAZ,CACE,0CADF,EAEE,IAAIC,GAAJ,CAAQ,6BAAR,EAAuCC,MAAM,CAACC,IAAP,CAAYC,GAAnD,EAAwDC,QAF1D,CAtCyB;AA4CzB,MAAIrC,OAAO,CAACgC,6BAAZ,CACE,4CADF,EAEE,IAAIC,GAAJ,CACE,6CADF,EAEEC,MAAM,CAACC,IAAP,CAAYC,GAFd,EAGEC,QALJ,CA5CyB;AAqDzB;AACA;AACA;AACA;AACA;AACA;AAEA,KAAG7G,OAAO,CAACkB,OA5Dc,CAA3B;AA+DA,SAAOA,OAAO,CAAC4F,MAAR,CAAed,eAAf,CAAP;AACD;;AC/ED;AAKA,MAAMA,eAAa,GAAGC,OAAtB;AAIe,SAASc,mBAAT,CACbC,yBADa,EAEbC,cAFa,EAGbjH,OAHa,EAIbkH,aAJa,EAK0B;AACvC,SAAO;AACL;AACA;AAEAC,IAAAA,OAAO,EAAE,CAAC,cAAD,EAAiBxF,OAAO,CAAC,KAAD,CAAxB,CAJJ;AAKLyF,IAAAA,UAAU,EAAE,CACVpH,OAAO,CAACqB,UAAR,IAAsB,KADZ,EAEVrB,OAAO,CAACqB,UAAR,IAAsB,MAFZ,EAGV,MAHU,EAIV,KAJU,EAKV,MALU,EAMVyF,MANU,CAMHd,eANG,CALP;AAaLiB,IAAAA,cAAc,EAAE,CACd,GAAGA,cADW,EAEdjH,OAAO,CAACO,GAAR,KAAgB,YAAhB,GAA+B,aAA/B,GAA+CD,SAFjC,EAGd,QAHc,EAIdwG,MAJc,CAIPd,eAJO,CAbX;AAmBLqB,IAAAA,UAAU,EAAE;AAEV,OAAI,EAAD,CAA2BC,MAA3B,CACD,GAAGN,yBAAyB,CAACO,GAA1B,CACAC,MAAD,IAAwC,CACtCxH,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAiC,UAASiH,MAAO,MADX,EAErC,UAASA,MAAO,EAFqB;AAItCxH,IAAAA,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAiC,WAAUiH,MAAO,MAJZ,EAKrC,WAAUA,MAAO,EALoB,CADvC,CADF,CAFO,EAcVxH,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,YAdtB,EAeV,QAfU;AAiBVP,IAAAA,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,kBAjBtB,EAkBV,cAlBU,EAoBV,IAAI,CAACyG,yBAAyB,CAACS,QAA1B,CAAmC,SAAnC,CAAD,GACA,EADA,GAEA;AAEEzH,IAAAA,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,aAFlC,EAGE,SAHF,CAFJ,CApBU,EA2BVP,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,UA3BtB,EA4BV,MA5BU,EA6BVuG,MA7BU,CA6BHd,eA7BG,CAnBP;AAkDL0B,IAAAA,WAAW,EAAE;AAEX,OAAI,EAAD,CAA2BJ,MAA3B,CACD,GAAGN,yBAAyB,CAACO,GAA1B,CACAC,MAAD,IAAwC,CACtCxH,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAiC,kBAAiBiH,MAAO,MADnB,EAErC,kBAAiBA,MAAO,EAFa;AAKtCxH,IAAAA,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAiC,mBAAkBiH,MAAO,MALpB,EAMrC,mBAAkBA,MAAO,EANY,CADvC,CADF,CAFQ,EAeXxH,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,oBAfrB,EAgBX,gBAhBW;AAmBXP,IAAAA,OAAO,CAACO,GAAR,KAAgB,YAAhB,IAAgC,qBAnBrB,EAoBX,iBApBW,EAqBX,SArBW,EAsBXyG,yBAAyB,CAACS,QAA1B,CAAmC,SAAnC,KACEzH,OAAO,CAACO,GAAR,KAAgB,YADlB,IAEE,aAxBS,EAyBXyG,yBAAyB,CAACS,QAA1B,CAAmC,SAAnC,KAAiD,SAzBtC,EA0BXX,MA1BW,CA0BJd,eA1BI,CAlDR;AA8EL2B,IAAAA,KAAK,EAAE,EAAE,GAAG3H,OAAO,CAACC,OAAb;AAAsB,SAAGiH;AAAzB;AA9EF,GAAP;AAgFD;;AC7ED,MAAMlB,eAAa,GAAGC,OAAtB;;AAIA,MAAM2B,eAAe,GACnB5H,OADsB,IAEsB;AAC5C,QAAM6H,WAAiC,GAAG;AACxC;AACAC,IAAAA,UAAU,EAAE,QAF4B;AAGxCC,IAAAA,eAAe,EAAE,KAHuB;AAIxCC,IAAAA,SAAS,EAAE,CACT,IAAIvB,GAAJ,CAAQ,iBAAR,EAA2BC,MAAM,CAACC,IAAP,CAAYC,GAAvC,EAA4CC,QADnC;AAGT,uBAHS,EAIT,uBAJS,EAKT,IAAI7G,OAAO,CAACW,2BAAR,GACA,CAAC,IAAIsH,MAAJ,CAAY,IAAGjI,OAAO,CAACW,2BAAR,CAAoCgD,IAApC,CAAyC,GAAzC,CAA8C,IAA7D,CAAD,CADA,GAEA,EAFJ,CALS;AAJ6B,GAA1C;AAeA,QAAMuE,gBAA0B,GAAG,EAAnC;AACA,MAAIC,CAAC,GAAG3H,OAAO,CAAC4H,GAAR,EAAR;;AACA,KAAG;AACD,UAAMC,sBAAsB,GAAGtD,IAAI,CAACpB,IAAL,CAAUwE,CAAV,EAAa,cAAb,CAA/B;;AACA,QAAIG,EAAE,CAAC1G,UAAH,CAAcyG,sBAAd,CAAJ,EAA2C;AACzCH,MAAAA,gBAAgB,CAACK,IAAjB,CAAsBF,sBAAtB;AACD;;AACDF,IAAAA,CAAC,GAAGpD,IAAI,CAACyD,OAAL,CAAaL,CAAb,CAAJ;AACD,GAND,QAMSA,CAAC,KAAK,GANf;;AAQA,SAAOD,gBAAgB,CAACX,GAAjB,CAAsBkB,eAAD,IAC1BC,aAAa,CAAC,EAAE,GAAGb,WAAL;AAAkBc,IAAAA,UAAU,EAAEF;AAA9B,GAAD,CADR,CAAP;AAGD,CA/BD;;AAiCO,SAASG,uBAAT,CACL5I,OADK,EAEuB;AAC5B,SAAO;AACL;AACA6I,IAAAA,IAAI,EAAE7I,OAAO,CAACO,GAAR,KAAgB,YAAhB,GAA+B,YAA/B,GAA8C,aAF/C;AAIL;AACAuI,IAAAA,IAAI,EAAE9I,OAAO,CAACO,GAAR,KAAgB,YALjB;AAOL;AACAwI,IAAAA,MAAM,EAAE,QARH;AAUL;AACAC,IAAAA,OAAO,EAAE,YAXJ;AAaLC,IAAAA,qBAAqB,EAAE;AACrBC,MAAAA,KAAK,EAAE;AADc,KAblB;AAiBLC,IAAAA,YAAY,EAAE;AACZC,MAAAA,OAAO,EAAE,KADG;AACI;AAChBC,MAAAA,YAAY,EAAE,KAFF;AAGZC,MAAAA,QAAQ,EAAE;AAHE,KAjBT;AAuBL;AACAC,IAAAA,gBAAgB,EAAE;AAAEC,MAAAA,IAAI,EAAE;AAAR,KAxBb;AAyBLC,IAAAA,SAAS,EAAE7B,eAAe,CAAC5H,OAAD,CAzBrB;AA2BL;AACA0J,IAAAA,KAAK,EAAE1J,OAAO,CAACU,GA5BV;AA8BL;AACAiJ,IAAAA,WAAW,EAAE;AACXC,MAAAA,KAAK,EAAE;AADI,KA/BR;AAmCLC,IAAAA,aAAa,EAAE;AACb1C,MAAAA,OAAO,EAAEnH,OAAO,CAACoB,oBAAR,IAAgC,CAAC,cAAD;AAD5B,KAnCV;AAuCLO,IAAAA,OAAO,EAAEoF,mBAAmB,CAC1B,CAAC,MAAD,CAD0B,EAE1B,CAAC,MAAD,EAAS/G,OAAO,CAACO,GAAR,KAAgB,YAAhB,GAA+B,YAA/B,GAA8C,aAAvD,CAF0B,EAG1B,EACE,GAAGP,OADL;AAEEE,MAAAA,KAAK,EAAEF,OAAO,CAACE;AAFjB,KAH0B,EAO1B;AACE;AACA,gCAA0B,0BAF5B;AAGE,4BAAsB;AAHxB,KAP0B,CAvCvB;AAqDL;AACA4J,IAAAA,KAAK,EAAE9J,OAAO,CAACI,OAAR,CAAgB2J,MAAhB,CACL,CAAC3J,OAAD,EAAoC0J,KAApC,KAA2D;AACzD,UAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+BA,KAAK,GAAG;AAAE/H,QAAAA,GAAG,EAAE+H,KAAP;AAAc/E,QAAAA,IAAI,EAAE+E;AAApB,OAAR;AAC/B1J,MAAAA,OAAO,CAAC0J,KAAK,CAAC/H,GAAP,CAAP,GAAqB,CACnB/B,OAAO,CAACU,GAAR,GACI,IAAI+F,GAAJ,CAAQ,iBAAR,EAA2BC,MAAM,CAACC,IAAP,CAAYC,GAAvC,EAA4CC,QADhD,GAEIvG,SAHe,EAInByE,IAAI,CAACpB,IAAL,CAAUoB,IAAI,CAACpD,OAAL,CAAa3B,OAAO,CAACe,KAAR,CAAcC,GAA3B,CAAV,EAA4C8I,KAAK,CAAC/E,IAAlD,CAJmB,EAKnB+B,MALmB,CAKZd,eALY,CAArB;AAMA,aAAO5F,OAAP;AACD,KAVI,EAWL,EAXK,CAtDF;AAoEL4J,IAAAA,WAAW,EAAE;AACXC,MAAAA,YAAY,EAAE;AADH,KApER;AAwELnF,IAAAA,MAAM,EAAE;AACNoF,MAAAA,QAAQ,EAAE,YADJ;AAENnF,MAAAA,IAAI,EAAEA,IAAI,CAACpD,OAAL,CAAa3B,OAAO,CAACe,KAAR,CAAcE,KAA3B,CAFA;AAGNkJ,MAAAA,aAAa,EAAE,QAHT;AAINC,MAAAA,6BAA6B,EAAE;AAJzB,KAxEH;AA+ELC,IAAAA,MAAM,EAAE9E,kBAAkB,CAACvF,OAAD,CA/ErB;AAiFLkB,IAAAA,OAAO,EAAE,CACPlB,OAAO,CAACU,GAAR,IAAe,IAAI8D,OAAO,CAAC8F,0BAAZ,EADR,EAEP,GAAGnE,mBAAmB,CAACnG,OAAD,CAFf,EAGP8G,MAHO,CAGAd,eAHA;AAjFJ,GAAP;AAsFD;;ACjIM,MAAMuE,qBAAqB,GAAG,CACnCvK,OADmC,EAEnCwK,eAFmC,KAInClG,qBAAqB,CACnB,MADmB,EAEnB/C,sBAAsB,CAACqH,uBAAD,CAAtB,CAAgD5I,OAAhD,CAFmB,EAGnBwK,eAHmB,CAJhB;;ACaP,MAAMxE,eAAa,GAAGC,OAAtB;;AAIA,MAAMZ,mBAAiB,GAAIC,UAAD,IAAgCA,UAA1D;;;AACA,MAAMuE,aAAa,GAAIjE,MAAD,IAA4BP,mBAAiB,CAACO,MAAD,CAAnE;;AAEA,MAAM6E,gBAAgB,GAAG,UACvBC,aADuB,EAEvBC,UAFuB,EAGvBC,YAHuB,EAIlB;AACL,SAAO;AACLC,IAAAA,SAAS,EAAE,CAACF,UADP;AAELxD,IAAAA,OAAO,EAAE2D,MAAM,GACX,KADW,GAEX;AACEC,MAAAA,gBAAgB,EAAEH,YADpB;AAEEI,MAAAA,cAAc,EAAEL,UAAU,GACtB,eADsB,GAEtB;AAJN,KAJC;AAULD,IAAAA;AAVK,GAAP;AAYD,CAjBD;;AAmBO,MAAMO,YAAkC,GAAG,UAAU;AAC1DlC,EAAAA,MAD0D;AAE1DmC,EAAAA,aAF0D;AAG1DhK,EAAAA,OAH0D;AAI1DyJ,EAAAA,UAJ0D;AAK1DQ,EAAAA,YAAY,GAAG;AAL2C,CAAV,EAM/C;AACD,MAAIpC,MAAM,KAAK,MAAf,EAAuB;AACrB,WAAO,CAAC;AAAEnD,MAAAA,MAAM,EAAEiE,aAAa,CAAC,eAAD;AAAvB,KAAD,CAAP;AACD;;AAED,SAAO,CACLqB,aADK,EAEL;AACEtF,IAAAA,MAAM,EAAEiE,aAAa,CAAC,YAAD,CADvB;AAEE;AACA7J,IAAAA,OAAO,EAAEyK,gBAAgB,CAACU,YAAY,CAAC3H,MAAb,GAAsB,CAAvB,EAA0BmH,UAA1B,EAAsC,KAAtC;AAH3B,GAFK,EAOL;AACE/E,IAAAA,MAAM,EAAEiE,aAAa,CAAC,gBAAD,CADvB;AAEE7J,IAAAA,OAAO,EAAE;AACP6K,MAAAA,SAAS,EAAE,CAACF,UADL;AAEPS,MAAAA,cAAc,EAAE;AACdC,QAAAA,KAAK,EAAE,SADO;AAEdnK,QAAAA;AAFc;AAFT;AAFX,GAPK,EAiBL,GAAGiK,YAjBE,EAkBLrE,MAlBK,CAkBEd,eAlBF,CAAP;AAmBD,CA9BM;AAgCA,MAAMsF,aAAa,GAAG,UAC3BtL,OAD2B,EAEd;AACb,SAAO;AACL0F,IAAAA,IAAI,EAAE,QADD;AAEL6F,IAAAA,WAAW,EAAE,IAFR;AAGLC,IAAAA,GAAG,EAAEP,YAAY,CAACjL,OAAD;AAHZ,GAAP;AAKD,CARM;;ACtFP;;AAUA,MAAMqF,iBAAiB,GAAIC,UAAD,IAAgCA,UAA1D;AAEA;;;AAIA,MAAMU,aAAa,GAAGC,OAAtB;AAIe,SAASwF,mBAAT,CACb1C,MADa,EAEb4B,UAAU,GAAG,KAFA,EAGK;AAClB,QAAMe,GAAG,GAAGpF,IAAI,CAACqF,KAAL;AAEVrD,EAAAA,EAAE,CAACsD,YAAH,CAAgB7G,IAAI,CAACpD,OAAL,CAAa,cAAb,CAAhB,EAA8C,OAA9C,CAFU,CAAZ;AAIA,QAAMkK,IAAI,GAAGH,GAAG,CAACI,YAAJ,IAAoB,EAAjC;AACA,QAAMC,OAAO,GAAGL,GAAG,CAACM,eAAJ,IAAuB,EAAvC;AAEA,QAAMC,OAAO,GAAG,CAAC,CAACJ,IAAI,CAACK,IAAvB;;AAEA,MAAIL,IAAI,CAACK,IAAT,EAAe;AACb,QAAI,CAACH,OAAO,CAACI,IAAb,EAAmB;AACjB,YAAM,IAAItK,KAAJ,CAAU,mCAAV,CAAN;AACD;AACF;;AAED,SAAO;AACLtB,IAAAA,GAAG,EAAEC,OAAO,CAACD,GAAR,CAAYE,QADZ;AAELC,IAAAA,GAAG,EAAE,CAACiK,UAFD;AAGLtJ,IAAAA,UAAU,EAAE,IAHP;AAKLV,IAAAA,2BAA2B,EAAE,CAC3B,KAD2B,EAE3B,KAF2B,EAG3B,MAH2B,EAI3B,KAJ2B,EAK3B,KAL2B,EAM3B,MAN2B,EAO3B,KAP2B,CALxB;AAeLI,IAAAA,KAAK,EAAE;AACLE,MAAAA,KAAK,EAAE8H,MAAM,KAAK,MAAX,GAAoB,OAApB,GAA8B;AADhC,KAfF;AAmBL3I,IAAAA,OAAO,EAAE,CACP;AACE2B,MAAAA,GAAG,EACDgH,MAAM,KAAK,MAAX,GACI,OADJ,GAEIA,MAAM,KAAK,SAAX,GACA,KADA,GAEA,iBANR;AAOEhE,MAAAA,IAAI,EAAEgE,MAAM,KAAK,MAAX,GAAoB,iBAApB,GAAwC;AAPhD,KADO,CAnBJ;AA+BL3H,IAAAA,oBAAoB,EAAE,CAAC,cAAD,CA/BjB;AAiCLlB,IAAAA,KAAK,EAAE;AACLkM,MAAAA,QAAQ,EAAErD,MAAM,KAAK,MAAX,IAAqB4B,UAD1B;AAEL0B,MAAAA,QAAQ,EAAE,EAAEtD,MAAM,KAAK,MAAX,IAAqB4B,UAAvB,CAFL;AAIL2B,MAAAA,OAAO,EAAE;AAEP,OACEjH,iBAAiB,CAAC,qBAAD,CADnB,EAEE;AAAEkH,QAAAA,WAAW,EAAE,CAAC5B,UAAhB;AAA4B6B,QAAAA,WAAW,EAAE,IAAzC;AAA+CC,QAAAA,OAAO,EAAE;AAAxD,OAFF,CAFO;AAOP,OACEpH,iBAAiB,CAAC,sBAAD,CADnB,EAEE;AACEqH,QAAAA,aAAa,EAAGC,MAAD,IACbtH,iBAAiB,CAACsH,MAAD,CAFrB;AAGEtL,QAAAA,UAAU,EAAE,IAHd;AAIEuL,QAAAA,aAAa,EAAE,IAJjB;AAKE7D,QAAAA,MAAM,EAAEA,MAAM,KAAK,MAAX,GAAoB,MAApB,GAA6B,SALvC;AAME8D,QAAAA,OAAO,EACL9D,MAAM,KAAK,MAAX,GACI,IADJ,GAEIA,MAAM,KAAK,gBAAX,GACA,QADA,GAEAzI,SAXR;AAYEwM,QAAAA,KAAK,EAAE,IAZT;AAaE3F,QAAAA,OAAO,EAAE;AAbX,OAFF,CAPO;AA0BP,OAAC9B,iBAAiB,CAAC,uBAAD,CAAlB,EAA6C,EAA7C,CA1BO,CAJJ;AAgCLnE,MAAAA,OAAO,EAAE,CACP+K,OAAO,IAAI,CACT5G,iBAAiB,CAAC,qBAAD,CADR,EAET;AACE0H,QAAAA,WAAW,EAAE,MADf;AAEEC,QAAAA,gBAAgB,EAAEjE,MAAM,KAAK,MAAX,GAAoB,KAApB,GAA4B,IAFhD;AAGEkE,QAAAA,KAAK,EAAElE,MAAM,KAAK;AAHpB,OAFS,CADJ,EASPjC,MATO,CASAd,aATA;AAhCJ,KAjCF;AA6ELlF,IAAAA,aAAa,EAAE,CACb;AACE8E,MAAAA,MAAM,EAAEP,iBAAiB,CAAC,0BAAD,CAD3B;AAEErF,MAAAA,OAAO,EAAE;AACP6K,QAAAA,SAAS,EAAE,CAACF,UADL;AAEPuC,QAAAA,YAAY,EAAE;AACZZ,UAAAA,OAAO,EAAE,CAAC,0BAAD;AADG;AAFP;AAFX,KADa,CA7EV;AAyFLzL,IAAAA,WAAW,EAAE;AAEXyK,IAAAA,aAAa,CAAC;AACZvC,MAAAA,MADY;AAEZmC,MAAAA,aAAa,EAAE;AACbtF,QAAAA,MAAM,EAAEuH,oBAAoB,CAACvH,MADhB;AAEb5F,QAAAA,OAAO,EAAE;AACPoN,UAAAA,IAAI,EAAErE,MAAM,KAAK;AADV;AAFI,OAFH;AAQZ4B,MAAAA,UARY;AASZzJ,MAAAA,OAAO,EAAE,CAACmM,YAAD;AATG,KAAD,CAFF;AAeX;AACE3H,MAAAA,IAAI,EAAE,SADR;AAEE8F,MAAAA,GAAG,EAAEP,YAAY,CAAC;AAChBlC,QAAAA,MADgB;AAEhBmC,QAAAA,aAAa,EAAE;AACbtF,UAAAA,MAAM,EAAEuH,oBAAoB,CAACvH,MADhB;AAEb5F,UAAAA,OAAO,EAAE;AACPoN,YAAAA,IAAI,EAAErE,MAAM,KAAK,MADV;AAEPuE,YAAAA,UAAU,EAAE;AAFL;AAFI,SAFC;AAShB3C,QAAAA,UATgB;AAUhBzJ,QAAAA,OAAO,EAAE,CAACmM,YAAD,CAVO;AAWhBlC,QAAAA,YAAY,EAAE,CACZ;AACEvF,UAAAA,MAAM,EAAEP,iBAAiB,CAAC,aAAD,CAD3B;AAEErF,UAAAA,OAAO,EAAE;AACPuN,YAAAA,iBAAiB,EAAE,IADZ;;AAAA;AAFX,SADY,EAQZ;AACE3H,UAAAA,MAAM,EAAEP,iBAAiB,CAAC,wBAAD,CAD3B;AAEErF,UAAAA,OAAO,EAAE;AACPwN,YAAAA,QAAQ,EAAEzI,IAAI,CAACpD,OAAL,CAAa,kBAAb;AADH;AAFX,SARY;AAXE,OAAD;AAFnB,KAfW;AA+CX;AACE+D,MAAAA,IAAI,EAAE,2BADR;AAEEhC,MAAAA,IAAI,EAAE,OAFR;AAGE+J,MAAAA,MAAM,EAAE;AACNC,QAAAA,gBAAgB,EAAE;AAChBC,UAAAA,OAAO,EAAE,IADO;;AAAA;AADZ;AAHV,KA/CW,CAzFR;AAmJL;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEAzM,IAAAA,OAAO,EAAE,CACP,IAAIiM,oBAAJ,CAAyB;AACvBS,MAAAA,2BAA2B,EAAE,IADN;AAEvB1D,MAAAA,QAAQ,EAAG,GACTnB,MAAM,KAAK,MAAX,GACI,QADJ,GAEIA,MAAM,KAAK,SAAX,GACA,KADA,GAEA,iBACL,MARsB;AAQf;AACR8E,MAAAA,aAAa,EAAE,sCATQ;AAUvBpB,MAAAA,OAAO,EAAE,KAVc;;AAAA,KAAzB,CADO,EAcPjM,OAAO,CAACiD,IAAR,IACE,IAAIe,OAAO,CAACsJ,cAAZ,CACE,CAACC,UAAD,EAAqB/J,OAArB,KAA+C;AAC7CxD,MAAAA,OAAO,CAACiD,IAAR,CAAc;AACZC,QAAAA,IAAI,EAAE,kBADM;AAEZqK,QAAAA,UAFY;AAGZ/J,QAAAA;AAHY,OAAd;AAKD,KAPH,CAfK;AAAA,MA0BP8C,MA1BO,CA0BAd,aA1BA;AA9JJ,GAAP;AA0LD;;AC3NM,MAAMgI,kBAAkB,GAAIrD,UAAD,IAChCJ,qBAAqB,CAACkB,mBAAmB,CAAC,MAAD,EAASd,UAAT,CAApB,EAA0C;AAC7DsD,EAAAA,WAAW,EAAE;AADgD,CAA1C,CADhB;;ACJP,MAAMC,YAAY,GAAGF,kBAAkB,CAACxN,OAAO,CAACD,GAAR,CAAYE,QAAZ,KAAyB,aAA1B,CAAvC;;AAGAyN,YAAY,CAACvJ,GAAb"}