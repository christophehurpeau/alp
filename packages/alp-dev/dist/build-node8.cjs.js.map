{"version":3,"file":"build-node8.cjs.js","sources":["../src/utils/readFile.js","../src/utils/writeFile.js","../src/utils/loadConfigFile.js","../src/config-build.js","../src/build.js"],"sourcesContent":["import fs from 'fs';\n\nexport default target =>\n  new Promise((resolve, reject) => {\n    fs.readFile(target, (err, content) => {\n      if (err) {\n        return reject(new Error(`Failed to read file \"${target}\": ${err.message || err}`));\n      }\n\n      resolve(content);\n    });\n  });\n","import fs from 'fs';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\n\nexport default (target, content) =>\n  new Promise((resolve, reject) => {\n    mkdirp(path.dirname(target), () => {\n      fs.writeFile(target, content, err => {\n        if (err) {\n          return reject(new Error(`Failed to write file \"${target}\": ${err.message || err}`));\n        }\n\n        resolve();\n      });\n    });\n  });\n","import { readFileSync } from 'fs';\nimport path from 'path';\nimport { safeLoad as saveLoadYml } from 'js-yaml';\n\nexport default function loadConfigFile(content, dirname) {\n  const data = saveLoadYml(content) || {};\n\n  const config = data.shared || data.common || {};\n  const serverConfig = { ...config, ...data.server };\n  const browserConfig = { ...config, ...data.browser };\n\n  if (data.include) {\n    const includePaths = data.include.map(includePath => path.resolve(dirname, includePath));\n    includePaths\n      .map(includePath => readFileSync(includePath))\n      .map((content, index) => loadConfigFile(content, path.dirname(includePaths[index])))\n      .forEach(([includeServerConfig, includeBrowserConfig]) => {\n        [\n          { config: serverConfig, include: includeServerConfig },\n          { config: browserConfig, include: includeBrowserConfig },\n        ].forEach(({ config, include }) =>\n          Object.keys(include).forEach(key => {\n            if (!(key in config)) {\n              config[key] = include[key];\n              return;\n            }\n            if (Array.isArray(config[key])) {\n              config[key].push(include[key]);\n            } else if (typeof config[key] === 'object') {\n              Object.assign(config[key], include[key]);\n            } else {\n              throw new Error(`Unexpected override \"${key}\", filename = ${includePaths[key]}`);\n            }\n          }),\n        );\n      });\n  }\n\n  return [serverConfig, browserConfig];\n}\n","import { dirname, join } from 'path';\nimport glob from 'glob';\nimport readFile from './utils/readFile';\nimport writeFile from './utils/writeFile';\nimport loadConfigFile from './utils/loadConfigFile';\n\nexport const clean = () => {};\n\nexport const build = (src = './src/config') =>\n  Promise.all(\n    glob.sync(join(src, '**/*.yml')).map(filename =>\n      readFile(filename).then(content => {\n        const [serverConfig, browserConfig] = loadConfigFile(content, dirname(filename));\n        const destFile = `${filename.slice('src/'.length, -'yml'.length)}json`;\n\n        return Promise.all([\n          writeFile(`build/${destFile}`, JSON.stringify(serverConfig)),\n          writeFile(`public/${destFile}`, JSON.stringify(browserConfig)),\n        ]);\n      }),\n    ),\n  );\n\nexport const watch = envs => {};\n","import { execSync } from 'child_process';\nimport { resolve as pathResolve } from 'path';\nimport execa from 'execa';\nimport { clean, build } from './config-build';\n\nexecSync(`rm -Rf ${pathResolve('public')}/* ${pathResolve('build')}/*`);\n\nclean();\n\nPromise.all([\n  build(),\n  ...['build-node', 'build-modern-browser', 'build-older-browser'].map(path => {\n    const instance = execa('node', [__filename.replace('/build-', `/${path}-`)]);\n    instance.stdout.pipe(process.stdout);\n    return instance;\n  }),\n]).then(() => {\n  console.log('done !');\n});\n"],"names":["target","Promise","resolve","reject","readFile","err","content","Error","message","path","dirname","writeFile","loadConfigFile","data","saveLoadYml","config","shared","common","serverConfig","server","browserConfig","browser","include","includePaths","map","includePath","readFileSync","index","forEach","includeServerConfig","includeBrowserConfig","Object","keys","key","Array","isArray","push","assign","build","src","all","glob","sync","join","filename","then","destFile","slice","JSON","stringify","execSync","pathResolve","instance","execa","__filename","replace","stdout","pipe","process","log"],"mappings":"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"}