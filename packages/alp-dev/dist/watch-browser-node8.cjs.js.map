{"version":3,"file":"watch-browser-node8.cjs.js","sources":["../src/webpack/createPobpackConfig.js","../src/webpack/browser.js","../src/watch-browser.js"],"sourcesContent":["import path from 'path';\nimport presetPobEnv from 'babel-preset-pob-env';\nimport presetReact from '@babel/preset-react';\nimport presetFlow from '@babel/preset-flow';\nimport OptimizeCssAssetsPlugin from 'optimize-css-assets-webpack-plugin';\nimport BabelMinifyPlugin from 'babel-minify-webpack-plugin';\nimport { optimize } from 'webpack';\nimport MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport autoprefixer from 'autoprefixer';\nimport { createModuleRules, createExtractPlugin } from 'ynnub/webpack-config';\n\ntype TargetType = 'node' | 'modern-browser' | 'browser';\n\nexport default (target: TargetType, production: ?boolean = false) => ({\n  env: process.env.NODE_ENV,\n  hmr: !production,\n\n  includeModules: ['ynnub', 'react-alp-login'],\n\n  paths: {\n    build: target === 'node' ? 'build' : 'public',\n  },\n\n  entries: [\n    {\n      // eslint-disable-next-line no-nested-ternary\n      key: target === 'node' ? 'index' : target === 'browser' ? 'es5' : 'modern-browsers',\n      path: target === 'node' ? 'index.server.js' : 'index.browser.js',\n    },\n  ],\n\n  resolveLoaderModules: [path.join(__dirname, '../..', 'node_modules'), 'node_modules'],\n\n  babel: {\n    minified: target !== 'node' && production,\n    comments: !(target !== 'node' && production),\n\n    presets: [\n      // flow\n      presetFlow,\n      // add react preset with jsx\n      [presetReact, { development: !production, useBuiltIns: true }],\n      // pob preset: flow, import `src`, export default function name, replacements, exnext features, ...\n      [\n        presetPobEnv,\n        {\n          resolvePreset: preset => require.resolve(preset),\n          production,\n          typescript: false,\n          exportDefaultName: false,\n          optimizations: true,\n          target: target === 'node' ? 'node' : 'browser',\n          // eslint-disable-next-line no-nested-ternary\n          version: target === 'node' ? 8.3 : target === 'modern-browser' ? 'modern' : undefined,\n          loose: false,\n          modules: false,\n          replacements: {\n            BROWSER: target !== 'node',\n            NODEJS: target === 'node',\n            SERVER: target === 'node',\n            MODERN_BROWSERS: target === 'modern-browser',\n          },\n        },\n      ],\n      // transpile for browser\n      // target === 'modern-browser' && [presetModernBrowsers, { modules: false, loose: true }],\n      // target === 'browser' && [\n      //   presetEnv,\n      //   {\n      //     modules: false,\n      //     loose: true,\n      //     useBuiltIns: true,\n      //     targets: [\n      //       '>1%',\n      //       'not ie < 9', // react doesn't support ie < 9\n      //     ],\n      //   },\n      // ],\n      //\n      // target === 'node' && [\n      //   presetLatestNode,\n      //   {\n      //     modules: false,\n      //     loose: true,\n      //     target: 8.3,\n      //   },\n      // ],\n    ].filter(Boolean),\n    plugins: [\n      require.resolve('babel-plugin-react-require'),\n      require.resolve('babel-plugin-inline-classnames'),\n    ],\n  },\n\n  moduleRules: [\n    // SCSS RULE, CSS RULE\n    ...createModuleRules({\n      MiniCssExtractPlugin,\n      production,\n      themeFile: './src/theme.scss',\n      plugins: [autoprefixer],\n      includePaths: [path.resolve('./node_modules')],\n      resolveLoader: loader => require.resolve(loader),\n    }),\n\n    // IMG RULE\n    {\n      test: /\\.(png|jpg|jpeg|gif|svg)$/,\n      loader: require.resolve('url-loader'),\n      options: {\n        emitFile: target === 'node', // only write file if node\n        limit: 1000,\n        name: 'images/[hash].[ext]',\n        outputPath: '../public/', // because it's node who is writing the file, node is in build/\n        publicPath: url => url.replace(/^..\\/public\\//, ''),\n      },\n    },\n  ],\n\n  plugins: [\n    createExtractPlugin(MiniCssExtractPlugin, {\n      // disable: target === 'node',\n      filename: `${\n        // eslint-disable-next-line no-nested-ternary\n        target === 'node' ? 'server' : target === 'browser' ? 'es5' : 'modern-browsers'\n      }.css`,\n    }),\n\n    new OptimizeCssAssetsPlugin(),\n\n    target !== 'node' &&\n      production &&\n      new BabelMinifyPlugin(\n        {\n          booleans: true,\n          builtIns: false,\n          consecutiveAdds: true,\n          deadcode: true,\n          evaluate: true,\n          flipComparisons: true,\n          guards: true,\n          infinity: false,\n          mangle: true,\n          memberExpressions: true,\n          mergeVars: true,\n          numericLiterals: true,\n          propertyLiterals: true,\n          regexpConstructors: true,\n          removeConsole: false,\n          removeDebugger: true,\n          removeUndefined: true,\n          replace: false,\n          simplify: true,\n          simplifyComparisons: true,\n          typeConstructors: true,\n          undefinedToVoid: false,\n          // keepFnName: true,\n          // keepClassName: true,\n        },\n        { comments: false },\n      ),\n\n    // target === 'browser' &&\n    production &&\n      new optimize.UglifyJsPlugin({\n        compress: {\n          warnings: false,\n        },\n        sourceMap: !production,\n      }),\n    // TODO https://github.com/NekR/offline-plugin\n  ].filter(Boolean),\n\n  defines: {\n    // BROWSER: target !== 'node',\n    // SERVER: target === 'node',\n    // NODEJS: target === 'node',\n    // PRODUCTION: production,\n    // MODERN_BROWSERS: target === 'modern-browser',\n    'process.env.ALP_TARGET': target,\n  },\n});\n","import {\n  createAppBrowserCompiler,\n  MODERN,\n  ALL,\n  runDevServer as runDevServerPobpack,\n} from 'pobpack-browser';\nimport createPobpackConfig from './createPobpackConfig';\n\nexport const createModernBrowserCompiler = production =>\n  createAppBrowserCompiler(MODERN, createPobpackConfig('modern-browser', production));\n\nexport const createOlderBrowserCompiler = production =>\n  createAppBrowserCompiler(ALL, createPobpackConfig('browser', production));\n\nexport const runDevServer = (compiler, port: number, proxyPort: number, options) =>\n  runDevServerPobpack(compiler, {\n    port: proxyPort,\n    https: false,\n\n    // contentBase: false,\n\n    headers: {\n      // avoid errors in console\n      'Access-Control-Expose-Headers': 'SourceMap,X-SourceMap',\n    },\n\n    proxy: {\n      '**': `http://localhost:${port}`,\n    },\n\n    ...options,\n  });\n","import argv from 'minimist-argv';\nimport { createModernBrowserCompiler, runDevServer } from './webpack/browser';\n\nconst browserCompiler = createModernBrowserCompiler();\n\nrunDevServer(browserCompiler, argv.port, argv['proxy-port'], {\n  host: argv.host,\n});\n"],"names":["target","production","process","env","NODE_ENV","path","join","__dirname","presetReact","presetPobEnv","preset","require","resolve","undefined","filter","Boolean","createModuleRules","autoprefixer","loader","url","replace","createExtractPlugin","MiniCssExtractPlugin","OptimizeCssAssetsPlugin","BabelMinifyPlugin","optimize","UglifyJsPlugin","createModernBrowserCompiler","createAppBrowserCompiler","MODERN","createPobpackConfig","runDevServer","compiler","port","proxyPort","options","runDevServerPobpack","browserCompiler","argv","host"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,2BAAe,CAACA,MAAD,EAAqBC,aAAuB,KAA5C,MAAuD;OAC/DC,QAAQC,GAAR,CAAYC,QADmD;OAE/D,CAACH,UAF8D;kBAIpD,CAAC,OAAD,EAAU,iBAAV,CAJoD;SAM7D;WACED,WAAW,MAAX,GAAoB,OAApB,GAA8B;GAP6B;WAU3D,CACP;;SAEOA,WAAW,MAAX,GAAoB,OAApB,GAA8BA,WAAW,SAAX,GAAuB,KAAvB,GAA+B,iBAFpE;UAGQA,WAAW,MAAX,GAAoB,iBAApB,GAAwC;GAJzC,CAV2D;wBAkB9C,CAACK,KAAKC,IAAL,CAAUC,SAAV,EAAqB,OAArB,EAA8B,cAA9B,CAAD,EAAgD,cAAhD,CAlB8C;SAoB7D;cACKP,WAAW,MAAX,IAAqBC,UAD1B;cAEK,EAAED,WAAW,MAAX,IAAqBC,UAAvB,CAFL;aAII;cAAA;KAINO,WAAD,EAAc;mBAAe,CAACP,UAAhB;mBAAyC;KAAvD,CAJO;KAOLQ,YADF,EAEE;qBACiBC,UAAUC,QAAQC,OAAR,CAAgBF,MAAhB,CAD3B;gBAAA;kBAGc,KAHd;yBAIqB,KAJrB;qBAKiB,IALjB;cAMUV,WAAW,MAAX,GAAoB,MAApB,GAA6B,SANvC;;eAQWA,WAAW,MAAX,GAAoB,GAApB,GAA0BA,WAAW,gBAAX,GAA8B,QAA9B,GAAyCa,SAR9E;aASS,KATT;eAUW,KAVX;oBAWgB;iBACHb,WAAW,MADR;gBAEJA,WAAW,MAFP;gBAGJA,WAAW,MAHP;yBAIKA,WAAW;;KAjBlC,CANO,EAkDPc,MAlDO,CAkDAC,OAlDA,CAJJ;aAuDI,CACPJ,QAAQC,OAAR,CAAgB,4BAAhB,CADO,EAEPD,QAAQC,OAAR,CAAgB,gCAAhB,CAFO;GA3EyD;eAiFvD;KAERI,gCAAkB;wBAAA;cAAA;eAGR,kBAHQ;aAIV,CAACC,YAAD,CAJU;kBAKL,CAACZ,KAAKO,OAAL,CAAa,gBAAb,CAAD,CALK;mBAMJM,UAAUP,QAAQC,OAAR,CAAgBM,MAAhB;GANxB,CAFQ;;UAaH,2BADR;YAEUP,QAAQC,OAAR,CAAgB,YAAhB,CAFV;aAGW;gBACGZ,WAAW,MADd;;aAEA,IAFA;YAGD,qBAHC;kBAIK,YAJL;;kBAKKmB,OAAOA,IAAIC,OAAJ,CAAY,eAAZ,EAA6B,EAA7B;;GApBZ,CAjFuD;WA0G3D,CACPC,kCAAoBC,oBAApB,EAA0C;;cAE7B;eAEE,MAAX,GAAoB,QAApB,GAA+BtB,WAAW,SAAX,GAAuB,KAAvB,GAA+B,iBAC/D;GALH,CADO,EASP,IAAIuB,uBAAJ,EATO,EAWPvB,WAAW,MAAX,IACEC,UADF,IAEE,IAAIuB,iBAAJ,CACE;cACY,IADZ;cAEY,KAFZ;qBAGmB,IAHnB;cAIY,IAJZ;cAKY,IALZ;qBAMmB,IANnB;YAOU,IAPV;cAQY,KARZ;YASU,IATV;uBAUqB,IAVrB;eAWa,IAXb;qBAYmB,IAZnB;sBAaoB,IAbpB;wBAcsB,IAdtB;mBAeiB,KAfjB;oBAgBkB,IAhBlB;qBAiBmB,IAjBnB;aAkBW,KAlBX;cAmBY,IAnBZ;yBAoBuB,IApBvB;sBAqBoB,IArBpB;qBAsBmB,KAtBnB;;;GADF,EA2BE;cAAY;GA3Bd,CAbK;gBA6CL,IAAIC,iBAASC,cAAb,CAA4B;cAChB;gBACE;KAFc;eAIf,CAACzB;GAJd,CA7CK,EAoDPa,MApDO,CAoDAC,OApDA,CA1G2D;WAgK3D;;;;;;8BAMmBf;;CAtKf,CAAf;;ACLO,MAAM2B,8BAA8B1B,cACzC2B,wCAAyBC,qBAAzB,EAAiCC,oBAAoB,gBAApB,EAAsC7B,UAAtC,CAAjC,CADK;AAGP,AAGO,MAAM8B,eAAe,CAACC,QAAD,EAAWC,IAAX,EAAyBC,SAAzB,EAA4CC,OAA5C,KAC1BC,4BAAoBJ,QAApB;QACQE,SADR;SAES,KAFT;;WAMW;;qCAE0B;GARrC;SAWS;UACE,oBAAmBD,IAAK;;GAG9BE,OAfL,EADK;;ACXP,MAAME,kBAAkBV,6BAAxB;AAEAI,aAAaM,eAAb,EAA8BC,KAAKL,IAAnC,EAAyCK,KAAK,YAAL,CAAzC,EAA6D;QACrDA,KAAKC;CADb"}