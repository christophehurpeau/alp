{"version":3,"file":"watch-node12.cjs.js","sources":["../src/utils/loadConfigFile.ts","../src/utils/readFile.ts","../src/utils/writeFile.ts","../src/config-build.ts","../src/watch.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment */\nimport { readFileSync } from 'fs';\nimport path from 'path';\nimport { safeLoad as saveLoadYml } from 'js-yaml';\n\nexport interface Config {\n  [key: string]: any;\n}\n\nexport default function loadConfigFile(\n  content: string,\n  dirname: string,\n): [Config, Config] {\n  const data: any = saveLoadYml(content) || {};\n\n  const config = data.shared || data.common || {};\n  const serverConfig = { ...config, ...data.server };\n  const browserConfig = { ...config, ...data.browser };\n\n  if (data.include) {\n    const includePaths = data.include.map((includePath: string) =>\n      path.resolve(dirname, includePath),\n    );\n    includePaths\n      .map((includePath: string) => readFileSync(includePath, 'utf-8'))\n      .map((content: string, index: number) =>\n        loadConfigFile(content, path.dirname(includePaths[index])),\n      )\n      .forEach(\n        ([includeServerConfig, includeBrowserConfig]: [Config, Config]) => {\n          [\n            { config: serverConfig, include: includeServerConfig },\n            { config: browserConfig, include: includeBrowserConfig },\n          ].forEach(({ config, include }) =>\n            Object.keys(include).forEach((key) => {\n              if (!(key in config)) {\n                config[key] = include[key];\n                return;\n              }\n              if (Array.isArray(config[key])) {\n                config[key].push(include[key]);\n              } else if (typeof config[key] === 'object') {\n                Object.assign(config[key], include[key]);\n              } else {\n                throw new TypeError(\n                  `Unexpected override \"${key}\", filename = ${includePaths[key]}`,\n                );\n              }\n            }),\n          );\n        },\n      );\n  }\n\n  return [serverConfig as Config, browserConfig as Config];\n}\n","import fs from 'fs';\n\nexport default function readFile(target: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    fs.readFile(target, 'utf-8', (err, content) => {\n      if (err) {\n        return reject(\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n          new Error(`Failed to read file \"${target}\": ${err.message || err}`),\n        );\n      }\n\n      resolve(content);\n    });\n  });\n}\n","import fs from 'fs';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\n\nexport default function writeFile(\n  target: string,\n  content: string,\n): Promise<void> {\n  return new Promise((resolve, reject) => {\n    mkdirp(path.dirname(target), () => {\n      fs.writeFile(target, content, (err) => {\n        if (err) {\n          return reject(\n            new Error(\n              // eslint-disable-next-line @typescript-eslint/restrict-template-expressions\n              `Failed to write file \"${target}\": ${err.message || err}`,\n            ),\n          );\n        }\n\n        resolve();\n      });\n    });\n  });\n}\n","import type { FSWatcher } from 'fs';\nimport { watch as fsWatch } from 'fs';\nimport { dirname, join } from 'path';\nimport glob from 'glob';\nimport loadConfigFile from './utils/loadConfigFile';\nimport readFile from './utils/readFile';\nimport writeFile from './utils/writeFile';\n\nexport const clean = (): void => {};\n\nconst compileYml = async (filename: string): Promise<void> => {\n  const content = await readFile(filename);\n\n  const [serverConfig, browserConfig] = loadConfigFile(\n    content,\n    dirname(filename),\n  );\n  const destFile = `${filename.slice('src/'.length, -'yml'.length)}json`;\n\n  await Promise.all([\n    writeFile(`build/${destFile}`, JSON.stringify(serverConfig)),\n    writeFile(`public/${destFile}`, JSON.stringify(browserConfig)),\n  ]);\n};\n\nexport const build = (\n  src = './src/config',\n  onChanged?: () => void,\n): Promise<any> =>\n  Promise.all(\n    glob.sync(join(src, '**/*.yml')).map(\n      async (filename: string): Promise<() => void> => {\n        const compilePromise = compileYml(filename);\n\n        if (onChanged) {\n          const fsWatcher: FSWatcher = fsWatch(\n            filename,\n            { persistent: false, recursive: false },\n            (eventType: string): void => {\n              console.log(eventType, filename);\n              if (eventType === 'change') {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                compileYml(filename).then(() => {\n                  onChanged();\n                });\n              }\n            },\n          );\n\n          await compilePromise;\n\n          return () => fsWatcher.close();\n        }\n\n        return () => {};\n      },\n    ),\n  ).then((closeFns: (() => void)[]) => () => {\n    closeFns.forEach((closeFn) => closeFn());\n  });\n\nexport const watch = (envs: string[]): void => {};\n","import './configure-logger';\nimport { execSync } from 'child_process';\nimport path from 'path';\nimport colorette from 'colorette';\nimport argv from 'minimist-argv';\nimport Logger, { addConfig, Level } from 'nightingale';\nimport formatterANSI from 'nightingale-ansi-formatter';\nimport ConsoleLogger from 'nightingale-console';\nimport portscanner from 'portscanner';\nimport ProgressBar from 'progress';\nimport type { Daemon } from 'springbokjs-daemon';\nimport createChild from 'springbokjs-daemon';\n// import watchServer from './server';\nimport * as configBuild from './config-build';\n\nconst startProxyPort: number = (argv.browserSyncStartPort as number) || 3000;\nconst startAppPort: number = (argv.startAppPort as number) || 3050;\nconst endProxyPort: number = startProxyPort + 49;\nconst endAppPort: number = startAppPort + 49;\n\nconst logger = new Logger('alp-dev:watch', 'alp-dev');\n\nexecSync(`rm -Rf ${path.resolve('public')}/* ${path.resolve('build')}/*`);\n\nlet nodeChild: Daemon | undefined;\n\nconst bar = new ProgressBar(\n  `${colorette.bold(colorette.yellow('Building...'))} ${colorette.bold(\n    ':percent',\n  )} [:bar] → :msg`,\n  {\n    incomplete: ' ',\n    complete: '▇',\n    total: 100,\n    width: 1024, // max width possible\n    clear: true,\n    stream: process.stdout,\n  },\n);\n\nconst output = (param: string | string[]): void => {\n  if (bar.complete) {\n    process.stdout.write(`${param as string}\\n`);\n  } else {\n    bar.interrupt(param as string);\n  }\n};\n\nconst formatterSimplified: typeof formatterANSI = ({\n  key,\n  datetime,\n  ...restRecord\n}) => formatterANSI(restRecord as Parameters<typeof formatterANSI>[0]);\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon/,\n    handler: new ConsoleLogger(Level.NOTICE, { output }),\n    stop: true,\n  },\n  true,\n);\n\naddConfig(\n  {\n    pattern: /^alp-dev/,\n    handler: new ConsoleLogger(Level.INFO, { output }),\n    stop: true,\n  },\n  true,\n);\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon:alp-dev:watch:output/,\n    handler: new ConsoleLogger(Level.INFO, {\n      output,\n      formatter: formatterSimplified,\n    }),\n    stop: true,\n  },\n  true,\n);\n\nPromise.all([\n  portscanner.findAPortNotInUse(startProxyPort, endProxyPort),\n  portscanner.findAPortNotInUse(startAppPort, endAppPort),\n  configBuild.build('./src/config', () => {\n    logger.warn('config changed, restarting server');\n    if (nodeChild) nodeChild.sendSIGUSR2();\n  }),\n])\n  .then(([proxyPort, port]: [number, number, undefined]) => {\n    if (proxyPort === port) {\n      throw new Error(\n        `\"proxyPort\" and \"port\" cannot have the same value: ${port}`,\n      );\n    }\n\n    const building = { node: true, browser: true };\n    const percentages = { node: 0, browser: 0 };\n\n    const handleMessage = (\n      source: 'node' | 'browser',\n      msg:\n        | 'ready'\n        | { type: 'webpack-progress'; percentage: number; message: string }\n        | any,\n    ): void => {\n      if (msg === 'ready') {\n        building[source] = false;\n        //\n        // if (Object.values(building).every(Boolean)) {\n        // }\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n      } else if (msg && msg.type === 'webpack-progress') {\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n        percentages[source] = msg.percentage;\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n        const message: string = msg.message;\n        bar.update((percentages.node + percentages.browser) / 2, {\n          msg: message.length > 20 ? `${message.slice(0, 20)}...` : message,\n        });\n      }\n    };\n\n    nodeChild = createChild({\n      key: 'alp-dev:watch:watch-server',\n      displayName: 'alp-dev:watch-server',\n      prefixStdout: true,\n      outputKey: 'alp-dev:watch:output:watch-server',\n      outputDisplayName: 'SERVER:',\n      autoRestart: true,\n      args: [\n        require.resolve(__filename.replace('/watch-', '/watch-node-')),\n        '--port',\n        port,\n      ],\n      env: {\n        ...process.env,\n        NIGHTINGALE_CONSOLE_FORMATTER: 'ansi',\n      },\n      onMessage: (msg) => handleMessage('node', msg),\n    });\n\n    const browserChild = createChild({\n      key: 'alp-dev:watch:watch-browser',\n      displayName: 'alp-dev:watch-browser',\n      autoRestart: true,\n      args: [\n        require.resolve(__filename.replace('/watch-', '/watch-browser-')),\n        '--port',\n        port,\n        '--proxy-port',\n        proxyPort,\n        '--host',\n        argv.host || '',\n      ],\n      env: {\n        ...process.env,\n        NIGHTINGALE_CONSOLE_FORMATTER: 'ansi',\n      },\n      onMessage: (msg) => handleMessage('browser', msg),\n    });\n\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    Promise.all([nodeChild.start(), browserChild.start()]).then(() => {\n      logger.success('ready', { port: proxyPort, serverPort: port });\n    });\n\n    const cleanup = (): void => {\n      // eslint-disable-next-line @typescript-eslint/no-floating-promises\n      Promise.all([\n        nodeChild?.stop().catch((err) => {}),\n        browserChild?.stop().catch((err) => {}),\n      ]).then(() => {\n        process.exit(0);\n      });\n    };\n\n    process.on('SIGINT', cleanup);\n    process.on('SIGTERM', cleanup);\n  })\n  // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  .catch((err) => console.log(err.stack));\n"],"names":["loadConfigFile","content","dirname","data","saveLoadYml","config","shared","common","serverConfig","server","browserConfig","browser","include","includePaths","map","includePath","path","resolve","readFileSync","index","forEach","includeServerConfig","includeBrowserConfig","Object","keys","key","Array","isArray","push","assign","TypeError","readFile","target","Promise","reject","fs","err","Error","message","writeFile","mkdirp","compileYml","filename","destFile","slice","all","JSON","stringify","build","src","onChanged","glob","sync","join","compilePromise","fsWatcher","fsWatch","persistent","recursive","eventType","console","log","then","close","closeFns","closeFn","startProxyPort","argv","browserSyncStartPort","startAppPort","endProxyPort","endAppPort","logger","Logger","execSync","nodeChild","bar","ProgressBar","colorette","bold","yellow","incomplete","complete","total","width","clear","stream","process","stdout","output","param","write","interrupt","formatterSimplified","datetime","restRecord","formatterANSI","addConfig","pattern","handler","ConsoleLogger","Level","NOTICE","stop","INFO","formatter","portscanner","findAPortNotInUse","configBuild","warn","sendSIGUSR2","proxyPort","port","percentages","node","handleMessage","source","msg","type","percentage","update","length","createChild","displayName","prefixStdout","outputKey","outputDisplayName","autoRestart","args","require","__filename","replace","env","NIGHTINGALE_CONSOLE_FORMATTER","onMessage","browserChild","host","start","success","serverPort","cleanup","catch","exit","on","stack"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AASe,SAASA,cAAT,CACbC,OADa,EAEbC,OAFa,EAGK;AAClB,QAAMC,IAAS,GAAGC,eAAW,CAACH,OAAD,CAAX,IAAwB,EAA1C;AAEA,QAAMI,MAAM,GAAGF,IAAI,CAACG,MAAL,IAAeH,IAAI,CAACI,MAApB,IAA8B,EAA7C;AACA,QAAMC,YAAY,GAAG,EAAE,GAAGH,MAAL;AAAa,OAAGF,IAAI,CAACM;AAArB,GAArB;AACA,QAAMC,aAAa,GAAG,EAAE,GAAGL,MAAL;AAAa,OAAGF,IAAI,CAACQ;AAArB,GAAtB;;AAEA,MAAIR,IAAI,CAACS,OAAT,EAAkB;AAChB,UAAMC,YAAY,GAAGV,IAAI,CAACS,OAAL,CAAaE,GAAb,CAAkBC,WAAD,IACpCC,aAAI,CAACC,OAAL,CAAaf,OAAb,EAAsBa,WAAtB,CADmB,CAArB;AAGAF,IAAAA,YAAY,CACTC,GADH,CACQC,WAAD,IAAyBG,eAAY,CAACH,WAAD,EAAc,OAAd,CAD5C,EAEGD,GAFH,CAEO,CAACb,OAAD,EAAkBkB,KAAlB,KACHnB,cAAc,CAACC,OAAD,EAAUe,aAAI,CAACd,OAAL,CAAaW,YAAY,CAACM,KAAD,CAAzB,CAAV,CAHlB,EAKGC,OALH,CAMI,CAAC,CAACC,mBAAD,EAAsBC,oBAAtB,CAAD,KAAmE;AACjE,OACE;AAAEjB,QAAAA,MAAM,EAAEG,YAAV;AAAwBI,QAAAA,OAAO,EAAES;AAAjC,OADF,EAEE;AAAEhB,QAAAA,MAAM,EAAEK,aAAV;AAAyBE,QAAAA,OAAO,EAAEU;AAAlC,OAFF,EAGEF,OAHF,CAGU,CAAC;AAAEf,QAAAA,MAAF;AAAUO,QAAAA;AAAV,OAAD,KACRW,MAAM,CAACC,IAAP,CAAYZ,OAAZ,EAAqBQ,OAArB,CAA8BK,GAAD,IAAS;AACpC,YAAI,EAAEA,GAAG,IAAIpB,MAAT,CAAJ,EAAsB;AACpBA,UAAAA,MAAM,CAACoB,GAAD,CAAN,GAAcb,OAAO,CAACa,GAAD,CAArB;AACA;AACD;;AACD,YAAIC,KAAK,CAACC,OAAN,CAActB,MAAM,CAACoB,GAAD,CAApB,CAAJ,EAAgC;AAC9BpB,UAAAA,MAAM,CAACoB,GAAD,CAAN,CAAYG,IAAZ,CAAiBhB,OAAO,CAACa,GAAD,CAAxB;AACD,SAFD,MAEO,IAAI,OAAOpB,MAAM,CAACoB,GAAD,CAAb,KAAuB,QAA3B,EAAqC;AAC1CF,UAAAA,MAAM,CAACM,MAAP,CAAcxB,MAAM,CAACoB,GAAD,CAApB,EAA2Bb,OAAO,CAACa,GAAD,CAAlC;AACD,SAFM,MAEA;AACL,gBAAM,IAAIK,SAAJ,CACH,wBAAuBL,GAAI,iBAAgBZ,YAAY,CAACY,GAAD,CAAM,EAD1D,CAAN;AAGD;AACF,OAdD,CAJF;AAoBD,KA3BL;AA6BD;;AAED,SAAO,CAACjB,YAAD,EAAyBE,aAAzB,CAAP;AACD;;ACrDc,SAASqB,QAAT,CAAkBC,MAAlB,EAAmD;AAChE,SAAO,IAAIC,OAAJ,CAAY,CAAChB,OAAD,EAAUiB,MAAV,KAAqB;AACtCC,IAAAA,WAAE,CAACJ,QAAH,CAAYC,MAAZ,EAAoB,OAApB,EAA6B,CAACI,GAAD,EAAMnC,OAAN,KAAkB;AAC7C,UAAImC,GAAJ,EAAS;AACP,eAAOF,MAAM;AAEX,YAAIG,KAAJ,CAAW,wBAAuBL,MAAO,MAAKI,GAAG,CAACE,OAAJ,IAAeF,GAAI,EAAjE,CAFW,CAAb;AAID;;AAEDnB,MAAAA,OAAO,CAAChB,OAAD,CAAP;AACD,KATD;AAUD,GAXM,CAAP;AAYD;;ACXc,SAASsC,SAAT,CACbP,MADa,EAEb/B,OAFa,EAGE;AACf,SAAO,IAAIgC,OAAJ,CAAY,CAAChB,OAAD,EAAUiB,MAAV,KAAqB;AACtCM,IAAAA,eAAM,CAACxB,aAAI,CAACd,OAAL,CAAa8B,MAAb,CAAD,EAAuB,MAAM;AACjCG,MAAAA,WAAE,CAACI,SAAH,CAAaP,MAAb,EAAqB/B,OAArB,EAA+BmC,GAAD,IAAS;AACrC,YAAIA,GAAJ,EAAS;AACP,iBAAOF,MAAM,CACX,IAAIG,KAAJ;AAEG,mCAAwBL,MAAO,MAAKI,GAAG,CAACE,OAAJ,IAAeF,GAAI,EAF1D,CADW,CAAb;AAMD;;AAEDnB,QAAAA,OAAO;AACR,OAXD;AAYD,KAbK,CAAN;AAcD,GAfM,CAAP;AAgBD;;ACdD,MAAMwB,UAAU,GAAG,MAAOC,QAAP,IAA2C;AAC5D,QAAMzC,OAAO,GAAG,MAAM8B,QAAQ,CAACW,QAAD,CAA9B;AAEA,QAAM,CAAClC,YAAD,EAAeE,aAAf,IAAgCV,cAAc,CAClDC,OADkD,EAElDC,YAAO,CAACwC,QAAD,CAF2C,CAApD;AAIA,QAAMC,QAAQ,GAAI,GAAED,QAAQ,CAACE,KAAT,IAA8B,EAA9B,CAA6C,MAAjE;AAEA,QAAMX,OAAO,CAACY,GAAR,CAAY,CAChBN,SAAS,CAAE,SAAQI,QAAS,EAAnB,EAAsBG,IAAI,CAACC,SAAL,CAAevC,YAAf,CAAtB,CADO,EAEhB+B,SAAS,CAAE,UAASI,QAAS,EAApB,EAAuBG,IAAI,CAACC,SAAL,CAAerC,aAAf,CAAvB,CAFO,CAAZ,CAAN;AAID,CAbD;;AAeO,MAAMsC,KAAK,GAAG,CACnBC,GAAG,GAAG,cADa,EAEnBC,SAFmB,KAInBjB,OAAO,CAACY,GAAR,CACEM,aAAI,CAACC,IAAL,CAAUC,SAAI,CAACJ,GAAD,EAAM,UAAN,CAAd,EAAiCnC,GAAjC,CACE,MAAO4B,QAAP,IAAiD;AAC/C,QAAMY,cAAc,GAAGb,UAAU,CAACC,QAAD,CAAjC;;AAEA,MAAIQ,SAAJ,EAAe;AACb,UAAMK,SAAoB,GAAGC,QAAO,CAClCd,QADkC,EAElC;AAAEe,MAAAA,UAAU,EAAE,KAAd;AAAqBC,MAAAA,SAAS,EAAE;AAAhC,KAFkC,EAGjCC,SAAD,IAA6B;AAC3BC,MAAAA,OAAO,CAACC,GAAR,CAAYF,SAAZ,EAAuBjB,QAAvB;;AACA,UAAIiB,SAAS,KAAK,QAAlB,EAA4B;AAC1B;AACAlB,QAAAA,UAAU,CAACC,QAAD,CAAV,CAAqBoB,IAArB,CAA0B,MAAM;AAC9BZ,UAAAA,SAAS;AACV,SAFD;AAGD;AACF,KAXiC,CAApC;AAcA,UAAMI,cAAN;AAEA,WAAO,MAAMC,SAAS,CAACQ,KAAV,EAAb;AACD;;AAED,SAAO,MAAM,EAAb;AACD,CAzBH,CADF,EA4BED,IA5BF,CA4BQE,QAAD,IAA8B,MAAM;AACzCA,EAAAA,QAAQ,CAAC5C,OAAT,CAAkB6C,OAAD,IAAaA,OAAO,EAArC;AACD,CA9BD,CAJK;;ACVP,MAAMC,cAAsB,GAAIC,aAAI,CAACC,oBAAN,IAAyC,IAAxE;AACA,MAAMC,YAAoB,GAAIF,aAAI,CAACE,YAAN,IAAiC,IAA9D;AACA,MAAMC,YAAoB,GAAGJ,cAAc,GAAG,EAA9C;AACA,MAAMK,UAAkB,GAAGF,YAAY,GAAG,EAA1C;AAEA,MAAMG,MAAM,GAAG,IAAIC,eAAJ,CAAW,eAAX,EAA4B,SAA5B,CAAf;AAEAC,sBAAQ,CAAE,UAAS1D,aAAI,CAACC,OAAL,CAAa,QAAb,CAAuB,MAAKD,aAAI,CAACC,OAAL,CAAa,OAAb,CAAsB,IAA7D,CAAR;AAEA,IAAI0D,SAAJ;AAEA,MAAMC,GAAG,GAAG,IAAIC,oBAAJ,CACT,GAAEC,kBAAS,CAACC,IAAV,CAAeD,kBAAS,CAACE,MAAV,CAAiB,aAAjB,CAAf,CAAgD,IAAGF,kBAAS,CAACC,IAAV,CACpD,UADoD,CAEpD,gBAHQ,EAIV;AACEE,EAAAA,UAAU,EAAE,GADd;AAEEC,EAAAA,QAAQ,EAAE,GAFZ;AAGEC,EAAAA,KAAK,EAAE,GAHT;AAIEC,EAAAA,KAAK,EAAE,IAJT;AAIe;AACbC,EAAAA,KAAK,EAAE,IALT;AAMEC,EAAAA,MAAM,EAAEC,OAAO,CAACC;AANlB,CAJU,CAAZ;;AAcA,MAAMC,MAAM,GAAIC,KAAD,IAAoC;AACjD,MAAId,GAAG,CAACM,QAAR,EAAkB;AAChBK,IAAAA,OAAO,CAACC,MAAR,CAAeG,KAAf,CAAsB,GAAED,KAAgB,IAAxC;AACD,GAFD,MAEO;AACLd,IAAAA,GAAG,CAACgB,SAAJ,CAAcF,KAAd;AACD;AACF,CAND;;AAQA,MAAMG,mBAAyC,GAAG,CAAC;AACjDpE,EAAAA,GADiD;AAEjDqE,EAAAA,QAFiD;AAGjD,KAAGC;AAH8C,CAAD,KAI5CC,sBAAa,CAACD,UAAD,CAJnB;;AAMAE,gBAAS,CACP;AACEC,EAAAA,OAAO,EAAE,qBADX;AAEEC,EAAAA,OAAO,EAAE,IAAIC,sBAAJ,CAAkBC,YAAK,CAACC,MAAxB,EAAgC;AAAEb,IAAAA;AAAF,GAAhC,CAFX;AAGEc,EAAAA,IAAI,EAAE;AAHR,CADO,EAMP,IANO,CAAT;AASAN,gBAAS,CACP;AACEC,EAAAA,OAAO,EAAE,UADX;AAEEC,EAAAA,OAAO,EAAE,IAAIC,sBAAJ,CAAkBC,YAAK,CAACG,IAAxB,EAA8B;AAAEf,IAAAA;AAAF,GAA9B,CAFX;AAGEc,EAAAA,IAAI,EAAE;AAHR,CADO,EAMP,IANO,CAAT;AASAN,gBAAS,CACP;AACEC,EAAAA,OAAO,EAAE,0CADX;AAEEC,EAAAA,OAAO,EAAE,IAAIC,sBAAJ,CAAkBC,YAAK,CAACG,IAAxB,EAA8B;AACrCf,IAAAA,MADqC;AAErCgB,IAAAA,SAAS,EAAEZ;AAF0B,GAA9B,CAFX;AAMEU,EAAAA,IAAI,EAAE;AANR,CADO,EASP,IATO,CAAT;AAYAtE,OAAO,CAACY,GAAR,CAAY,CACV6D,oBAAW,CAACC,iBAAZ,CAA8BzC,cAA9B,EAA8CI,YAA9C,CADU,EAEVoC,oBAAW,CAACC,iBAAZ,CAA8BtC,YAA9B,EAA4CE,UAA5C,CAFU,EAGVqC,KAAA,CAAkB,cAAlB,EAAkC,MAAM;AACtCpC,EAAAA,MAAM,CAACqC,IAAP,CAAY,mCAAZ;AACA,MAAIlC,SAAJ,EAAeA,SAAS,CAACmC,WAAV;AAChB,CAHD,CAHU,CAAZ,EAQGhD,IARH,CAQQ,CAAC,CAACiD,SAAD,EAAYC,IAAZ,CAAD,KAAoD;AACxD,MAAID,SAAS,KAAKC,IAAlB,EAAwB;AACtB,UAAM,IAAI3E,KAAJ,CACH,sDAAqD2E,IAAK,EADvD,CAAN;AAGD;AAGD,QAAMC,WAAW,GAAG;AAAEC,IAAAA,IAAI,EAAE,CAAR;AAAWvG,IAAAA,OAAO,EAAE;AAApB,GAApB;;AAEA,QAAMwG,aAAa,GAAG,CACpBC,MADoB,EAEpBC,GAFoB,KAMX;AACT,QAAIA,GAAG,KAAK,OAAZ,EAAqB,CAArB,MAMO,IAAIA,GAAG,IAAIA,GAAG,CAACC,IAAJ,KAAa,kBAAxB,EAA4C;AACjD;AACAL,MAAAA,WAAW,CAACG,MAAD,CAAX,GAAsBC,GAAG,CAACE,UAA1B,CAFiD;;AAIjD,YAAMjF,OAAe,GAAG+E,GAAG,CAAC/E,OAA5B;AACAsC,MAAAA,GAAG,CAAC4C,MAAJ,CAAW,CAACP,WAAW,CAACC,IAAZ,GAAmBD,WAAW,CAACtG,OAAhC,IAA2C,CAAtD,EAAyD;AACvD0G,QAAAA,GAAG,EAAE/E,OAAO,CAACmF,MAAR,GAAiB,EAAjB,GAAuB,GAAEnF,OAAO,CAACM,KAAR,CAAc,CAAd,EAAiB,EAAjB,CAAqB,KAA9C,GAAqDN;AADH,OAAzD;AAGD;AACF,GAtBD;;AAwBAqC,EAAAA,SAAS,GAAG+C,oBAAW,CAAC;AACtBjG,IAAAA,GAAG,EAAE,4BADiB;AAEtBkG,IAAAA,WAAW,EAAE,sBAFS;AAGtBC,IAAAA,YAAY,EAAE,IAHQ;AAItBC,IAAAA,SAAS,EAAE,mCAJW;AAKtBC,IAAAA,iBAAiB,EAAE,SALG;AAMtBC,IAAAA,WAAW,EAAE,IANS;AAOtBC,IAAAA,IAAI,EAAE,CACJC,OAAO,CAAChH,OAAR,CAAgBiH,UAAU,CAACC,OAAX,CAAmB,SAAnB,EAA8B,cAA9B,CAAhB,CADI,EAEJ,QAFI,EAGJnB,IAHI,CAPgB;AAYtBoB,IAAAA,GAAG,EAAE,EACH,GAAG7C,OAAO,CAAC6C,GADR;AAEHC,MAAAA,6BAA6B,EAAE;AAF5B,KAZiB;AAgBtBC,IAAAA,SAAS,EAAGjB,GAAD,IAASF,aAAa,CAAC,MAAD,EAASE,GAAT;AAhBX,GAAD,CAAvB;AAmBA,QAAMkB,YAAY,GAAGb,oBAAW,CAAC;AAC/BjG,IAAAA,GAAG,EAAE,6BAD0B;AAE/BkG,IAAAA,WAAW,EAAE,uBAFkB;AAG/BI,IAAAA,WAAW,EAAE,IAHkB;AAI/BC,IAAAA,IAAI,EAAE,CACJC,OAAO,CAAChH,OAAR,CAAgBiH,UAAU,CAACC,OAAX,CAAmB,SAAnB,EAA8B,iBAA9B,CAAhB,CADI,EAEJ,QAFI,EAGJnB,IAHI,EAIJ,cAJI,EAKJD,SALI,EAMJ,QANI,EAOJ5C,aAAI,CAACqE,IAAL,IAAa,EAPT,CAJyB;AAa/BJ,IAAAA,GAAG,EAAE,EACH,GAAG7C,OAAO,CAAC6C,GADR;AAEHC,MAAAA,6BAA6B,EAAE;AAF5B,KAb0B;AAiB/BC,IAAAA,SAAS,EAAGjB,GAAD,IAASF,aAAa,CAAC,SAAD,EAAYE,GAAZ;AAjBF,GAAD,CAAhC,CArDwD;;AA0ExDpF,EAAAA,OAAO,CAACY,GAAR,CAAY,CAAC8B,SAAS,CAAC8D,KAAV,EAAD,EAAoBF,YAAY,CAACE,KAAb,EAApB,CAAZ,EAAuD3E,IAAvD,CAA4D,MAAM;AAChEU,IAAAA,MAAM,CAACkE,OAAP,CAAe,OAAf,EAAwB;AAAE1B,MAAAA,IAAI,EAAED,SAAR;AAAmB4B,MAAAA,UAAU,EAAE3B;AAA/B,KAAxB;AACD,GAFD;;AAIA,QAAM4B,OAAO,GAAG,MAAY;AAAA;;AAC1B;AACA3G,IAAAA,OAAO,CAACY,GAAR,CAAY,eACV8B,SADU,+CACV,WAAW4B,IAAX,GAAkBsC,KAAlB,CAAwB,MAAS,EAAjC,CADU,EAEVN,YAFU,aAEVA,YAFU,uBAEVA,YAAY,CAAEhC,IAAd,GAAqBsC,KAArB,CAA2B,MAAS,EAApC,CAFU,CAAZ,EAGG/E,IAHH,CAGQ,MAAM;AACZyB,MAAAA,OAAO,CAACuD,IAAR,CAAa,CAAb;AACD,KALD;AAMD,GARD;;AAUAvD,EAAAA,OAAO,CAACwD,EAAR,CAAW,QAAX,EAAqBH,OAArB;AACArD,EAAAA,OAAO,CAACwD,EAAR,CAAW,SAAX,EAAsBH,OAAtB;AACD,CAlGH;AAAA,CAoGGC,KApGH,CAoGUzG,GAAD,IAASwB,OAAO,CAACC,GAAR,CAAYzB,GAAG,CAAC4G,KAAhB,CApGlB;;"}