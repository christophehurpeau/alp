{"version":3,"file":"watch-browser-node10-dev.cjs.js","sources":["../src/webpack/createPobpackConfig.ts","../src/webpack/browser.ts","../src/watch-browser.ts"],"sourcesContent":["import path from 'path';\nimport OptimizeCssAssetsPlugin from 'optimize-css-assets-webpack-plugin';\nimport MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport autoprefixer from 'autoprefixer';\nimport { createModuleRules } from 'ynnub-webpack-config';\nimport { Options } from 'pobpack-types';\n\n// stylesCacheGroups\n\ntype TargetType = 'node' | 'modern-browser' | 'browser';\n\nexport default (\n  target: TargetType,\n  production: boolean = false,\n): Partial<Options> => ({\n  env: process.env.NODE_ENV,\n  hmr: !production,\n  typescript: true,\n\n  includeModules: ['ynnub'],\n\n  paths: {\n    build: target === 'node' ? 'build' : 'public',\n  },\n\n  entries: [\n    {\n      key:\n        // eslint-disable-next-line no-nested-ternary\n        target === 'node'\n          ? 'index'\n          : target === 'browser'\n          ? 'es5'\n          : 'modern-browsers',\n      path: target === 'node' ? 'index.server.ts' : 'index.browser.ts',\n    },\n  ],\n\n  resolveLoaderModules: [\n    path.join(__dirname, '../..', 'node_modules'),\n    'node_modules',\n  ],\n\n  babel: {\n    minified: target !== 'node' && production,\n    comments: !(target !== 'node' && production),\n\n    presets: [\n      // add react preset with jsx\n      [\n        require.resolve('@babel/preset-react'),\n        { development: !production, useBuiltIns: true },\n      ],\n      // pob preset: flow, import `src`, export default function name, replacements, exnext features, ...\n      [\n        require.resolve('babel-preset-pob-env'),\n        {\n          resolvePreset: (preset: string): string => require.resolve(preset),\n          production,\n          typescript: true,\n          exportDefaultName: false,\n          optimizations: true,\n          target: target === 'node' ? 'node' : 'browser',\n          version:\n            // eslint-disable-next-line no-nested-ternary\n            target === 'node'\n              ? 8.3\n              : target === 'modern-browser'\n              ? 'modern'\n              : undefined,\n          loose: true,\n          modules: false,\n        },\n      ],\n    ].filter(Boolean),\n    plugins: [require.resolve('babel-plugin-inline-classnames-babel7')],\n  },\n\n  moduleRules: [\n    // SCSS RULE, CSS RULE\n    ...createModuleRules({\n      target,\n      extractLoader: MiniCssExtractPlugin.loader,\n      production,\n      themeFile: './src/theme.scss',\n      plugins: [autoprefixer],\n      includePaths: [path.resolve('./node_modules')],\n      resolveLoader: (loader: string): string => require.resolve(loader),\n    }),\n\n    // IMG RULE\n    {\n      test: /\\.(png|jpg|jpeg|gif|svg)$/,\n      loader: require.resolve('url-loader'),\n      options: {\n        /* config to emit with node doesn't work anymore because css is ignored by node */\n        // emitFile: target === 'node', // only write file if node\n        // outputPath: '../public/', // because it's node who is writing the file, node is in build/\n        // publicPath: (url: string): string => url.replace(/^..\\/public\\//, ''),\n        emitFile: target === 'modern-browser',\n        limit: 1000,\n        name: 'images/[hash].[ext]',\n      },\n    },\n  ],\n\n  // TODO https://github.com/zeit/next.js/blob/7d78c3b64185d6d6417f1af9cde4a69d32b18cc6/packages/next/build/webpack.js\n  // optimization: {\n  //   minimizer:\n  //     target === 'browser' ? [new OptimizeCssAssetsPlugin()] : undefined,\n  //   splitChunks: {\n  //     cacheGroups: {\n  //       styles: stylesCacheGroups,\n  //     },\n  //   },\n  // },\n\n  plugins: [\n    new MiniCssExtractPlugin({\n      // disable: target === 'node',\n      filename: `${\n        // eslint-disable-next-line no-nested-ternary\n        target === 'node'\n          ? 'server'\n          : target === 'browser'\n          ? 'es5'\n          : 'modern-browsers'\n      }.css`,\n    }),\n    new OptimizeCssAssetsPlugin(),\n\n    // target === 'browser' &&\n    // target !== 'node' &&\n    //   production &&\n    //   new optimize.UglifyJsPlugin({\n    //     compress: {\n    //       warnings: false,\n    //     },\n    //     sourcleMap: !production,\n    //   }),!== 'node' &&\n    //   production &&\n    //   new optimize.UglifyJsPlugin({\n    //     compress: {\n    //       warnings: false,\n    //     },\n    //     sourceMap: !production,\n    //   }),\n    // TODO https://github.com/NekR/offline-plugin\n  ].filter(Boolean),\n});\n","import path from 'path';\nimport {\n  createAppBrowserCompiler,\n  MODERN,\n  ALL,\n  runDevServer as runDevServerPobpack,\n  RunOptions,\n} from 'pobpack-browser';\nimport { PobpackCompiler } from 'pobpack-types';\nimport createPobpackConfig from './createPobpackConfig';\n\nexport const createModernBrowserCompiler = (production: boolean) =>\n  createAppBrowserCompiler(\n    MODERN,\n    createPobpackConfig('modern-browser', production),\n  );\n\nexport const createOlderBrowserCompiler = (production: boolean) =>\n  createAppBrowserCompiler(ALL, createPobpackConfig('browser', production));\n\nexport type RunDevServerOptions = Pick<\n  RunOptions,\n  Exclude<keyof RunOptions, 'port' | 'https' | 'headers' | 'proxy'>\n>;\n\nexport const runDevServer = (\n  compiler: PobpackCompiler,\n  port: number,\n  proxyPort: number,\n  options?: RunDevServerOptions,\n): ReturnType<typeof runDevServerPobpack> =>\n  runDevServerPobpack(compiler, {\n    port: proxyPort,\n    https: false,\n\n    contentBase: path.resolve('public'),\n    watchContentBase: true,\n\n    headers: {\n      // avoid errors in console\n      'Access-Control-Expose-Headers': 'SourceMap,X-SourceMap',\n    },\n\n    proxy: {\n      '**': `http://localhost:${port}`,\n    },\n\n    ...options,\n  });\n","import argv from 'minimist-argv';\nimport { createModernBrowserCompiler, runDevServer } from './webpack/browser';\n\nconst browserCompiler = createModernBrowserCompiler(false);\n\nrunDevServer(browserCompiler, argv.port, argv['proxy-port'], {\n  host: argv.host,\n});\n"],"names":["target","production","env","process","NODE_ENV","hmr","typescript","includeModules","paths","build","entries","key","path","resolveLoaderModules","join","__dirname","babel","minified","comments","presets","require","resolve","development","useBuiltIns","resolvePreset","preset","exportDefaultName","optimizations","version","undefined","loose","modules","filter","Boolean","plugins","moduleRules","createModuleRules","extractLoader","MiniCssExtractPlugin","loader","themeFile","autoprefixer","includePaths","resolveLoader","test","options","emitFile","limit","name","filename","OptimizeCssAssetsPlugin","createModernBrowserCompiler","createAppBrowserCompiler","MODERN","createPobpackConfig","runDevServer","compiler","port","proxyPort","runDevServerPobpack","https","contentBase","watchContentBase","headers","proxy","browserCompiler","argv","host"],"mappings":"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"}