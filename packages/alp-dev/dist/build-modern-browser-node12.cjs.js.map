{"version":3,"file":"build-modern-browser-node12.cjs.js","sources":["../src/pobpack/utils/createOptions.ts","../src/pobpack/utils/createAppWebpackConfig.ts","../src/pobpack/utils/FriendlyErrorsWebpackPlugin.ts","../src/pobpack/utils/createPobpackCompiler.ts","../src/pobpack/utils/webpack/createModuleConfig.ts","../src/pobpack/utils/webpack/createPluginsConfig.ts","../src/pobpack/utils/webpack/createResolveConfig.ts","../src/pobpack/browser/createBrowserWebpackConfig.ts","../src/pobpack/browser/index.ts","../src/webpack/css-module-rules.ts","../src/webpack/createPobpackConfig.ts","../src/webpack/browser.ts","../src/build-modern-browser.ts"],"sourcesContent":["/* eslint-disable complexity */\nimport type { Options } from '../types';\n\nexport default function createOptions(options: Partial<Options>): Options {\n  return {\n    aliases: options.aliases || {},\n    babel: options.babel || {},\n    defines: options.defines || {},\n    entries: options.entries || ['index'],\n    serviceWorkerEntry:\n      options.serviceWorkerEntry === undefined\n        ? 'service-worker'\n        : options.serviceWorkerEntry,\n    env: options.env || process.env.NODE_ENV,\n    hmr: options.hmr,\n    allowlistExternalExtensions: options.allowlistExternalExtensions || [],\n    includePaths: options.includePaths || [],\n    moduleRules: options.moduleRules,\n    paths: { src: 'src', build: 'build', ...options.paths },\n    plugins: options.plugins || [],\n    prependPlugins: options.prependPlugins || [],\n    resolveLoaderModules: options.resolveLoaderModules,\n    typescript: options.typescript || false,\n    webpackPrefixPackageFields: options.webpackPrefixPackageFields || [],\n  };\n}\n","import { existsSync } from 'fs';\nimport { resolve } from 'path';\nimport type { Options, FilledWebpackConfiguration } from '../types';\nimport createOptions from './createOptions';\n\nexport type CreateWebpackConfig = (\n  options: Options,\n) => FilledWebpackConfiguration;\n\nexport type CreateWebpackConfigPartialOptions = (\n  options: Partial<Options>,\n) => FilledWebpackConfiguration;\n\nexport type AppWebpackConfigCreator = (\n  createWebpackConfig: CreateWebpackConfigPartialOptions,\n  options: Partial<Options>,\n) => FilledWebpackConfiguration;\n\nexport function createAppWebpackConfig(\n  createWebpackConfig: CreateWebpackConfig,\n): CreateWebpackConfigPartialOptions {\n  const wrapCreateWebpackConfig: CreateWebpackConfigPartialOptions = (\n    options,\n  ) => createWebpackConfig(createOptions(options));\n\n  return (options: Partial<Options>): FilledWebpackConfiguration => {\n    const appWebpackConfigPath = resolve('createAppWebpackConfig.js');\n    if (existsSync(appWebpackConfigPath)) {\n      console.info('Using app createAppWebpackConfig.js');\n      // eslint-disable-next-line import/no-dynamic-require, @typescript-eslint/no-var-requires, @typescript-eslint/no-unsafe-assignment\n      const appWebpackConfigCreator: AppWebpackConfigCreator = require(appWebpackConfigPath);\n      if (typeof appWebpackConfigCreator !== 'function') {\n        console.error(\n          'app createAppWebpackConfig.js should export a function\\n' +\n            'module.exports = function (config, options) { ... }',\n        );\n      }\n\n      options = createOptions(options);\n      const config = appWebpackConfigCreator(wrapCreateWebpackConfig, options);\n\n      if (typeof config !== 'object') {\n        console.error(\n          'app createAppWebpackConfig.js should return the config\\n' +\n            'function (config, options) { return config(options); }',\n        );\n      }\n\n      return config;\n    } else {\n      return wrapCreateWebpackConfig(options);\n    }\n  };\n}\n","/* eslint-disable no-console */\n\nimport { addConfig, levels } from 'nightingale';\nimport ConsoleHandler from 'nightingale-console';\nimport Logger from 'nightingale-logger';\nimport formatWebpackMessages from 'react-dev-utils/formatWebpackMessages';\nimport type { Compiler } from 'webpack';\n\nexport interface Options {\n  bundleName: string;\n  successMessage?: string;\n}\n\naddConfig({ key: 'pobpack-utils', handler: new ConsoleHandler(levels.INFO) });\nconst logger = new Logger('pobpack-utils', 'pobpack');\n\nconst pluginName = 'pobpack/FriendlyErrorsWebpackPlugin';\n\nexport default class FriendlyErrorsWebpackPlugin {\n  logger: Logger;\n\n  bundleName: string;\n\n  successMessage?: string;\n\n  constructor(options: Options) {\n    this.bundleName = options.bundleName;\n    this.successMessage = options.successMessage;\n    this.logger = logger.context({ bundleName: options.bundleName });\n  }\n\n  apply(compiler: Compiler): void {\n    // webpack is recompiling\n    compiler.hooks.invalid.tap(pluginName, () => {\n      this.logger.info('Compiling...');\n    });\n\n    // compilation done\n    compiler.hooks.done.tap(pluginName, (stats) => {\n      const messages = formatWebpackMessages(stats.toJson({}));\n      // const messages = stats.toJson({}, true);\n\n      if (messages.errors.length > 0) {\n        if (process.send) {\n          process.send({\n            type: 'failed-to-compile',\n            errors: messages.errors.join('\\n'),\n            bundleName: this.bundleName,\n          });\n        } else {\n          this.logger.critical('Failed to compile.');\n          console.log();\n          messages.errors.forEach((message: string) => {\n            console.log(message);\n            console.log();\n          });\n        }\n        return;\n      }\n\n      if (process.send) process.send('ready');\n\n      if (messages.warnings.length > 0) {\n        if (process.send) {\n          process.send({\n            type: 'compiled-with-arnings',\n            warnings: messages.warnings.join('\\n'),\n            bundleName: this.bundleName,\n          });\n        } else {\n          this.logger.critical('Compiled with warnings.');\n          console.log();\n          messages.warnings.forEach((message: string) => {\n            console.log(message);\n            console.log();\n          });\n        }\n      }\n\n      if (process.send) {\n        process.send({\n          type: 'compiled-successfully',\n          bundleName: this.bundleName,\n        });\n      } else {\n        this.logger.success('Compiled successfully!');\n        if (this.successMessage) {\n          console.log(this.successMessage);\n        }\n      }\n    });\n  }\n}\n","import { execSync } from 'child_process';\nimport { promisify } from 'util';\nimport type { Stats } from 'webpack';\nimport webpack from 'webpack';\nimport type {\n  PobpackCompiler,\n  CreateCompilerOptions,\n  FilledWebpackConfiguration,\n} from '../types';\nimport FriendlyErrorsWebpackPlugin from './FriendlyErrorsWebpackPlugin';\n\nconst buildThrowOnError = (stats?: Stats): Stats | undefined => {\n  if (!stats) return stats;\n  if (!stats.hasErrors()) {\n    return stats;\n  }\n\n  throw new Error(stats.toString({}));\n};\n\nexport function createPobpackCompiler(\n  bundleName: string,\n  webpackConfig: FilledWebpackConfiguration,\n  { successMessage }: CreateCompilerOptions = {},\n): PobpackCompiler {\n  const compiler = webpack(webpackConfig);\n\n  // human-readable error messages\n  new FriendlyErrorsWebpackPlugin({ bundleName, successMessage }).apply(\n    compiler,\n  );\n\n  const promisifyRun: () => Promise<Stats | undefined> = promisify(\n    compiler.run.bind(compiler),\n  );\n\n  return {\n    compiler,\n    webpackConfig,\n    clean: (): undefined => {\n      if (webpackConfig.output?.path) {\n        execSync(`rm -Rf ${webpackConfig.output.path}`);\n      }\n      return undefined;\n    },\n    run: (): Promise<Stats | undefined> =>\n      promisifyRun().then(buildThrowOnError),\n    watch: (callback: (stats?: Stats) => unknown) =>\n      compiler.watch({}, (err?: Error, stats?: Stats): void => {\n        if (err || !stats) return;\n        if (stats.hasErrors()) return;\n        buildThrowOnError(stats);\n        callback(stats);\n      }),\n  };\n}\n","import { resolve } from 'path';\nimport type { Configuration } from 'webpack';\nimport type { Options } from '../../types';\n\nexport default function createModuleConfig(\n  options: Options,\n): NonNullable<Configuration['module']> {\n  return {\n    strictExportPresence: true,\n\n    rules: [\n      // tsx? / jsx?\n      {\n        test: options.typescript ? /\\.(mjs|[jt]sx?)$/ : /\\.(mjs|jsx?)$/,\n        include: [\n          resolve(options.paths.src as string),\n          ...options.includePaths,\n        ],\n        rules: [\n          {\n            loader: require.resolve('babel-loader'),\n            options: {\n              babelrc: false,\n              configFile: false,\n              cacheDirectory: true,\n              ...options.babel,\n            },\n          },\n        ],\n      },\n\n      // other rules\n      ...(options.moduleRules || []),\n    ],\n  };\n}\n","import CaseSensitivePathsPlugin from 'case-sensitive-paths-webpack-plugin';\nimport type { Configuration } from 'webpack';\nimport webpack from 'webpack';\nimport type { Options } from '../../types';\n\nconst ExcludesFalsy = (Boolean as unknown) as <T>(\n  x: T | boolean | null | undefined,\n) => x is T;\n\nexport default function createPluginsConfig(\n  options: Options,\n): NonNullable<Configuration['plugins']> {\n  const plugins: unknown[] = [\n    ...(options.prependPlugins || []),\n\n    // enforces the entire path of all required modules match the exact case\n    // of the actual path on disk. Using this plugin helps alleviate cases\n    // for developers working on case insensitive systems like OSX.\n    options.env !== 'production' && new CaseSensitivePathsPlugin(),\n\n    new webpack.DefinePlugin({\n      'process.env.NODE_ENV': JSON.stringify(options.env),\n      ...options.defines,\n    }),\n\n    /* replace object-assign ponyfill to use native implementation */\n\n    // Array.isArray\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/isarray\\/index.js$/,\n      require.resolve('../replacements/Array.isArray.js'),\n    ),\n\n    // Object.assign\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/(object-assign|extend-shallow)\\/index.js$/,\n      require.resolve('../replacements/Object.assign.js'),\n    ),\n\n    // Object.setPrototypeOf\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/setprototypeof\\/index.js$/,\n      require.resolve('../replacements/Object.setPrototypeOf.js'),\n    ),\n\n    // Promise\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/any-promise\\/index.js$/,\n      require.resolve('../replacements/Promise.js'),\n    ),\n\n    // String.prototype.repeat\n    new webpack.NormalModuleReplacementPlugin(\n      /.*\\/node_modules\\/repeat-string\\/index.js$/,\n      require.resolve('../replacements/String.prototype.repeat.js'),\n    ),\n\n    // Symbol.observable\n    // https://github.com/tc39/proposal-observable\n    // https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/observable\n    // new webpack.NormalModuleReplacementPlugin(\n    //   /.*\\/node_modules\\/symbol-observable\\/es\\/ponyfill.js$/,\n    //   require.resolve('../replacements/Symbol.observable.js'),\n    // ),\n\n    ...options.plugins,\n  ];\n\n  return plugins.filter(ExcludesFalsy) as NonNullable<Configuration['plugins']>;\n}\n","/* eslint-disable complexity */\nimport { resolve } from 'path';\nimport type { Configuration } from 'webpack';\nimport type { Options } from '../../types';\n\nconst ExcludesFalsy = (Boolean as unknown) as <T>(\n  x: T | boolean | null | undefined,\n) => x is T;\n\nexport default function createResolveConfig(\n  modulePrefixPackageFields: string[],\n  conditionNames: string[],\n  options: Options,\n  targetAliases?: Options['aliases'],\n): NonNullable<Configuration['resolve']> {\n  return {\n    // https://github.com/DefinitelyTyped/DefinitelyTyped/pull/25209\n    // cacheWithContext: false,\n\n    modules: ['node_modules', resolve('src')],\n    extensions: [\n      options.typescript && '.ts',\n      options.typescript && '.tsx',\n      '.mjs',\n      '.js',\n      '.jsx',\n    ].filter(ExcludesFalsy),\n\n    conditionNames: [\n      ...conditionNames,\n      options.env !== 'production' ? 'development' : undefined,\n      'import',\n    ].filter(ExcludesFalsy),\n\n    mainFields: [\n      ...([] as (string | false)[]).concat(\n        ...modulePrefixPackageFields.map((prefix: string): (\n          | string\n          | false\n        )[] => [\n          options.env !== 'production' && `module:${prefix}-dev`,\n          `module:${prefix}`,\n          // old `webpack:` syntax\n          options.env !== 'production' && `webpack:${prefix}-dev`,\n          `webpack:${prefix}`,\n        ]),\n      ),\n\n      options.env !== 'production' && 'module-dev',\n      'module',\n      // old webpack: syntax\n      options.env !== 'production' && 'webpack:main-dev',\n      'webpack:main',\n\n      ...(!modulePrefixPackageFields.includes('browser')\n        ? []\n        : [\n            // Browser builds\n            options.env !== 'production' && 'browser-dev',\n            'browser',\n          ]),\n      options.env !== 'production' && 'main-dev',\n      'main',\n    ].filter(ExcludesFalsy),\n\n    aliasFields: [\n      ...([] as (string | false)[]).concat(\n        ...modulePrefixPackageFields.map((prefix: string): (\n          | string\n          | false\n        )[] => [\n          options.env !== 'production' && `module:aliases-${prefix}-dev`,\n          `module:aliases-${prefix}`,\n\n          // old webpack: syntax\n          options.env !== 'production' && `webpack:aliases-${prefix}-dev`,\n          `webpack:aliases-${prefix}`,\n        ]),\n      ),\n\n      options.env !== 'production' && 'module:aliases-dev',\n      'module:aliases',\n\n      // old webpack: syntax\n      options.env !== 'production' && 'webpack:aliases-dev',\n      'webpack:aliases',\n      'webpack',\n      modulePrefixPackageFields.includes('browser') &&\n        options.env !== 'production' &&\n        'browser-dev',\n      modulePrefixPackageFields.includes('browser') && 'browser',\n    ].filter(ExcludesFalsy),\n\n    alias: { ...options.aliases, ...targetAliases },\n  };\n}\n","/* eslint-disable camelcase */\n/* eslint-disable complexity */\nimport path from 'path';\nimport ReactRefreshWebpackPlugin from '@pmmmwh/react-refresh-webpack-plugin';\nimport CssMinimizerPlugin from 'css-minimizer-webpack-plugin';\nimport TerserPlugin from 'terser-webpack-plugin';\nimport WorkboxWebpackPlugin from 'workbox-webpack-plugin';\nimport type {\n  Options,\n  ConfigEntry,\n  FilledWebpackConfiguration,\n} from '../types';\nimport {\n  createModuleConfig,\n  createPluginsConfig,\n  createResolveConfig,\n} from '../utils';\n\nexport type BrowserTargetType = 'modern' | 'all';\n\nexport const MODERN = 'modern';\nexport const ALL = 'all';\nexport const TARGETS: BrowserTargetType[] = [ALL, MODERN];\n\nconst ExcludesFalsy = (Boolean as unknown) as <T>(\n  x: T | boolean | null | undefined,\n) => x is T;\n\nexport default function createBrowserWebpackConfig(target: BrowserTargetType) {\n  return (options: Options): FilledWebpackConfiguration => ({\n    // production or development\n    mode: options.env === 'production' ? 'production' : 'development',\n\n    // Don't attempt to continue if there are any errors.\n    bail: options.env === 'production',\n\n    // Target web\n    target: target === MODERN ? 'browserslist:modern' : 'browserslist',\n\n    // get right stack traces\n    devtool:\n      options.env === 'production' ? 'nosources-source-map' : 'source-map',\n\n    infrastructureLogging: {\n      level: 'none',\n    },\n\n    optimization: {\n      nodeEnv: false, // see createPluginsConfig\n      emitOnErrors: false,\n      minimize: options.env === 'production',\n      minimizer: [\n        // This is only used in production mode\n        new TerserPlugin({\n          terserOptions: {\n            parse: {\n              ecma: 2019,\n            },\n            compress: {\n              ecma: 5,\n            },\n            mangle: {\n              safari10: true,\n            },\n            // Added for profiling in devtools\n            keep_classnames: options.productionProfiling || false,\n            keep_fnames: options.productionProfiling || false,\n            output: {\n              ecma: 5,\n              comments: false,\n              // issue with emoji\n              ascii_only: true,\n            },\n          },\n        }),\n        // This is only used in production mode\n        new CssMinimizerPlugin(),\n      ],\n    },\n\n    // use cache\n    cache: options.hmr,\n\n    resolveLoader: {\n      modules: options.resolveLoaderModules || ['node_modules'],\n    },\n\n    resolve: createResolveConfig(\n      [target === MODERN ? 'modern-browsers' : undefined, 'browser'].filter(\n        ExcludesFalsy,\n      ),\n      [\n        target === MODERN ? 'browser:modern' : undefined,\n        'browser',\n        options.env === 'production' ? 'production' : 'development',\n      ].filter(ExcludesFalsy),\n      {\n        ...options,\n        babel: {\n          ...options.babel,\n          plugins: [\n            ...(options.babel.plugins || []),\n            options.hmr && require.resolve('react-refresh/babel'),\n          ].filter(ExcludesFalsy),\n        },\n      },\n      {\n        'react-native$': 'react-native-web',\n        ...(options.productionProfiling\n          ? {\n              'react-dom$': 'react-dom/profiling',\n              'scheduler/tracing': 'scheduler/tracing-profiling',\n            }\n          : {}),\n      },\n    ),\n\n    entry: options.entries.reduce(\n      (entries: { [key: string]: string[] }, entry: ConfigEntry) => {\n        if (typeof entry === 'string') entry = { key: entry, path: entry };\n        entries[entry.key] = [\n          // options.env !== 'production' && require.resolve('../source-map-support'),\n          target !== MODERN && require.resolve('regenerator-runtime/runtime'),\n          path.join(path.resolve(options.paths.src as string), entry.path),\n        ].filter(ExcludesFalsy);\n        return entries;\n      },\n      {},\n    ),\n\n    output: {\n      path: path.resolve(options.paths.build as string),\n      pathinfo: options.env !== 'production',\n      filename:\n        options.env !== 'production'\n          ? 'static/js/[name].[contenthash:8].js'\n          : 'static/js/bundle-[name].js',\n      chunkFilename:\n        options.env !== 'production'\n          ? 'static/js/[name].[contenthash:8].chunk.js'\n          : 'static/js/[name].chunk.js',\n      assetModuleFilename: 'static/media/[name].[contenthash:8][ext]',\n      publicPath: options.paths.build,\n\n      // Point sourcemap entries to original disk location\n      devtoolModuleFilenameTemplate:\n        options.env === 'production'\n          ? (info: { absoluteResourcePath: string }) =>\n              path\n                .relative(\n                  options.paths.src as string,\n                  info.absoluteResourcePath,\n                )\n                .replace(/\\\\/g, '/')\n          : // eslint-disable-next-line unicorn/no-nested-ternary\n          options.env === 'development'\n          ? (info: { absoluteResourcePath: string }) =>\n              path.resolve(info.absoluteResourcePath).replace(/\\\\/g, '/')\n          : undefined,\n    },\n\n    module: createModuleConfig(options),\n\n    plugins: [\n      ...createPluginsConfig(options),\n      options.hmr &&\n        new ReactRefreshWebpackPlugin({\n          overlay: false,\n        }),\n      options.env === 'production' &&\n      options.paths.src &&\n      options.serviceWorkerEntry\n        ? new WorkboxWebpackPlugin.InjectManifest({\n            swSrc: path.resolve(\n              options.paths.src,\n              options.serviceWorkerEntry.endsWith('.js') ||\n                options.serviceWorkerEntry.endsWith('.ts')\n                ? options.serviceWorkerEntry\n                : `${options.serviceWorkerEntry}${\n                    options.typescript ? '.ts' : '.js'\n                  }`,\n            ),\n            compileSrc: true,\n            dontCacheBustURLsMatching: /\\.[\\da-f]{8}\\./,\n            exclude: [/\\.map$/, /asset-manifest\\.json$/, /LICENSE/],\n          })\n        : undefined,\n    ].filter(ExcludesFalsy),\n  });\n}\n","import type { Stats } from 'webpack';\nimport type { Options, PobpackCompiler, CreateCompilerOptions } from '../types';\nimport { createPobpackCompiler, createAppWebpackConfig } from '../utils';\nimport type { BrowserTargetType } from './createBrowserWebpackConfig';\nimport createBrowserWebpackConfig, {\n  TARGETS,\n  ALL,\n  MODERN,\n} from './createBrowserWebpackConfig';\n\nexport { TARGETS, ALL, MODERN };\n\nexport const createAppBrowserCompiler = (\n  target: BrowserTargetType,\n  options: Partial<Options>,\n  compilerOptions?: CreateCompilerOptions,\n): PobpackCompiler =>\n  createPobpackCompiler(\n    target,\n    createAppWebpackConfig(createBrowserWebpackConfig(target))({\n      entries: [{ key: target, path: 'index' }], // override default entry\n      ...options,\n      paths: { build: 'public', ...options.paths },\n    }),\n    compilerOptions,\n  );\n\nexport const build = (options = {}): Promise<Stats | undefined>[] => {\n  if (!process.env.NODE_ENV) process.env.NODE_ENV = 'production';\n  const compilers = TARGETS.map((t) =>\n    createAppBrowserCompiler(t, { ...options, hmr: false }),\n  );\n  compilers[0].clean();\n  return compilers.map((compiler) => compiler.run());\n};\n\n// export const watchAndRunDevServer = (\n//   options: Partial<Options>,\n//   runOptions: RunOptions,\n// ): PobpackBrowserCompiler => {\n//   const url = `http${runOptions.https ? 's' : ''}://localhost:${\n//     runOptions.port\n//   }`;\n//   const compiler: PobpackCompiler = createAppBrowserCompiler(\n//     MODERN,\n//     { ...options, hmr: true },\n//     {\n//       successMessage: `Your application is running here: ${url}`,\n//     },\n//   );\n//   compiler.clean();\n//   const webpackDevServer = runDevServer(compiler, runOptions);\n//   return { ...compiler, webpackDevServer };\n// };\n","/* eslint-disable max-lines, complexity */\nimport path from 'path';\nimport type { RuleSetUseItem, RuleSetRule } from 'webpack';\n\ntype Target = 'node' | 'modern-browser' | 'browser';\n\nexport interface CreateCssModuleUseOptions {\n  target: Target;\n  extractLoader: RuleSetUseItem;\n  global?: boolean;\n  plugins: any[];\n  production: boolean;\n  otherLoaders?: RuleSetUseItem[];\n}\n\nexport interface CreateScssModuleUseOptions {\n  target: Target;\n  extractLoader: RuleSetUseItem;\n  global?: boolean;\n  plugins: any[];\n  production: boolean;\n  themeFile?: string;\n  otherLoaders?: RuleSetUseItem[];\n  includePaths?: string[];\n}\n\nexport interface CreateModuleRulesOptions {\n  target: Target;\n  extractLoader: RuleSetUseItem;\n  plugins: any[];\n  production: boolean;\n  themeFile?: string;\n  includePaths?: string[];\n}\n\nexport interface StylesCacheGroups {\n  name: 'styles';\n  test: RegExp;\n  chunks: 'all';\n  enforce: true;\n}\n\ntype CreateCssModuleUseFn = (\n  options: CreateCssModuleUseOptions,\n) => RuleSetUseItem[];\ntype CreateScssModuleUseFn = (\n  options: CreateScssModuleUseOptions,\n) => RuleSetUseItem[];\ntype CreateModuleRulesFn = (options: CreateModuleRulesOptions) => RuleSetRule[];\n\nconst ExcludesFalsy = (Boolean as any) as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nconst resolveLoader = (loader: string): string => require.resolve(loader);\n\nconst cssLoaderOptions = function (\n  importLoaders: number,\n  global: boolean,\n  production: boolean,\n  targetIsNode: boolean,\n): any {\n  return {\n    sourceMap: !production,\n    modules: global\n      ? false\n      : {\n          exportOnlyLocals: targetIsNode,\n          localIdentName:\n            production !== false\n              ? '[hash:base64]'\n              : '[name]__[local]___[hash:base64:5]',\n        },\n    importLoaders,\n  };\n};\n\nexport const createCssModuleUse: CreateCssModuleUseFn = function ({\n  target,\n  extractLoader,\n  global = false,\n  plugins,\n  production,\n  otherLoaders = [],\n}) {\n  if (global && target === 'node') {\n    return [{ loader: resolveLoader('ignore-loader') }];\n  }\n\n  return [\n    target !== 'node' && extractLoader,\n    {\n      loader: resolveLoader('css-loader'),\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment\n      options: cssLoaderOptions(\n        otherLoaders.length + 1 + (!global && !production ? 1 : 0),\n        global,\n        production,\n        target === 'node',\n      ),\n    },\n    !global &&\n      !production &&\n      target !== 'node' && {\n        loader: resolveLoader('typed-css-modules-loader'),\n        options: { noEmit: true },\n      },\n    {\n      loader: resolveLoader('postcss-loader'),\n      options: {\n        sourceMap: !production,\n        postcssOptions: {\n          ident: 'postcss',\n          plugins,\n        },\n      },\n    },\n    ...otherLoaders,\n  ].filter(ExcludesFalsy);\n};\n\nconst createScssModuleUse: CreateScssModuleUseFn = function ({\n  target,\n  extractLoader,\n  global = false,\n  plugins,\n  production,\n  themeFile,\n  includePaths = [],\n}) {\n  return createCssModuleUse({\n    target,\n    extractLoader,\n    global,\n    plugins,\n    production,\n    otherLoaders: [\n      {\n        loader: resolveLoader('sass-loader'),\n        options: {\n          sourceMap: !production,\n          additionalData: `$env: ${process.env.NODE_ENV as string};${\n            themeFile ? `@import '${path.resolve(themeFile)}';` : ''\n          }`,\n          sassOptions: {\n            outputStyle: production !== false ? undefined : 'compressed',\n            includePaths,\n          },\n        },\n      },\n    ],\n  });\n};\n\nconst createCssModuleRule = function (\n  options: CreateCssModuleUseOptions,\n): RuleSetRule {\n  return {\n    test: /\\.css$/,\n    sideEffects: true,\n    use: createCssModuleUse(options),\n  };\n};\n\nconst fileExtensions = ['css', 'scss'];\n\nexport const stylesCacheGroups = {\n  name: 'styles',\n  test: new RegExp(`\\\\.+(${[...fileExtensions].join('|')})$`),\n  chunks: 'all',\n  enforce: true,\n};\n\nexport const createModuleRules: CreateModuleRulesFn = function ({\n  target,\n  extractLoader,\n  plugins,\n  production,\n  themeFile,\n  includePaths,\n}) {\n  return [\n    {\n      test: /\\.scss$/,\n      oneOf: [\n        {\n          test: /\\.global\\.scss$/,\n          sideEffects: true,\n          use: createScssModuleUse({\n            target,\n            extractLoader,\n            global: true,\n            plugins,\n            production,\n            themeFile,\n            includePaths,\n          }),\n        },\n        {\n          sideEffects: true,\n          use: createScssModuleUse({\n            target,\n            extractLoader,\n            global: false,\n            plugins,\n            production,\n            themeFile,\n            includePaths,\n          }),\n        },\n      ],\n    },\n\n    createCssModuleRule({\n      target,\n      extractLoader,\n      global: false,\n      plugins,\n      production,\n    }),\n  ];\n};\n","/* eslint-disable @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment, complexity, max-lines */\n\nimport fs from 'fs';\nimport path from 'path';\nimport autoprefixer from 'autoprefixer';\nimport MiniCssExtractPlugin from 'mini-css-extract-plugin';\nimport webpack from 'webpack';\nimport type { Options } from '../pobpack/types';\nimport { createModuleRules, createCssModuleUse } from './css-module-rules';\n\n// stylesCacheGroups\n\ntype TargetType = 'node' | 'modern-browser' | 'browser';\n\nconst ExcludesFalsy = (Boolean as any) as <T>(\n  x: T | false | null | undefined,\n) => x is T;\n\nexport default function createPobpackConfig(\n  target: TargetType,\n  production = false,\n): Partial<Options> {\n  const pkg = JSON.parse(\n    fs.readFileSync(path.resolve('package.json'), 'utf-8'),\n  );\n  const deps = pkg.dependencies || {};\n  const devdeps = pkg.devDependencies || {};\n\n  const hasAntd = !!deps.antd;\n\n  if (deps.antd) {\n    if (!devdeps.less) {\n      throw new Error('less missing: yarn add --dev less');\n    }\n  }\n\n  return {\n    env: process.env.NODE_ENV,\n    hmr: !production,\n    typescript: true,\n\n    allowlistExternalExtensions: [\n      'png',\n      'jpg',\n      'jpeg',\n      'gif',\n      'svg',\n      'scss',\n      'css',\n    ],\n\n    paths: {\n      build: target === 'node' ? 'build' : 'public',\n    },\n\n    entries: [\n      {\n        key:\n          target === 'node'\n            ? 'index'\n            : // eslint-disable-next-line unicorn/no-nested-ternary\n            target === 'browser'\n            ? 'es5'\n            : 'modern-browsers',\n        path: target === 'node' ? 'index.server.ts' : 'index.browser.ts',\n      },\n    ],\n\n    resolveLoaderModules: [\n      path.join(__dirname, '../..', 'node_modules'),\n      'node_modules',\n    ],\n\n    babel: {\n      minified: target !== 'node' && production,\n      comments: !(target !== 'node' && production),\n\n      presets: [\n        // add react preset with jsx\n        [\n          require.resolve('@babel/preset-react'),\n          { development: !production, useBuiltIns: true, runtime: 'automatic' },\n        ],\n        // pob preset: flow, import `src`, export default function name, replacements, exnext features, ...\n        [\n          require.resolve('babel-preset-pob-env'),\n          {\n            resolvePreset: (preset: string): string => require.resolve(preset),\n            production,\n            typescript: true,\n            optimizations: true,\n            target: target === 'node' ? 'node' : 'browser',\n            version:\n              target === 'node'\n                ? '12.10'\n                : // eslint-disable-next-line unicorn/no-nested-ternary\n                target === 'modern-browser'\n                ? 'modern'\n                : undefined,\n            loose: true,\n            modules: false,\n          },\n        ],\n      ],\n      plugins: [\n        require.resolve('babel-plugin-inline-classnames-babel7'),\n        hasAntd && [\n          require.resolve('babel-plugin-import'),\n          {\n            libraryName: 'antd',\n            libraryDirectory: target === 'node' ? 'lib' : 'es',\n            style: target !== 'node',\n          },\n        ],\n      ].filter(ExcludesFalsy),\n    },\n\n    moduleRules: [\n      // SCSS RULE, CSS RULE\n      ...createModuleRules({\n        target,\n        extractLoader: {\n          loader: MiniCssExtractPlugin.loader,\n          options: { esModule: true },\n        },\n        production,\n        themeFile: './src/theme.scss',\n        plugins: [autoprefixer],\n        includePaths: [path.resolve('./node_modules')],\n      }),\n\n      // LESS RULE (antd)\n      {\n        test: /\\.less$/,\n        use: createCssModuleUse({\n          global: true,\n          target,\n          extractLoader: {\n            loader: MiniCssExtractPlugin.loader,\n            options: { publicPath: '../..' },\n          },\n          production,\n          plugins: [autoprefixer],\n          otherLoaders: [\n            {\n              loader: require.resolve('less-loader'),\n              options: {\n                javascriptEnabled: true,\n                // modifyVars: path.resolve('./src/less-modifyVars.js'),\n              },\n            },\n            {\n              loader: require.resolve('less-modify-var-loader'),\n              options: {\n                filePath: path.resolve('./src/theme.less'),\n              },\n            },\n          ],\n        }),\n      },\n\n      // IMG RULE\n      {\n        test: /\\.(png|jpg|jpeg|gif|svg)$/,\n        type: 'asset',\n        parser: {\n          dataUrlCondition: {\n            maxSize: 1024, // 1kb\n          },\n        },\n      },\n    ],\n\n    // TODO https://github.com/zeit/next.js/blob/7d78c3b64185d6d6417f1af9cde4a69d32b18cc6/packages/next/build/webpack.js\n    // optimization: {\n    //   minimizer:\n    //     target === 'browser' ? [new OptimizeCssAssetsPlugin()] : undefined,\n    //   splitChunks: {\n    //     cacheGroups: {\n    //       styles: stylesCacheGroups,\n    //     },\n    //   },\n    // },\n\n    plugins: [\n      new MiniCssExtractPlugin({\n        experimentalUseImportModule: true,\n        filename: `${\n          target === 'node'\n            ? 'server'\n            : // eslint-disable-next-line unicorn/no-nested-ternary\n            target === 'browser'\n            ? 'es5'\n            : 'modern-browsers'\n        }.css`, // [name].[contenthash:8].css\n        chunkFilename: 'css/[name].[contenthash:8].chunk.css',\n        runtime: target !== 'node',\n      }),\n\n      process.send &&\n        new webpack.ProgressPlugin(\n          (percentage: number, message: string): void => {\n            (process.send as NonNullable<typeof process.send>)({\n              type: 'webpack-progress',\n              percentage,\n              message,\n            });\n          },\n        ),\n\n      // TODO https://github.com/NekR/offline-plugin\n    ].filter(ExcludesFalsy),\n  };\n}\n","import path from 'path';\nimport evalSourceMapMiddleware from 'react-dev-utils/evalSourceMapMiddleware';\nimport ignoredFiles from 'react-dev-utils/ignoredFiles';\nimport noopServiceWorkerMiddleware from 'react-dev-utils/noopServiceWorkerMiddleware';\nimport WebpackDevServer from 'webpack-dev-server';\nimport { createAppBrowserCompiler, MODERN, ALL } from '../pobpack/browser';\nimport type { PobpackCompiler } from '../pobpack/types';\nimport createPobpackConfig from './createPobpackConfig';\n\nexport const createModernBrowserCompiler = (\n  production: boolean,\n): PobpackCompiler =>\n  createAppBrowserCompiler(\n    MODERN,\n    createPobpackConfig('modern-browser', production),\n    { progressBar: false },\n  );\n\nexport const createOlderBrowserCompiler = (\n  production: boolean,\n): PobpackCompiler =>\n  createAppBrowserCompiler(ALL, createPobpackConfig('browser', production));\n\nexport type RunDevServerOptions = Pick<WebpackDevServer.Configuration, 'https'>;\n\nexport const runDevServer = (\n  compiler: PobpackCompiler,\n  port: number,\n  proxyPort: number,\n  options?: RunDevServerOptions,\n): WebpackDevServer => {\n  const browserDevServer = new WebpackDevServer(\n    {\n      host: process.env.ALP_DEV_WEBPACK_DEV_SERVER_HOST || '0.0.0.0',\n      port: proxyPort,\n      hot: true,\n      allowedHosts: 'all',\n\n      devMiddleware: {\n        publicPath: '/',\n      },\n\n      client: {\n        logging: 'none',\n        overlay: {\n          errors: true,\n          warnings: false,\n        },\n      },\n\n      proxy: {\n        '/ws': { target: `http://localhost:${port}`, ws: true },\n        '**': { target: `http://localhost:${port}` },\n      },\n\n      static: {\n        directory: path.resolve('public'),\n        // use react-scripts ignoredFiles for perf\n        watch: {\n          ignored: ignoredFiles(path.resolve('src')),\n        },\n      },\n\n      headers: {\n        // avoid errors in console\n        'Access-Control-Expose-Headers': 'SourceMap,X-SourceMap',\n      },\n\n      https: false,\n\n      onBeforeSetupMiddleware(devServer) {\n        // https://github.com/facebook/create-react-app/blob/30ee52cf3b2cbb6ac70999c02b1196bcaba8d4ca/packages/react-scripts/config/webpackDevServer.config.js#L99\n        // This lets us fetch source contents from webpack for the error overlay\n        // @ts-expect-error react-dev-tools types is not up-to-date\n        devServer.app.use(evalSourceMapMiddleware(devServer));\n      },\n\n      onAfterSetupMiddleware(devServer) {\n        // This service worker file is effectively a 'no-op' that will reset any\n        // previous service worker registered for the same host:port combination.\n        // We do this in development to avoid hitting the production cache if\n        // it used the same host and port.\n        // https://github.com/facebook/create-react-app/issues/2272#issuecomment-302832432\n        devServer.app.use(noopServiceWorkerMiddleware('/'));\n      },\n\n      ...options,\n    },\n    compiler.compiler,\n  );\n\n  browserDevServer.start().catch((err: any) => {\n    if (err) {\n      console.error(err);\n    }\n  });\n\n  ['SIGINT', 'SIGTERM'].forEach((sig) => {\n    process.on(sig, () => {\n      browserDevServer.stopCallback(() => {\n        process.exit();\n      });\n    });\n  });\n\n  return browserDevServer;\n};\n","import { createModernBrowserCompiler } from './webpack/browser';\n\nconst browserCompiler = createModernBrowserCompiler(\n  process.env.NODE_ENV !== 'development',\n);\n\n// eslint-disable-next-line @typescript-eslint/no-floating-promises\nbrowserCompiler.run();\n"],"names":["createOptions","options","aliases","babel","defines","entries","serviceWorkerEntry","undefined","env","process","NODE_ENV","hmr","allowlistExternalExtensions","includePaths","moduleRules","paths","src","build","plugins","prependPlugins","resolveLoaderModules","typescript","webpackPrefixPackageFields","createAppWebpackConfig","createWebpackConfig","wrapCreateWebpackConfig","appWebpackConfigPath","resolve","existsSync","console","info","appWebpackConfigCreator","require","error","config","addConfig","key","handler","ConsoleHandler","levels","INFO","logger","Logger","pluginName","FriendlyErrorsWebpackPlugin","constructor","bundleName","successMessage","context","apply","compiler","hooks","invalid","tap","done","stats","messages","formatWebpackMessages","toJson","errors","length","send","type","join","critical","log","forEach","message","warnings","success","buildThrowOnError","hasErrors","Error","toString","createPobpackCompiler","webpackConfig","webpack","promisifyRun","promisify","run","bind","clean","output","path","execSync","then","watch","callback","err","createModuleConfig","strictExportPresence","rules","test","include","loader","babelrc","configFile","cacheDirectory","ExcludesFalsy","Boolean","createPluginsConfig","CaseSensitivePathsPlugin","DefinePlugin","JSON","stringify","NormalModuleReplacementPlugin","filter","createResolveConfig","modulePrefixPackageFields","conditionNames","targetAliases","modules","extensions","mainFields","concat","map","prefix","includes","aliasFields","alias","MODERN","createBrowserWebpackConfig","target","mode","bail","devtool","infrastructureLogging","level","optimization","nodeEnv","emitOnErrors","minimize","minimizer","TerserPlugin","terserOptions","parse","ecma","compress","mangle","safari10","keep_classnames","productionProfiling","keep_fnames","comments","ascii_only","CssMinimizerPlugin","cache","resolveLoader","entry","reduce","pathinfo","filename","chunkFilename","assetModuleFilename","publicPath","devtoolModuleFilenameTemplate","relative","absoluteResourcePath","replace","module","ReactRefreshWebpackPlugin","overlay","WorkboxWebpackPlugin","InjectManifest","swSrc","endsWith","compileSrc","dontCacheBustURLsMatching","exclude","createAppBrowserCompiler","compilerOptions","cssLoaderOptions","importLoaders","global","production","targetIsNode","sourceMap","exportOnlyLocals","localIdentName","createCssModuleUse","extractLoader","otherLoaders","noEmit","postcssOptions","ident","createScssModuleUse","themeFile","additionalData","sassOptions","outputStyle","createCssModuleRule","sideEffects","use","createModuleRules","oneOf","createPobpackConfig","pkg","fs","readFileSync","deps","dependencies","devdeps","devDependencies","hasAntd","antd","less","__dirname","minified","presets","development","useBuiltIns","runtime","resolvePreset","preset","optimizations","version","loose","libraryName","libraryDirectory","style","MiniCssExtractPlugin","esModule","autoprefixer","javascriptEnabled","filePath","parser","dataUrlCondition","maxSize","experimentalUseImportModule","ProgressPlugin","percentage","createModernBrowserCompiler","progressBar","browserCompiler"],"mappings":"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"}