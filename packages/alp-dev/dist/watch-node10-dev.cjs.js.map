{"version":3,"file":"watch-node10-dev.cjs.js","sources":["../src/configure-logger.ts","../src/utils/readFile.ts","../src/utils/writeFile.ts","../src/utils/loadConfigFile.ts","../src/config-build.ts","../src/watch.ts"],"sourcesContent":["import { addConfig, Level } from 'nightingale';\nimport ConsoleLogger from 'nightingale-console';\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon/,\n    handler: new ConsoleLogger(Level.NOTICE),\n    stop: true,\n  },\n  true,\n);\n","import fs from 'fs';\n\nexport default function readFile(target: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    fs.readFile(target, 'utf-8', (err, content) => {\n      if (err) {\n        return reject(\n          new Error(`Failed to read file \"${target}\": ${err.message || err}`),\n        );\n      }\n\n      resolve(content);\n    });\n  });\n}\n","import fs from 'fs';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\n\nexport default function writeFile(\n  target: string,\n  content: string,\n): Promise<void> {\n  return new Promise((resolve, reject) => {\n    mkdirp(path.dirname(target), () => {\n      fs.writeFile(target, content, (err) => {\n        if (err) {\n          return reject(\n            new Error(\n              `Failed to write file \"${target}\": ${err.message || err}`,\n            ),\n          );\n        }\n\n        resolve();\n      });\n    });\n  });\n}\n","import { readFileSync } from 'fs';\nimport path from 'path';\nimport { safeLoad as saveLoadYml } from 'js-yaml';\n\nexport interface Config {\n  [key: string]: any;\n}\n\nexport default function loadConfigFile(\n  content: string,\n  dirname: string,\n): [Config, Config] {\n  const data = saveLoadYml(content) || {};\n\n  const config = data.shared || data.common || {};\n  const serverConfig = { ...config, ...data.server };\n  const browserConfig = { ...config, ...data.browser };\n\n  if (data.include) {\n    const includePaths = data.include.map((includePath: string) =>\n      path.resolve(dirname, includePath),\n    );\n    includePaths\n      .map((includePath: string) => readFileSync(includePath, 'utf-8'))\n      .map((content: string, index: number) =>\n        loadConfigFile(content, path.dirname(includePaths[index])),\n      )\n      .forEach(\n        ([includeServerConfig, includeBrowserConfig]: [Config, Config]) => {\n          [\n            { config: serverConfig, include: includeServerConfig },\n            { config: browserConfig, include: includeBrowserConfig },\n          ].forEach(({ config, include }) =>\n            Object.keys(include).forEach((key) => {\n              if (!(key in config)) {\n                config[key] = include[key];\n                return;\n              }\n              if (Array.isArray(config[key])) {\n                config[key].push(include[key]);\n              } else if (typeof config[key] === 'object') {\n                Object.assign(config[key], include[key]);\n              } else {\n                throw new TypeError(\n                  `Unexpected override \"${key}\", filename = ${includePaths[key]}`,\n                );\n              }\n            }),\n          );\n        },\n      );\n  }\n\n  return [serverConfig, browserConfig];\n}\n","import { dirname, join } from 'path';\nimport { FSWatcher, watch as fsWatch } from 'fs';\nimport glob from 'glob';\nimport readFile from './utils/readFile';\nimport writeFile from './utils/writeFile';\nimport loadConfigFile from './utils/loadConfigFile';\n\nexport const clean = () => {};\n\nconst compileYml = async (filename: string) => {\n  const content = await readFile(filename);\n\n  const [serverConfig, browserConfig] = loadConfigFile(\n    content,\n    dirname(filename),\n  );\n  const destFile = `${filename.slice('src/'.length, -'yml'.length)}json`;\n\n  return Promise.all([\n    writeFile(`build/${destFile}`, JSON.stringify(serverConfig)),\n    writeFile(`public/${destFile}`, JSON.stringify(browserConfig)),\n  ]);\n};\n\nexport const build = (\n  src = './src/config',\n  onChanged?: () => void,\n): Promise<any> =>\n  Promise.all(\n    glob.sync(join(src, '**/*.yml')).map(\n      async (filename: string): Promise<() => void> => {\n        const compilePromise = compileYml(filename);\n\n        if (onChanged) {\n          const fsWatcher: FSWatcher = fsWatch(\n            filename,\n            { persistent: false, recursive: false },\n            (eventType: string): void => {\n              console.log(eventType, filename);\n              if (eventType === 'change') {\n                compileYml(filename).then(() => {\n                  onChanged();\n                });\n              }\n            },\n          );\n\n          await compilePromise;\n\n          return () => fsWatcher.close();\n        }\n\n        return () => {};\n      },\n    ),\n  ).then((closeFns: (() => void)[]) => () => {\n    closeFns.forEach((closeFn) => closeFn());\n  });\n\nexport const watch = (envs: string[]) => {};\n","import './configure-logger';\nimport { execSync } from 'child_process';\nimport path from 'path';\nimport Logger, { addConfig, Level } from 'nightingale';\nimport ConsoleLogger from 'nightingale-console';\nimport formatterANSI from 'nightingale-ansi-formatter';\nimport portscanner from 'portscanner';\nimport argv from 'minimist-argv';\nimport createChild, { Daemon } from 'springbokjs-daemon';\nimport colorette from 'colorette';\nimport ProgressBar from 'progress';\n// import watchServer from './server';\nimport * as configBuild from './config-build';\n\nconst startProxyPort: number = argv.browserSyncStartPort || 3000;\nconst startAppPort: number = argv.startAppPort || 3050;\nconst endProxyPort: number = startProxyPort + 49;\nconst endAppPort: number = startAppPort + 49;\n\nconst logger = new Logger('alp-dev:watch', 'alp-dev');\n\nexecSync(`rm -Rf ${path.resolve('public')}/* ${path.resolve('build')}/*`);\n\nlet nodeChild: Daemon | undefined;\n\nconst bar = new ProgressBar(\n  `${colorette.bold(colorette.yellow('Building...'))} ${colorette.bold(\n    ':percent',\n  )} [:bar] → :msg`,\n  {\n    incomplete: ' ',\n    complete: '▇',\n    total: 100,\n    width: 1024, // max width possible\n    clear: true,\n    stream: process.stdout,\n  },\n);\n\nconst output = (param: string | string[]): void => {\n  if (bar.complete) {\n    process.stdout.write(`${param as string}\\n`);\n  } else {\n    bar.interrupt(param as string);\n  }\n};\n\nconst formatterSimplified: any = ({ key, datetime, ...restRecord }: any) =>\n  formatterANSI(restRecord);\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon/,\n    handler: new ConsoleLogger(Level.NOTICE, { output }),\n    stop: true,\n  },\n  true,\n);\n\naddConfig(\n  {\n    pattern: /^alp-dev/,\n    handler: new ConsoleLogger(Level.INFO, { output }),\n    stop: true,\n  },\n  true,\n);\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon:alp-dev:watch:output/,\n    handler: new ConsoleLogger(Level.INFO, {\n      output,\n      formatter: formatterSimplified,\n    }),\n    stop: true,\n  },\n  true,\n);\n\nPromise.all([\n  portscanner.findAPortNotInUse(startProxyPort, endProxyPort),\n  portscanner.findAPortNotInUse(startAppPort, endAppPort),\n  configBuild.build('./src/config', () => {\n    logger.warn('config changed, restarting server');\n    if (nodeChild) nodeChild.sendSIGUSR2();\n  }),\n])\n  .then(([proxyPort, port]: [number, number, void]) => {\n    if (proxyPort === port) {\n      throw new Error(\n        `\"proxyPort\" and \"port\" cannot have the same value: ${port}`,\n      );\n    }\n\n    const building = { node: true, browser: true };\n    const percentages = { node: 0, browser: 0 };\n\n    const handleMessage = (\n      source: 'node' | 'browser',\n      msg:\n        | 'ready'\n        | { type: 'webpack-progress'; percentage: number; message: string }\n        | any,\n    ) => {\n      if (msg === 'ready') {\n        building[source] = false;\n        //\n        // if (Object.values(building).every(Boolean)) {\n        // }\n      } else if (msg && msg.type === 'webpack-progress') {\n        percentages[source] = msg.percentage;\n        const message = msg.message;\n        bar.update((percentages.node + percentages.browser) / 2, {\n          msg: message.length > 20 ? `${message.slice(0, 20)}...` : message,\n        });\n      }\n    };\n\n    nodeChild = createChild({\n      key: 'alp-dev:watch:watch-server',\n      displayName: 'alp-dev:watch-server',\n      prefixStdout: true,\n      outputKey: 'alp-dev:watch:output:watch-server',\n      outputDisplayName: 'SERVER:',\n      autoRestart: true,\n      args: [\n        require.resolve(__filename.replace('/watch-', '/watch-node-')),\n        '--port',\n        port,\n      ],\n      env: {\n        ...process.env,\n        NIGHTINGALE_CONSOLE_FORMATTER: 'ansi',\n      },\n      onMessage: (msg) => handleMessage('node', msg),\n    });\n\n    const browserChild = createChild({\n      key: 'alp-dev:watch:watch-browser',\n      displayName: 'alp-dev:watch-browser',\n      autoRestart: true,\n      args: [\n        require.resolve(__filename.replace('/watch-', '/watch-browser-')),\n        '--port',\n        port,\n        '--proxy-port',\n        proxyPort,\n        '--host',\n        argv.host || '',\n      ],\n      env: {\n        ...process.env,\n        NIGHTINGALE_CONSOLE_FORMATTER: 'ansi',\n      },\n      onMessage: (msg) => handleMessage('browser', msg),\n    });\n\n    Promise.all([nodeChild.start(), browserChild.start()]).then(() => {\n      logger.success('ready', { port: proxyPort, serverPort: port });\n    });\n\n    const cleanup = (): void => {\n      Promise.all([\n        nodeChild?.stop().catch((err) => {}),\n        browserChild?.stop().catch((err) => {}),\n      ]).then(() => {\n        process.exit(0);\n      });\n    };\n\n    process.on('SIGINT', cleanup);\n    process.on('SIGTERM', cleanup);\n  })\n  .catch((err) => console.log(err.stack));\n"],"names":["addConfig","pattern","handler","ConsoleLogger","Level","NOTICE","stop","readFile","target","Promise","resolve","reject","fs","err","content","Error","message","writeFile","mkdirp","path","dirname","loadConfigFile","data","saveLoadYml","config","shared","common","serverConfig","server","browserConfig","browser","include","includePaths","map","includePath","readFileSync","index","forEach","includeServerConfig","includeBrowserConfig","Object","keys","key","Array","isArray","push","assign","TypeError","compileYml","filename","destFile","slice","all","JSON","stringify","build","src","onChanged","glob","sync","join","compilePromise","fsWatcher","fsWatch","persistent","recursive","eventType","console","log","then","close","closeFns","closeFn","startProxyPort","argv","browserSyncStartPort","startAppPort","endProxyPort","endAppPort","logger","Logger","execSync","nodeChild","bar","ProgressBar","colorette","bold","yellow","incomplete","complete","total","width","clear","stream","process","stdout","output","param","write","interrupt","formatterSimplified","datetime","restRecord","formatterANSI","INFO","formatter","portscanner","findAPortNotInUse","configBuild","warn","sendSIGUSR2","proxyPort","port","percentages","node","handleMessage","source","msg","type","percentage","update","length","createChild","displayName","prefixStdout","outputKey","outputDisplayName","autoRestart","args","require","__filename","replace","env","NIGHTINGALE_CONSOLE_FORMATTER","onMessage","browserChild","host","start","success","serverPort","cleanup","catch","exit","on","stack"],"mappings":"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"}