{"version":3,"file":"watch-node8-dev.cjs.js","sources":["../src/utils/readFile.js","../src/utils/writeFile.js","../src/utils/loadConfigFile.js","../src/config-build.js","../src/watch.js"],"sourcesContent":["import fs from 'fs';\n\nexport default target =>\n  new Promise((resolve, reject) => {\n    fs.readFile(target, (err, content) => {\n      if (err) {\n        return reject(new Error(`Failed to read file \"${target}\": ${err.message || err}`));\n      }\n\n      resolve(content);\n    });\n  });\n","import fs from 'fs';\nimport path from 'path';\nimport mkdirp from 'mkdirp';\n\nexport default (target, content) =>\n  new Promise((resolve, reject) => {\n    mkdirp(path.dirname(target), () => {\n      fs.writeFile(target, content, err => {\n        if (err) {\n          return reject(new Error(`Failed to write file \"${target}\": ${err.message || err}`));\n        }\n\n        resolve();\n      });\n    });\n  });\n","import { readFileSync } from 'fs';\nimport path from 'path';\nimport { safeLoad as saveLoadYml } from 'js-yaml';\n\nexport default function loadConfigFile(content, dirname) {\n  const data = saveLoadYml(content) || {};\n\n  const config = data.shared || data.common || {};\n  const serverConfig = { ...config, ...data.server };\n  const browserConfig = { ...config, ...data.browser };\n\n  if (data.include) {\n    const includePaths = data.include.map(includePath => path.resolve(dirname, includePath));\n    includePaths\n      .map(includePath => readFileSync(includePath))\n      .map((content, index) => loadConfigFile(content, path.dirname(includePaths[index])))\n      .forEach(([includeServerConfig, includeBrowserConfig]) => {\n        [\n          { config: serverConfig, include: includeServerConfig },\n          { config: browserConfig, include: includeBrowserConfig },\n        ].forEach(({ config, include }) =>\n          Object.keys(include).forEach(key => {\n            if (!(key in config)) {\n              config[key] = include[key];\n              return;\n            }\n            if (Array.isArray(config[key])) {\n              config[key].push(include[key]);\n            } else if (typeof config[key] === 'object') {\n              Object.assign(config[key], include[key]);\n            } else {\n              throw new Error(`Unexpected override \"${key}\", filename = ${includePaths[key]}`);\n            }\n          }),\n        );\n      });\n  }\n\n  return [serverConfig, browserConfig];\n}\n","import { dirname, join } from 'path';\nimport glob from 'glob';\nimport readFile from './utils/readFile';\nimport writeFile from './utils/writeFile';\nimport loadConfigFile from './utils/loadConfigFile';\n\nexport const clean = () => {};\n\nexport const build = (src = './src/config') =>\n  Promise.all(\n    glob.sync(join(src, '**/*.yml')).map(filename =>\n      readFile(filename).then(content => {\n        const [serverConfig, browserConfig] = loadConfigFile(content, dirname(filename));\n        const destFile = `${filename.slice('src/'.length, -'yml'.length)}json`;\n\n        return Promise.all([\n          writeFile(`build/${destFile}`, JSON.stringify(serverConfig)),\n          writeFile(`public/${destFile}`, JSON.stringify(browserConfig)),\n        ]);\n      }),\n    ),\n  );\n\nexport const watch = envs => {};\n","/* eslint-disable global-require */\nimport { execSync } from 'child_process';\nimport path from 'path';\nimport portscanner from 'portscanner';\nimport argv from 'minimist-argv';\nimport createChild from 'springbokjs-daemon/src';\n// import watchServer from './server';\nimport * as configBuild from './config-build';\n\nconst startProxyPort = argv.browserSyncStartPort || 3000;\nconst startAppPort = argv.startAppPort || 3050;\n\nexecSync(`rm -Rf ${path.resolve('public')}/* ${path.resolve('build')}/*`);\n\nPromise.all([\n  portscanner.findAPortNotInUse(startProxyPort, startProxyPort + 49),\n  portscanner.findAPortNotInUse(startAppPort, startAppPort + 49),\n  configBuild.build(),\n])\n  .then(([proxyPort, port]) => {\n    if (proxyPort === port) {\n      throw new Error(`\"proxyPort\" and \"port\" cannot have the same value: ${port}`);\n    }\n\n    createChild({\n      autoRestart: true,\n      args: [require.resolve(__filename.replace('/watch-', '/watch-node-')), '--port', port],\n    }).start();\n\n    createChild({\n      autoRestart: true,\n      args: [\n        require.resolve(__filename.replace('/watch-', '/watch-browser-')),\n        '--port',\n        port,\n        '--proxy-port',\n        proxyPort,\n        '--host',\n        argv.host || '',\n      ],\n    }).start();\n  })\n  .catch(err => console.log(err.stack));\n"],"names":["target","Promise","resolve","reject","readFile","err","content","Error","message","path","dirname","writeFile","loadConfigFile","data","saveLoadYml","config","shared","common","serverConfig","server","browserConfig","browser","include","includePaths","map","includePath","readFileSync","index","forEach","includeServerConfig","includeBrowserConfig","Object","keys","key","Array","isArray","push","assign","build","src","all","glob","sync","join","filename","then","destFile","slice","JSON","stringify","startProxyPort","argv","browserSyncStartPort","startAppPort","execSync","portscanner","findAPortNotInUse","configBuild","proxyPort","port","require","__filename","replace","start","host","catch","console","log","stack"],"mappings":"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"}