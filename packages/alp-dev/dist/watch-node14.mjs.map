{"version":3,"file":"watch-node14.mjs","sources":["../src/utils/loadConfigFile.ts","../src/utils/readFile.ts","../src/utils/writeFile.ts","../src/config-build.ts","../src/watch.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-unsafe-call, @typescript-eslint/no-unsafe-member-access, @typescript-eslint/no-unsafe-assignment */\nimport { readFileSync } from 'fs';\nimport path from 'path';\nimport yaml from 'js-yaml';\n\nexport type Config = Record<string, any>;\n\nexport default function loadConfigFile(\n  content: string,\n  dirname: string,\n): [Config, Config] {\n  const data: any = yaml.load(content) || {};\n\n  const config = data.shared || data.common || {};\n  const serverConfig = { ...config, ...data.server };\n  const browserConfig = { ...config, ...data.browser };\n\n  if (data.include) {\n    const includePaths = data.include.map((includePath: string) =>\n      path.resolve(dirname, includePath),\n    );\n    includePaths\n      .map((includePath: string) => readFileSync(includePath, 'utf-8'))\n      .map((fileContent: string, index: number) =>\n        // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n        loadConfigFile(fileContent, path.dirname(includePaths[index])),\n      )\n      .forEach(\n        ([includeServerConfig, includeBrowserConfig]: [Config, Config]) => {\n          [\n            { includeConfig: serverConfig, include: includeServerConfig },\n            { includeConfig: browserConfig, include: includeBrowserConfig },\n          ].forEach(({ includeConfig, include }) => {\n            Object.keys(include).forEach((key) => {\n              if (!(key in includeConfig)) {\n                includeConfig[key] = include[key];\n                return;\n              }\n              if (Array.isArray(includeConfig[key])) {\n                includeConfig[key].push(include[key]);\n              } else if (typeof includeConfig[key] === 'object') {\n                Object.assign(includeConfig[key], include[key]);\n              } else {\n                throw new TypeError(\n                  `Unexpected override \"${key}\", filename = ${includePaths[key]}`,\n                );\n              }\n            });\n          });\n        },\n      );\n  }\n\n  return [serverConfig as Config, browserConfig as Config];\n}\n","import fs from 'fs';\n\nexport default function readFile(target: string): Promise<string> {\n  return new Promise((resolve, reject) => {\n    fs.readFile(target, 'utf-8', (err, content) => {\n      if (err) {\n        reject(\n          // eslint-disable-next-line @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-base-to-string\n          new Error(`Failed to read file \"${target}\": ${err.message || err}`),\n        );\n        return;\n      }\n\n      resolve(content);\n    });\n  });\n}\n","import fs from 'fs';\nimport path from 'path';\n\nexport default function writeFile(\n  target: string,\n  content: string,\n): Promise<void> {\n  return new Promise((resolve, reject) => {\n    fs.mkdir(path.dirname(target), { recursive: true }, () => {\n      fs.writeFile(target, content, (err) => {\n        if (err) {\n          reject(\n            new Error(\n              // eslint-disable-next-line @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-base-to-string\n              `Failed to write file \"${target}\": ${err.message || err}`,\n            ),\n          );\n          return;\n        }\n\n        resolve();\n      });\n    });\n  });\n}\n","import type { FSWatcher } from 'fs';\nimport { watch as fsWatch } from 'fs';\nimport { dirname, join } from 'path';\nimport glob from 'glob';\nimport loadConfigFile from './utils/loadConfigFile';\nimport readFile from './utils/readFile';\nimport writeFile from './utils/writeFile';\n\nexport const clean = (): void => {};\n\nconst compileYml = async (filename: string): Promise<void> => {\n  const content = await readFile(filename);\n\n  const [serverConfig, browserConfig] = loadConfigFile(\n    content,\n    dirname(filename),\n  );\n  const destFile = `${filename.slice('src/'.length, -'yml'.length)}json`;\n\n  await Promise.all([\n    writeFile(`build/${destFile}`, JSON.stringify(serverConfig)),\n    writeFile(`public/${destFile}`, JSON.stringify(browserConfig)),\n  ]);\n};\n\nexport const build = (\n  src = './src/config',\n  onChanged?: () => void,\n): Promise<any> =>\n  Promise.all(\n    glob\n      .sync(join(src, '**/*.yml'))\n      .map(async (filename: string): Promise<() => void> => {\n        const compilePromise = compileYml(filename);\n\n        if (onChanged) {\n          const fsWatcher: FSWatcher = fsWatch(\n            filename,\n            { persistent: false, recursive: false },\n            (eventType: string): void => {\n              console.log(eventType, filename);\n              if (eventType === 'change') {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                compileYml(filename).then(() => {\n                  onChanged();\n                });\n              }\n            },\n          );\n\n          await compilePromise;\n\n          return () => fsWatcher.close();\n        }\n\n        return () => {};\n      }),\n  ).then((closeFns: (() => void)[]) => () => {\n    closeFns.forEach((closeFn) => closeFn());\n  });\n\nexport const watch = (envs: string[]): void => {};\n","import './configure-logger';\nimport { execSync } from 'child_process';\nimport path from 'path';\nimport { URL } from 'url';\nimport * as colorette from 'colorette';\nimport argv from 'minimist-argv';\nimport { Logger, addConfig, Level } from 'nightingale';\nimport formatterANSI from 'nightingale-ansi-formatter';\nimport { ConsoleHandler } from 'nightingale-console';\nimport portscanner from 'portscanner';\nimport ProgressBar from 'progress';\nimport type { Daemon } from 'springbokjs-daemon';\nimport createChild from 'springbokjs-daemon';\n// import watchServer from './server';\nimport * as configBuild from './config-build';\n\nconst https = false;\nconst startProxyPort: number = (argv.browserSyncStartPort as number) || 3000;\nconst startAppPort: number = (argv.startAppPort as number) || 3050;\nconst endProxyPort: number = startProxyPort + 49;\nconst endAppPort: number = startAppPort + 49;\n\nconst logger = new Logger('alp-dev:watch', 'alp-dev');\n\nexecSync(`rm -Rf ${path.resolve('public')}/* ${path.resolve('build')}/*`);\n\nlet nodeChild: Daemon | undefined;\n\nconst bar = new ProgressBar(\n  `${colorette.bold(colorette.yellow('Building...'))} ${colorette.bold(\n    ':percent',\n  )} [:bar] → :msg`,\n  {\n    incomplete: ' ',\n    complete: '▇',\n    total: 100,\n    width: 1024, // max width possible\n    clear: true,\n    stream: process.stdout,\n  },\n);\n\nconst output = (param: string | string[]): void => {\n  if (bar.complete) {\n    process.stdout.write(`${param as string}\\n`);\n  } else {\n    bar.interrupt(param as string);\n  }\n};\n\nconst formatterSimplified: typeof formatterANSI = ({\n  key,\n  datetime,\n  ...restRecord\n}) => formatterANSI(restRecord as Parameters<typeof formatterANSI>[0]);\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon/,\n    handler: new ConsoleHandler(Level.NOTICE, { output }),\n    stop: true,\n  },\n  true,\n);\n\naddConfig(\n  {\n    pattern: /^alp-dev/,\n    handler: new ConsoleHandler(Level.INFO, { output }),\n    stop: true,\n  },\n  true,\n);\n\naddConfig(\n  {\n    pattern: /^springbokjs-daemon:alp-dev:watch:output/,\n    handler: new ConsoleHandler(Level.INFO, {\n      output,\n      formatter: formatterSimplified,\n    }),\n    stop: true,\n  },\n  true,\n);\n\nconst [proxyPort, port] = await Promise.all([\n  portscanner.findAPortNotInUse(startProxyPort, endProxyPort),\n  portscanner.findAPortNotInUse(startAppPort, endAppPort),\n  configBuild.build('./src/config', () => {\n    logger.warn('Config changed, restarting server');\n    if (nodeChild) nodeChild.sendSIGUSR2();\n  }),\n]);\nif (proxyPort === port) {\n  throw new Error(`\"proxyPort\" and \"port\" cannot have the same value: ${port}`);\n}\n\nconst building = { node: true, browser: true };\nconst percentages = { node: 0, browser: 0 };\n\nconst handleMessage = (\n  source: 'node' | 'browser',\n  msg:\n    | 'ready'\n    | { type: 'webpack-progress'; percentage: number; message: string }\n    | any,\n): void => {\n  if (msg === 'ready') {\n    building[source] = false;\n    //\n    // if (Object.values(building).every(Boolean)) {\n    // }\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  } else if (msg && msg.type === 'webpack-progress') {\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n    percentages[source] = msg.percentage;\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-assignment, @typescript-eslint/no-unsafe-member-access\n    const message: string = msg.message;\n    bar.update((percentages.node + percentages.browser) / 2, {\n      msg: message.length > 20 ? `${message.slice(0, 20)}...` : message,\n    });\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  } else if (msg && msg.type === 'failed-to-compile') {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-unsafe-member-access\n    logger.fatal(`Failed to compile ${msg.bundleName}:\\n${msg.errors}`);\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  } else if (msg && msg.type === 'compiled-with-arnings') {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-unsafe-member-access\n    logger.fatal(`Failed to compile ${msg.bundleName}:\\n${msg.warnings}`);\n    // eslint-disable-next-line @typescript-eslint/no-unsafe-member-access\n  } else if (msg && msg.type === 'compiled-successfully') {\n    // eslint-disable-next-line @typescript-eslint/restrict-template-expressions, @typescript-eslint/no-unsafe-member-access\n    logger.success(`Compiled ${msg.bundleName} successfully!`);\n  }\n};\n\nnodeChild = createChild({\n  key: 'alp-dev:watch:watch-server',\n  displayName: 'alp-dev:watch-server',\n  prefixStdout: true,\n  outputKey: 'alp-dev:watch:output:watch-server',\n  outputDisplayName: 'SERVER:',\n  autoRestart: true,\n  args: [\n    new URL(import.meta.url).pathname.replace('/watch-', '/watch-node-'),\n    '--port',\n    port,\n  ],\n  env: {\n    ...process.env,\n    NIGHTINGALE_CONSOLE_FORMATTER: 'ansi',\n  },\n  onMessage: (msg) => {\n    handleMessage('node', msg);\n  },\n});\n\nconst browserChild = createChild({\n  key: 'alp-dev:watch:watch-browser',\n  displayName: 'alp-dev:watch-browser',\n  autoRestart: true,\n  args: [\n    new URL(import.meta.url).pathname.replace('/watch-', '/watch-browser-'),\n    '--port',\n    port,\n    '--proxy-port',\n    proxyPort,\n    '--host',\n    argv.host || '',\n  ],\n  env: {\n    ...process.env,\n    NIGHTINGALE_CONSOLE_FORMATTER: 'ansi',\n  },\n  onMessage: (msg) => {\n    handleMessage('browser', msg);\n  },\n});\n\nconst cleanup = (): void => {\n  // eslint-disable-next-line @typescript-eslint/no-floating-promises\n  Promise.all([\n    nodeChild?.stop().catch((err) => {}),\n    browserChild?.stop().catch((err) => {}),\n  ]).then(() => {\n    process.exit(0);\n  });\n};\n\nprocess.on('SIGINT', cleanup);\nprocess.on('SIGTERM', cleanup);\n\nawait Promise.all([nodeChild.start(), browserChild.start()]);\nconst url = `http${https ? 's' : ''}://localhost:${proxyPort}`;\nlogger.success(`Your application is running here: ${url}`);\n"],"names":["loadConfigFile","content","dirname","data","yaml","load","config","shared","common","serverConfig","server","browserConfig","browser","include","includePaths","map","includePath","path","resolve","readFileSync","fileContent","index","forEach","includeServerConfig","includeBrowserConfig","includeConfig","Object","keys","key","Array","isArray","push","assign","TypeError","readFile","target","Promise","reject","fs","err","Error","message","writeFile","mkdir","recursive","compileYml","filename","destFile","slice","all","JSON","stringify","build","src","onChanged","glob","sync","join","compilePromise","fsWatcher","fsWatch","persistent","eventType","console","log","then","close","closeFns","closeFn","startProxyPort","argv","browserSyncStartPort","startAppPort","endProxyPort","endAppPort","logger","Logger","execSync","nodeChild","bar","ProgressBar","colorette","bold","yellow","incomplete","complete","total","width","clear","stream","process","stdout","output","param","write","interrupt","formatterSimplified","datetime","restRecord","formatterANSI","addConfig","pattern","handler","ConsoleHandler","Level","NOTICE","stop","INFO","formatter","proxyPort","port","portscanner","findAPortNotInUse","configBuild","warn","sendSIGUSR2","building","node","percentages","handleMessage","source","msg","type","percentage","update","length","fatal","bundleName","errors","warnings","success","createChild","displayName","prefixStdout","outputKey","outputDisplayName","autoRestart","args","URL","import","meta","url","pathname","replace","env","NIGHTINGALE_CONSOLE_FORMATTER","onMessage","browserChild","host","cleanup","catch","exit","on","start"],"mappings":"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"}