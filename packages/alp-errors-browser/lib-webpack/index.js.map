{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;AAAA,SAAS,SAAS,UAAlB,QAAoC,UAApC;AACA;AACA,OAAO,MAAP,MAAmB,oBAAnB;;AAEA,IAAM,SAAS,IAAI,MAAJ,CAAW,YAAX,CAAf;AACA;;AAEA;AAAA,yDAAe,iBAAgB,GAAhB,EAAqB,IAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,+BAED,MAFC;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAIP;AACA,4BAAI,YAAJ,EAAU,cAAM,IAAI,KAAJ,CAAU,eAAV,CAAN;AACV;AACA,4BAAI,uBAAe,QAAnB,EAA6B,cAAM,IAAI,KAAJ,aAAN;;AAE7B,4BAAI,MAAJ,GAAa,YAAI,MAAJ,IAAc,GAA3B;;AATO,8BAWH,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAXtB;AAAA;AAAA;AAAA;;AAYG,mCAZH,GAYiB,uBAZjB;;AAaH,+BAAO,KAAP,CAAa,WAAb;AACA;AACA,4BAAI,IAAJ,GAAW,YAAY,KAAvB;AAfG;AAAA;;AAAA;AAiBH,+BAAO,KAAP;;AAjBG,6BAkBC,YAAI,MAlBL;AAAA;AAAA;AAAA;;AAmBC,4BAAI,IAAJ,GAAW,YAAI,OAAf;AAnBD;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAf;;AAAA;AAAA;AAAA;AAAA","file":"index.js","sourcesContent":["import { parse as parseError } from 'alouette';\n// import ErrorHtmlRenderer from 'alouette/lib/HtmlRenderer';\nimport Logger from 'nightingale-logger';\n\nconst logger = new Logger('alp.errors');\n// const errorHtmlRenderer = new ErrorHtmlRenderer();\n\nexport default async function (ctx, next) {\n    try {\n        await next();\n    } catch (err) {\n        // eslint-disable-next-line no-ex-assign\n        if (!err) err = new Error('Unknown error');\n        // eslint-disable-next-line no-ex-assign\n        if (typeof err === 'string') err = new Error(err);\n\n        ctx.status = err.status || 500;\n\n        if (process.env.NODE_ENV !== 'production') {\n            const parsedError = parseError(err);\n            logger.error(parsedError);\n            // ctx.body = errorHtmlRenderer.render(parsedError);\n            ctx.body = parsedError.stack;\n        } else {\n            logger.error(err);\n            if (err.expose) {\n                ctx.body = err.message;\n            } else {\n                throw err;\n            }\n        }\n    }\n}\n"]}