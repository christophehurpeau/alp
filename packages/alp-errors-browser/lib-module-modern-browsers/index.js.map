{"version":3,"sources":["../src/index.js"],"names":["ErrorHtmlRenderer","Logger","logger","errorHtmlRenderer","ctx","next","err","Error","status","error","expose","body","message"],"mappings":"AAAA,OAAOA,iBAAP;AACA,OAAOC,MAAP;;AAEA,MAAMC,SAAS,IAAID,MAAJ,CAAW,YAAX,CAAf;AACA,MAAME,oBAAoB,IAAIH,iBAAJ,EAA1B;;AAEA,gBAAe,gBAAeI,GAAf,EAAoBC,IAApB,EAA0B;AACvC,MAAI;AACF,UAAMA,MADJ;AAEH,GAFD,CAEE,OAAOC,GAAP,EAAY;AAWL,QATFA,GASE,KATGA,MAAM,IAAIC,KAAJ,CAAU,eAAV,CAST,GAPH,OAAOD,GAAP,KAAe,QAOZ,KAPsBA,MAAM,IAAIC,KAAJ,CAAUD,GAAV,CAO5B,GALPF,IAAII,MAAJ,GAAaF,IAAIE,MAAJ,IAAc,GAKpB,EAHPN,OAAOO,KAAP,CAAaH,GAAb,CAGO,EAAIA,IAAII,MAAR,EACLN,IAAIO,IAAJ,GAAWL,IAAIM,OADV,MAGL,MAAMN,GAAN;AAEH;AACF,CApBD","file":"index.js","sourcesContent":["import ErrorHtmlRenderer from 'error-html/src';\nimport Logger from 'nightingale-logger/src';\n\nconst logger = new Logger('alp:errors');\nconst errorHtmlRenderer = new ErrorHtmlRenderer();\n\nexport default async function(ctx, next) {\n  try {\n    await next();\n  } catch (err) {\n    // eslint-disable-next-line no-ex-assign\n    if (!err) err = new Error('Unknown error');\n    // eslint-disable-next-line no-ex-assign\n    if (typeof err === 'string') err = new Error(err);\n\n    ctx.status = err.status || 500;\n\n    logger.error(err);\n    if (!PRODUCTION) {\n      ctx.body = errorHtmlRenderer.render(err);\n    } else if (err.expose) {\n      ctx.body = err.message;\n    } else {\n      throw err;\n    }\n  }\n}\n"]}