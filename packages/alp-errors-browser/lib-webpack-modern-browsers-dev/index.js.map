{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;AAAA,SAAS,SAAS,UAAlB,QAAoC,UAApC;AACA;AACA,OAAO,MAAP,MAAmB,oBAAnB;;AAEA,IAAM,SAAS,IAAI,MAAJ,CAAW,YAAX,CAAf;AACA;;AAEA;AAAA,iCAAe,WAAgB,GAAhB,EAAqB,IAArB,EAA2B;AACtC,YAAI;AACA,kBAAM,MAAN;AACH,SAFD,CAEE,OAAO,GAAP,EAAY;AACV;AACA,gBAAI,CAAC,GAAL,EAAU,MAAM,IAAI,KAAJ,CAAU,eAAV,CAAN;AACV;AACA,gBAAI,OAAO,GAAP,KAAe,QAAnB,EAA6B,MAAM,IAAI,KAAJ,CAAU,GAAV,CAAN;;AAE7B,gBAAI,MAAJ,GAAa,IAAI,MAAJ,IAAc,GAA3B;;AAEA,gBAAI,QAAQ,GAAR,CAAY,QAAZ,KAAyB,YAA7B,EAA2C;AACvC,oBAAM,cAAc,WAAW,GAAX,CAApB;AACA,uBAAO,KAAP,CAAa,WAAb;AACA;AACA,oBAAI,IAAJ,GAAW,YAAY,KAAvB;AACA;AACH,aAND,MAMO;AACH,uBAAO,KAAP,CAAa,GAAb;AACA,oBAAI,IAAI,MAAR,EAAgB;AACZ,wBAAI,IAAJ,GAAW,IAAI,OAAf;AACH,iBAFD,MAEO;AACH,0BAAM,GAAN;AACH;AACJ;AACJ;AACJ,KA1BD;;AAAA;AAAA;AAAA;AAAA","file":"index.js","sourcesContent":["import { parse as parseError } from 'alouette';\n// import ErrorHtmlRenderer from 'alouette/lib/HtmlRenderer';\nimport Logger from 'nightingale-logger';\n\nconst logger = new Logger('alp.errors');\n// const errorHtmlRenderer = new ErrorHtmlRenderer();\n\nexport default async function (ctx, next) {\n    try {\n        await next();\n    } catch (err) {\n        // eslint-disable-next-line no-ex-assign\n        if (!err) err = new Error('Unknown error');\n        // eslint-disable-next-line no-ex-assign\n        if (typeof err === 'string') err = new Error(err);\n\n        ctx.status = err.status || 500;\n\n        if (process.env.NODE_ENV !== 'production') {\n            const parsedError = parseError(err);\n            logger.error(parsedError);\n            // ctx.body = errorHtmlRenderer.render(parsedError);\n            ctx.body = parsedError.stack;\n            debugger;\n        } else {\n            logger.error(err);\n            if (err.expose) {\n                ctx.body = err.message;\n            } else {\n                throw err;\n            }\n        }\n    }\n}\n"]}