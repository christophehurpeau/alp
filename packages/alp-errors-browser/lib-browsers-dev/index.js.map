{"version":3,"sources":["../src/index.js"],"names":["logger","errorHtmlRenderer","ctx","next","Error","status","error","body","render"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;;;AAEA,IAAMA,SAAS,gCAAW,YAAX,CAAf;AACA,IAAMC,oBAAoB,yBAA1B;;;uDAEe,iBAAgBC,GAAhB,EAAqBC,IAArB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAELA,MAFK;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAIX;AACA,gBAAI,YAAJ,EAAU,cAAM,IAAIC,KAAJ,CAAU,eAAV,CAAN;AACV;AACA,gBAAI,uBAAe,QAAnB,EAA6B,cAAM,IAAIA,KAAJ,aAAN;;AAE7BF,gBAAIG,MAAJ,GAAa,YAAIA,MAAJ,IAAc,GAA3B;;AAEAL,mBAAOM,KAAP;;AAEEJ,gBAAIK,IAAJ,GAAWN,kBAAkBO,MAAlB,aAAX;;AAbS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","file":"index.js","sourcesContent":["import ErrorHtmlRenderer from 'error-html';\nimport Logger from 'nightingale-logger/src';\n\nconst logger = new Logger('alp:errors');\nconst errorHtmlRenderer = new ErrorHtmlRenderer();\n\nexport default async function (ctx, next) {\n  try {\n    await next();\n  } catch (err) {\n    // eslint-disable-next-line no-ex-assign\n    if (!err) err = new Error('Unknown error');\n    // eslint-disable-next-line no-ex-assign\n    if (typeof err === 'string') err = new Error(err);\n\n    ctx.status = err.status || 500;\n\n    logger.error(err);\n    if (!PRODUCTION) {\n      ctx.body = errorHtmlRenderer.render(err);\n    } else if (err.expose) {\n      ctx.body = err.message;\n    } else {\n      throw err;\n    }\n  }\n}\n"]}