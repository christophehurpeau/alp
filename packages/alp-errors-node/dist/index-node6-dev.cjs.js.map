{"version":3,"file":"index-node6-dev.cjs.js","sources":["../src/index.js"],"sourcesContent":["import { STATUS_CODES } from 'http';\nimport ErrorHtmlRenderer from 'error-html';\nimport Logger from 'nightingale-logger/src';\n\nconst logger = new Logger('alp:errors');\nconst errorHtmlRenderer = new ErrorHtmlRenderer({\n  appPath: process.cwd(),\n});\n\nexport default async (ctx, next) => {\n  try {\n    await next();\n  } catch (err) {\n    // eslint-disable-next-line no-ex-assign\n    if (!err) err = new Error('Unknown error');\n    // eslint-disable-next-line no-ex-assign\n    if (typeof err === 'string') err = new Error(err);\n\n    ctx.status = err.status || 500;\n    logger.error(err);\n\n    switch (ctx.accepts('html', 'text', 'json')) {\n      case 'text':\n        ctx.type = 'text/plain';\n        if (process.env.NODE_ENV !== 'production') {\n          ctx.body = err.message;\n        } else if (err.expose) {\n          ctx.body = err.message;\n        } else {\n          throw err;\n        }\n\n        break;\n\n      case 'json':\n        ctx.type = 'application/json';\n        if (process.env.NODE_ENV !== 'production') {\n          ctx.body = { error: err.message };\n        } else if (err.expose) {\n          ctx.body = { error: err.message };\n        } else {\n          ctx.body = { error: STATUS_CODES[ctx.status] };\n        }\n\n        break;\n\n      case 'html':\n        ctx.type = 'text/html';\n        if (process.env.NODE_ENV !== 'production') {\n          ctx.body = errorHtmlRenderer.render(err);\n        } else if (err.expose) {\n          ctx.body = err.message;\n        } else {\n          throw err;\n        }\n\n        break;\n    }\n  }\n};\n"],"names":["logger","Logger","errorHtmlRenderer","ErrorHtmlRenderer","process","cwd","ctx","next","err","Error","status","error","accepts","type","env","NODE_ENV","body","message","expose","STATUS_CODES","render"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAIA,MAAMA,SAAS,IAAIC,MAAJ,CAAW,YAAX,CAAf;AACA,MAAMC,oBAAoB,IAAIC,iBAAJ,CAAsB;WACrCC,QAAQC,GAAR;CADe,CAA1B;;AAIA;8BAAe,WAAOC,GAAP,EAAYC,IAAZ,EAAqB;QAC9B;YACIA,MAAN;KADF,CAEE,OAAOC,GAAP,EAAY;;UAER,CAACA,GAAL,EAAUA,MAAM,IAAIC,KAAJ,CAAU,eAAV,CAAN;;UAEN,OAAOD,GAAP,KAAe,QAAnB,EAA6BA,MAAM,IAAIC,KAAJ,CAAUD,GAAV,CAAN;;UAEzBE,MAAJ,GAAaF,IAAIE,MAAJ,IAAc,GAA3B;aACOC,KAAP,CAAaH,GAAb;;cAEQF,IAAIM,OAAJ,CAAY,MAAZ,EAAoB,MAApB,EAA4B,MAA5B,CAAR;aACO,MAAL;cACMC,IAAJ,GAAW,YAAX;cACIT,QAAQU,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;gBACrCC,IAAJ,GAAWR,IAAIS,OAAf;WADF,MAEO,IAAIT,IAAIU,MAAR,EAAgB;gBACjBF,IAAJ,GAAWR,IAAIS,OAAf;WADK,MAEA;kBACCT,GAAN;;;;;aAKC,MAAL;cACMK,IAAJ,GAAW,kBAAX;cACIT,QAAQU,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;gBACrCC,IAAJ,GAAW,EAAEL,OAAOH,IAAIS,OAAb,EAAX;WADF,MAEO,IAAIT,IAAIU,MAAR,EAAgB;gBACjBF,IAAJ,GAAW,EAAEL,OAAOH,IAAIS,OAAb,EAAX;WADK,MAEA;gBACDD,IAAJ,GAAW,EAAEL,OAAOQ,kBAAab,IAAII,MAAjB,CAAT,EAAX;;;;;aAKC,MAAL;cACMG,IAAJ,GAAW,WAAX;cACIT,QAAQU,GAAR,CAAYC,QAAZ,KAAyB,YAA7B,EAA2C;gBACrCC,IAAJ,GAAWd,kBAAkBkB,MAAlB,CAAyBZ,GAAzB,CAAX;WADF,MAEO,IAAIA,IAAIU,MAAR,EAAgB;gBACjBF,IAAJ,GAAWR,IAAIS,OAAf;WADK,MAEA;kBACCT,GAAN;;;;;;GA5CV;;;;;;;;;"}