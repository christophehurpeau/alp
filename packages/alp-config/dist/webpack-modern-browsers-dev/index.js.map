{"version":3,"sources":["../../src/index.js"],"names":[],"mappings":";;;;AAAA,OAAO,IAAP,MAAiB,eAAjB;AACA,OAAO,UAAP,MAAuB,iBAAvB;AACA,OAAO,SAAP,MAAsB,0BAAtB;AACA,SAAS,UAAT,EAAqB,YAArB,QAAyC,IAAzC;;AAEA,SAAS,YAAT,CAAsB,OAAtB,EAAuC,IAAvC,EAAqD;AAAA,iBAA/B,OAA+B;AAAA,uHAA/B,OAA+B;AAAA;;AAAA,iBAAd,IAAc;AAAA,oHAAd,IAAc;AAAA;;AACjD,WAAO,WAAW,CAAC,AAAD,GAAG,OAAH,EAAW,AAAX,GAAa,IAAb,EAAkB,KAAlB,CAAX,CAAP;AACH;;AAED,SAAS,UAAT,CAAoB,OAApB,EAAqC,IAArC,EAAmD;AAAA,iBAA/B,OAA+B;AAAA,uHAA/B,OAA+B;AAAA;;AAAA,iBAAd,IAAc;AAAA,oHAAd,IAAc;AAAA;;AAC/C,QAAI,UAAU,aAAa,CAAC,AAAD,GAAG,OAAH,EAAW,AAAX,GAAa,IAAb,EAAkB,KAAlB,CAAb,CAAd;AACA,WAAO,UAAU,OAAV,CAAP;AACH;;AAED,eAAe,SAAS,SAAT,CAAmB,OAAnB,EAA0D;AAAA,QAAtB,OAAsB,yDAAJ,EAAI;;AAAA,iBAAvC,OAAuC;AAAA,uHAAvC,OAAuC;AAAA;;AAAA,UAAtB,OAAsB,YAAb,MAAa;AAAA,uHAAtB,OAAsB;AAAA;;AACrE,cAAU,QAAQ,OAAR,CAAgB,MAAhB,EAAwB,GAAxB,CAAV;;AAEA,cAAU,OAAO,MAAP,CAAc,EAAd,EAAkB,OAAlB,EAA2B;AACjC,cAAM;AAD2B,KAA3B,CAAV;;AAIA,WAAO,OAAO;AACV,YAAI,YAAJ,GAAoB,IAAD;AAAA,mBAAU,aAAa,OAAb,EAAsB,IAAtB,CAAV;AAAA,SAAnB;AACA,YAAI,UAAJ,GAAkB,IAAD;AAAA,mBAAU,WAAW,OAAX,EAAoB,IAApB,CAAV;AAAA,SAAjB;;AAEA,YAAM,SAAS,WAAW,OAAX,EAAoB,QAApB,CAAf;AAJU,sBAKe,WAAW,OAAX,EAAoB,IAAI,GAAxB,CALf;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAKV,0KAAuD;AAAA;;AAAA;;AAAA;;AAAA,oBAA7C,GAA6C;AAAA,oBAAxC,KAAwC;;AACnD,uBAAO,GAAP,CAAW,GAAX,EAAgB,KAAhB;AACH;AAPS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AASV,YAAI,aAAa,OAAb,EAAsB,OAAtB,CAAJ,EAAoC;AAAA,2BACP,WAAW,OAAX,EAAoB,OAApB,CADO;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAChC,qLAAuD;AAAA;;AAAA;;AAAA;;AAAA,wBAA7C,IAA6C;AAAA,wBAAxC,MAAwC;;AACnD,2BAAO,GAAP,CAAW,IAAX,EAAgB,MAAhB;AACH;AAH+B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAInC;;AAED,YAAI,CAAC,OAAO,GAAP,CAAW,SAAX,CAAL,EAA4B;AACxB,mBAAO,GAAP,CAAW,SAAX,EAAsB,KAAK,OAAL,IAAgB,QAAQ,aAAR,CAAsB,OAA5D;AACH;;AAED,YAAI,aAAa,KAAK,aAAL,KAAuB,KAAK,UAA7C;AACA,YAAI,UAAJ,EAAgB;AACZ,mBAAO,GAAP,CAAW,YAAX,EAAyB,UAAzB;AACH,SAFD,MAEO,IAAI,KAAK,IAAT,EAAe;AAClB,mBAAO,GAAP,CAAW,MAAX,EAAmB,KAAK,IAAxB;AACA,mBAAO,MAAP,CAAc,YAAd;AACH;;AAED,gBAAQ,IAAR,CAAa,OAAb,CAAqB,OAAO;AACxB,gBAAI,KAAK,GAAL,MAAc,SAAlB,EAA6B;AACzB,uBAAO,GAAP,CAAW,GAAX,EAAgB,KAAK,GAAL,CAAhB;AACH;AACJ,SAJD;;AAMA,YAAI,MAAJ,GAAa,MAAb;AACA,YAAI,OAAJ,CAAY,MAAZ,GAAqB,MAArB;;AAEA,eAAO,WAAW,MAAX,CAAP;AACH,KArCD;AAsCH","file":"index.js","sourcesContent":["import argv from 'minimist-argv';\nimport deepFreeze from 'deep-freeze-es6';\nimport parseJSON from 'parse-json-object-as-map';\nimport { existsSync, readFileSync } from 'fs';\n\nfunction existsConfig(dirname: string, name: string) {\n    return existsSync(`${dirname}${name}.json`);\n}\n\nfunction loadConfig(dirname: string, name: string) {\n    let content = readFileSync(`${dirname}${name}.json`);\n    return parseJSON(content);\n}\n\nexport default function alpConfig(dirname: string, options: Object = {}) {\n    dirname = dirname.replace(/\\/*$/, '/');\n\n    options = Object.assign({}, options, {\n        argv: [],\n    });\n\n    return app => {\n        app.existsConfig = (name) => existsConfig(dirname, name);\n        app.loadConfig = (name) => loadConfig(dirname, name);\n\n        const config = loadConfig(dirname, 'common');\n        for (let [key, value] of loadConfig(dirname, app.env)) {\n            config.set(key, value);\n        }\n\n        if (existsConfig(dirname, 'local')) {\n            for (let [key, value] of loadConfig(dirname, 'local')) {\n                config.set(key, value);\n            }\n        }\n\n        if (!config.has('version')) {\n            config.set('version', argv.version || options.packageConfig.version);\n        }\n\n        let socketPath = argv['socket-path'] || argv.socketPath;\n        if (socketPath) {\n            config.set('socketPath', socketPath);\n        } else if (argv.port) {\n            config.set('port', argv.port);\n            config.delete('socketPath');\n        }\n\n        options.argv.forEach(key => {\n            if (argv[key] !== undefined) {\n                config.set(key, argv[key]);\n            }\n        });\n\n        app.config = config;\n        app.context.config = config;\n\n        return deepFreeze(config);\n    };\n}\n"]}