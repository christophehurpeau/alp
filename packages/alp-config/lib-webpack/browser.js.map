{"version":3,"sources":["../src/browser.js"],"names":[],"mappings":"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","file":"browser.js","sourcesContent":["/* global fetch */\nimport * as storedConfig from './browserStoredConfig';\nimport parseJSON from 'parse-json-object-as-map';\n\nfunction fetchConfig(path) {\n    return fetch(`${path}.json`)\n        .then(res => res.text())\n        .then(text => parseJSON(text))\n        .catch(() => false);\n}\n\n/**\n * @param {string} path\n * @returns {Promise|Map}\n */\nfunction getConfig(path) {\n    if (storedConfig.has(path)) {\n        return storedConfig.get(path);\n    }\n    return fetchConfig(path);\n}\n\n/**\n * @param {string} path\n * @returns {Promise|Boolean}\n */\nfunction existsConfig(path) {\n    if (storedConfig.has(path)) {\n        return storedConfig.get(path) !== false;\n    }\n    return fetchConfig(path);\n}\n\nconst getOrFetchAppConfig = async function (version, environment, configPath) {\n    if (storedConfig.getVersion() === version && storedConfig.has('_appConfig')) {\n        return storedConfig.get('_appConfig');\n    }\n\n    storedConfig.clear(version);\n\n    const jsonConfig = await Promise.all([\n        getConfig(`${configPath}common`),\n        environment && getConfig(`${configPath}environment`),\n        getConfig(`${configPath}local`),\n    ]);\n    const config = jsonConfig[0] || new Map();\n    jsonConfig.slice(1).filter(Boolean).forEach(jsonConfig => {\n        for (let [key, value] of jsonConfig) {\n            config.set(key, value);\n        }\n    });\n\n    storedConfig.set('_appConfig', config);\n    return config;\n};\n\nexport default function alpConfig(configPath) {\n    configPath = configPath.replace(/\\/*$/, '/');\n    return async function (app) {\n        app.existsConfig = (name) => existsConfig(`${configPath}${name}`);\n        app.loadConfig = (name) => getConfig(`${configPath}${name}`);\n\n        const version = app.appVersion;\n\n        if (!version) {\n            throw new Error('Missing appVersion');\n        }\n\n        const config = await getOrFetchAppConfig(version, app.environment, configPath);\n        app.config = config;\n        app.context.config = config;\n        app.context.production = !!config.get('production');\n        return config;\n    };\n}\n"]}