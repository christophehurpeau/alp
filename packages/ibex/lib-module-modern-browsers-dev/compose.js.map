{"version":3,"sources":["../src/compose.js"],"names":["compose","middlewares","ctx","index","dispatch","i","Promise","reject","Error","fn","called","resolve","call","e"],"mappings":";AAAA;AACA,eAAe,SAASA,OAAT,CAAiBC,WAAjB,EAA+C;AAAA,yBAAnB,QAAQ,YAAR,CAAmB;;AAC5D,uEAAO,UAASC,GAAT,EAAc;AACnB,QAAIC,QAAQ,CAAC,CAAb;AACA,WAAQ,SAASC,QAAT,CAAkBC,CAAlB,EAAqB;AAC3B,UAAIA,KAAKF,KAAT,EACE,OAAOG,QAAQC,MAAR,CAAe,IAAIC,KAAJ,gCAAf,CAAP;AAEFL,cAAQE,CAJmB;;;AAM3B,YAAMI,KAAKR,YAAYI,CAAZ,CAAX;;AAEA,UAAIK,SAAS,KAAb;AACA,UAAI;AACF,eAAOJ,QAAQK,OAAR,CACLF,GAAGG,IAAH,CAAQV,GAAR,EAAaA,GAAb,EAAkB,YAAM;AACtB,cAAIQ,MAAJ,EAAY,MAAM,IAAIF,KAAJ,sCAAN;;AAEZ,iBADAE,SAAS,IACT,EAAON,SAASC,IAAI,CAAb,CAAP;AACD,SAJD,CADK,CAAP;AAOD,OARD,CAQE,OAAOQ,CAAP,EAAU;AACV,eAAOP,QAAQC,MAAR,CAAeM,CAAf,CAAP;AACD;AACF,KApBM,CAoBJ,CApBI,CAAP;AAqBD,GAvBD;AAwBD","file":"compose.js","sourcesContent":["// create lib\nexport default function compose(middlewares: Array<Function>) {\n  return function(ctx) {\n    let index = -1;\n    return (function dispatch(i) {\n      if (i <= index) {\n        return Promise.reject(new Error(!PRODUCTION && 'next() called multiple times'));\n      }\n      index = i;\n\n      const fn = middlewares[i];\n\n      let called = false;\n      try {\n        return Promise.resolve(\n          fn.call(ctx, ctx, () => {\n            if (called) throw new Error(!PRODUCTION && 'Cannot call next() more than once.');\n            called = true;\n            return dispatch(i + 1);\n          }),\n        );\n      } catch (e) {\n        return Promise.reject(e);\n      }\n    })(0);\n  };\n}\n"]}