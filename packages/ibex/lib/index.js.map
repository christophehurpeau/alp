{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;IAIqB,WAAW;cAAX,WAAW;;AAC5B,aADiB,WAAW,GACd;8BADG,WAAW;;2EAAX,WAAW;;AAGxB,cAAK,UAAU,GAAG,EAAE,CAAC;AACrB,cAAK,OAAO,GAAG,MAAM,CAAC,MAAM,mBAAS,CAAC;AACtC,cAAK,aAAa,GAAG,EAAE,CAAC;;KAC3B;;iBANgB,WAAW;;6BAYvB,EAAE,EAAE;AACL,gBAAI,CAAC,aAAa,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;SACrC;;;4BAEG,EAAE,EAAE;;AAEJ,gBAAI,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC;AACzB,mBAAO,IAAI,CAAC;SACf;;;gCAEO,CAAC,EAAE;AACP,mBAAO,CAAC,GAAG,CAAC,CAAC,CAAC,KAAK,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,CAAC,CAAC;SAC1C;;;8BAEK;;;AACF,mBAAO,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,IAAI,CAAC,YAAM;AAC9C,uBAAO,OAAK,aAAa,CAAC;;AAE1B,oBAAI,CAAC,OAAK,SAAS,CAAC,OAAO,CAAC,CAAC,MAAM,EAAE;AACjC,2BAAK,EAAE,CAAC,OAAO,EAAE,OAAK,OAAO,CAAC,CAAC;iBAClC;;AAED,uBAAK,QAAQ,GAAG,uBAAQ,OAAK,UAAU,CAAC,CAAC;aAC5C,CAAC,CAAC;SACN;;;6BAEI,GAAG,EAAE;AACN,gBAAI,GAAG,CAAC,UAAU,CAAC,GAAG,CAAC,EAAE;AACrB,mBAAG,GAAG,MAAM,CAAC,QAAQ,CAAC,QAAQ,GAAG,GAAG,CAAC;aACxC;;AAED,gBAAM,GAAG,GAAG,IAAI,CAAC;AACjB,gBAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,CAClB,IAAI,CAAC;uBAAM,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC;aAAA,CAAC,CAC7B,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC;SAC3B;;;4BAvCiB;AACd,mBAAO,IAAI,CAAC,GAAG,CAAC;SACnB;;;WAVgB,WAAW;WAJvB,YAAY;;kBAIA,WAAW;;AAkDhC,SAAS,OAAO,GAAG;;AAEf,QAAI,IAAI,CAAC,OAAO,KAAK,KAAK,EAAE;AACxB,eAAO;KACV;;AAED,QAAI,CAAC,IAAI,CAAC,QAAQ,EAAE,OAAO;;AAE3B,QAAI,IAAI,GAAG,IAAI,CAAC,IAAI;;;AAAC,AAGrB,QAAI,OAAO,IAAI,KAAK,QAAQ,EAAE;AAC1B,gBAAQ,CAAC,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AAC/B,eAAO;KACV;;AAED,QAAI,IAAI,CAAC,QAAQ,EAAE;AACf,gBAAQ,CAAC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;AAC7B,gBAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;KACnC;;AAED,UAAM,IAAI,KAAK,CAAC,qBAAqB,CAAC,CAAC;CAC1C","file":"index.js","sourcesContent":["import { EventEmitter } from 'events';\nimport compose from './compose';\nimport context from './context';\n\nexport default class Application extends EventEmitter {\n    constructor() {\n        super();\n        this.middleware = [];\n        this.context = Object.create(context);\n        this._initPromises = [];\n    }\n\n    get environment() {\n        return this.env;\n    }\n\n    init(fn) {\n        this._initPromises.push(fn(this));\n    }\n\n    use(fn) {\n        // logger.debug('use', {name: fn._name || fn.name || '-'});\n        this.middleware.push(fn);\n        return this;\n    }\n\n    onerror(e) {\n        console.log(e.stack || e.message || e);\n    }\n\n    run() {\n        return Promise.all(this._initPromises).then(() => {\n            delete this._initPromises;\n\n            if (!this.listeners('error').length) {\n                this.on('error', this.onerror);\n            }\n\n            this.callback = compose(this.middleware);\n        });\n    }\n\n    load(url) {\n        if (url.startsWith('?')) {\n            url = window.location.pathname + url;\n        }\n\n        const ctx = null;\n        this.callback.call(ctx)\n            .then(() => respond.call(ctx))\n            .catch(ctx.onerror);\n    }\n}\n\nfunction respond() {\n    // allow bypassing\n    if (this.respond === false) {\n        return;\n    }\n\n    if (!this.writable) return;\n\n    let body = this.body;\n    // let code = this.status;\n\n    if (typeof body === 'string') {\n        document.body.innerHTML = body;\n        return;\n    }\n\n    if (body.nodeType) {\n        document.body.innerHTML = '';\n        document.body.appendChild(body);\n    }\n\n    throw new Error('Invalid body result');\n}\n"]}