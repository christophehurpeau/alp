{"version":3,"sources":["../src/compose.js"],"names":["compose","middlewares","ctx","index","dispatch","i","Promise","reject","Error","fn","called","resolve","call","e"],"mappings":"AAAA;AACA,eAAe,SAASA,OAAT,CAAiBC,WAAjB,EAA+C;AAC5D,SAAO,UAAUC,GAAV,EAAe;AACpB,QAAIC,QAAQ,CAAC,CAAb;AACA,WAAQ,SAASC,QAAT,CAAkBC,CAAlB,EAAqB;AAC3B,UAAIA,KAAKF,KAAT,EAAgB;AACd,eAAOG,QAAQC,MAAR,CAAe,IAAIC,KAAJ,OAAf,CAAP;AACD;AACDL,cAAQE,CAAR;;AAEA,YAAMI,KAAKR,YAAYI,CAAZ,CAAX;;AAEA,UAAIK,SAAS,KAAb;AACA,UAAI;AACF,eAAOJ,QAAQK,OAAR,CAAgBF,GAAGG,IAAH,CAAQV,GAAR,EAAaA,GAAb,EAAkB,YAAM;AAC7C,cAAIQ,MAAJ,EAAY,MAAM,IAAIF,KAAJ,OAAN;AACZE,mBAAS,IAAT;AACA,iBAAON,SAASC,IAAI,CAAb,CAAP;AACD,SAJsB,CAAhB,CAAP;AAKD,OAND,CAME,OAAOQ,CAAP,EAAU;AACV,eAAOP,QAAQC,MAAR,CAAeM,CAAf,CAAP;AACD;AACF,KAlBO,CAkBN,CAlBM,CAAR;AAmBD,GArBD;AAsBD","file":"compose.js","sourcesContent":["// create lib\nexport default function compose(middlewares: Array<Function>) {\n  return function (ctx) {\n    let index = -1;\n    return (function dispatch(i) {\n      if (i <= index) {\n        return Promise.reject(new Error(!PRODUCTION && 'next() called multiple times'));\n      }\n      index = i;\n\n      const fn = middlewares[i];\n\n      let called = false;\n      try {\n        return Promise.resolve(fn.call(ctx, ctx, () => {\n          if (called) throw new Error(!PRODUCTION && 'Cannot call next() more than once.');\n          called = true;\n          return dispatch(i + 1);\n        }));\n      } catch (e) {\n        return Promise.reject(e);\n      }\n    }(0));\n  };\n}\n"]}