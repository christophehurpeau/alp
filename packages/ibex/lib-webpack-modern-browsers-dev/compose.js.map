{"version":3,"sources":["../src/compose.js"],"names":["compose","middleware","ctx","index","dispatch","i","Promise","reject","Error","fn","called","resolve","call","e"],"mappings":"AAAA;AACA;AACA,eAAe,SAASA,OAAT,CAAiBC,UAAjB,EAA8C;AAAA,sBAA7BA,UAA6B,KAA7BA,UAA6B;AAAA;AAAA;AAAA,+HAA7BA,UAA6B;AAAA;;AAC3D,SAAO,UAAUC,GAAV,EAAe;AACpB,QAAIC,UAAJ;AACA,WAAQ,SAASC,QAAT,CAAkBC,CAAlB,EAAqB;AAC3B,UAAIA,KAAKF,KAAT,EAAgB;AACd,eAAOG,QAAQC,MAAR,CAAe,IAAIC,KAAJ,gCAAf,CAAP;AACD;AACDL,cAAQE,CAAR,CAJ2B,CAIhB;;AAEX,UAAMI,KAAKR,WAAWI,CAAX,CAAX;AACA,UAAmB,CAACI,EAApB,EAAwB,MAAM,IAAID,KAAJ,CAA0B,eAAaH,CAAE,GAAzC,CAAN;;AAExB,UAAIK,SAAS,KAAb;AACA,UAAI;AACF,eAAOJ,QAAQK,OAAR,CAAgBF,GAAGG,IAAH,CAAQV,GAAR,EAAaA,GAAb,EAAkB,MAAM;AAC7C,cAAIQ,MAAJ,EAAY,MAAM,IAAIF,KAAJ,sCAAN;AACZE,mBAAS,IAAT;AACA,iBAAON,SAASC,IAAI,CAAb,CAAP;AACD,SAJsB,CAAhB,CAAP;AAKD,OAND,CAME,OAAOQ,CAAP,EAAU;AACV,eAAOP,QAAQC,MAAR,CAAeM,CAAf,CAAP;AACD;AACF,KAnBO,CAmBN,CAnBM,CAAR;AAoBD,GAtBD;AAuBD","file":"compose.js","sourcesContent":["/* global PRODUCTION */\n// create lib\nexport default function compose(middleware: Array<Function>) {\n  return function (ctx) {\n    let index = -1;\n    return (function dispatch(i) {\n      if (i <= index) {\n        return Promise.reject(new Error(!PRODUCTION && 'next() called multiple times'));\n      }\n      index = i; // #if !PRODUCTION\n\n      const fn = middleware[i];\n      if (!PRODUCTION && !fn) throw new Error(!PRODUCTION && `Invalid fn ${i}`);\n\n      let called = false;\n      try {\n        return Promise.resolve(fn.call(ctx, ctx, () => {\n          if (called) throw new Error(!PRODUCTION && 'Cannot call next() more than once.');\n          called = true;\n          return dispatch(i + 1);\n        }));\n      } catch (e) {\n        return Promise.reject(e);\n      }\n    }(0));\n  };\n}\n"]}