{"version":3,"file":"index-node22.mjs","sources":["../src/index.tsx"],"sourcesContent":["/* eslint-disable react/destructuring-assignment */\nimport type { ReactElement } from \"react\";\nimport { PureComponent } from \"react\";\n\n/*\nExample with antd:\nimport { Progress } from 'antd';\n\nconst LoadingBarComponent = ({ progress }) => (\n  <Progress\n    type=\"line\"\n    status=\"active\"\n    percent={progress}\n    showInfo={false}\n  />\n);\n*/\n\n/* number between 0 and 1 */\nconst random = (): number => Math.ceil(Math.random() * 100) / 100;\n\n/**\n * around:\n * at 100ms 20%\n * at 1s 40%\n * at 2s 60%\n * at 3s 80%\n */\nconst calculatePercent = (percent: number): number => {\n  if (percent < 60) return percent + random() * 10 + 5;\n  if (percent < 70) return percent + random() * 10 + 3;\n  else if (percent < 80) return percent + random() + 5;\n  else if (percent < 90) return percent + random() + 1;\n  else if (percent < 95) return percent + 0.1;\n  else return percent;\n};\n\ninterface LoadingBarProps {\n  LoadingBarComponent: React.ComponentType<{ progress: number }>;\n  websocket: WebsocketInterface;\n}\n\ninterface LoadingBarState {\n  loading: boolean;\n  hidden: boolean;\n  progress: number;\n}\n\ninterface WebsocketInterface {\n  isConnected: () => boolean;\n  on: (event: \"connect\" | \"disconnect\", callback: () => unknown) => void;\n}\n\nexport default class LoadingBar extends PureComponent<\n  LoadingBarProps,\n  LoadingBarState\n> {\n  override state = {\n    loading: true,\n    hidden: true,\n    progress: 1,\n  };\n\n  fadeOffTimeout?: ReturnType<typeof setTimeout>;\n\n  resetTimeout?: ReturnType<typeof setTimeout>;\n\n  first20Timeout?: ReturnType<typeof setTimeout>;\n\n  progressTimer?: ReturnType<typeof setTimeout>;\n\n  override componentDidMount(): void {\n    if (this.props.websocket.isConnected()) {\n      this.setState((prevState) => ({\n        loading: false,\n        progress: 100,\n        hidden: prevState.hidden || prevState.progress === 100,\n      }));\n    }\n    this.props.websocket.on(\"connect\", () => {\n      this.setState({ loading: false });\n    });\n    this.props.websocket.on(\"disconnect\", () => {\n      this.setState({ loading: true, progress: 1, hidden: false });\n    });\n  }\n\n  override componentDidUpdate(\n    prevProps: LoadingBarProps,\n    prevState: LoadingBarState,\n  ): void {\n    if (this.props.websocket !== prevProps.websocket) {\n      throw new Error(\"Unsupported at the moment\");\n    }\n    if (this.state.loading !== prevState.loading) {\n      if (this.state.loading) {\n        this.showBar();\n      } else {\n        this.hideBar();\n      }\n    }\n  }\n\n  override componentWillUnmount(): void {\n    if (this.fadeOffTimeout) clearTimeout(this.fadeOffTimeout);\n    if (this.resetTimeout) clearTimeout(this.resetTimeout);\n    if (this.first20Timeout) clearTimeout(this.first20Timeout);\n    if (this.progressTimer) clearInterval(this.progressTimer);\n  }\n\n  private showBar(): void {\n    if (this.fadeOffTimeout) clearTimeout(this.fadeOffTimeout);\n    if (this.resetTimeout) clearTimeout(this.resetTimeout);\n\n    this.first20Timeout = setTimeout(() => {\n      this.setState({ progress: 20 });\n    }, 100);\n\n    this.progressTimer = setInterval(() => {\n      this.setState((prevState) => {\n        const newValue = calculatePercent(prevState.progress);\n        return { progress: newValue };\n      });\n    }, 500);\n  }\n\n  private hideBar(): void {\n    if (this.first20Timeout) clearTimeout(this.first20Timeout);\n    if (this.progressTimer) clearInterval(this.progressTimer);\n\n    this.fadeOffTimeout = setTimeout(() => {\n      this.setState({\n        progress: 100,\n      });\n    }, 500);\n\n    this.resetTimeout = setTimeout(() => {\n      this.setState({\n        hidden: true,\n        progress: 1,\n      });\n    }, 1000);\n  }\n\n  override render(): ReactElement {\n    const LoadingBarComponent = this.props.LoadingBarComponent;\n\n    return (\n      <div\n        hidden={this.state.hidden}\n        style={{\n          position: \"fixed\",\n          top: 0,\n          left: 0,\n          right: 0,\n          zIndex: 4,\n          pointerEvents: \"none\",\n        }}\n      >\n        <LoadingBarComponent progress={this.state.progress} />\n      </div>\n    );\n  }\n}\n"],"names":[],"mappings":"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"}