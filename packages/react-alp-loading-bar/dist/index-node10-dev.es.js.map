{"version":3,"file":"index-node10-dev.es.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { PureComponent } from 'react';\nimport ReactAlpContext from 'react-alp-context';\n\n/*\nExample with antd:\nimport { Progress } from 'antd';\n\nconst LoadingBarComponent = ({ progress }) => (\n  <Progress\n    type=\"line\"\n    status=\"active\"\n    percent={progress}\n    showInfo={false}\n  />\n);\n*/\n\n/* number between 0 and 1 */\nconst random = () => Math.ceil(Math.random() * 100) / 100;\n\n/**\n * around:\n * at 100ms 20%\n * at 1s 40%\n * at 2s 60%\n * at 3s 80%\n */\nconst calculatePercent = (percent: number) => {\n  if (percent < 60) return percent + random() * 10 + 5;\n  if (percent < 70) return percent + random() * 10 + 3;\n  else if (percent < 80) return percent + random() + 5;\n  else if (percent < 90) return percent + random() + 1;\n  else if (percent < 95) return percent + 0.1;\n  else return percent;\n};\n\ninterface LoadingBarProps {\n  LoadingBarComponent: React.ComponentType<{ progress: number }>;\n}\n\ninterface LoadingBarState {\n  loading: boolean;\n  hidden: boolean;\n  progress: number;\n}\n\nexport default class LoadingBar extends PureComponent<\n  LoadingBarProps,\n  LoadingBarState\n> {\n  static contextType = ReactAlpContext;\n\n  context!: React.ContextType<typeof ReactAlpContext>;\n\n  state = {\n    loading: true,\n    hidden: true,\n    progress: 1,\n  };\n\n  fadeOffTimeout?: any;\n\n  resetTimeout?: any;\n\n  first20Timeout?: any;\n\n  progressTimer?: any;\n\n  componentDidMount(): void {\n    const websocket = this.getWebsocket();\n    if (websocket.isConnected()) {\n      this.setState((prevState) => ({\n        loading: false,\n        progress: 100,\n        hidden: prevState.hidden || prevState.progress === 100,\n      }));\n    }\n    websocket.on('connect', () => {\n      this.setState({ loading: false });\n    });\n    websocket.on('disconnect', () => {\n      this.setState({ loading: true, progress: 1, hidden: false });\n    });\n  }\n\n  componentDidUpdate(\n    prevProps: LoadingBarProps,\n    prevState: LoadingBarState,\n  ): void {\n    if (this.state.loading !== prevState.loading) {\n      if (this.state.loading) {\n        this.showBar();\n      } else {\n        this.hideBar();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    clearTimeout(this.fadeOffTimeout);\n    clearTimeout(this.resetTimeout);\n    clearTimeout(this.first20Timeout);\n    clearInterval(this.progressTimer);\n  }\n\n  getWebsocket() {\n    return this.context.app.websocket;\n  }\n\n  private showBar() {\n    clearTimeout(this.fadeOffTimeout);\n    clearTimeout(this.resetTimeout);\n\n    this.first20Timeout = setTimeout(() => {\n      this.setState({ progress: 20 });\n    }, 100);\n\n    this.progressTimer = setInterval(() => {\n      this.setState((prevState) => {\n        const newValue = calculatePercent(prevState.progress);\n        return { progress: newValue };\n      });\n    }, 500);\n  }\n\n  private hideBar() {\n    clearTimeout(this.first20Timeout);\n    clearInterval(this.progressTimer);\n\n    this.fadeOffTimeout = setTimeout(() => {\n      this.setState({\n        progress: 100,\n      });\n    }, 500);\n\n    this.resetTimeout = setTimeout(() => {\n      this.setState({\n        hidden: true,\n        progress: 1,\n      });\n    }, 1000);\n  }\n\n  render() {\n    const LoadingBarComponent = this.props.LoadingBarComponent;\n\n    return (\n      <div\n        hidden={this.state.hidden}\n        style={{\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          right: 0,\n          zIndex: 4,\n          pointerEvents: 'none',\n        }}\n      >\n        <LoadingBarComponent progress={this.state.progress} />\n      </div>\n    );\n  }\n}\n"],"names":["random","Math","ceil","calculatePercent","percent","LoadingBar","PureComponent","state","loading","hidden","progress","componentDidMount","websocket","getWebsocket","isConnected","setState","prevState","on","componentDidUpdate","prevProps","showBar","hideBar","componentWillUnmount","clearTimeout","fadeOffTimeout","resetTimeout","first20Timeout","clearInterval","progressTimer","context","app","setTimeout","setInterval","newValue","render","LoadingBarComponent","props","position","top","left","right","zIndex","pointerEvents","contextType","ReactAlpContext"],"mappings":"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"}