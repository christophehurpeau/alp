{"version":3,"file":"index-browser.cjs.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { ReactElement, useContext, useEffect, useState } from 'react';\nimport ReactAlpContext from 'react-alp-context';\nimport { T } from 'react-alp-translate';\nimport '../ConnectionState.global.scss';\n\ntype State = null | 'connecting' | 'connected' | 'disconnected';\n\nexport default function ConnectionState(): ReactElement {\n  const ctx = useContext(ReactAlpContext);\n  const notConnected = !ctx.sanitizedState.user;\n\n  const [connectionState, setConnectionState] = useState<State>(null);\n  useEffect((): (() => void) => {\n    const websocket = ctx.app.websocket;\n    let unloading = false;\n\n    const beforeUnloadHandler = (): void => {\n      unloading = true;\n    };\n    window.addEventListener('beforeunload', beforeUnloadHandler);\n\n    const connectedHandler = websocket.on('connect', (): void => {\n      setConnectionState('connected');\n    });\n    const disconnectedHandler = websocket.on('disconnect', (): void => {\n      if (unloading) return;\n      setConnectionState('disconnected');\n    });\n\n    setConnectionState(websocket.connected ? 'connected' : 'connecting');\n\n    return (): void => {\n      websocket.off('connected', connectedHandler);\n      websocket.off('disconnected', disconnectedHandler);\n      window.removeEventListener('beforeunload', beforeUnloadHandler);\n    };\n  }, [ctx.app.websocket]);\n\n  return (\n    <div\n      hidden={\n        !connectionState || notConnected || connectionState === 'connected'\n      }\n      className=\"alp-connection-state\"\n    >\n      {!connectionState || notConnected ? null : (\n        <div>\n          <T id={`connectionState.${connectionState}`} />\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["ConnectionState","ctx","useContext","ReactAlpContext","notConnected","sanitizedState","user","useState","connectionState","setConnectionState","useEffect","websocket","app","unloading","beforeUnloadHandler","window","addEventListener","connectedHandler","on","disconnectedHandler","connected","off","removeEventListener","React","T"],"mappings":";;;;;;;;;;;;AAOe,SAASA,eAAT,GAAyC;AACtD,MAAMC,GAAG,GAAGC,gBAAU,CAACC,eAAD,CAAtB;AACA,MAAMC,YAAY,GAAG,CAACH,GAAG,CAACI,cAAJ,CAAmBC,IAAzC;;AAFsD,kBAIRC,cAAQ,CAAQ,IAAR,CAJA;AAAA,MAI/CC,eAJ+C;AAAA,MAI9BC,kBAJ8B;;AAKtDC,EAAAA,eAAS,CAAC,YAAoB;AAC5B,QAAMC,SAAS,GAAGV,GAAG,CAACW,GAAJ,CAAQD,SAA1B;AACA,QAAIE,SAAS,GAAG,KAAhB;;AAEA,QAAMC,mBAAmB,GAAG,SAAtBA,mBAAsB,GAAY;AACtCD,MAAAA,SAAS,GAAG,IAAZ;AACD,KAFD;;AAGAE,IAAAA,MAAM,CAACC,gBAAP,CAAwB,cAAxB,EAAwCF,mBAAxC;AAEA,QAAMG,gBAAgB,GAAGN,SAAS,CAACO,EAAV,CAAa,SAAb,EAAwB,YAAY;AAC3DT,MAAAA,kBAAkB,CAAC,WAAD,CAAlB;AACD,KAFwB,CAAzB;AAGA,QAAMU,mBAAmB,GAAGR,SAAS,CAACO,EAAV,CAAa,YAAb,EAA2B,YAAY;AACjE,UAAIL,SAAJ,EAAe;AACfJ,MAAAA,kBAAkB,CAAC,cAAD,CAAlB;AACD,KAH2B,CAA5B;AAKAA,IAAAA,kBAAkB,CAACE,SAAS,CAACS,SAAV,GAAsB,WAAtB,GAAoC,YAArC,CAAlB;AAEA,WAAO,YAAY;AACjBT,MAAAA,SAAS,CAACU,GAAV,CAAc,WAAd,EAA2BJ,gBAA3B;AACAN,MAAAA,SAAS,CAACU,GAAV,CAAc,cAAd,EAA8BF,mBAA9B;AACAJ,MAAAA,MAAM,CAACO,mBAAP,CAA2B,cAA3B,EAA2CR,mBAA3C;AACD,KAJD;AAKD,GAxBQ,EAwBN,CAACb,GAAG,CAACW,GAAJ,CAAQD,SAAT,CAxBM,CAAT;AA0BA,sBACEY;AACE,IAAA,MAAM,EACJ,CAACf,eAAD,IAAoBJ,YAApB,IAAoCI,eAAe,KAAK,WAF5D;AAIE,IAAA,SAAS,EAAC;AAJZ,KAMG,CAACA,eAAD,IAAoBJ,YAApB,GAAmC,IAAnC,gBACCmB,uDACEA,6BAACC,mBAAD;AAAG,IAAA,EAAE,uBAAqBhB;AAA1B,IADF,CAPJ,CADF;AAcD;;;;"}