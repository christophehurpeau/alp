{"version":3,"file":"index-node8-dev.cjs.js","sources":["../src/index.tsx"],"sourcesContent":["import React, { ReactElement, useContext, useEffect, useState } from 'react';\nimport ReactAlpContext from 'react-alp-context';\nimport { T } from 'react-alp-translate';\nimport '../ConnectionState.global.scss';\n\ntype State = null | 'connecting' | 'connected' | 'disconnected';\n\nexport default function ConnectionState(): ReactElement {\n  const ctx = useContext(ReactAlpContext);\n  const notConnected = !ctx.sanitizedState.user;\n\n  const [connectionState, setConnectionState] = useState<State>(null);\n  useEffect(\n    (): (() => void) => {\n      const websocket = ctx.app.websocket;\n      let unloading = false;\n\n      window.addEventListener(\n        'beforeunload',\n        (): void => {\n          unloading = true;\n        },\n      );\n\n      const connectedHandler = websocket.on(\n        'connect',\n        (): void => {\n          setConnectionState('connected');\n        },\n      );\n      const disconnectedHandler = websocket.on(\n        'disconnect',\n        (): void => {\n          if (unloading) return;\n          setConnectionState('disconnected');\n        },\n      );\n\n      setConnectionState(websocket.connected ? 'connected' : 'connecting');\n\n      return (): void => {\n        websocket.off('connected', connectedHandler);\n        websocket.off('disconnected', disconnectedHandler);\n      };\n    },\n  );\n\n  return (\n    <div\n      hidden={\n        !connectionState || notConnected || connectionState === 'connected'\n      }\n      className=\"alp-connection-state\"\n    >\n      {!connectionState || notConnected ? null : (\n        <div>\n          <T id={`connectionState.${connectionState}`} />\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["ConnectionState","ctx","useContext","ReactAlpContext","notConnected","sanitizedState","user","connectionState","setConnectionState","useState","useEffect","websocket","app","unloading","window","addEventListener","connectedHandler","on","disconnectedHandler","connected","off","React","T"],"mappings":";;;;;;;;;;;;AAAA,AAOe,SAASA,eAAT,GAAyC;QAChDC,GAAG,GAAGC,gBAAU,CAACC,eAAD,CAAtB;QACMC,YAAY,GAAG,CAACH,GAAG,CAACI,cAAJ,CAAmBC,IAAzC;QAEM,CAACC,eAAD,EAAkBC,kBAAlB,IAAwCC,cAAQ,CAAQ,IAAR,CAAtD;EACAC,eAAS,CACP,MAAoB;UACZC,SAAS,GAAGV,GAAG,CAACW,GAAJ,CAAQD,SAA1B;QACIE,SAAS,GAAG,KAAhB;IAEAC,MAAM,CAACC,gBAAP,CACE,cADF,EAEE,MAAY;MACVF,SAAS,GAAG,IAAZ;KAHJ;UAOMG,gBAAgB,GAAGL,SAAS,CAACM,EAAV,CACvB,SADuB,EAEvB,MAAY;MACVT,kBAAkB,CAAC,WAAD,CAAlB;KAHqB,CAAzB;UAMMU,mBAAmB,GAAGP,SAAS,CAACM,EAAV,CAC1B,YAD0B,EAE1B,MAAY;UACNJ,SAAJ,EAAe;MACfL,kBAAkB,CAAC,cAAD,CAAlB;KAJwB,CAA5B;IAQAA,kBAAkB,CAACG,SAAS,CAACQ,SAAV,GAAsB,WAAtB,GAAoC,YAArC,CAAlB;WAEO,MAAY;MACjBR,SAAS,CAACS,GAAV,CAAc,WAAd,EAA2BJ,gBAA3B;MACAL,SAAS,CAACS,GAAV,CAAc,cAAd,EAA8BF,mBAA9B;KAFF;GA5BK,CAAT;SAoCEG;IACE,MAAM,EACJ,CAACd,eAAD,IAAoBH,YAApB,IAAoCG,eAAe,KAAK,WAF5D;IAIE,SAAS,EAAC,sBAJZ;;;;;;KAMG,CAACA,eAAD,IAAoBH,YAApB,GAAmC,IAAnC,GACCiB;;;;;;KACEA,6BAACC,mBAAD;IAAG,EAAE,EAAG,mBAAkBf,eAAgB,EAA1C;;;;;;IADF,CAPJ,CADF;;;;;"}