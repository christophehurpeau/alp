{"version":3,"file":"index-node12.mjs","sources":["../src/index.ts"],"sourcesContent":["import type { ApplicationInCreation } from 'alp-types';\n// eslint-disable-next-line node/no-extraneous-import\nimport type { Context } from 'koa';\nimport { defineLazyProperty } from 'object-properties';\n\ndeclare module 'alp-types' {\n  interface BaseContext {}\n  interface Context {\n    readonly firstAcceptedLanguage: string;\n    readonly language: string;\n  }\n}\n\nexport default function alpLanguage(app: ApplicationInCreation): void {\n  const config = app.context.config;\n  const availableLanguages: string[] = config.get('availableLanguages');\n  if (!availableLanguages) {\n    throw new Error('Missing config \"availableLanguages\"');\n  }\n\n  defineLazyProperty(app.context, 'language', function (this: Context): string {\n    return (\n      (this.acceptsLanguages(availableLanguages) as string | false) ||\n      availableLanguages[0]\n    );\n  });\n\n  defineLazyProperty(\n    app.context,\n    'firstAcceptedLanguage',\n    function (this: Context): string {\n      return ((this.acceptsLanguages() as string[])[0] ||\n        availableLanguages[0]) as string;\n    },\n  );\n}\n"],"names":["alpLanguage","app","config","context","availableLanguages","get","Error","defineLazyProperty","acceptsLanguages"],"mappings":";;AACA;AAYe,SAASA,WAAT,CAAqBC,GAArB,EAAuD;AACpE,QAAMC,MAAM,GAAGD,GAAG,CAACE,OAAJ,CAAYD,MAA3B;AACA,QAAME,kBAA4B,GAAGF,MAAM,CAACG,GAAP,CAAW,oBAAX,CAArC;;AACA,MAAI,CAACD,kBAAL,EAAyB;AACvB,UAAM,IAAIE,KAAJ,CAAU,qCAAV,CAAN;AACD;;AAEDC,EAAAA,kBAAkB,CAACN,GAAG,CAACE,OAAL,EAAc,UAAd,EAA0B,YAAiC;AAC3E,WACG,KAAKK,gBAAL,CAAsBJ,kBAAtB,CAAD,IACAA,kBAAkB,CAAC,CAAD,CAFpB;AAID,GALiB,CAAlB;AAOAG,EAAAA,kBAAkB,CAChBN,GAAG,CAACE,OADY,EAEhB,uBAFgB,EAGhB,YAAiC;AAC/B,WAAS,KAAKK,gBAAL,EAAD,CAAsC,CAAtC,KACNJ,kBAAkB,CAAC,CAAD,CADpB;AAED,GANe,CAAlB;AAQD;;;;"}