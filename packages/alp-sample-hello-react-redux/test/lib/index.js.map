{"version":3,"sources":["../src/index.js"],"names":[],"mappings":";;AACA;;AACA;;;;AACA;;AACA;;;;;;;AAEA,MAAM,WAAW;AACb,mBAAe,sBAAa,CAAC,AAAD,GAAG,SAAH,EAAa,6BAAb,CAAb,EACM,QADN;AADF,CAAjB;;AAKA,SAAS,iBAAT,CAA2B,MAA3B,EAAmC,OAAnC,EAA4C;AACxC,WAAO,CACH,MADG,EAEH,OAFG,EAGL,GAHK,CAGD,KACF,EACK,IADL,GAEK,OAFL,CAEa,WAFb,EAE0B,EAF1B,EAGK,OAHL,CAGa,oCAHb,EAGmD,EAHnD,CAJG,CAAP;AASH;;AAED,MAAM,mBAAN,EAA2B,MAAM;AAC7B,QAAI,SAAS,6BAAa,CACtB,cADsB,EAEtB,cAFsB,EAGtB,QAHsB,EAItB,IAJsB,CAAb,CAAb;;AAOA,eAAW,QAAQ;AACf,eAAO,KAAP;AACA,eAAO,EAAP,CAAU,QAAV,EAAqB,IAAD,IAAU;AAC1B,gBAAI,SAAS,KAAK,QAAL,GAAgB,WAAhB,EAAb;AACA,gBAAI,OAAO,OAAP,CAAe,WAAf,MAAgC,CAAC,CAArC,EAAwC;AACpC,oBAAI,IAAJ,EAAU;AACN;AACH;AACJ;AACJ,SAPD;AAQH,KAVD;;AAYA,kBAAc,MAAM;AAChB,eAAO,IAAP;AACH,KAFD;;AAIA,SAAK,oBAAL,EAA2B,MACvB,yBAAM,wBAAN,EACK,IADL,CACU,OAAO,IAAI,IAAJ,EADjB,EAEK,IAFL,CAEU,OAAO;AACT,iCACI,GAAG,kBAAkB,GAAlB,EAAuB,SAAS,aAAT,CAAvB,CADP;AAGH,KANL,CADJ;;AAUA,SAAK,iBAAL,EAAwB,MACpB,yBAAM,mCAAN,EACK,IADL,CACU,OAAO,IAAI,IAAJ,EADjB,EAEK,IAFL,CAEU,OAAO;AACT,iCACI,GAAG,kBACC,GADD,EAEC,SAAS,aAAT,EACK,OADL,CACa,eADb,EAC8B,cAD9B,EAEK,OAFL,CAEa,aAFb,EAE4B,kBAF5B,EAGK,OAHL,CAIQ,sBAJR,EAKQ,2BALR,CAFD,CADP;AAYH,KAfL,CADJ;AAkBH,CApDD","file":"index.js","sourcesContent":["/* global suite, suiteSetup, suiteTeardown, test */\nimport { node as createDaemon } from 'springbokjs-daemon';\nimport fetch from 'node-fetch';\nimport { strictEqual } from 'assert';\nimport { readFileSync } from 'fs';\n\nconst fixtures = {\n    'hello-world': readFileSync(`${__dirname}/../fixtures/hello-world.html`)\n                        .toString(),\n};\n\nfunction comparableContent(result, fixture) {\n    return [\n        result,\n        fixture,\n    ].map(s => (\n        s\n            .trim()\n            .replace(/\\r?\\n\\s*/g, '')\n            .replace(/ data-react(id|-checksum)=\"[^\"]+\"/g, '')\n    ));\n}\n\nsuite('test hello server', () => {\n    let daemon = createDaemon([\n        '--es_staging',\n        'lib/index.js',\n        '--port',\n        5555,\n    ]);\n\n    suiteSetup(done => {\n        daemon.start();\n        daemon.on('stdout', (data) => {\n            let string = data.toString().toLowerCase();\n            if (string.indexOf('listening') !== -1) {\n                if (done) {\n                    done();\n                }\n            }\n        });\n    });\n\n    suiteTeardown(() => {\n        daemon.stop();\n    });\n\n    test('hello without name', () => (\n        fetch('http://localhost:5555/')\n            .then(res => res.text())\n            .then(res => {\n                strictEqual(\n                    ...comparableContent(res, fixtures['hello-world'])\n                );\n            })\n    ));\n\n    test('hello with name', () => (\n        fetch('http://localhost:5555/?name=Chris')\n            .then(res => res.text())\n            .then(res => {\n                strictEqual(\n                    ...comparableContent(\n                        res,\n                        fixtures['hello-world']\n                            .replace(/Hello World!/g, 'Hello Chris!')\n                            .replace('{\"name\":\"\"}', '{\"name\":\"Chris\"}')\n                            .replace(\n                                'type=\"text\" value=\"\"',\n                                'type=\"text\" value=\"Chris\"'\n                            )\n                    )\n                );\n            })\n    ));\n});\n"]}