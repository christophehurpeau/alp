{"version":3,"sources":["../../../src/models/user/UsersManager.js"],"names":[],"mappings":";;;;;;;;;;;;AAAA,OAAO,UAAP,MAAuB,YAAvB;AACA,SAAS,eAAT,QAAgC,MAAhC;AACA,SAAS,QAAT,EAAmB,WAAnB,QAAsC,SAAtC;;IAEqB,Y;;;;;;;;;;;;;;8MAQjB,Q,GAAW,aAAa,Q;;;;;wDAKF;AAAA,gBAFhB,QAEgB,SAFhB,QAEgB;AAAA,gBAFN,SAEM,SAFN,SAEM;AAAA,gBAFK,MAEL,SAFK,MAEL;;AAAA;AAAA,qCAAnB,OAAmB;AAAA;AAAA;;AAAA;AAAA;;AAAA,8DADZ,QACY,sCADM,SACN,qCADM,SACN,gCADgC,MAChC,uCADgC,MAChC,kBADgC,MAChC;AAAA;AAAA;AAAA;AAAA;;AAClB,gBAAI,QAAQ;AACR,qCAAqB,QADb;AAER,sCAAsB;AAFd,aAAZ;;AAKA,gBAAI,UAAU,OAAO,MAArB,EAA6B;AACzB,wBAAQ;AACJ,yBAAK,CACD,KADC,EAED;AACI,gCAAQ,EAAE,KAAK,MAAP;AADZ,qBAFC;AADD,iBAAR;AAQH;;AAfiB,wBAiBX,KAAK,KAAL,CAAW,OAAX,CAAmB,KAAnB,CAjBW;AAkBrB;;;sCAEa,S,EAA+B;AAAA;AAAA,sCAAnB,OAAmB;AAAA;AAAA;;AAAA;AAAA;;AAAA,yBAClC,KAAK,KAAL,CAAW,SAAX,CAAqB,SAArB,CADkC;AAE5C;;;kCAES,I,EAAe;AAAA;AAAA,sCAAR,OAAQ;AAAA;AAAA;;AAAA;AAAA;;AAAA,yBACd,KAAK,KAAL,CAAW,SAAX,CAAqB,IAArB,CADc;AAExB;;;kCAES,I,EAAe;AAAA;AAAA,sCAAR,OAAQ;AAAA;AAAA;;AAAA;AAAA;;AAAA,yBACd,KAAK,KAAL,CAAW,SAAX,CAAqB,IAArB,CADc;AAExB;;;sCAEa,I,EAAgB,O,EAAsB;AAAA,kBAAtC,IAAsC,YAAhC,QAAgC;AAAA,8HAAtC,IAAsC;AAAA;;AAAA,kBAAtB,OAAsB,YAAb,WAAa;AAAA,oIAAtB,OAAsB;AAAA;;AAChD,gBAAI,eAAe,KAAK,QAAL,CAAc,OAAd,CAAsB,OAAtB,CAAnB;AACA,mBAAO,KAAK,KAAL,CAAW,gBAAX,CAA4B,IAA5B,oCAAiD,YAAjD,EAAkE,OAAlE,EAAP;AACH;;;4CAEmB,I,EAAM;AACtB,mBAAO;AACH,6BAAa,KAAK,WADf;AAEH,0BAAU,KAAK,QAFZ;AAGH,wBAAQ,KAAK,MAHV;AAIH,wBAAQ,KAAK,MAJV;AAKH,0BAAU,KAAK,QAAL,CAAc,GAAd,CAAkB;AAAA,2BAAY;AACpC,kCAAU,QAAQ,QADkB;AAEpC,mCAAW,QAAQ,SAFiB;AAGpC,8BAAM,QAAQ,IAHsB;AAIpC,gCAAQ,QAAQ;AAJoB,qBAAZ;AAAA,iBAAlB;AALP,aAAP;AAYH;;;;EA/DqC,e;;AAArB,Y,CAGV,Q,GAAW;AACd,eAAW,WADG;AAEd,aAAS;AAFK,C;eAHD,Y","file":"UsersManager.js","sourcesContent":["import MongoStore from 'liwi/mongo';\nimport { AbstractManager } from 'liwi';\nimport { UserType, AccountType } from './types';\n\nexport default class UsersManager extends AbstractManager {\n    store: MongoStore;\n\n    static STATUSES = {\n        VALIDATED: 'validated',\n        DELETED: 'deleted',\n    };\n\n    STATUSES = UsersManager.STATUSES;\n\n    findOneByAccountOrEmails(\n        { provider, accountId, emails }:\n            { provider: string, accountId: string|number, emails: ?Array<string> }\n    ): Promise<?UserType> {\n        let query = {\n            'accounts.provider': provider,\n            'accounts.accountId': accountId,\n        };\n\n        if (emails && emails.length) {\n            query = {\n                $or: [\n                    query,\n                    {\n                        emails: { $in: emails },\n                    },\n                ],\n            };\n        }\n\n        return this.store.findOne(query);\n    }\n\n    findConnected(connected): Promise<?UserType> {\n        return this.store.findByKey(connected);\n    }\n\n    insertOne(user): Promise {\n        return this.store.insertOne(user);\n    }\n\n    updateOne(user): Promise {\n        return this.store.updateOne(user);\n    }\n\n    updateAccount(user: UserType, account: AccountType) {\n        let accountIndex = user.accounts.indexOf(account);\n        return this.store.partialUpdateOne(user, { [`accounts.${accountIndex}`]: account });\n    }\n\n    transformForBrowser(user) {\n        return {\n            displayName: user.displayName,\n            fullName: user.fullName,\n            status: user.status,\n            emails: user.emails,\n            accounts: user.accounts.map(account => ({\n                provider: account.provider,\n                accountId: account.accountId,\n                name: account.name,\n                status: account.status,\n            })),\n        };\n    }\n}\n"]}