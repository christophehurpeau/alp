{"version":3,"sources":["../../../src/models/user/UsersManager.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AAEe,MAAM,YAAN,+BAA2C;AAAA;AAAA;;AAAA,iDAQtD,QARsD,GAQ3C,aAAa,QAR8B;AAAA;;AAUtD,mCAGsB;AAAA,YAFhB,QAEgB,QAFhB,QAEgB;AAAA,YAFN,SAEM,QAFN,SAEM;AAAA,YAFK,MAEL,QAFK,MAEL;;AAClB,YAAI,QAAQ;AACR,iCAAqB,QADb;AAER,kCAAsB;AAFd,SAAZ;;AAKA,YAAI,UAAU,OAAO,MAArB,EAA6B;AACzB,oBAAQ;AACJ,qBAAK,CACD,KADC,EAED;AACI,4BAAQ,EAAE,KAAK,MAAP;AADZ,iBAFC;AADD,aAAR;AAQH;;AAED,eAAO,KAAK,KAAL,CAAW,OAAX,CAAmB,KAAnB,CAAP;AACH;;AAED,kBAAc,SAAd,EAA6C;AACzC,eAAO,KAAK,KAAL,CAAW,SAAX,CAAqB,SAArB,CAAP;AACH;;AAED,cAAU,IAAV,EAAyB;AACrB,eAAO,KAAK,KAAL,CAAW,SAAX,CAAqB,IAArB,CAAP;AACH;;AAED,cAAU,IAAV,EAAyB;AACrB,eAAO,KAAK,KAAL,CAAW,SAAX,CAAqB,IAArB,CAAP;AACH;;AAED,kBAAc,IAAd,EAA8B,OAA9B,EAAoD;AAChD,YAAI,eAAe,KAAK,QAAL,CAAc,OAAd,CAAsB,OAAtB,CAAnB;AACA,eAAO,KAAK,KAAL,CAAW,gBAAX,CAA4B,IAA5B,EAAkC,EAAE,CAAC,CAAC,SAAD,GAAY,YAAZ,EAAyB,AAAzB,CAAD,GAA8B,OAAhC,EAAlC,CAAP;AACH;;AAED,wBAAoB,IAApB,EAA0B;AACtB,eAAO;AACH,yBAAa,KAAK,WADf;AAEH,sBAAU,KAAK,QAFZ;AAGH,oBAAQ,KAAK,MAHV;AAIH,oBAAQ,KAAK,MAJV;AAKH,sBAAU,KAAK,QAAL,CAAc,GAAd,CAAkB,YAAY;AACpC,0BAAU,QAAQ,QADkB;AAEpC,2BAAW,QAAQ,SAFiB;AAGpC,sBAAM,QAAQ,IAHsB;AAIpC,wBAAQ,QAAQ;AAJoB,aAAZ,CAAlB;AALP,SAAP;AAYH;AA/DqD;kBAArC,Y;AAAA,Y,CAGV,Q,GAAW;AACd,eAAW,WADG;AAEd,aAAS;AAFK,C","file":"UsersManager.js","sourcesContent":["import MongoStore from 'liwi/mongo';\nimport { AbstractManager } from 'liwi';\nimport { UserType, AccountType } from './types';\n\nexport default class UsersManager extends AbstractManager {\n    store: MongoStore;\n\n    static STATUSES = {\n        VALIDATED: 'validated',\n        DELETED: 'deleted',\n    };\n\n    STATUSES = UsersManager.STATUSES;\n\n    findOneByAccountOrEmails(\n        { provider, accountId, emails }:\n            { provider: string, accountId: string|number, emails: ?Array<string> }\n    ): Promise<?UserType> {\n        let query = {\n            'accounts.provider': provider,\n            'accounts.accountId': accountId,\n        };\n\n        if (emails && emails.length) {\n            query = {\n                $or: [\n                    query,\n                    {\n                        emails: { $in: emails },\n                    },\n                ],\n            };\n        }\n\n        return this.store.findOne(query);\n    }\n\n    findConnected(connected): Promise<?UserType> {\n        return this.store.findByKey(connected);\n    }\n\n    insertOne(user): Promise {\n        return this.store.insertOne(user);\n    }\n\n    updateOne(user): Promise {\n        return this.store.updateOne(user);\n    }\n\n    updateAccount(user: UserType, account: AccountType) {\n        let accountIndex = user.accounts.indexOf(account);\n        return this.store.partialUpdateOne(user, { [`accounts.${accountIndex}`]: account });\n    }\n\n    transformForBrowser(user) {\n        return {\n            displayName: user.displayName,\n            fullName: user.fullName,\n            status: user.status,\n            emails: user.emails,\n            accounts: user.accounts.map(account => ({\n                provider: account.provider,\n                accountId: account.accountId,\n                name: account.name,\n                status: account.status,\n            })),\n        };\n    }\n}\n"]}