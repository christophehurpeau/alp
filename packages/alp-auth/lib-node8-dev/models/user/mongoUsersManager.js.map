{"version":3,"sources":["../../../src/models/user/mongoUsersManager.js"],"names":["mongoUsersManager","Object","create","assign","findOneByAccountOrEmails","provider","accountId","emails","query","length","$or","$in","store","findOne","updateAccount","user","account","accountIndex","accounts","indexOf","Error","partialUpdateOne"],"mappings":";;;;;;AAAA;;;;AACA;;;;;;;;;;;;AAEA,MAAMA,oBAAoBC,OAAOC,MAAP,gCAA1B;kBACeF,iB;AAEfC,OAAOE,MAAP,CAAcH,iBAAd,EAAiC;AAC/BI,iCAQuB;AAAA,qDAAX,+BAAC,mCAAD,CAAW;;AAAA,QARE;AACvBC,cADuB;AAEvBC,eAFuB;AAGvBC;AAHuB,KAQF,GAJtB,6BACC,2CAAU,8BAAV,CADD,EAEC,4CAAW,4DAAS,8BAAT,CAAX,CAFD,EAGC,yCAAQ,+BAAC,4BAAM,8BAAN,CAAD,CAAR,CAHD,CAIsB;;AACrB,QAAIC,QAAQ;AACV,2BAAqBH,QADX;AAEV,4BAAsBC;AAFZ,KAAZ;;AAgBA,WAXIC,UAAUA,OAAOE,MAWrB,KAVED,QAAQ;AACNE,WAAK,CACHF,KADG,EAEH;AACED,gBAAQ,EAAEI,KAAKJ,MAAP;AADV,OAFG;AADC,KAUV,GAAO,KAAKK,KAAL,CAAWC,OAAX,CAAmBL,KAAnB,CAAP;AACD,GA3B8B;;AA6B/BM,gBAAcC,IAAd,EAA8BC,OAA9B,EAAoD;AAAA,oBAAlC,mCAAkC;;AAAA,uBAAf,sCAAe;;AAAA;;AAClD,QAAIC,eAAeF,KAAKG,QAAL,CAAcC,OAAd,CAAsBH,OAAtB,CAAnB;AACA,QAAIC,iBAAiB,CAAC,CAAtB,EACE,MAAM,IAAIG,KAAJ,CAAU,iBAAV,CAAN;;AAGF,WAAO,KAAKR,KAAL,CAAWS,gBAAX,CAA4BN,IAA5B,EAAkC,EAAE,CAAE,YAAWE,YAAa,EAA1B,GAA8BD,OAAhC,EAAlC,CAAP;AACD;AApC8B,CAAjC,C","file":"mongoUsersManager.js","sourcesContent":["import abstractUsersManager from './abstractUsersManager';\nimport type { UserType, AccountType } from './types/index';\n\nconst mongoUsersManager = Object.create(abstractUsersManager);\nexport default mongoUsersManager;\n\nObject.assign(mongoUsersManager, {\n  findOneByAccountOrEmails({\n    provider,\n    accountId,\n    emails,\n  }: {\n    provider: string,\n    accountId: string | number,\n    emails: ?Array<string>,\n  }): Promise<?UserType> {\n    let query = {\n      'accounts.provider': provider,\n      'accounts.accountId': accountId,\n    };\n\n    if (emails && emails.length) {\n      query = {\n        $or: [\n          query,\n          {\n            emails: { $in: emails },\n          },\n        ],\n      };\n    }\n\n    return this.store.findOne(query);\n  },\n\n  updateAccount(user: UserType, account: AccountType) {\n    let accountIndex = user.accounts.indexOf(account);\n    if (accountIndex === -1) {\n      throw new Error('Invalid account');\n    }\n\n    return this.store.partialUpdateOne(user, { [`accounts.${accountIndex}`]: account });\n  },\n});\n"]}