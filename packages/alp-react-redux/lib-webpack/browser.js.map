{"version":3,"sources":["../src/browser.js"],"names":[],"mappings":"AAAA,OAAO,MAAP,IAAiB,OAAO,UAAxB,QAA0C,MAA1C;AACA,OAAO,QAAP,MAAqB,gBAArB;AACA,OAAO,MAAP,MAAmB,oBAAnB;AACA,SAAS,WAAT,EAAsB,eAAtB,EAAuC,OAAvC,QAAsD,OAAtD;AACA,SAAS,iBAAT,EAA4B,wBAA5B,QAA4D,eAA5D;AACA,SAAS,mBAAT,QAAoC,aAApC;;AAEA,SAAS,OAAT,QAAwB,aAAxB;0BACyB,gB;0BAAlB,Y;2BACmB,iB;2BAAnB,a;;AACP,SAAS,gBAAT,EAA2B,uBAA3B,QAA0D,aAA1D;;AAEA,IAAM,SAAS,IAAI,MAAJ,CAAW,iBAAX,CAAf;;AAEA,IAAI,iBAAJ;;AAEA,eAAe,SAAS,aAAT,CAAuB,OAAvB,EAAgC;AAC3C,WAAO,UAAC,GAAD,EAAS;AACZ,YAAM,cAAc,CAChB,yBAAyB,GAAzB,CADgB,EAEhB,iBAFgB,CAApB;AAIA,YAAI,IAAI,SAAR,EAAmB;AACf,mBAAO,KAAP,CAAa,iCAAb;AACA,gBAAI,SAAJ,CAAc,EAAd,CAAiB,cAAjB,EAAiC,kBAAU;AACvC,uBAAO,IAAP,CAAY,gCAAZ,EAA8C,MAA9C;AACA,oBAAI,KAAJ,EAAW;AACP,0BAAM,QAAN,CAAe,MAAf;AACH;AACJ,aALD;AAMA,wBAAY,IAAZ,CAAiB,oBAAoB,GAApB,CAAjB;AACH;;AAED,YAAI,OAAJ,CAAY,MAAZ,GAAqB,UAAU,gBAAV,EAA4B,IAA5B,EAAkC;AACnD,mBAAO,KAAP,CAAa,aAAb,EAA4B,EAAE,UAAF,EAA5B;;AAEA,gBAAI,CAAC,iBAAiB,IAAtB,EAA4B;AACxB,sBAAM,IAAI,KAAJ,CAAU,mCAAV,CAAN;AACH;;AAED,gBAAM,UAAU,iBAAiB,OAAjC;;AAEA,gBAAI,UAAU,SAAd,EAAyB;AACrB,oBAAI,OAAJ,EAAa;AACT,4BAAQ,YACJ,OADI,EAEJ,IAFI,EAGJ,QACI,iCAAmB,WAAnB,CADJ,EAEI,OAAO,iBAAP,GAA2B,OAAO,iBAAP,EAA3B,GAAwD;AAAA,+BAAK,CAAL;AAAA,qBAF5D,CAHI,CAAR;AAQH;AACJ,aAXD,MAWO;AAAA;;AAEH,wBAAM,QAAQ,MAAM,QAAN,EAAd;AACA,2BAAO,IAAP,CAAY,KAAZ,EAAmB,OAAnB,CAA2B;AAAA,+BAAO,OAAO,MAAM,GAAN,CAAd;AAAA,qBAA3B;AACA,2BAAO,MAAP,CAAc,KAAd,EAAqB,IAArB;;;AAGA,wBAAI,OAAJ,EAAa;AACT,8BAAM,cAAN,CAAqB,OAArB;AACH,qBAFD,MAEO;AACH,8BAAM,cAAN,CAAqB,UAAC,KAAD,EAAQ,MAAR;AAAA,mCAAmB,KAAnB;AAAA,yBAArB;AACH;AAXE;AAYN;;AAED,gBAAI,OAAJ,EAAa;AACT,qBAAK,KAAL,GAAa,KAAb;AACH;;AAED,mBAAO;AACH,yBAAS,IADN;AAEH,sBAAM,iBAAiB,IAFpB;AAGH,0BAHG;AAIH,gCAJG;AAKH,qBAAK,UAAU,QAAV,GAAqB;AALvB,aAAP;AAOH,SA7CD;AA8CH,KA9DD;AA+DH","file":"browser.js","sourcesContent":["import render, { App as DefaultApp } from 'fody';\nimport ReduxApp from 'fody-redux-app';\nimport Logger from 'nightingale-logger';\nimport { createStore, applyMiddleware, compose } from 'redux';\nimport { promiseMiddleware, createFunctionMiddleware } from './middlewares';\nimport { websocketMiddleware } from './websocket';\n\nexport { connect } from 'react-redux';\nexport createAction from './createAction';\nexport createReducer from './createReducer';\nexport { createEmitAction, createEmitPromiseAction } from './websocket';\n\nconst logger = new Logger('alp.react-redux');\n\nlet store;\n\nexport default function alpReactRedux(element) {\n    return (app) => {\n        const middlewares = [\n            createFunctionMiddleware(app),\n            promiseMiddleware,\n        ];\n        if (app.websocket) {\n            logger.debug('register websocket redux:action');\n            app.websocket.on('redux:action', action => {\n                logger.info('dispatch action from websocket', action);\n                if (store) {\n                    store.dispatch(action);\n                }\n            });\n            middlewares.push(websocketMiddleware(app));\n        }\n\n        app.context.render = function (moduleDescriptor, data) {\n            logger.debug('render view', { data });\n\n            if (!moduleDescriptor.View) {\n                throw new Error('View is undefined, class expected');\n            }\n\n            const reducer = moduleDescriptor.reducer;\n\n            if (store === undefined) {\n                if (reducer) {\n                    store = createStore(\n                        reducer,\n                        data,\n                        compose(\n                            applyMiddleware(...middlewares),\n                            window.devToolsExtension ? window.devToolsExtension() : f => f\n                        )\n                    );\n                }\n            } else {\n                // replace state\n                const state = store.getState();\n                Object.keys(state).forEach(key => delete state[key]);\n                Object.assign(state, data);\n\n                // replace reducer\n                if (reducer) {\n                    store.replaceReducer(reducer);\n                } else {\n                    store.replaceReducer((state, action) => state);\n                }\n            }\n\n            if (reducer) {\n                this.store = store;\n            }\n\n            render({\n                context: this,\n                View: moduleDescriptor.View,\n                data,\n                element,\n                App: reducer ? ReduxApp : DefaultApp,\n            });\n        };\n    };\n}\n"]}