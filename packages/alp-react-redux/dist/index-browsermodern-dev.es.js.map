{"version":3,"file":"index-browsermodern-dev.es.js","sources":["../src/createAlpAppWrapper.jsx","../src/utils/identityReducer.js","../src/store/middleware-browser.js","../src/store/createBrowserStore.js","../src/types.js","../src/store/createBrowserModuleStoreReducer.js","../src/module/AlpModule.jsx","../src/module/createModuleVisitor.js","../src/utils/createAction.js","../src/utils/createReducer.js","../src/utils/createLoader.js","../src/utils/createPureStatelessComponent.js","../src/utils/classNames.js","../src/module/AlpReduxModuleBrowser.jsx","../src/layout/Body.jsx","../src/layout/AppContainer.jsx","../src/browser.js"],"sourcesContent":["import { Component, type Element } from 'react';\nimport PropTypes from 'prop-types';\n\ntype PropsType = {||};\n\nexport default (app: Element, context: Object) =>\n  class AlpAppWrapper extends Component {\n    props: PropsType;\n\n    static childContextTypes = {\n      context: PropTypes.object.isRequired,\n      store: PropTypes.object.isRequired,\n      setModuleReducers: PropTypes.func,\n    };\n\n    state = {\n      error: null,\n    };\n\n    getChildContext(): Object {\n      return context;\n    }\n\n    componentDidCatch(error, errorInfo) {\n      this.setState({ error });\n      console.error(error, errorInfo);\n      if (window.Raven) window.Raven.captureException(error, { extra: errorInfo });\n    }\n\n    render(): Element {\n      if (this.state.error) return <div>An unexpected error occured</div>;\n      return app;\n    }\n  };\n","export default (state = null) => state;\n","export const promiseMiddleware = store => next => action => {\n  if (typeof action.then !== 'function') {\n    return next(action);\n  }\n\n  return Promise.resolve(action).then(store.dispatch);\n};\n\nexport const createFunctionMiddleware = app => store => next => action => {\n  if (typeof action !== 'function') {\n    return next(action);\n  }\n\n  return action(store.dispatch, app);\n};\n","import { createStore, applyMiddleware, compose, combineReducers } from 'redux/src';\nimport identityReducer from '../utils/identityReducer';\nimport { promiseMiddleware, createFunctionMiddleware } from './middleware-browser';\n\nexport default (app, ctx, moduleReducer, { middlewares, sharedReducers }) => {\n  const reducers = {\n    ...app.reduxReducers,\n    ...sharedReducers,\n    ctx: identityReducer,\n    module: moduleReducer,\n  };\n\n  if (!PRODUCTION) {\n    Object.keys(reducers).forEach(key => {\n      if (typeof reducers[key] !== 'function') throw new Error(`Invalid reducer ${key}`);\n    });\n  }\n\n  const rootReducer = combineReducers(reducers);\n\n  const composeEnhancers = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\n\n  middlewares = [\n    createFunctionMiddleware(app),\n    promiseMiddleware,\n    ...app.reduxMiddlewares,\n    ...middlewares,\n  ];\n\n  return createStore(\n    rootReducer,\n    { ctx, ...window.__INITIAL_DATA__ },\n    composeEnhancers(applyMiddleware(...middlewares)),\n  );\n};\n","export type ReduxActionType = { +type: string };\nexport type ReduxDispatchType = (action: ReduxActionType) => ReduxActionType | any;\nexport type ReduxReducerType = (state: any, action: ReduxActionType) => any;\nexport type ReducerDictionaryType = { [string]: ReduxReducerType };\n","import { combineReducers } from 'redux/src';\nimport type { ReducerDictionaryType } from '../types';\n\nconst MODULE_INIT_TYPE = '@@alp-redux/INIT_MODULE';\n\n// https://github.com/insin/react-examples/tree/master/code-splitting-redux-reducers\n// https://medium.com/@luigiplr/react-redux-react-router-4-code-splitting-w-rxjs-webpack-32eabedf0e9\n// https://gist.github.com/gaearon/0a2213881b5d53973514\n// https://github.com/zeit/next.js/pull/1459\n\nconst createModuleReducer = (reducers: ?ReducerDictionaryType) =>\n  reducers ? combineReducers(reducers) : (state = null) => state;\n\nexport default (initialReducers: ?ReducerDictionaryType) => {\n  let _reducers = initialReducers;\n  let moduleReducer = createModuleReducer(initialReducers);\n  return {\n    reducer: (state, action) =>\n      moduleReducer(action.type === MODULE_INIT_TYPE ? undefined : state, action),\n\n    set: (store, reducers) => {\n      if (reducers === _reducers) return false;\n      return new Promise((resolve, reject) => {\n        setImmediate(() => {\n          _reducers = reducers;\n          moduleReducer = createModuleReducer(reducers);\n          store.dispatch({ type: MODULE_INIT_TYPE });\n          resolve();\n        });\n      });\n    },\n  };\n};\n","import { Component, type Node } from 'react';\n\ntype PropsType = {|\n  children: Node,\n|};\n\nexport default class AlpModule extends Component {\n  props: PropsType;\n\n  render(): Node {\n    if (!PRODUCTION) {\n      // eslint-disable-next-line react/prop-types\n      if (this.props.reducers) {\n        throw new Error('You have reducers, probably want to use AlpReduxModule.');\n      }\n    }\n    return this.props.children;\n  }\n}\n","// import AppContainer from '../layout/AppContainer';\nimport AlpModule from './AlpModule';\n\nexport default () => {\n  let reducers;\n\n  return {\n    visitor: (element, instance, context) => {\n      // console.log(element, instance, instance instanceof AlpModule, element.type === AppContainer);\n\n      if (instance && instance instanceof AlpModule) {\n        // eslint-disable-next-line prefer-destructuring\n        reducers = instance.props.reducers;\n        return false;\n      }\n\n      return true;\n    },\n\n    getReducers: () => reducers,\n  };\n};\n","// eslint-disable-next-line flowtype/no-weak-types\ntype HandlerType = (...args: Array<any>) => Object;\n\nexport default (type: string, handler: ?HandlerType) => {\n  const action = !handler ? () => ({ type }) : (...args) => ({ type, ...handler(...args) });\n  action.type = type;\n  action.toString = () => type;\n  return action;\n};\n","/* global PRODUCTION */\n\nexport default function createReducer(defaultState: Function | Object, handlers: ?Object) {\n  if (typeof defaultState === 'object') {\n    handlers = defaultState;\n    defaultState = () => null;\n  }\n\n  const handlerMap = new Map();\n  Object.keys(handlers).forEach(key => {\n    if (typeof key === 'function') {\n      if (!PRODUCTION && typeof key.type !== 'string') {\n        throw new Error(`Invalid handler key: \"${key.name}\"`);\n      }\n      handlerMap.set(key.type, handlers[key]);\n    } else {\n      handlerMap.set(key, handlers[key]);\n    }\n  });\n  handlers = undefined;\n\n  return (state = defaultState(), action) => {\n    if (action && handlerMap.has(action.type)) {\n      return handlerMap.get(action.type)(state, action);\n    }\n\n    return state;\n  };\n}\n","/* global PRODUCTION */\nexport default function createLoader(handlers: ?Object) {\n  const handlerMap = new Map(Object.keys(handlers).map(key => [key, handlers[key]]));\n  handlers = undefined;\n\n  return (state, data) => {\n    const keys = Object.keys(data);\n    return Promise.all(\n      keys.map(key => {\n        const handler = handlerMap.get(key);\n        if (!PRODUCTION && !handler) throw new Error(`Missing handler for \"${key}\".`);\n        return handler(state, data[key]);\n      }),\n    ).then(results => {\n      const data = Object.create(null);\n      results.forEach((result, index) => {\n        data[keys[index]] = result;\n      });\n      return data;\n    });\n  };\n}\n","import { connect } from 'react-redux';\n\n// mergeProps: remove dispatch from dispatchProps (and perf !)\nconst mergeProps = (stateProps, dispatchProps, ownProps) => ownProps;\n\nexport default Component => connect(null, null, mergeProps)(Component);\n","export default (...classNames) => classNames.filter(Boolean).join(' ');\n","import { type Node } from 'react';\nimport PropTypes from 'prop-types';\nimport type { ReducerDictionaryType } from '../types';\nimport AlpModule from './AlpModule';\n\ntype PropsType = {|\n  children: Node,\n  reducers: ?ReducerDictionaryType,\n|};\n\nexport default class AlpReduxModule extends AlpModule {\n  props: PropsType;\n\n  static contextTypes = {\n    setModuleReducers: PropTypes.func.isRequired,\n  };\n\n  constructor(props, context) {\n    super(props, context);\n    this.state = {\n      loading: this.setModuleReducers(props.reducers),\n    };\n  }\n\n  setModuleReducers(reducers) {\n    if (!this.context.setModuleReducers) return false; // pre render\n    const result = this.context.setModuleReducers(reducers);\n    if (result === false) return false;\n    result.then(() => {\n      this.setState({ loading: false });\n    });\n    return true;\n  }\n\n  componentWillReceiveProps(nextProps: PropTypes) {\n    if (nextProps.reducers !== this.props.reducers) {\n      this.setState({\n        loading: this.setModuleReducers(nextProps.reducers),\n      });\n    }\n  }\n\n  render(): Node {\n    return this.state.loading ? null : this.props.children;\n  }\n}\n","import { type Node } from 'react';\n\ntype Props = {| children: Node |};\n\nexport default ({ children }: Props) => <div>{children}</div>;\n","import type { Element, Node } from 'react';\n\ntype PropsType = {| children: Node |};\n\nexport default ({ children }: PropsType): Element<'div'> => <div>{children}</div>;\n","import contentLoaded from 'content-loaded';\nimport React from 'react';\nimport { hydrate } from 'react-dom';\nimport reactTreeWalker from 'react-tree-walker';\nimport Logger from 'nightingale-logger/src';\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport BrowserAppContainer from 'alp-dev/BrowserAppContainer';\nimport createAlpAppWrapper from './createAlpAppWrapper';\nimport createBrowserStore from './store/createBrowserStore';\nimport createBrowserModuleStoreReducer from './store/createBrowserModuleStoreReducer';\nimport createModuleVisitor from './module/createModuleVisitor';\nimport type { ReduxActionType } from './types';\n\nexport Helmet from 'react-helmet';\nexport { combineReducers } from 'redux/src';\nexport { connect } from 'react-redux/src';\nexport {\n  createAction,\n  createReducer,\n  createLoader,\n  classNames,\n  createPureStatelessComponent,\n  identityReducer,\n} from './utils/index';\nexport AlpModule from './module/AlpModule';\nexport AlpReduxModule from './module/AlpReduxModuleBrowser';\nexport Body from './layout/Body';\nexport AppContainer from './layout/AppContainer';\n\nconst logger = new Logger('alp:react-redux');\n\nconst hydrateApp = App => hydrate(React.createElement(App), document.getElementById('react-app'));\n\nconst preRender = async function preRender(ctx, appElement) {\n  const moduleVisitor = createModuleVisitor();\n  const preRenderStore = { getState: () => ({ ctx }) };\n  const PreRenderWrappedApp = createAlpAppWrapper(appElement, {\n    context: ctx,\n    store: preRenderStore,\n  });\n  await reactTreeWalker(React.createElement(PreRenderWrappedApp), moduleVisitor.visitor);\n\n  return moduleVisitor.getReducers();\n};\n\nexport default app => {\n  app.reduxReducers = {\n    loading: (state: ?number = 0, action: ReduxActionType) => {\n      if (action.meta && action.meta.loading !== undefined) {\n        return state + (action.meta.loading ? 1 : -1);\n      }\n      return state;\n    },\n  };\n  app.reduxMiddlewares = [];\n\n  return {\n    renderApp: async function renderApp(App, { middlewares = [], sharedReducers } = {}) {\n      let store;\n      let moduleStoreReducer;\n\n      const createStore = (ctx, moduleReducers) => {\n        moduleStoreReducer = createBrowserModuleStoreReducer(moduleReducers);\n        const store = createBrowserStore(app, ctx, moduleStoreReducer.reducer, {\n          middlewares,\n          sharedReducers,\n        });\n        app.store = store;\n        window.store = store;\n        return store;\n      };\n\n      const ctx = app.createContext();\n\n      const render = async App => {\n        let appElement = React.createElement(App);\n        if (!PRODUCTION) {\n          appElement = React.createElement(BrowserAppContainer, {}, appElement);\n        }\n\n        const moduleReducers = await preRender(ctx, appElement);\n\n        if (!PRODUCTION) {\n          store = createStore(ctx, moduleReducers);\n        } else {\n          // in DEV\n          // eslint-disable-next-line no-lonely-if\n          if (!store) {\n            store = createStore(ctx, moduleReducers);\n          } else {\n            moduleStoreReducer.setReducers(moduleReducers);\n          }\n        }\n\n        const WrappedApp = createAlpAppWrapper(appElement, {\n          context: ctx,\n          store,\n          setModuleReducers: reducers => moduleStoreReducer.set(store, reducers),\n        });\n\n        await contentLoaded();\n        hydrateApp(WrappedApp);\n        logger.success('rendered');\n      };\n\n      await render(App);\n\n      return render;\n    },\n  };\n};\n"],"names":["app","context","Component","state","error","errorInfo","setState","window","Raven","captureException","extra","childContextTypes","PropTypes","object","isRequired","func","promiseMiddleware","action","then","next","Promise","resolve","store","dispatch","createFunctionMiddleware","ctx","moduleReducer","middlewares","sharedReducers","reducers","reduxReducers","identityReducer","keys","forEach","key","Error","rootReducer","combineReducers","composeEnhancers","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","reduxMiddlewares","createStore","__INITIAL_DATA__","applyMiddleware","MODULE_INIT_TYPE","createModuleReducer","initialReducers","_reducers","type","undefined","AlpModule","props","children","PropsType","element","instance","handler","args","toString","createReducer","defaultState","handlers","handlerMap","Map","name","set","has","get","createLoader","Object","map","data","all","create","result","index","mergeProps","stateProps","dispatchProps","ownProps","connect","classNames","filter","Boolean","join","AlpReduxModule","setModuleReducers","loading","nextProps","contextTypes","logger","Logger","hydrateApp","hydrate","React","createElement","App","document","getElementById","preRender","appElement","moduleVisitor","createModuleVisitor","PreRenderWrappedApp","createAlpAppWrapper","getState","reactTreeWalker","visitor","getReducers","meta","renderApp","moduleStoreReducer","moduleReducers","createBrowserModuleStoreReducer","createBrowserStore","reducer","createContext","render","BrowserAppContainer","WrappedApp","contentLoaded","success"],"mappings":";;;;;;;;;;;;;;;;;;AAGA,sCAAiB,eAAjB;;;AAEA,2BAAe,UAACA,GAAD,EAAeC,OAAf;;;iBAAI,gBAAJ;;qBAAsB,UAAtB;;;;2BACb,cAA4BC,SAA5B,CAAsC;;;;0CASpCC,KAToC,GAS5B;eACC;OAV2B;;;sBAaV;mCAAP,UAAO;;gCACjBF,OAAP;;;sBAGgBG,KAAlB,EAAyBC,SAAzB,EAAoC;WAC7BC,QAAL,CAAc,EAAEF,KAAF,EAAd;cACQA,KAAR,CAAcA,KAAd,EAAqBC,SAArB;UACIE,OAAOC,KAAX,EAAkBD,OAAOC,KAAP,CAAaC,gBAAb,CAA8BL,KAA9B,EAAqC,EAAEM,OAAOL,SAAT,EAArC;;;aAGF;oCAAR,gBAAQ;;UACZ,KAAKF,KAAL,CAAWC,KAAf,EAAsB,2BAAO;;;;OAAP;iCACfJ,GAAP;;GA1BS,iCAEN,SAFM,UAIJW,iBAJI,GAIgB;aAChBC,UAAUC,MAAV,CAAiBC,UADD;WAElBF,UAAUC,MAAV,CAAiBC,UAFC;uBAGNF,UAAUG;GAPpB;CAAf;;ACLA,uBAAe,UAACZ,QAAQ,IAAT;SAAkBA,KAAlB;CAAf;;ACAO,MAAMa,oBAAoB,SAApBA,iBAAoB;SAAS;WAAQ,kBAAU;UACtD,OAAOC,OAAOC,IAAd,KAAuB,UAA3B,EAAuC;eAC9BC,KAAKF,MAAL,CAAP;;;aAGKG,QAAQC,OAAR,CAAgBJ,MAAhB,EAAwBC,IAAxB,CAA6BI,MAAMC,QAAnC,CAAP;KALwC;GAAT;CAA1B;;AAQP,AAAO,MAAMC,2BAA2B,SAA3BA,wBAA2B;SAAO;WAAS;aAAQ,kBAAU;YACpE,OAAOP,MAAP,KAAkB,UAAtB,EAAkC;iBACzBE,KAAKF,MAAL,CAAP;;;eAGKA,OAAOK,MAAMC,QAAb,EAAuBvB,GAAvB,CAAP;OALsD;KAAT;GAAP;CAAjC;;ACJP,0BAAe,UAACA,GAAD,EAAMyB,GAAN,EAAWC,aAAX,EAA0B,EAAEC,WAAF,EAAeC,cAAf,EAA1B,EAA8D;QACrEC,6BACD7B,IAAI8B,aADH,EAEDF,cAFC;SAGCG,eAHD;YAIIL;IAJV;;SAQSM,IAAP,CAAYH,QAAZ,EAAsBI,OAAtB,CAA8B,eAAO;QAC/B,OAAOJ,SAASK,GAAT,CAAP,KAAyB,UAA7B,EAAyC,MAAM,IAAIC,KAAJ,CAAW,mBAAkBD,GAAI,EAAjC,CAAN;GAD3C;;;QAKIE,cAAcC,gBAAgBR,QAAhB,CAApB;;QAEMS,mBAAmB/B,OAAOgC,oCAAP,IAA+CC,OAAxE;;gBAEc,CACZhB,yBAAyBxB,GAAzB,CADY,EAEZgB,iBAFY,EAGZ,GAAGhB,IAAIyC,gBAHK,EAIZ,GAAGd,WAJS,CAAd;;SAOOe,YACLN,WADK,kBAEHX,GAFG,IAEKlB,OAAOoC,gBAFZ,GAGLL,iBAAiBM,gBAAgB,GAAGjB,WAAnB,CAAjB,CAHK,CAAP;CAzBF;;ACJO,kDAAuB,SAAE,mBAAO,UAAP,CAAF,CAAvB;AACP,AAAO,sDAAyB,WAAC,kBAAQ,eAAR,CAAD,WAA6B,yBAAkB,OAAlB,CAA7B,EAAzB;AACP,AAAO,oDAAwB,WAAC,iBAAO,OAAP,CAAD,EAAa,kBAAQ,eAAR,CAAb,WAAyC,OAAzC,EAAxB;AACP,AAAO,8DAA6B,SAAE,iBAAC,UAAD,EAAU,gBAAV,CAAF,CAA7B;;;;;ACAP,MAAMkB,mBAAmB,yBAAzB;;;;;;;AAOA,MAAMC,sBAAsB,SAAtBA,mBAAsB,CAACjB,QAAD;sBAAS,WAAG,8BAAH,CAAT;;;SAC1BA,WAAWQ,gBAAgBR,QAAhB,CAAX,GAAuC,UAAC1B,QAAQ,IAAT;WAAkBA,KAAlB;GADb;CAA5B;;AAGA,uCAAe,UAAC4C,eAAD,EAA6C;6BAA7B,WAAG,8BAAH,CAA6B;;;;MACtDC,YAAYD,eAAhB;MACIrB,gBAAgBoB,oBAAoBC,eAApB,CAApB;SACO;aACI,iBAAC5C,KAAD,EAAQc,MAAR;aACPS,cAAcT,OAAOgC,IAAP,KAAgBJ,gBAAhB,GAAmCK,SAAnC,GAA+C/C,KAA7D,EAAoEc,MAApE,CADO;KADJ;;SAIA,aAACK,KAAD,EAAQO,QAAR,EAAqB;UACpBA,aAAamB,SAAjB,EAA4B,OAAO,KAAP;aACrB,IAAI5B,OAAJ,CAAY,UAACC,OAAD,EAAqB;qBACzB,YAAM;sBACLQ,QAAZ;0BACgBiB,oBAAoBjB,QAApB,CAAhB;gBACMN,QAAN,CAAe,EAAE0B,MAAMJ,gBAAR,EAAf;;SAHF;OADK,CAAP;;GANJ;CAHF;;;;;;ACXA,wCAAiB,cACf,uBAAU,aAAV,CADe,CAAjB;IAIqBM,8BAAN,cAAwBjD,SAAxB,CAAkC;;WAGhC;iCAAL,aAAK;;;QAGP,KAAKkD,KAAL,CAAWvB,QAAf,EAAyB;YACjB,IAAIM,KAAJ,CAAU,yDAAV,CAAN;;;8BAGG,KAAKiB,KAAL,CAAWC,QAAlB;;kCATGC;;ACPP;AACA;AAEA,2BAAe,YAAM;MACfzB,QAAJ;;SAEO;aACI,iBAAC0B,OAAD,EAAUC,QAAV,EAAgC;;;UAGnCA,YAAYA,oBAAoBL,SAApC,EAA+C;;mBAElCK,SAASJ,KAAT,CAAevB,QAA1B;eACO,KAAP;;;aAGK,IAAP;KAVG;;iBAaQ;aAAMA,QAAN;;GAbf;CAHF;;ACHA;AACA,0CAAmB,WAAI,eAAM,QAAM,OAAN,CAAN,CAAJ,WAAyB,UAAzB,EAAnB;;;AAEA,oBAAe,UAACoB,IAAD,EAAeQ,OAAf,EAAyC;kBAApC,UAAoC;;qBAAnB,WAAG,WAAH,CAAmB;;;;;QAChDxC,SAAS,CAACwC,OAAD,GAAW;WAAO,EAAER,IAAF,EAAP;GAAX,GAA8B,UAAC,GAAGS,IAAJ;2BAAgBT,IAAhB,IAAyBQ,QAAQ,GAAGC,IAAX,CAAzB;GAA7C;SACOT,IAAP,GAAcA,IAAd;SACOU,QAAP,GAAkB;WAAMV,IAAN;GAAlB;SACOhC,MAAP;CAJF;;ACHA;;AAEA,AAAe,SAAS2C,aAAT,CAAuBC,YAAvB,EAAwDC,QAAxD,EAA2E;0BAAxC,QAAE,YAAF,EAAa,UAAb,CAAwC;;sBAAX,WAAG,UAAH,CAAW;;;;;MACpF,OAAOD,YAAP,KAAwB,QAA5B,EAAsC;oCACzBA,YAAX;4CACe;aAAM,IAAN;KAAf;;;QAGIE,aAAa,IAAIC,GAAJ,EAAnB;SACOhC,IAAP,CAAY8B,QAAZ,EAAsB7B,OAAtB,CAA8B,eAAO;QAC/B,OAAOC,GAAP,KAAe,UAAnB,EAA+B;UACV,OAAOA,IAAIe,IAAX,KAAoB,QAAvC,EAAiD;cACzC,IAAId,KAAJ,CAAW,yBAAwBD,IAAI+B,IAAK,GAA5C,CAAN;;iBAESC,GAAX,CAAehC,IAAIe,IAAnB,EAAyBa,SAAS5B,GAAT,CAAzB;KAJF,MAKO;iBACMgC,GAAX,CAAehC,GAAf,EAAoB4B,SAAS5B,GAAT,CAApB;;GAPJ;kCAUWgB,SAAX;;SAEO,UAAC/C,QAAQ0D,cAAT,EAAyB5C,MAAzB,EAAoC;QACrCA,UAAU8C,WAAWI,GAAX,CAAelD,OAAOgC,IAAtB,CAAd,EAA2C;aAClCc,WAAWK,GAAX,CAAenD,OAAOgC,IAAtB,EAA4B9C,KAA5B,EAAmCc,MAAnC,CAAP;;;WAGKd,KAAP;GALF;;;ACrBF;AACA,AAAe,SAASkE,YAAT,CAAsBP,QAAtB,EAAyC;sBAAX,WAAG,UAAH,CAAW;;;;QAChDC,aAAa,IAAIC,GAAJ,CAAQM,OAAOtC,IAAP,CAAY8B,QAAZ,EAAsBS,GAAtB,CAA0B;WAAO,CAACrC,GAAD,EAAM4B,SAAS5B,GAAT,CAAN,CAAP;GAA1B,CAAR,CAAnB;kCACWgB,SAAX;;SAEO,UAAC/C,KAAD,EAAQqE,IAAR,EAAiB;UAChBxC,OAAOsC,OAAOtC,IAAP,CAAYwC,IAAZ,CAAb;WACOpD,QAAQqD,GAAR,CACLzC,KAAKuC,GAAL,CAAS,eAAO;YACRd,UAAUM,WAAWK,GAAX,CAAelC,GAAf,CAAhB;UACmB,CAACuB,OAApB,EAA6B,MAAM,IAAItB,KAAJ,CAAW,wBAAuBD,GAAI,IAAtC,CAAN;aACtBuB,QAAQtD,KAAR,EAAeqE,KAAKtC,GAAL,CAAf,CAAP;KAHF,CADK,EAMLhB,IANK,CAMA,mBAAW;YACVsD,OAAOF,OAAOI,MAAP,CAAc,IAAd,CAAb;cACQzC,OAAR,CAAgB,UAAC0C,MAAD,EAASC,KAAT,EAAmB;aAC5B5C,KAAK4C,KAAL,CAAL,IAAoBD,MAApB;OADF;aAGOH,IAAP;KAXK,CAAP;GAFF;;;ACHF;AACA,MAAMK,aAAa,SAAbA,UAAa,CAACC,UAAD,EAAaC,aAAb,EAA4BC,QAA5B;SAAyCA,QAAzC;CAAnB;;AAEA,oCAAe;SAAaC,QAAQ,IAAR,EAAc,IAAd,EAAoBJ,UAApB,EAAgC3E,YAAhC,CAAb;CAAf;;ACLA,kBAAe,UAAC,GAAGgF,UAAJ;SAAmBA,WAAWC,MAAX,CAAkBC,OAAlB,EAA2BC,IAA3B,CAAgC,GAAhC,CAAnB;CAAf;;;;;;;;;ACKA,wCAAiB,cACf,uBAAU,aAAV,CADe,EAEf,uBAAU,WAAC,8BAAD,CAAV,CAFe,CAAjB;IAKqBC,uCAAN,cAA6BnC,SAA7B,CAAuC;;cAOxCC,KAAZ,EAAmBnD,OAAnB,EAA4B;UACpBmD,KAAN,EAAanD,OAAb;SACKE,KAAL,GAAa;eACF,KAAKoF,iBAAL,CAAuBnC,MAAMvB,QAA7B;KADX;;;oBAKgBA,QAAlB,EAA4B;;;QACtB,CAAC,KAAK5B,OAAL,CAAasF,iBAAlB,EAAqC,OAAO,KAAP,CADX;UAEpBZ,SAAS,KAAK1E,OAAL,CAAasF,iBAAb,CAA+B1D,QAA/B,CAAf;QACI8C,WAAW,KAAf,EAAsB,OAAO,KAAP;WACfzD,IAAP,CAAY,YAAM;YACXZ,QAAL,CAAc,EAAEkF,SAAS,KAAX,EAAd;KADF;WAGO,IAAP;;;4BAGwBC,SAA1B,EAAgD;yBAAb,gBAAa;;;;QAC1CA,UAAU5D,QAAV,KAAuB,KAAKuB,KAAL,CAAWvB,QAAtC,EAAgD;WACzCvB,QAAL,CAAc;iBACH,KAAKiF,iBAAL,CAAuBE,UAAU5D,QAAjC;OADX;;;;WAMW;iCAAL,aAAK;;8BACN,KAAK1B,KAAL,CAAWqF,OAAX,GAAqB,IAArB,GAA4B,KAAKpC,KAAL,CAAWC,QAA9C;;YA9BKqC,eAAe;qBACD9E,UAAUG,IAAV,CAAeD;;;;;;ACZtC,8BAAa,cAAG,uBAAU,aAAV,CAAH,CAAb;;;AAEA,YAAe;MAAC,EAAEuC,QAAF,EAAD,GAAa,KAAb;SAAyB;;;;GAAzB;CAAf;;;;;;;;ACFA,wCAAiB,cAAG,uBAAU,aAAV,CAAH,CAAjB;;;AAEA,oBAAe;+BAA2B,iBAAQ,eAAR,CAA3B;;MAAC,EAAEA,QAAF,EAAD,GAAaC,WAAb;4BAA6C;;;;GAA7C;CAAf;;;;;;;ACyBA,MAAMqC,SAAS,IAAIC,MAAJ,CAAW,iBAAX,CAAf;;AAEA,MAAMC,aAAa,SAAbA,UAAa;SAAOC,QAAQC,MAAMC,aAAN,CAAoBC,GAApB,CAAR,EAAkCC,SAASC,cAAT,CAAwB,WAAxB,CAAlC,CAAP;CAAnB;;AAEA,MAAMC,YAAY,eAAeA,SAAf,CAAyB3E,GAAzB,EAA8B4E,UAA9B,EAA0C;QACpDC,gBAAgBC,qBAAtB;;QAEMC,sBAAsBC,oBAAoBJ,UAApB,EAAgC;aACjD5E,GADiD;WADrC,EAAEiF,UAAU;eAAO,EAAEjF,GAAF,EAAP;OAAZ;GACK,CAA5B;QAIMkF,gBAAgBZ,MAAMC,aAAN,CAAoBQ,mBAApB,CAAhB,EAA0DF,cAAcM,OAAxE,CAAN;;SAEON,cAAcO,WAAd,EAAP;CATF;;AAYA,eAAe,eAAO;MAChB/E,aAAJ,GAAoB;aACT,iBAAC3B,QAAiB,CAAlB,EAAqBc,MAArB,EAAiD;uBAA3C,WAAG,UAAH,CAA2C;;wBAAtB,wBAAsB;;;;;UACpDA,OAAO6F,IAAP,IAAe7F,OAAO6F,IAAP,CAAYtB,OAAZ,KAAwBtC,SAA3C,EAAsD;eAC7C/C,SAASc,OAAO6F,IAAP,CAAYtB,OAAZ,GAAsB,CAAtB,GAA0B,CAAC,CAApC,CAAP;;aAEKrF,KAAP;;GALJ;MAQIsC,gBAAJ;;SAEO;eACM,eAAesE,SAAf,CAAyBd,GAAzB,EAA8B,EAAEtE,gBAAF,EAAoBC,cAApB,OAA9B,EAAyE;UAC9EN,KAAJ;UACI0F,kBAAJ;;YAEMtE,iBAAc,SAAdA,cAAc,CAACjB,GAAD,EAAMwF,cAAN,EAAyB;6BACtBC,gCAAgCD,cAAhC,CAArB;cACM3F,QAAQ6F,mBAAmBnH,GAAnB,EAAwByB,GAAxB,EAA6BuF,mBAAmBI,OAAhD,EAAyD;qBAAA;;SAAzD,CAAd;YAII9F,KAAJ,GAAYA,KAAZ;eACOA,KAAP,GAAeA,KAAf;eACOA,KAAP;OARF;;YAWMG,MAAMzB,IAAIqH,aAAJ,EAAZ;;YAEMC,SAAS,eAATA,MAAS,CAAMrB,GAAN,EAAa;YACtBI,aAAaN,MAAMC,aAAN,CAAoBC,GAApB,CAAjB;;qBAEeF,MAAMC,aAAN,CAAoBuB,mBAApB,MAA6ClB,UAA7C,CAAb;;;cAGIY,iBAAiB,MAAMb,UAAU3E,GAAV,EAAe4E,UAAf,CAA7B;;gBAGU3D,eAAYjB,GAAZ,EAAiBwF,cAAjB,CAAR;;;cAWIO,aAAaf,oBAAoBJ,UAApB,EAAgC;mBACxC5E,GADwC;eAAA;6BAG9B;mBAAYuF,mBAAmB9C,GAAnB,CAAuB5C,KAAvB,EAA8BO,QAA9B,CAAZ;;SAHF,CAAnB;;cAMM4F,eAAN;mBACWD,UAAX;eACOE,OAAP,CAAe,UAAf;OA5BF;;YA+BMJ,OAAOrB,GAAP,CAAN;;aAEOqB,MAAP;;GAnDJ;CAXF;;;;;"}