{"version":3,"file":"index-node8-dev.es.js","sources":["../src/layout/assetUrl.js","../src/layout/uneval.js","../src/layout/htmlLayout.js","../src/createAlpAppWrapper.jsx","../src/utils/identityReducer.js","../src/store/createServerStore.js","../src/module/AlpModule.jsx","../src/module/createModuleVisitor.js","../src/types.js","../src/utils/createAction.js","../src/utils/createReducer.js","../src/utils/createLoader.js","../src/utils/createPureStatelessComponent.js","../src/utils/classNames.js","../src/module/AlpReduxModuleServer.jsx","../src/layout/Body.jsx","../src/layout/AppContainer.jsx","../src/index.js"],"sourcesContent":["export default (PRODUCTION\n  ? (asset, version) => (asset.startsWith('/') ? `/${version}${asset}` : asset)\n  : (asset, version) => (asset.startsWith('/') ? `${asset}?${version}` : asset));\n","/* global PRODUCTION */\n\nfunction uneval(obj, keys, objects = new Set()) {\n  switch (obj) {\n    case null:\n      return 'null';\n    case undefined:\n      return 'undefined';\n    case Infinity:\n      return 'Infinity';\n    case -Infinity:\n      return '-Infinity';\n  }\n\n  if (Number.isNaN(obj)) {\n    return 'NaN';\n  }\n\n  switch (typeof obj) {\n    case 'function':\n      if (!PRODUCTION) console.log(obj);\n      throw new Error(!PRODUCTION && `Unsupported function \"${keys}\".`);\n    case 'string':\n    case 'number':\n    case 'boolean':\n      return JSON.stringify(obj);\n  }\n\n  if (objects.has(obj)) {\n    throw new Error(!PRODUCTION && 'Circular reference detected.');\n  }\n\n  objects.add(obj);\n\n  // specialized types\n  if (obj instanceof Array) {\n    return `[${obj\n      .map((o, index) => uneval(o, !PRODUCTION && `${keys}[${index}]`, objects))\n      .join(',')}]`;\n  }\n\n  if (obj instanceof Date) {\n    return `new Date(${obj.getTime()})`;\n  }\n\n  if (obj instanceof Set) {\n    return `new Set(${uneval(Array.from(obj), keys)})`;\n  }\n\n  if (obj instanceof Map) {\n    return `new Map(${uneval(Array.from(obj), keys)})`;\n  }\n\n  return `{${Object.keys(obj)\n    .map(key => `${JSON.stringify(key)}:${uneval(obj[key], !PRODUCTION && `${keys}.${key}`)}`)\n    .join(',')}}`;\n}\n\n// https://medium.com/node-security/the-most-common-xss-vulnerability-in-react-js-applications-2bdffbcc1fa0#.tm3hd6riw\nconst UNSAFE_CHARS_REGEXP = /[<>/\\u2028\\u2029]/g;\nconst ESCAPED_CHARS = {\n  '<': '\\\\u003C',\n  '>': '\\\\u003E',\n  '/': '\\\\u002F',\n  '\\u2028': '\\\\u2028',\n  '\\u2029': '\\\\u2029',\n};\n\nconst escapeUnsafeChars = unsafeChar => ESCAPED_CHARS[unsafeChar];\n\nexport default obj => uneval(obj, 'obj').replace(UNSAFE_CHARS_REGEXP, escapeUnsafeChars);\n","/* eslint-disable jsx-a11y/html-has-lang, prefer-template */\nimport type { Element } from 'react';\nimport assetUrl from './assetUrl';\nimport uneval from './uneval';\n\ntype HelmetDataAttributeType = {\n  toString(): string,\n  toComponent(): Element,\n};\n\ntype HelmetDataType = {\n  htmlAttributes: HelmetDataAttributeType,\n  title: HelmetDataAttributeType,\n  base: HelmetDataAttributeType,\n  meta: HelmetDataAttributeType,\n  link: HelmetDataAttributeType,\n  script: HelmetDataAttributeType,\n  style: HelmetDataAttributeType,\n};\n\nexport type LayoutOptionsType = {|\n  layoutBody?: ?Function,\n  version: string,\n  scriptName: string | false,\n  styleName: string | false,\n  initialData?: ?any,\n  polyfillFeatures?: ?string,\n|};\n\nexport default (\n  helmet: HelmetDataType,\n  content: string,\n  {\n    version,\n    scriptName,\n    styleName,\n    initialData,\n    polyfillFeatures = 'default,es6,es7,localStorage,fetch,Intl',\n  },\n): string =>\n  `<!doctype html>\n<html ${helmet.htmlAttributes.toString()}>\n  <head>\n    ${helmet.title.toString()}\n    ${helmet.meta.toString()}\n    ${helmet.link.toString()}\n    ${helmet.base.toString()}\n    <link rel=\"stylesheet\" href=\"${assetUrl(`/${styleName || 'index'}.css`, version)}\" />\n    ${helmet.style.toString()}\n    ${polyfillFeatures &&\n      `<script defer src=\"${`https://polyfill.io/v2/polyfill.min.js?features=${polyfillFeatures}&unknown=polyfill`}\"></script>`}\n    ${helmet.script.toString()}\n    ${\n      scriptName === false\n        ? ''\n        : `<script>\nwindow.VERSION='${version}';\nwindow.__INITIAL_DATA__=${uneval(initialData)};\n</script>\n<script defer src=\"${assetUrl(`/${scriptName}.js`, version)}\"></script>`\n    }\n  </head>\n  <body ${helmet.bodyAttributes.toString()}>\n    <div id=\"react-app\">${content}</div>\n  </body>\n</html>`;\n","import { Component, type Element } from 'react';\nimport PropTypes from 'prop-types';\n\ntype PropsType = {||};\n\nexport default (app: Element, context: Object) =>\n  class AlpAppWrapper extends Component {\n    props: PropsType;\n\n    static childContextTypes = {\n      context: PropTypes.object.isRequired,\n      store: PropTypes.object.isRequired,\n      setModuleReducers: PropTypes.func,\n    };\n\n    state = {\n      error: null,\n    };\n\n    getChildContext(): Object {\n      return context;\n    }\n\n    componentDidCatch(error, errorInfo) {\n      this.setState({ error });\n      console.error(error, errorInfo);\n      if (window.Raven) window.Raven.captureException(error, { extra: errorInfo });\n    }\n\n    render(): Element {\n      if (this.state.error) return <div>An unexpected error occured</div>;\n      return app;\n    }\n  };\n","export default (state = null) => state;\n","import { combineReducers, createStore } from 'redux/src';\nimport identityReducer from '../utils/identityReducer';\n\nexport default (ctx, moduleReducers, { sharedReducers }) => {\n  const initialContext = {\n    ctx,\n    ...ctx.reduxInitialContext,\n  };\n\n  initialContext.ctx = ctx;\n\n  const rootReducer = combineReducers({\n    ...ctx.app.reduxReducers,\n    ...sharedReducers,\n    ctx: identityReducer,\n    module: moduleReducers ? combineReducers(moduleReducers) : identityReducer,\n  });\n\n  return createStore(rootReducer, initialContext);\n};\n","import { Component, type Node } from 'react';\n\ntype PropsType = {|\n  children: Node,\n|};\n\nexport default class AlpModule extends Component {\n  props: PropsType;\n\n  render(): Node {\n    if (!PRODUCTION) {\n      // eslint-disable-next-line react/prop-types\n      if (this.props.reducers) {\n        throw new Error('You have reducers, probably want to use AlpReduxModule.');\n      }\n    }\n    return this.props.children;\n  }\n}\n","// import AppContainer from '../layout/AppContainer';\nimport AlpModule from './AlpModule';\n\nexport default () => {\n  let reducers;\n\n  return {\n    visitor: (element, instance, context) => {\n      // console.log(element, instance, instance instanceof AlpModule, element.type === AppContainer);\n\n      if (instance && instance instanceof AlpModule) {\n        // eslint-disable-next-line prefer-destructuring\n        reducers = instance.props.reducers;\n        return false;\n      }\n\n      return true;\n    },\n\n    getReducers: () => reducers,\n  };\n};\n","export type ReduxActionType = { +type: string };\nexport type ReduxDispatchType = (action: ReduxActionType) => ReduxActionType | any;\nexport type ReduxReducerType = (state: any, action: ReduxActionType) => any;\nexport type ReducerDictionaryType = { [string]: ReduxReducerType };\n","// eslint-disable-next-line flowtype/no-weak-types\ntype HandlerType = (...args: Array<any>) => Object;\n\nexport default (type: string, handler: ?HandlerType) => {\n  const action = !handler ? () => ({ type }) : (...args) => ({ type, ...handler(...args) });\n  action.type = type;\n  action.toString = () => type;\n  return action;\n};\n","/* global PRODUCTION */\n\nexport default function createReducer(defaultState: Function | Object, handlers: ?Object) {\n  if (typeof defaultState === 'object') {\n    handlers = defaultState;\n    defaultState = () => null;\n  }\n\n  const handlerMap = new Map();\n  Object.keys(handlers).forEach(key => {\n    if (typeof key === 'function') {\n      if (!PRODUCTION && typeof key.type !== 'string') {\n        throw new Error(`Invalid handler key: \"${key.name}\"`);\n      }\n      handlerMap.set(key.type, handlers[key]);\n    } else {\n      handlerMap.set(key, handlers[key]);\n    }\n  });\n  handlers = undefined;\n\n  return (state = defaultState(), action) => {\n    if (action && handlerMap.has(action.type)) {\n      return handlerMap.get(action.type)(state, action);\n    }\n\n    return state;\n  };\n}\n","/* global PRODUCTION */\nexport default function createLoader(handlers: ?Object) {\n  const handlerMap = new Map(Object.keys(handlers).map(key => [key, handlers[key]]));\n  handlers = undefined;\n\n  return (state, data) => {\n    const keys = Object.keys(data);\n    return Promise.all(\n      keys.map(key => {\n        const handler = handlerMap.get(key);\n        if (!PRODUCTION && !handler) throw new Error(`Missing handler for \"${key}\".`);\n        return handler(state, data[key]);\n      }),\n    ).then(results => {\n      const data = Object.create(null);\n      results.forEach((result, index) => {\n        data[keys[index]] = result;\n      });\n      return data;\n    });\n  };\n}\n","import { connect } from 'react-redux';\n\n// mergeProps: remove dispatch from dispatchProps (and perf !)\nconst mergeProps = (stateProps, dispatchProps, ownProps) => ownProps;\n\nexport default Component => connect(null, null, mergeProps)(Component);\n","export default (...classNames) => classNames.filter(Boolean).join(' ');\n","import { type Node } from 'react';\nimport type { ReducerDictionaryType } from '../types';\nimport AlpModule from './AlpModule';\n\ntype PropsType = {|\n  reducers: ?ReducerDictionaryType,\n  children: Node,\n|};\n\nexport default class AlpReduxModule extends AlpModule {\n  props: PropsType;\n\n  render(): Node {\n    return this.props.children;\n  }\n}\n","import { type Node } from 'react';\n\ntype Props = {| children: Node |};\n\nexport default ({ children }: Props) => <div>{children}</div>;\n","import type { Element, Node } from 'react';\n\ntype PropsType = {| children: Node |};\n\nexport default ({ children }: PropsType): Element<'div'> => <div>{children}</div>;\n","import React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport Helmet from 'react-helmet';\nimport reactTreeWalker from 'react-tree-walker';\nimport Logger from 'nightingale-logger/src';\nimport createIsModernBrowser from 'modern-browsers';\nimport htmlLayout from './layout/htmlLayout';\nimport createAlpAppWrapper from './createAlpAppWrapper';\nimport createServerStore from './store/createServerStore';\nimport createModuleVisitor from './module/createModuleVisitor';\nimport type { ReduxActionType } from './types';\n\nexport { Helmet };\nexport { combineReducers } from 'redux/src';\nexport { connect } from 'react-redux/src';\nexport {\n  createAction,\n  createReducer,\n  createLoader,\n  classNames,\n  createPureStatelessComponent,\n  identityReducer,\n} from './utils/index';\nexport AlpModule from './module/AlpModule';\nexport AlpReduxModule from './module/AlpReduxModuleServer';\nexport Body from './layout/Body';\nexport AppContainer from './layout/AppContainer';\n\nconst logger = new Logger('alp:react-redux');\n\nconst renderHtml = (app, options) => {\n  const content = renderToString(app);\n  const helmet = Helmet.renderStatic();\n  return htmlLayout(helmet, content, options);\n};\n\nconst isModernBrowser = createIsModernBrowser();\n\ntype OptionsType = {|\n  polyfillFeatures?: ?string,\n  scriptName?: ?string | false,\n  sharedReducers?: ?{ [string]: any },\n  styleName?: ?string | false,\n|};\n\nexport default () => app => {\n  app.reduxReducers = {};\n  app.reduxMiddlewares = [];\n\n  return {\n    middleware: (ctx, next) => {\n      ctx.reduxInitialContext = {};\n      return next();\n    },\n\n    createApp: (App, options: ?OptionsType = {}) => async ctx => {\n      const version: string = ctx.config.get('version');\n      // TODO create alp-useragent with getter in context\n      const ua = ctx.req.headers['user-agent'];\n      const name = isModernBrowser(ua) ? 'modern-browsers' : 'es5';\n\n      const app = React.createElement(App);\n      const moduleVisitor = createModuleVisitor();\n      const preRenderStore = { getState: () => ({ ctx }) };\n      const PreRenderWrappedApp = createAlpAppWrapper(app, { context: ctx, store: preRenderStore });\n      await reactTreeWalker(React.createElement(PreRenderWrappedApp), moduleVisitor.visitor);\n\n      const store = createServerStore(ctx, moduleVisitor.getReducers(), {\n        sharedReducers: options.sharedReducers,\n      });\n\n      const WrappedApp = createAlpAppWrapper(app, { context: ctx, store });\n\n      // eslint-disable-next-line no-unused-vars\n      const { ctx: removeCtxFromInitialData, ...initialData } = store.getState();\n      ctx.body = await renderHtml(React.createElement(WrappedApp), {\n        version,\n        scriptName: options.scriptName !== undefined ? options.scriptName : name,\n        styleName: options.styleName !== undefined ? options.styleName : name,\n        polyfillFeatures: options.polyfillFeatures,\n        initialData,\n      });\n    },\n  };\n};\n\nconst loggerWebsocket = logger.child('websocket');\n\nexport function emitAction(to: string, action: ReduxActionType) {\n  loggerWebsocket.debug('emitAction', action);\n  to.emit('redux:action', action);\n}\n"],"names":["asset","version","startsWith","uneval","obj","keys","objects","Set","undefined","Infinity","Number","isNaN","log","Error","JSON","stringify","has","add","Array","map","o","index","join","Date","getTime","from","Map","Object","key","UNSAFE_CHARS_REGEXP","ESCAPED_CHARS","escapeUnsafeChars","unsafeChar","replace","helmet","content","htmlAttributes","toString","title","meta","link","base","assetUrl","styleName","style","polyfillFeatures","script","scriptName","initialData","bodyAttributes","app","context","Component","state","error","errorInfo","setState","window","Raven","captureException","extra","childContextTypes","PropTypes","object","isRequired","func","ctx","moduleReducers","sharedReducers","initialContext","reduxInitialContext","rootReducer","combineReducers","reduxReducers","identityReducer","createStore","AlpModule","props","reducers","children","PropsType","element","instance","type","handler","action","args","createReducer","defaultState","handlers","handlerMap","forEach","name","set","get","createLoader","data","Promise","all","then","results","create","result","mergeProps","stateProps","dispatchProps","ownProps","connect","classNames","filter","Boolean","AlpReduxModule","logger","Logger","renderHtml","options","renderToString","Helmet","renderStatic","htmlLayout","isModernBrowser","createIsModernBrowser","reduxMiddlewares","next","App","config","ua","req","headers","React","createElement","moduleVisitor","createModuleVisitor","PreRenderWrappedApp","createAlpAppWrapper","store","getState","reactTreeWalker","visitor","createServerStore","getReducers","WrappedApp","body","loggerWebsocket","child","emitAction","to","debug","emit"],"mappings":";;;;;;;;;;;;;;AAAA,gBAEI,CAACA,KAAD,EAAQC,OAAR,KAAqBD,MAAME,UAAN,CAAiB,GAAjB,IAAyB,GAAEF,KAAM,IAAGC,OAAQ,EAA5C,GAAgDD,KAFzE;;ACAA;;AAEA,SAASG,MAAT,CAAgBC,GAAhB,EAAqBC,IAArB,EAA2BC,UAAU,IAAIC,GAAJ,EAArC,EAAgD;UACtCH,GAAR;SACO,IAAL;aACS,MAAP;SACGI,SAAL;aACS,WAAP;SACGC,QAAL;aACS,UAAP;SACG,CAACA,QAAN;aACS,WAAP;;;MAGAC,OAAOC,KAAP,CAAaP,GAAb,CAAJ,EAAuB;WACd,KAAP;;;UAGM,OAAOA,GAAf;SACO,UAAL;cAC2BQ,GAAR,CAAYR,GAAZ;YACX,IAAIS,KAAJ,CAA0B,yBAAwBR,IAAK,IAAvD,CAAN;SACG,QAAL;SACK,QAAL;SACK,SAAL;aACSS,KAAKC,SAAL,CAAeX,GAAf,CAAP;;;MAGAE,QAAQU,GAAR,CAAYZ,GAAZ,CAAJ,EAAsB;UACd,IAAIS,KAAJ,gCAAN;;;UAGMI,GAAR,CAAYb,GAAZ;;;MAGIA,eAAec,KAAnB,EAA0B;WAChB,IAAGd,IACRe,GADQ,CACJ,CAACC,CAAD,EAAIC,KAAJ,KAAclB,OAAOiB,CAAP,EAA0B,GAAEf,IAAK,IAAGgB,KAAM,GAA1C,EAA8Cf,OAA9C,CADV,EAERgB,IAFQ,CAEH,GAFG,CAEE,GAFb;;;MAKElB,eAAemB,IAAnB,EAAyB;WACf,YAAWnB,IAAIoB,OAAJ,EAAc,GAAjC;;;MAGEpB,eAAeG,GAAnB,EAAwB;WACd,WAAUJ,OAAOe,MAAMO,IAAN,CAAWrB,GAAX,CAAP,EAAwBC,IAAxB,CAA8B,GAAhD;;;MAGED,eAAesB,GAAnB,EAAwB;WACd,WAAUvB,OAAOe,MAAMO,IAAN,CAAWrB,GAAX,CAAP,EAAwBC,IAAxB,CAA8B,GAAhD;;;SAGM,IAAGsB,OAAOtB,IAAP,CAAYD,GAAZ,EACRe,GADQ,CACJS,OAAQ,GAAEd,KAAKC,SAAL,CAAea,GAAf,CAAoB,IAAGzB,OAAOC,IAAIwB,GAAJ,CAAP,EAAiC,GAAEvB,IAAK,IAAGuB,GAAI,EAA/C,CAAkD,EAD/E,EAERN,IAFQ,CAEH,GAFG,CAEE,GAFb;;;;AAMF,MAAMO,sBAAsB,oBAA5B;AACA,MAAMC;;;;;;CAAN;;AAQA,MAAMC,oBAAoBC,cAAcF,cAAcE,UAAd,CAAxC;;AAEA,gBAAe5B,OAAOD,OAAOC,GAAP,EAAY,KAAZ,EAAmB6B,OAAnB,CAA2BJ,mBAA3B,EAAgDE,iBAAhD,CAAtB;;ACtEA;AACA;AAIA,kEAA+B,SAC7B,2CAAY,UAAZ,GAD6B,EAE7B,8CAAe,gBAAf,GAF6B,CAA/B;AAKA,gDAAsB,SACpB,6BAAgB,uBAAhB,CADoB,EAEpB,oBAAO,uBAAP,CAFoB,EAGpB,mBAAM,uBAAN,CAHoB,EAIpB,mBAAM,uBAAN,CAJoB,EAKpB,mBAAM,uBAAN,CALoB,EAMpB,qBAAQ,uBAAR,CANoB,EAOpB,oBAAO,uBAAP,CAPoB,CAAtB;;;AAUA,AAAO,sDAAyB,cAC9B,yBAAa,WAAC,YAAD,CAAb,OAD8B,EAE9B,sBAAS,UAAT,CAF8B,EAG9B,yBAAY,oBAAS,gBAAT,CAAZ,CAH8B,EAI9B,wBAAW,oBAAS,gBAAT,CAAX,CAJ8B,EAK9B,0BAAc,WAAC,OAAD,CAAd,OAL8B,EAM9B,+BAAmB,WAAC,UAAD,CAAnB,OAN8B,CAAzB;;AASP,kBAAe,CACbG,MADa,EAEbC,OAFa,EAGb;SAAA;YAAA;WAAA;aAAA;qBAKqB;CARR;qBAEN,UAFM;;+BAUZ,UAVY;;oBACP,cADO;;4BAWZ;QACKD,OAAOE,cAAP,CAAsBC,QAAtB,EAAiC;;MAEnCH,OAAOI,KAAP,CAAaD,QAAb,EAAwB;MACxBH,OAAOK,IAAP,CAAYF,QAAZ,EAAuB;MACvBH,OAAOM,IAAP,CAAYH,QAAZ,EAAuB;MACvBH,OAAOO,IAAP,CAAYJ,QAAZ,EAAuB;mCACMK,SAAU,IAAGC,aAAa,OAAQ,MAAlC,EAAyC1C,OAAzC,CAAkD;MAC/EiC,OAAOU,KAAP,CAAaP,QAAb,EAAwB;MACxBQ,oBACC,sBAAsB,mDAAkDA,gBAAiB,mBAAmB,aAAa;MAC1HX,OAAOY,MAAP,CAAcT,QAAd,EAAyB;MAEzBU,eAAe,KAAf,GACI,EADJ,GAEK;kBACO9C,OAAQ;0BACAE,SAAO6C,WAAP,CAAoB;;qBAEzBN,SAAU,IAAGK,UAAW,KAAxB,EAA8B9C,OAA9B,CAAuC,aACvD;;UAEKiC,OAAOe,cAAP,CAAsBZ,QAAtB,EAAiC;0BACjBF,OAAQ;;QAlCnB;CAAf;;;AC1BA,sCAAiB,eAAjB;;;AAEA,2BAAe,CAACe,GAAD,EAAeC,OAAf;;;iBAAI,gBAAJ;;qBAAsB,UAAtB;;;;2BACb,cAA4BC,SAA5B,CAAsC;;;;0CASpCC,KAToC,GAS5B;eACC;OAV2B;;;sBAaV;mCAAP,UAAO;;gCACjBF,OAAP;;;sBAGgBG,KAAlB,EAAyBC,SAAzB,EAAoC;WAC7BC,QAAL,CAAc,EAAEF,KAAF,EAAd;cACQA,KAAR,CAAcA,KAAd,EAAqBC,SAArB;UACIE,OAAOC,KAAX,EAAkBD,OAAOC,KAAP,CAAaC,gBAAb,CAA8BL,KAA9B,EAAqC,EAAEM,OAAOL,SAAT,EAArC;;;aAGF;oCAAR,gBAAQ;;UACZ,KAAKF,KAAL,CAAWC,KAAf,EAAsB,2BAAO;;;;OAAP;iCACfJ,GAAP;;GA1BS,iCAEN,SAFM,UAIJW,iBAJI,GAIgB;aAChBC,UAAUC,MAAV,CAAiBC,UADD;WAElBF,UAAUC,MAAV,CAAiBC,UAFC;uBAGNF,UAAUG;GAPpB;CAAf;;ACLA,uBAAe,CAACZ,QAAQ,IAAT,KAAkBA,KAAjC;;ACGA,yBAAe,CAACa,GAAD,EAAMC,cAAN,EAAsB,EAAEC,cAAF,EAAtB,KAA6C;QACpDC;;KAEDH,IAAII,mBAFH;OAAA,EAKeJ;IALrB;;QAOMK,cAAcC,kCACfN,IAAIhB,GAAJ,CAAQuB,aADO,EAEfL,cAFe;SAGbM,eAHa;YAIVP,iBAAiBK,gBAAgBL,cAAhB,CAAjB,GAAmDO;KAJ7D;;SAOOC,YAAYJ,WAAZ,EAAyBF,cAAzB,CAAP;CAfF;;;;ACDA,wCAAiB,cACf,uBAAU,aAAV,CADe,CAAjB;IAIqBO,8BAAN,cAAwBxB,SAAxB,CAAkC;;WAGhC;iCAAL,aAAK;;;QAGP,KAAKyB,KAAL,CAAWC,QAAf,EAAyB;YACjB,IAAIjE,KAAJ,CAAU,yDAAV,CAAN;;;8BAGG,KAAKgE,KAAL,CAAWE,QAAlB;;kCATGC;;ACPP;AACA;AAEA,2BAAe,MAAM;MACfF,QAAJ;;SAEO;aACI,CAACG,OAAD,EAAUC,QAAV,KAAgC;;;UAGnCA,YAAYA,oBAAoBN,SAApC,EAA+C;;mBAElCM,SAASL,KAAT,CAAeC,QAA1B;eACO,KAAP;;;aAGK,IAAP;KAVG;;iBAaQ,MAAMA;GAbrB;CAHF;;ACHO,kDAAuB,SAAE,mBAAO,UAAP,CAAF,CAAvB;AACP,AAAO,sDAAyB,WAAC,kBAAQ,eAAR,CAAD,WAA6B,yBAAkB,OAAlB,CAA7B,EAAzB;AACP,AAAO,oDAAwB,WAAC,iBAAO,OAAP,CAAD,EAAa,kBAAQ,eAAR,CAAb,WAAyC,OAAzC,EAAxB;AACP,AAAO,8DAA6B,SAAE,iBAAC,UAAD,EAAU,gBAAV,CAAF,CAA7B;;ACHP;AACA,0CAAmB,WAAI,eAAM,QAAM,OAAN,CAAN,CAAJ,WAAyB,UAAzB,EAAnB;;;AAEA,oBAAe,CAACK,IAAD,EAAeC,OAAf,KAAyC;kBAApC,UAAoC;;qBAAnB,WAAG,WAAH,CAAmB;;;;;QAChDC,SAAS,CAACD,OAAD,GAAW,OAAO,EAAED,IAAF,EAAP,CAAX,GAA8B,CAAC,GAAGG,IAAJ,qBAAgBH,IAAhB,IAAyBC,QAAQ,GAAGE,IAAX,CAAzB,CAA7C;SACOH,IAAP,GAAcA,IAAd;SACO9C,QAAP,GAAkB,MAAM8C,IAAxB;SACOE,MAAP;CAJF;;ACHA;;AAEA,AAAe,SAASE,aAAT,CAAuBC,YAAvB,EAAwDC,QAAxD,EAA2E;0BAAxC,QAAE,YAAF,EAAa,UAAb,CAAwC;;sBAAX,WAAG,UAAH,CAAW;;;;;MACpF,OAAOD,YAAP,KAAwB,QAA5B,EAAsC;oCACzBA,YAAX;4CACe,MAAM,IAArB;;;QAGIE,aAAa,IAAIhE,GAAJ,EAAnB;SACOrB,IAAP,CAAYoF,QAAZ,EAAsBE,OAAtB,CAA8B/D,OAAO;QAC/B,OAAOA,GAAP,KAAe,UAAnB,EAA+B;UACV,OAAOA,IAAIuD,IAAX,KAAoB,QAAvC,EAAiD;cACzC,IAAItE,KAAJ,CAAW,yBAAwBe,IAAIgE,IAAK,GAA5C,CAAN;;iBAESC,GAAX,CAAejE,IAAIuD,IAAnB,EAAyBM,SAAS7D,GAAT,CAAzB;KAJF,MAKO;iBACMiE,GAAX,CAAejE,GAAf,EAAoB6D,SAAS7D,GAAT,CAApB;;GAPJ;kCAUWpB,SAAX;;SAEO,CAAC6C,QAAQmC,cAAT,EAAyBH,MAAzB,KAAoC;QACrCA,UAAUK,WAAW1E,GAAX,CAAeqE,OAAOF,IAAtB,CAAd,EAA2C;aAClCO,WAAWI,GAAX,CAAeT,OAAOF,IAAtB,EAA4B9B,KAA5B,EAAmCgC,MAAnC,CAAP;;;WAGKhC,KAAP;GALF;;;ACrBF;AACA,AAAe,SAAS0C,YAAT,CAAsBN,QAAtB,EAAyC;sBAAX,WAAG,UAAH,CAAW;;;;QAChDC,aAAa,IAAIhE,GAAJ,CAAQC,OAAOtB,IAAP,CAAYoF,QAAZ,EAAsBtE,GAAtB,CAA0BS,OAAO,CAACA,GAAD,EAAM6D,SAAS7D,GAAT,CAAN,CAAjC,CAAR,CAAnB;kCACWpB,SAAX;;SAEO,CAAC6C,KAAD,EAAQ2C,IAAR,KAAiB;UAChB3F,OAAOsB,OAAOtB,IAAP,CAAY2F,IAAZ,CAAb;WACOC,QAAQC,GAAR,CACL7F,KAAKc,GAAL,CAASS,OAAO;YACRwD,UAAUM,WAAWI,GAAX,CAAelE,GAAf,CAAhB;UACmB,CAACwD,OAApB,EAA6B,MAAM,IAAIvE,KAAJ,CAAW,wBAAuBe,GAAI,IAAtC,CAAN;aACtBwD,QAAQ/B,KAAR,EAAe2C,KAAKpE,GAAL,CAAf,CAAP;KAHF,CADK,EAMLuE,IANK,CAMAC,WAAW;YACVJ,OAAOrE,OAAO0E,MAAP,CAAc,IAAd,CAAb;cACQV,OAAR,CAAgB,CAACW,MAAD,EAASjF,KAAT,KAAmB;aAC5BhB,KAAKgB,KAAL,CAAL,IAAoBiF,MAApB;OADF;aAGON,IAAP;KAXK,CAAP;GAFF;;;ACHF;AACA,MAAMO,aAAa,CAACC,UAAD,EAAaC,aAAb,EAA4BC,QAA5B,KAAyCA,QAA5D;;AAEA,oCAAetD,gBAAauD,QAAQ,IAAR,EAAc,IAAd,EAAoBJ,UAApB,EAAgCnD,YAAhC,CAA5B;;ACLA,kBAAe,CAAC,GAAGwD,UAAJ,KAAmBA,WAAWC,MAAX,CAAkBC,OAAlB,EAA2BxF,IAA3B,CAAgC,GAAhC,CAAlC;;;;ACIA,wCAAiB,cACf,uBAAU,WAAC,8BAAD,CAAV,CADe,EAEf,uBAAU,aAAV,CAFe,CAAjB;IAKqByF,iBAAN,cAA6BnC,SAA7B,CAAuC;;WAGrC;iCAAL,aAAK;;8BACN,KAAKC,KAAL,CAAWE,QAAlB;;;;;ACXJ,8BAAa,cAAG,uBAAU,aAAV,CAAH,CAAb;;;AAEA,YAAe;MAAC,EAAEA,QAAF,EAAD,GAAa,KAAb;SAAyB;;;;GAAzB;CAAf;;;;ACFA,wCAAiB,cAAG,uBAAU,aAAV,CAAH,CAAjB;;;AAEA,oBAAe;+BAA2B,iBAAQ,eAAR,CAA3B;;MAAC,EAAEA,QAAF,EAAD,GAAaC,WAAb;4BAA6C;;;;GAA7C;CAAf;;;;;;;;;;;;;;;ACQA;;AAgBA,MAAMgC,SAAS,IAAIC,MAAJ,CAAW,iBAAX,CAAf;;AAEA,MAAMC,aAAa,CAAChE,GAAD,EAAMiE,OAAN,KAAkB;QAC7BhF,UAAUiF,eAAelE,GAAf,CAAhB;QACMhB,SAASmF,OAAOC,YAAP,EAAf;SACOC,WAAWrF,MAAX,EAAmBC,OAAnB,EAA4BgF,OAA5B,CAAP;CAHF;;AAMA,MAAMK,kBAAkBC,uBAAxB;;AAEA,0CAAmB,cACjB,+BAAmB,WAAC,UAAD,CAAnB,OADiB,EAEjB,yBAAa,mBAAC,UAAD,GAAU,gBAAV,CAAb,OAFiB,EAGjB,6BAAiB,WAAC,SAAE,iBAAC,UAAD,EAAU,OAAV,CAAF,CAAD,CAAjB,OAHiB,EAIjB,wBAAY,mBAAC,UAAD,GAAU,gBAAV,CAAZ,OAJiB,CAAnB;;;AAOA,aAAe,MAAMvE,OAAO;MACtBuB,aAAJ;MACIiD,gBAAJ;;SAEO;gBACO,CAACxD,GAAD,EAAMyD,IAAN,KAAe;UACrBrD,mBAAJ;aACOqD,MAAP;KAHG;;eAMM,CAACC,GAAD,EAAMT,YAAN;yBAAa,WAAG,WAAH,CAAb;;;aAAqC,MAAMjD,GAAN,IAAa;wBAC9C,UAAb,QAAwBA,IAAI2D,MAAJ,CAAW/B,GAAX,CAAe,SAAf,CAAxB;;cAEMgC,KAAK5D,IAAI6D,GAAJ,CAAQC,OAAR,CAAgB,YAAhB,CAAX;cACMpC,OAAO4B,gBAAgBM,EAAhB,IAAsB,iBAAtB,GAA0C,KAAvD;;cAEM5E,MAAM+E,MAAMC,aAAN,CAAoBN,GAApB,CAAZ;cACMO,gBAAgBC,qBAAtB;;cAEMC,sBAAsBC,oBAAoBpF,GAApB,EAAyB,EAAEC,SAASe,GAAX,EAAgBqE,OAD9C,EAAEC,UAAU,OAAO,EAAEtE,GAAF,EAAP,CAAZ,EAC8B,EAAzB,CAA5B;cACMuE,gBAAgBR,MAAMC,aAAN,CAAoBG,mBAApB,CAAhB,EAA0DF,cAAcO,OAAxE,CAAN;;cAEMH,QAAQI,kBAAkBzE,GAAlB,EAAuBiE,cAAcS,WAAd,EAAvB,EAAoD;0BAChDzB,QAAQ/C;SADZ,CAAd;;cAIMyE,aAAaP,oBAAoBpF,GAApB,EAAyB,EAAEC,SAASe,GAAX,EAAgBqE,KAAhB,EAAzB,CAAnB;;;gCAG0DA,MAAMC,QAAN,EAA1D;cAAM,AAAoCxF,WAA1C;YACI8F,IAAJ,GAAW,MAAM5B,WAAWe,MAAMC,aAAN,CAAoBW,UAApB,CAAX,EAA4C;iBAAA;sBAE/C1B,QAAQpE,UAAR,KAAuBvC,SAAvB,GAAmC2G,QAAQpE,UAA3C,GAAwD6C,IAFT;qBAGhDuB,QAAQxE,SAAR,KAAsBnC,SAAtB,GAAkC2G,QAAQxE,SAA1C,GAAsDiD,IAHN;4BAIzCuB,QAAQtE,gBAJiC;;SAA5C,CAAjB;OApBS;;GANb;CAJF;;AAyCA,MAAMkG,kBAAkB/B,OAAOgC,KAAP,CAAa,WAAb,CAAxB;;AAEA,AAAO,SAASC,UAAT,CAAoBC,EAApB,EAAgC7D,MAAhC,EAAyD;gBAAnC,UAAmC;;oBAAnB,wBAAmB;;;;;kBAC9C8D,KAAhB,CAAsB,YAAtB,EAAoC9D,MAApC;KACG+D,IAAH,CAAQ,cAAR,EAAwB/D,MAAxB;;;;;;"}