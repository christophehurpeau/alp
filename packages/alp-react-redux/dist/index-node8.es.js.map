{"version":3,"file":"index-node8.es.js","sources":["../src/layout/assetUrl.js","../src/layout/uneval.js","../src/layout/htmlLayout.js","../src/createAlpAppWrapper.jsx","../src/utils/identityReducer.js","../src/store/createServerStore.js","../src/module/AlpModule.jsx","../src/module/createModuleVisitor.js","../src/utils/createAction.js","../src/utils/createReducer.js","../src/utils/createLoader.js","../src/utils/createPureStatelessComponent.js","../src/utils/classNames.js","../src/module/AlpReduxModuleServer.jsx","../src/layout/Body.jsx","../src/layout/AppContainer.jsx","../src/index.js"],"sourcesContent":["export default (PRODUCTION\n  ? (asset, version) => (asset.startsWith('/') ? `/${version}${asset}` : asset)\n  : (asset, version) => (asset.startsWith('/') ? `${asset}?${version}` : asset));\n","/* global PRODUCTION */\n\nfunction uneval(obj, keys, objects = new Set()) {\n  switch (obj) {\n    case null:\n      return 'null';\n    case undefined:\n      return 'undefined';\n    case Infinity:\n      return 'Infinity';\n    case -Infinity:\n      return '-Infinity';\n  }\n\n  if (Number.isNaN(obj)) {\n    return 'NaN';\n  }\n\n  switch (typeof obj) {\n    case 'function':\n      if (!PRODUCTION) console.log(obj);\n      throw new Error(!PRODUCTION && `Unsupported function \"${keys}\".`);\n    case 'string':\n    case 'number':\n    case 'boolean':\n      return JSON.stringify(obj);\n  }\n\n  if (objects.has(obj)) {\n    throw new Error(!PRODUCTION && 'Circular reference detected.');\n  }\n\n  objects.add(obj);\n\n  // specialized types\n  if (obj instanceof Array) {\n    return `[${obj\n      .map((o, index) => uneval(o, !PRODUCTION && `${keys}[${index}]`, objects))\n      .join(',')}]`;\n  }\n\n  if (obj instanceof Date) {\n    return `new Date(${obj.getTime()})`;\n  }\n\n  if (obj instanceof Set) {\n    return `new Set(${uneval(Array.from(obj), keys)})`;\n  }\n\n  if (obj instanceof Map) {\n    return `new Map(${uneval(Array.from(obj), keys)})`;\n  }\n\n  return `{${Object.keys(obj)\n    .map(key => `${JSON.stringify(key)}:${uneval(obj[key], !PRODUCTION && `${keys}.${key}`)}`)\n    .join(',')}}`;\n}\n\n// https://medium.com/node-security/the-most-common-xss-vulnerability-in-react-js-applications-2bdffbcc1fa0#.tm3hd6riw\nconst UNSAFE_CHARS_REGEXP = /[<>/\\u2028\\u2029]/g;\nconst ESCAPED_CHARS = {\n  '<': '\\\\u003C',\n  '>': '\\\\u003E',\n  '/': '\\\\u002F',\n  '\\u2028': '\\\\u2028',\n  '\\u2029': '\\\\u2029',\n};\n\nconst escapeUnsafeChars = unsafeChar => ESCAPED_CHARS[unsafeChar];\n\nexport default obj => uneval(obj, 'obj').replace(UNSAFE_CHARS_REGEXP, escapeUnsafeChars);\n","/* eslint-disable jsx-a11y/html-has-lang, prefer-template */\nimport type { Element } from 'react';\nimport assetUrl from './assetUrl';\nimport uneval from './uneval';\n\ntype HelmetDataAttributeType = {\n  toString(): string,\n  toComponent(): Element,\n};\n\ntype HelmetDataType = {\n  htmlAttributes: HelmetDataAttributeType,\n  title: HelmetDataAttributeType,\n  base: HelmetDataAttributeType,\n  meta: HelmetDataAttributeType,\n  link: HelmetDataAttributeType,\n  script: HelmetDataAttributeType,\n  style: HelmetDataAttributeType,\n};\n\nexport type LayoutOptionsType = {|\n  layoutBody?: ?Function,\n  version: string,\n  scriptName: string | false,\n  styleName: string | false,\n  initialData?: ?any,\n  polyfillFeatures?: ?string,\n|};\n\nexport default (\n  helmet: HelmetDataType,\n  content: string,\n  {\n    version,\n    scriptName,\n    styleName,\n    initialData,\n    polyfillFeatures = 'default,es6,es7,localStorage,fetch,Intl',\n  },\n): string =>\n  `<!doctype html>\n<html ${helmet.htmlAttributes.toString()}>\n  <head>\n    ${helmet.title.toString()}\n    ${helmet.meta.toString()}\n    ${helmet.link.toString()}\n    ${helmet.base.toString()}\n    <link rel=\"stylesheet\" href=\"${assetUrl(`/${styleName || 'index'}.css`, version)}\" />\n    ${helmet.style.toString()}\n    ${polyfillFeatures &&\n      `<script defer src=\"${`https://polyfill.io/v2/polyfill.min.js?features=${polyfillFeatures}&unknown=polyfill`}\"></script>`}\n    ${helmet.script.toString()}\n    ${\n      scriptName === false\n        ? ''\n        : `<script>\nwindow.VERSION='${version}';\nwindow.__INITIAL_DATA__=${uneval(initialData)};\n</script>\n<script defer src=\"${assetUrl(`/${scriptName}.js`, version)}\"></script>`\n    }\n  </head>\n  <body ${helmet.bodyAttributes.toString()}>\n    <div id=\"react-app\">${content}</div>\n  </body>\n</html>`;\n","import { Component, type Element } from 'react';\nimport PropTypes from 'prop-types';\n\ntype PropsType = {||};\n\nexport default (app: Element, context: Object) =>\n  class AlpAppWrapper extends Component {\n    props: PropsType;\n\n    static childContextTypes = {\n      context: PropTypes.object.isRequired,\n      store: PropTypes.object.isRequired,\n      setModuleReducers: PropTypes.func,\n    };\n\n    state = {\n      error: null,\n    };\n\n    getChildContext(): Object {\n      return context;\n    }\n\n    componentDidCatch(error, errorInfo) {\n      this.setState({ error });\n      console.error(error, errorInfo);\n      if (window.Raven) window.Raven.captureException(error, { extra: errorInfo });\n    }\n\n    render(): Element {\n      if (this.state.error) return <div>An unexpected error occured</div>;\n      return app;\n    }\n  };\n","export default (state = null) => state;\n","import { combineReducers, createStore } from 'redux/src';\nimport identityReducer from '../utils/identityReducer';\n\nexport default (ctx, moduleReducers, { sharedReducers }) => {\n  const initialContext = {\n    ctx,\n    ...ctx.reduxInitialContext,\n  };\n\n  initialContext.ctx = ctx;\n\n  const rootReducer = combineReducers({\n    ...ctx.app.reduxReducers,\n    ...sharedReducers,\n    ctx: identityReducer,\n    module: moduleReducers ? combineReducers(moduleReducers) : identityReducer,\n  });\n\n  return createStore(rootReducer, initialContext);\n};\n","import { Component, type Node } from 'react';\n\ntype PropsType = {|\n  children: Node,\n|};\n\nexport default class AlpModule extends Component {\n  props: PropsType;\n\n  render(): Node {\n    if (!PRODUCTION) {\n      // eslint-disable-next-line react/prop-types\n      if (this.props.reducers) {\n        throw new Error('You have reducers, probably want to use AlpReduxModule.');\n      }\n    }\n    return this.props.children;\n  }\n}\n","// import AppContainer from '../layout/AppContainer';\nimport AlpModule from './AlpModule';\n\nexport default () => {\n  let reducers;\n\n  return {\n    visitor: (element, instance, context) => {\n      // console.log(element, instance, instance instanceof AlpModule, element.type === AppContainer);\n\n      if (instance && instance instanceof AlpModule) {\n        // eslint-disable-next-line prefer-destructuring\n        reducers = instance.props.reducers;\n        return false;\n      }\n\n      return true;\n    },\n\n    getReducers: () => reducers,\n  };\n};\n","// eslint-disable-next-line flowtype/no-weak-types\ntype HandlerType = (...args: Array<any>) => Object;\n\nexport default (type: string, handler: ?HandlerType) => {\n  const action = !handler ? () => ({ type }) : (...args) => ({ type, ...handler(...args) });\n  action.type = type;\n  action.toString = () => type;\n  return action;\n};\n","/* global PRODUCTION */\n\nexport default function createReducer(defaultState: Function | Object, handlers: ?Object) {\n  if (typeof defaultState === 'object') {\n    handlers = defaultState;\n    defaultState = () => null;\n  }\n\n  const handlerMap = new Map();\n  Object.keys(handlers).forEach(key => {\n    if (typeof key === 'function') {\n      if (!PRODUCTION && typeof key.type !== 'string') {\n        throw new Error(`Invalid handler key: \"${key.name}\"`);\n      }\n      handlerMap.set(key.type, handlers[key]);\n    } else {\n      handlerMap.set(key, handlers[key]);\n    }\n  });\n  handlers = undefined;\n\n  return (state = defaultState(), action) => {\n    if (action && handlerMap.has(action.type)) {\n      return handlerMap.get(action.type)(state, action);\n    }\n\n    return state;\n  };\n}\n","/* global PRODUCTION */\nexport default function createLoader(handlers: ?Object) {\n  const handlerMap = new Map(Object.keys(handlers).map(key => [key, handlers[key]]));\n  handlers = undefined;\n\n  return (state, data) => {\n    const keys = Object.keys(data);\n    return Promise.all(\n      keys.map(key => {\n        const handler = handlerMap.get(key);\n        if (!PRODUCTION && !handler) throw new Error(`Missing handler for \"${key}\".`);\n        return handler(state, data[key]);\n      }),\n    ).then(results => {\n      const data = Object.create(null);\n      results.forEach((result, index) => {\n        data[keys[index]] = result;\n      });\n      return data;\n    });\n  };\n}\n","import { connect } from 'react-redux';\n\n// mergeProps: remove dispatch from dispatchProps (and perf !)\nconst mergeProps = (stateProps, dispatchProps, ownProps) => ownProps;\n\nexport default Component => connect(null, null, mergeProps)(Component);\n","export default (...classNames) => classNames.filter(Boolean).join(' ');\n","import { type Node } from 'react';\nimport type { ReducerDictionaryType } from '../types';\nimport AlpModule from './AlpModule';\n\ntype PropsType = {|\n  reducers: ?ReducerDictionaryType,\n  children: Node,\n|};\n\nexport default class AlpReduxModule extends AlpModule {\n  props: PropsType;\n\n  render(): Node {\n    return this.props.children;\n  }\n}\n","import { type Node } from 'react';\n\ntype Props = {| children: Node |};\n\nexport default ({ children }: Props) => <div>{children}</div>;\n","import type { Element, Node } from 'react';\n\ntype PropsType = {| children: Node |};\n\nexport default ({ children }: PropsType): Element<'div'> => <div>{children}</div>;\n","import React from 'react';\nimport { renderToString } from 'react-dom/server';\nimport Helmet from 'react-helmet';\nimport reactTreeWalker from 'react-tree-walker';\nimport Logger from 'nightingale-logger/src';\nimport createIsModernBrowser from 'modern-browsers';\nimport htmlLayout from './layout/htmlLayout';\nimport createAlpAppWrapper from './createAlpAppWrapper';\nimport createServerStore from './store/createServerStore';\nimport createModuleVisitor from './module/createModuleVisitor';\nimport type { ReduxActionType } from './types';\n\nexport { Helmet };\nexport { combineReducers } from 'redux/src';\nexport { connect } from 'react-redux/src';\nexport * from './types';\nexport {\n  createAction,\n  createReducer,\n  createLoader,\n  classNames,\n  createPureStatelessComponent,\n  identityReducer,\n} from './utils/index';\nexport AlpModule from './module/AlpModule';\nexport AlpReduxModule from './module/AlpReduxModuleServer';\nexport Body from './layout/Body';\nexport AppContainer from './layout/AppContainer';\n\nconst logger = new Logger('alp:react-redux');\n\nconst renderHtml = (app, options) => {\n  const content = renderToString(app);\n  const helmet = Helmet.renderStatic();\n  return htmlLayout(helmet, content, options);\n};\n\nconst isModernBrowser = createIsModernBrowser();\n\ntype OptionsType = {|\n  polyfillFeatures?: ?string,\n  scriptName?: ?string | false,\n  sharedReducers?: ?{ [string]: any },\n  styleName?: ?string | false,\n|};\n\nexport default () => app => {\n  app.reduxReducers = {};\n  app.reduxMiddlewares = [];\n\n  return {\n    middleware: (ctx, next) => {\n      ctx.reduxInitialContext = {};\n      return next();\n    },\n\n    createApp: (App, options: ?OptionsType = {}) => async ctx => {\n      const version: string = ctx.config.get('version');\n      // TODO create alp-useragent with getter in context\n      const ua = ctx.req.headers['user-agent'];\n      const name = isModernBrowser(ua) ? 'modern-browsers' : 'es5';\n\n      const app = React.createElement(App);\n      const moduleVisitor = createModuleVisitor();\n      const preRenderStore = { getState: () => ({ ctx }) };\n      const PreRenderWrappedApp = createAlpAppWrapper(app, { context: ctx, store: preRenderStore });\n      await reactTreeWalker(React.createElement(PreRenderWrappedApp), moduleVisitor.visitor);\n\n      const store = createServerStore(ctx, moduleVisitor.getReducers(), {\n        sharedReducers: options.sharedReducers,\n      });\n\n      const WrappedApp = createAlpAppWrapper(app, { context: ctx, store });\n\n      // eslint-disable-next-line no-unused-vars\n      const { ctx: removeCtxFromInitialData, ...initialData } = store.getState();\n      ctx.body = await renderHtml(React.createElement(WrappedApp), {\n        version,\n        scriptName: options.scriptName !== undefined ? options.scriptName : name,\n        styleName: options.styleName !== undefined ? options.styleName : name,\n        polyfillFeatures: options.polyfillFeatures,\n        initialData,\n      });\n    },\n  };\n};\n\nconst loggerWebsocket = logger.child('websocket');\n\nexport function emitAction(to: string, action: ReduxActionType) {\n  loggerWebsocket.debug('emitAction', action);\n  to.emit('redux:action', action);\n}\n"],"names":["asset","version","startsWith","uneval","obj","keys","objects","Set","undefined","Infinity","Number","isNaN","Error","JSON","stringify","has","add","Array","map","o","join","Date","getTime","from","Map","Object","key","UNSAFE_CHARS_REGEXP","ESCAPED_CHARS","escapeUnsafeChars","unsafeChar","replace","helmet","content","htmlAttributes","toString","title","meta","link","base","assetUrl","styleName","style","polyfillFeatures","script","scriptName","initialData","bodyAttributes","app","context","Component","state","error","errorInfo","setState","window","Raven","captureException","extra","childContextTypes","PropTypes","object","isRequired","func","ctx","moduleReducers","sharedReducers","initialContext","reduxInitialContext","rootReducer","combineReducers","reduxReducers","identityReducer","createStore","AlpModule","props","children","reducers","element","instance","type","handler","action","args","createReducer","defaultState","handlers","handlerMap","forEach","set","get","createLoader","data","Promise","all","then","results","create","result","index","mergeProps","stateProps","dispatchProps","ownProps","connect","classNames","filter","Boolean","AlpReduxModule","logger","Logger","renderHtml","options","renderToString","Helmet","renderStatic","htmlLayout","isModernBrowser","createIsModernBrowser","reduxMiddlewares","next","App","config","ua","req","headers","name","React","createElement","moduleVisitor","createModuleVisitor","PreRenderWrappedApp","createAlpAppWrapper","store","getState","reactTreeWalker","visitor","createServerStore","getReducers","WrappedApp","body","loggerWebsocket","child","emitAction","to","debug","emit"],"mappings":"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"}