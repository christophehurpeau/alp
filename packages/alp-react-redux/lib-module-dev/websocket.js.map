{"version":3,"sources":["../src/websocket.js"],"names":["Logger","createAction","logger","createEmitAction","type","argsNamesOrHandler","meta","websocket","createEmitPromiseAction","promise","websocketMiddleware","action","next","app","emit","resolved","setTimeout","warn","console","log","clearTimeout","store","dispatch"],"mappings":"AAAA,OAAOA,MAAP;AACA,OAAOC,YAAP,MAAyB,sBAAzB;;;AAEA,IAAMC,SAAS,IAAIF,MAAJ,CAAW,2BAAX,CAAf;;AAEA,8DAA8B,gBAAM,UAAN,GAAgB,UAAhB,EAAyB,YAAzB,CAA9B;;;AAEA,OAAO,SAASG,gBAAT,CAA0BC,IAA1B,EAAwCC,kBAAxC,EAAqF;AAAA,kBAAvD,UAAuD;;AAAA,gCAA3B,WAAG,sBAAH,CAA2B;;AAC1F,qIAAOJ,aAAaG,IAAb,EAAmBC,kBAAnB,EAAuC,EAAEC,MAAM,EAAEC,WAAW,IAAb,EAAR,EAAvC,CAAP;AACD;;AAED,OAAO,SAASC,uBAAT,CACLJ,IADK,EAELC,kBAFK,EAGL;AAAA,mBAFI,UAEJ;;AAAA,iCADkB,QAAE,WAAC,QAAM,UAAN,CAAD,CAAF,EAAmB,UAAnB,EAA4B,YAA5B,CAClB;;AACA,uIAAOJ,aAAaG,IAAb,EAAmBC,kBAAnB,EAAuC,EAAEC,MAAM,EAAEC,WAAW,IAAb,EAAmBE,SAAS,IAA5B,EAAR,EAAvC,CAAP;AACD;;AAED,OAAO,IAAMC,sBAAsB,SAAtBA,mBAAsB;AAAA,SAAO;AAAA,WAAS;AAAA,aAAQ,kBAAU;AACnE,YAAI,CAACC,OAAOL,IAAR,IAAgB,CAACK,OAAOL,IAAP,CAAYC,SAAjC,EACE,OAAOK,KAAKD,MAAL,CAAP;;AAGF,YAAI,CAACA,OAAOL,IAAP,CAAYG,OAAjB,EAEE,YADAI,IAAIN,SAAJ,CAAcO,IAAd,CAAmBH,OAAOP,IAA1B,EAAgCO,MAAhC,CACA;;AAGF,YAAMI,WAAWC,WAAW,YAAM;AAChCd,iBAAOe,IAAP,CAAY,wBAAZ,EAAsC,EAAEN,cAAF,EAAtC,CADgC,EAGhCO,QAAQC,GAAR,CAAY,wCAAZ,EAAsDR,MAAtD,CAHgC;AAIjC,SAJgB,EAId,KAJc,CAAjB;;AAMAE,YAAIN,SAAJ,CAAcO,IAAd,CAAmBH,OAAOP,IAA1B,EAAgCO,MAAhC,EAAwC,kBAAU;AAChDS,uBAAaL,QAAb,CADgD,EAE5CJ,MAF4C,IAG9CU,MAAMC,QAAN,CAAeX,MAAf,CAH8C;AAKjD,SALD,CAhBmE;AAsBpE,OAtBkD;AAAA,KAAT;AAAA,GAAP;AAAA,CAA5B","file":"websocket.js","sourcesContent":["import Logger from 'nightingale-logger/src';\nimport createAction from './utils/createAction';\n\nconst logger = new Logger('alp:react-redux:websocket');\n\ntype ArgsNamesOfHandlerType = Array<string> | string | Function;\n\nexport function createEmitAction(type: string, argsNamesOrHandler: ?ArgsNamesOfHandlerType) {\n  return createAction(type, argsNamesOrHandler, { meta: { websocket: true } });\n}\n\nexport function createEmitPromiseAction(\n  type: string,\n  argsNamesOrHandler: ?Array<string> | string | Function,\n) {\n  return createAction(type, argsNamesOrHandler, { meta: { websocket: true, promise: true } });\n}\n\nexport const websocketMiddleware = app => store => next => action => {\n  if (!action.meta || !action.meta.websocket) {\n    return next(action);\n  }\n\n  if (!action.meta.promise) {\n    app.websocket.emit(action.type, action);\n    return;\n  }\n\n  const resolved = setTimeout(() => {\n    logger.warn('websocket emit timeout', { action });\n    // eslint-disable-next-line no-console\n    console.log('alp.react-redux websocket emit timeout', action);\n  }, 10000);\n\n  app.websocket.emit(action.type, action, action => {\n    clearTimeout(resolved);\n    if (action) {\n      store.dispatch(action);\n    }\n  });\n};\n"]}