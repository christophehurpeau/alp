{"version":3,"sources":["../src/websocket.js"],"names":[],"mappings":";;AAAA,OAAO,MAAP,MAAmB,oBAAnB;AACA,OAAO,YAAP,MAAyB,gBAAzB;;AAEA,IAAM,SAAS,IAAI,MAAJ,CAAW,2BAAX,CAAf;;AAEA,OAAO,SAAS,gBAAT,CAA0B,IAA1B,EAAwC,kBAAxC,EAA4F;AAAA,eAAlE,IAAkE;AAAA,gHAAlE,IAAkE;AAAA;;AAAA,QAApD,kBAAoD,0BAApD,kBAAoD,KAApD,kBAAoD;AAAA;AAAA,eAApD,kBAAoD,wBAApD,kBAAoD;AAAA,0JAApD,kBAAoD;AAAA;;AACjG,SAAO,aAAa,IAAb,EAAmB,kBAAnB,EAAuC,EAAE,MAAM,EAAE,WAAW,IAAb,EAAR,EAAvC,CAAP;AACD;;AAED,OAAO,SAAS,uBAAT,CACL,IADK,EAEL,kBAFK,EAGL;AAAA,eAFA,IAEA;AAAA,gHAFA,IAEA;AAAA;;AAAA,QADA,kBACA,0BADA,kBACA,KADA,kBACA;AAAA;AAAA,eADA,kBACA,wBADA,kBACA;AAAA,0JADA,kBACA;AAAA;;AACA,SAAO,aAAa,IAAb,EAAmB,kBAAnB,EAAuC,EAAE,MAAM,EAAE,WAAW,IAAb,EAAmB,SAAS,IAA5B,EAAR,EAAvC,CAAP;AACD;;AAED,OAAO,IAAM,sBAAsB,SAAtB,mBAAsB;AAAA,SAAO;AAAA,WAAS;AAAA,aAAQ,kBAAU;AACnE,YAAI,CAAC,OAAO,IAAR,IAAgB,CAAC,OAAO,IAAP,CAAY,SAAjC,EAA4C;AAC1C,iBAAO,KAAK,MAAL,CAAP;AACD;;AAED,YAAI,CAAC,OAAO,IAAP,CAAY,OAAjB,EAA0B;AACxB,cAAI,SAAJ,CAAc,IAAd,CAAmB,OAAO,IAA1B,EAAgC,MAAhC;AACA;AACD;;AAED,YAAM,WAAW,WAAW,YAAM;AAChC,iBAAO,IAAP,CAAY,wBAAZ,EAAsC,EAAE,cAAF,EAAtC;AACA;AACA,kBAAQ,GAAR,CAAY,wCAAZ,EAAsD,MAAtD;AACD,SAJgB,EAId,KAJc,CAAjB;;AAMA,YAAI,SAAJ,CAAc,IAAd,CAAmB,OAAO,IAA1B,EAAgC,MAAhC,EAAwC,UAAC,MAAD,EAAY;AAClD,uBAAa,QAAb;AACA,cAAI,MAAJ,EAAY;AACV,kBAAM,QAAN,CAAe,MAAf;AACD;AACF,SALD;AAMD,OAtBkD;AAAA,KAAT;AAAA,GAAP;AAAA,CAA5B","file":"websocket.js","sourcesContent":["import Logger from 'nightingale-logger';\nimport createAction from './createAction';\n\nconst logger = new Logger('alp.react-redux.websocket');\n\nexport function createEmitAction(type: string, argsNamesOrHandler: ?Array<string>|string|Function) {\n  return createAction(type, argsNamesOrHandler, { meta: { websocket: true } });\n}\n\nexport function createEmitPromiseAction(\n  type: string,\n  argsNamesOrHandler: ?Array<string>|string|Function,\n) {\n  return createAction(type, argsNamesOrHandler, { meta: { websocket: true, promise: true } });\n}\n\nexport const websocketMiddleware = app => store => next => action => {\n  if (!action.meta || !action.meta.websocket) {\n    return next(action);\n  }\n\n  if (!action.meta.promise) {\n    app.websocket.emit(action.type, action);\n    return;\n  }\n\n  const resolved = setTimeout(() => {\n    logger.warn('websocket emit timeout', { action });\n    // eslint-disable-next-line no-console\n    console.log('alp.react-redux websocket emit timeout', action);\n  }, 10000);\n\n  app.websocket.emit(action.type, action, (action) => {\n    clearTimeout(resolved);\n    if (action) {\n      store.dispatch(action);\n    }\n  });\n};\n"]}