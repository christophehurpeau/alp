{"version":3,"file":"index-browsermodern-dev.es.js","sources":["../src/index.ts"],"sourcesContent":["import { PRODUCTION } from 'pob-babel';\nimport Ibex from 'ibex';\nimport config, { getConfig, existsConfig } from 'alp-browser-config';\nimport language from 'alp-browser-language';\nimport translate from 'alp-translate/browser';\nimport Logger from 'nightingale-logger';\nimport {\n  BrowserApplication as BrowserApplicationType,\n  BrowserApplicationInCreation,\n} from 'alp-types';\n\nexport type BrowserApplication = BrowserApplicationType;\n\nconst logger = new Logger('alp');\n\ndeclare global {\n  interface Window {\n    __VERSION__: string;\n  }\n}\n\ninterface Options {\n  version?: string; // default to window.__VERSION__\n}\nconst configPath = '/config';\n\nexport default class AlpBrowser extends Ibex\n  implements BrowserApplicationInCreation {\n  path: string;\n\n  appVersion: string;\n\n  constructor(path = '/', { version = window.__VERSION__ }: Options = {}) {\n    super();\n    this.path = path;\n    this.appVersion = version;\n  }\n\n  async init(): Promise<BrowserApplication> {\n    await config(\n      this,\n      PRODUCTION ? `/${this.appVersion}${configPath}` : configPath,\n    );\n\n    language(this);\n    await translate('/locales')(this);\n\n    return (this as unknown) as BrowserApplication;\n  }\n\n  existsConfig(name: string) {\n    return existsConfig(`${configPath}${name}`);\n  }\n\n  loadConfig(name: string) {\n    return getConfig(`${configPath}${name}`);\n  }\n\n  start(fn: Function) {\n    try {\n      fn()\n        .then(() => logger.success('started'))\n        .catch((err: any) => logger.error('start fail', { err }));\n    } catch (err) {\n      logger.error('start fail', { err });\n    }\n  }\n}\n\nexport const startApp = (\n  callback: (app: BrowserApplication) => unknown,\n): void => {\n  const app = new AlpBrowser();\n\n  return app.start(async () => {\n    // init\n    const browserApp = await app.init();\n    await callback(browserApp);\n  });\n};\n"],"names":["logger","Logger","configPath","AlpBrowser","Ibex","constructor","path","version","window","__VERSION__","appVersion","init","config","language","translate","existsConfig","name","loadConfig","getConfig","start","fn","then","success","catch","err","error","startApp","callback","app","browserApp"],"mappings":";;;;;;AAaA,MAAMA,MAAM,GAAG,IAAIC,MAAJ,CAAW,KAAX,CAAf;AAWA,MAAMC,UAAU,GAAG,SAAnB;AAEe,MAAMC,UAAN,SAAyBC,IAAzB,CAC2B;AAKxCC,EAAAA,WAAW,CAACC,IAAI,GAAG,GAAR,EAAa;AAAEC,IAAAA,OAAO,GAAGC,MAAM,CAACC;AAAnB,MAA4C,EAAzD,EAA6D;AACtE;AACA,SAAKH,IAAL,GAAYA,IAAZ;AACA,SAAKI,UAAL,GAAkBH,OAAlB;AACD;;AAED,QAAMI,IAAN,GAA0C;AACxC,UAAMC,MAAM,CACV,IADU,EAEwCV,UAFxC,CAAZ;AAKAW,IAAAA,QAAQ,CAAC,IAAD,CAAR;AACA,UAAMC,SAAS,CAAC,UAAD,CAAT,CAAsB,IAAtB,CAAN;AAEA,WAAQ,IAAR;AACD;;AAEDC,EAAAA,YAAY,CAACC,IAAD,EAAe;AACzB,WAAOD,YAAY,CAAE,GAAEb,UAAW,GAAEc,IAAK,EAAtB,CAAnB;AACD;;AAEDC,EAAAA,UAAU,CAACD,IAAD,EAAe;AACvB,WAAOE,SAAS,CAAE,GAAEhB,UAAW,GAAEc,IAAK,EAAtB,CAAhB;AACD;;AAEDG,EAAAA,KAAK,CAACC,EAAD,EAAe;AAClB,QAAI;AACFA,MAAAA,EAAE,GACCC,IADH,CACQ;AAAA,eAAMrB,MAAM,CAACsB,OAAP,CAAe,SAAf,CAAN;AAAA,OADR,EAEGC,KAFH,CAES,UAACC,GAAD;AAAA,eAAcxB,MAAM,CAACyB,KAAP,CAAa,YAAb,EAA2B;AAAED,UAAAA;AAAF,SAA3B,CAAd;AAAA,OAFT;AAGD,KAJD,CAIE,OAAOA,GAAP,EAAY;AACZxB,MAAAA,MAAM,CAACyB,KAAP,CAAa,YAAb,EAA2B;AAAED,QAAAA;AAAF,OAA3B;AACD;AACF;;AAvCuC;MA0C7BE,QAAQ,GAAG,SAAXA,QAAW,CACtBC,QADsB,EAEb;AACT,QAAMC,GAAG,GAAG,IAAIzB,UAAJ,EAAZ;AAEA,SAAOyB,GAAG,CAACT,KAAJ,CAAU,kBAAY;AAC3B;AACA,UAAMU,UAAU,GAAG,MAAMD,GAAG,CAACjB,IAAJ,EAAzB;AACA,UAAMgB,QAAQ,CAACE,UAAD,CAAd;AACD,GAJM,CAAP;AAKD;;;;;"}