{"version":3,"file":"index-browser.es.js","sources":["../src/index.ts"],"sourcesContent":["import 'pob-babel';\nimport config, { getConfig, existsConfig } from 'alp-browser-config';\nimport language from 'alp-browser-language';\n// eslint-disable-next-line import/no-unresolved\nimport translate from 'alp-translate/browser';\nimport type {\n  BrowserApplication as BrowserApplicationType,\n  BrowserApplicationInCreation,\n  BaseContext as AlpBaseContext,\n  Context as AlpContext,\n  Config,\n  ContextState,\n  RawConfig,\n} from 'alp-types';\nimport Ibex from 'ibex';\nimport { Logger } from 'nightingale-logger';\n\nexport type BrowserApplication = BrowserApplicationType;\n\nconst logger = new Logger('alp');\n\ndeclare global {\n  interface Window {\n    __VERSION__: string;\n  }\n}\n\ninterface Options {\n  version?: string; // default to window.__VERSION__\n}\n\ndeclare module 'ibex' {\n  // eslint-disable-next-line @typescript-eslint/no-empty-interface\n  interface BaseContext extends AlpBaseContext {}\n  // eslint-disable-next-line @typescript-eslint/no-empty-interface\n  interface DefaultState extends ContextState {}\n  // eslint-disable-next-line @typescript-eslint/no-empty-interface\n  interface Context extends AlpContext {}\n}\n\nconst configPath = '/config';\n\nexport default class AlpBrowser\n  extends Ibex\n  implements BrowserApplicationInCreation\n{\n  path: string;\n\n  appVersion: string;\n\n  constructor(path = '/', { version = window.__VERSION__ }: Options = {}) {\n    super();\n    this.path = path;\n    this.appVersion = version;\n  }\n\n  config?: Config | undefined;\n\n  async init(): Promise<BrowserApplication> {\n    const configInstance = await config(\n      this,\n      !__DEV__ ? `/${this.appVersion}${configPath}` : configPath,\n    );\n    this.context.config = configInstance;\n\n    language(this);\n    await translate('/locales')(this);\n\n    return this as unknown as BrowserApplication;\n  }\n\n  async existsConfig(name: string): Promise<boolean> {\n    return existsConfig(`${configPath}${name}`);\n  }\n\n  loadConfig(name: string): Promise<RawConfig> {\n    return getConfig(`${configPath}${name}`);\n  }\n\n  start(fn: () => Promise<void>): void {\n    try {\n      fn()\n        .then(() => {\n          logger.success('started');\n        })\n        .catch((err: unknown) => {\n          logger.error('start fail', { err });\n        });\n    } catch (err: unknown) {\n      logger.error('start fail', { err });\n    }\n  }\n}\n\nexport const startApp = (\n  callback: (app: BrowserApplication) => unknown,\n): void => {\n  const app = new AlpBrowser();\n\n  app.start(async () => {\n    // init\n    const browserApp = await app.init();\n    await callback(browserApp);\n  });\n};\n"],"names":["logger","Logger","configPath","AlpBrowser","path","version","window","__VERSION__","appVersion","init","config","configInstance","context","language","translate","existsConfig","name","loadConfig","getConfig","start","fn","then","success","catch","err","error","Ibex","startApp","callback","app","browserApp"],"mappings":";;;;;;;;;AAmBA,IAAMA,MAAM,GAAG,IAAIC,MAAJ,CAAW,KAAX,CAAf;AAqBA,IAAMC,UAAU,GAAG,SAAnB;;IAEqBC;;;AAQnB,sBAAYC,IAAZ,SAAwE;AAAA;;AAAA,QAA5DA,IAA4D;AAA5DA,MAAAA,IAA4D,GAArD,GAAqD;AAAA;;AAAA,kCAAJ,EAAI;AAAA,4BAA9CC,OAA8C;AAAA,QAA9CA,OAA8C,6BAApCC,MAAM,CAACC,WAA6B;;AACtE;AACA,UAAKH,IAAL,GAAYA,IAAZ;AACA,UAAKI,UAAL,GAAkBH,OAAlB;AAHsE;AAIvE;;;;SAIKI;yEAAN;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAC+BC,MAAM,CACjC,IADiC,EAEjC,wCAAA,SAAe,KAAKF,UAApB,GAAiCN,UAAjC,GAAgDA,UAFf,CADrC;;AAAA;AACQS,cAAAA,cADR;AAKE,mBAAKC,OAAL,CAAaF,MAAb,GAAsBC,cAAtB;AAEAE,cAAAA,QAAQ,CAAC,IAAD,CAAR;AAPF;AAAA,qBAQQC,SAAS,CAAC,UAAD,CAAT,CAAsB,IAAtB,CARR;;AAAA;AAAA,+CAUS,IAVT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;SAaMC;kFAAN,kBAAmBC,IAAnB;AAAA;AAAA;AAAA;AAAA;AAAA,gDACSD,YAAY,aAAiBC,IAAjB,CADrB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;SAIAC,aAAA,oBAAWD,IAAX,EAA6C;AAC3C,WAAOE,SAAS,aAAiBF,IAAjB,CAAhB;AACD;;SAEDG,QAAA,eAAMC,EAAN,EAAqC;AACnC,QAAI;AACFA,MAAAA,EAAE,GACCC,IADH,CACQ,YAAM;AACVrB,QAAAA,MAAM,CAACsB,OAAP,CAAe,SAAf;AACD,OAHH,EAIGC,KAJH,CAIS,UAACC,GAAD,EAAkB;AACvBxB,QAAAA,MAAM,CAACyB,KAAP,CAAa,YAAb,EAA2B;AAAED,UAAAA,GAAG,EAAHA;AAAF,SAA3B;AACD,OANH;AAOD,KARD,CAQE,OAAOA,GAAP,EAAqB;AACrBxB,MAAAA,MAAM,CAACyB,KAAP,CAAa,YAAb,EAA2B;AAAED,QAAAA,GAAG,EAAHA;AAAF,OAA3B;AACD;AACF;;;EAhDOE;IAmDGC,QAAQ,GAAG,SAAXA,QAAW,CACtBC,QADsB,EAEb;AACT,MAAMC,GAAG,GAAG,IAAI1B,UAAJ,EAAZ;AAEA0B,EAAAA,GAAG,CAACV,KAAJ,wEAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAEiBU,GAAG,CAACpB,IAAJ,EAFjB;;AAAA;AAEFqB,YAAAA,UAFE;AAAA;AAAA,mBAGFF,QAAQ,CAACE,UAAD,CAHN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAV;AAKD;;;;"}