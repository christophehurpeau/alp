{"version":3,"sources":["../src/index.js"],"names":["Ibex","config","errors","params","language","translate","contentLoaded","init","initWebApp","redirect","Logger","Config","default","newController","logger","AlpBrowser","path","options","global","initialBrowserContext","context","state","use","moduleDescriptor","data","Object","create","assign","then","render","on","load","url","fn","success","catch","error","err","env"],"mappings":";;;;;;;;;;;;AAAA,OAAOA,IAAP,MAAiB,MAAjB;AACA,OAAOC,MAAP,MAAmB,YAAnB;AACA,OAAOC,MAAP,MAAmB,oBAAnB;AACA,OAAOC,MAAP,MAAmB,YAAnB;AACA,OAAOC,QAAP,MAAqB,cAArB;AACA,OAAOC,SAAP,MAAsB,eAAtB;AACA,OAAOC,aAAP,MAA0B,gBAA1B;AACA,SAASC,QAAQC,UAAjB,EAA6BC,QAA7B;AACA,OAAOC,MAAP,MAAmB,oBAAnB;;AAEA,SAASC,MAAT,QAAuB,YAAvB;AACA,SAASC,WAAWC,aAApB,QAAyC,gBAAzC;;AAEA,IAAMC,SAAS,IAAIJ,MAAJ,CAAW,KAAX,CAAf;;IAEqBK,U;;;AAInB;;;;AAIA,wBAAsC;AAAA,QAA1BC,IAA0B,uEAAnB,GAAmB;AAAA,QAAdC,OAAc,uEAAJ,EAAI;;AAAA;;AAAA;;AAEpC,UAAKD,IAAL,GAAYA,IAAZ;;AAEA,QAAIE,OAAOC,qBAAX,EAAkC;AAChC,YAAKC,OAAL,CAAaC,KAAb,GAAqBH,OAAOC,qBAAP,CAA6BE,KAAlD;AACD;AANmC;AAOrC;;;;;;;;;;;uBAGOpB,OAAO,SAAP,EAAkB,IAAlB,C;;;AACNE,uBAAO,IAAP;AACAC,yBAAS,IAAT;;uBACMC,UAAU,UAAV,EAAsB,IAAtB,C;;;;;;;;;;;;;;;;;;kCAOM;AACZ,WAAKiB,GAAL,CAASpB,MAAT;AACD;;;kCAEaqB,gB,EAAkBC,I,EAAM;AAAA;;AACpC,UAAMJ,UAAUK,OAAOC,MAAP,CAAc,KAAKN,OAAnB,CAAhB;AACAK,aAAOE,MAAP,CAAcP,OAAd,EAAuBF,OAAOC,qBAA9B;AACA,aAAOC,QAAQC,KAAf;;AAEA,aAAOf,gBACJsB,IADI,CACC;AAAA,eACJR,QAAQS,MAAR,CAAeN,gBAAf,EAAiCC,IAAjC,EAAuC,IAAvC,CADI;AAAA,OADD,EAGFI,IAHE,CAGG,YAAM;AACZ,eAAKE,EAAL,CAAQ,UAAR,EAAoBrB,QAApB;AACAD,mBAAW;AAAA,iBAAO,OAAKuB,IAAL,CAAUC,GAAV,CAAP;AAAA,SAAX;AACD,OANI,CAAP;AAOD;;;0BAEKC,E,EAAc;AAAA,cAAdA,EAAc;;AAClBA,WACGL,IADH,CACQ;AAAA,eAAMd,OAAOoB,OAAP,CAAe,SAAf,CAAN;AAAA,OADR,EAEGC,KAFH,CAES;AAAA,eAAOrB,OAAOsB,KAAP,CAAa,YAAb,EAA2B,EAAEC,QAAF,EAA3B,CAAP;AAAA,OAFT;AAGD;;;wBA1BiB;AAChB,aAAO,KAAKC,GAAZ;AACD;;;;EA1BqCtC,I;;eAAnBe,U","file":"index.js","sourcesContent":["import Ibex from 'ibex';\nimport config from 'alp-config';\nimport errors from 'alp-errors-browser';\nimport params from 'alp-params';\nimport language from 'alp-language';\nimport translate from 'alp-translate';\nimport contentLoaded from 'content-loaded';\nimport { init as initWebApp, redirect } from 'alauda/src/web-app';\nimport Logger from 'nightingale-logger';\n\nexport { Config } from 'alp-config';\nexport { default as newController } from 'alp-controller';\n\nconst logger = new Logger('alp');\n\nexport default class AlpBrowser extends Ibex {\n  path: string;\n  appVersion: string;\n\n  /**\n   * @param {string} [path='/']\n   * @param {Object} [options]\n   */\n  constructor(path = '/', options = {}) {\n    super();\n    this.path = path;\n\n    if (global.initialBrowserContext) {\n      this.context.state = global.initialBrowserContext.state;\n    }\n  }\n\n  async init() {\n    await config('/config')(this);\n    params(this);\n    language(this);\n    await translate('/locales')(this);\n  }\n\n  get environment() {\n    return this.env;\n  }\n\n  catchErrors() {\n    this.use(errors);\n  }\n\n  initialRender(moduleDescriptor, data) {\n    const context = Object.create(this.context);\n    Object.assign(context, global.initialBrowserContext);\n    delete context.state;\n\n    return contentLoaded()\n      .then(() => (\n        context.render(moduleDescriptor, data, true)\n      )).then(() => {\n        this.on('redirect', redirect);\n        initWebApp(url => this.load(url));\n      });\n  }\n\n  start(fn: Function) {\n    fn()\n      .then(() => logger.success('started'))\n      .catch(err => logger.error('start fail', { err }));\n  }\n}\n"]}