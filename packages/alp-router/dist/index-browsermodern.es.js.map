{"version":3,"file":"index-browsermodern.es.js","sources":["../src/index.ts"],"sourcesContent":["import type { Context, NodeApplication } from 'alp-types';\nimport type { Router, RouteMatch } from 'router-segments';\n\ntype ReturnType = (app: NodeApplication) => (ctx: Context) => Promise<void>;\n\nexport type UrlGenerator = <P extends Record<string, unknown> | undefined>(\n  routeKey: string,\n  params?: P,\n) => string;\n\ndeclare module 'alp-types' {\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  interface NodeApplication {\n    router?: Router;\n  }\n\n  interface BaseContext {\n    urlGenerator: UrlGenerator;\n    redirectTo: <P extends Record<string, unknown>>(\n      to: string,\n      params?: P,\n    ) => Promise<void>;\n  }\n\n  // eslint-disable-next-line @typescript-eslint/no-shadow\n  interface Context {\n    route: RouteMatch<any>;\n  }\n}\n\nexport default function alpRouter(router: Router): ReturnType {\n  return (app: NodeApplication) => {\n    app.router = router;\n\n    app.context.urlGenerator = function <\n      P extends Record<string, unknown> | undefined,\n    >(this: Context, routeKey: string, params?: P): string {\n      return router.toLocalizedPath(this.language, routeKey, params);\n    };\n\n    app.context.redirectTo = function <\n      P extends Record<string, unknown> | undefined,\n    >(this: Context, to: string, params?: P): Promise<void> {\n      return this.redirect(router.toLocalizedPath(this.language, to, params));\n    };\n\n    return (ctx: Context): Promise<void> => {\n      // eslint-disable-next-line unicorn/no-array-method-this-argument\n      const routeMatch = router.find(ctx.request.path, ctx.language);\n\n      if (!routeMatch) {\n        ctx.status = 404;\n        throw new Error(`Route not found: ${ctx.request.path}`);\n      }\n\n      ctx.route = routeMatch;\n\n      return (routeMatch.ref as (ctx: Context) => Promise<void>)(ctx);\n    };\n  };\n}\n"],"names":["alpRouter","router","app","context","urlGenerator","routeKey","params","toLocalizedPath","language","redirectTo","to","redirect","ctx","routeMatch","find","request","path","status","Error","route","ref"],"mappings":"AA8Be,SAASA,SAAT,CAAmBC,MAAnB,EAA+C;AAC5D,EAAA,OAAQC,GAAD,IAA0B;IAC/BA,GAAG,CAACD,MAAJ,GAAaA,MAAb,CAAA;;IAEAC,GAAG,CAACC,OAAJ,CAAYC,YAAZ,GAA2B,UAEVC,QAFU,EAEQC,MAFR,EAE4B;MACrD,OAAOL,MAAM,CAACM,eAAP,CAAuB,IAAA,CAAKC,QAA5B,EAAsCH,QAAtC,EAAgDC,MAAhD,CAAP,CAAA;KAHF,CAAA;;IAMAJ,GAAG,CAACC,OAAJ,CAAYM,UAAZ,GAAyB,UAERC,EAFQ,EAEIJ,MAFJ,EAE+B;AACtD,MAAA,OAAO,IAAKK,CAAAA,QAAL,CAAcV,MAAM,CAACM,eAAP,CAAuB,IAAKC,CAAAA,QAA5B,EAAsCE,EAAtC,EAA0CJ,MAA1C,CAAd,CAAP,CAAA;KAHF,CAAA;;AAMA,IAAA,OAAQM,GAAD,IAAiC;AACtC;AACA,MAAA,MAAMC,UAAU,GAAGZ,MAAM,CAACa,IAAP,CAAYF,GAAG,CAACG,OAAJ,CAAYC,IAAxB,EAA8BJ,GAAG,CAACJ,QAAlC,CAAnB,CAAA;;MAEA,IAAI,CAACK,UAAL,EAAiB;QACfD,GAAG,CAACK,MAAJ,GAAa,GAAb,CAAA;QACA,MAAM,IAAIC,KAAJ,CAAW,CAAmBN,iBAAAA,EAAAA,GAAG,CAACG,OAAJ,CAAYC,IAAK,CAAA,CAA/C,CAAN,CAAA;AACD,OAAA;;MAEDJ,GAAG,CAACO,KAAJ,GAAYN,UAAZ,CAAA;AAEA,MAAA,OAAQA,UAAU,CAACO,GAAZ,CAAoDR,GAApD,CAAP,CAAA;KAXF,CAAA;GAfF,CAAA;AA6BD;;;;"}