{"version":3,"file":"index-node10.cjs.js","sources":["../src/index.ts"],"sourcesContent":["import { Router } from 'router-segments';\nimport { Context, NodeApplication } from 'alp-types';\n\ntype ReturnType = (app: NodeApplication) => (ctx: Context) => Promise<void>;\n\nexport type UrlGenerator = (routeKey: string, params: any) => string;\n\ndeclare module 'alp-types' {\n  interface NodeApplication {\n    router?: Router;\n  }\n\n  interface Context {\n    urlGenerator: UrlGenerator;\n    redirectTo: (to: string, params: any) => any;\n  }\n}\n\nexport default function alpRouter(router: Router): ReturnType {\n  return (app: NodeApplication) => {\n    app.router = router;\n\n    app.context.urlGenerator = function(routeKey: string, params: any): string {\n      return router.toLocalizedPath(this.language, routeKey, params);\n    };\n\n    app.context.redirectTo = function(to: string, params: any): any {\n      return this.redirect(router.toLocalizedPath(this.language, to, params));\n    };\n\n    return (ctx: Context) => {\n      const routeMatch = router.find(ctx.path, ctx.language);\n\n      if (!routeMatch) {\n        ctx.status = 404;\n        throw new Error(`Route not found: ${ctx.path}`);\n      }\n\n      ctx.route = routeMatch;\n\n      return routeMatch.ref(ctx);\n    };\n  };\n}\n"],"names":["alpRouter","router","app","context","urlGenerator","routeKey","params","toLocalizedPath","language","redirectTo","to","redirect","ctx","routeMatch","find","path","status","Error","route","ref"],"mappings":";;;;AAkBe,SAASA,SAAT,CAAmBC,MAAnB,EAA+C;SACpDC,GAAD,IAA0B;IAC/BA,GAAG,CAACD,MAAJ,GAAaA,MAAb;;IAEAC,GAAG,CAACC,OAAJ,CAAYC,YAAZ,GAA2B,UAASC,QAAT,EAA2BC,MAA3B,EAAgD;aAClEL,MAAM,CAACM,eAAP,CAAuB,KAAKC,QAA5B,EAAsCH,QAAtC,EAAgDC,MAAhD,CAAP;KADF;;IAIAJ,GAAG,CAACC,OAAJ,CAAYM,UAAZ,GAAyB,UAASC,EAAT,EAAqBJ,MAArB,EAAuC;aACvD,KAAKK,QAAL,CAAcV,MAAM,CAACM,eAAP,CAAuB,KAAKC,QAA5B,EAAsCE,EAAtC,EAA0CJ,MAA1C,CAAd,CAAP;KADF;;WAIQM,GAAD,IAAkB;YACjBC,UAAU,GAAGZ,MAAM,CAACa,IAAP,CAAYF,GAAG,CAACG,IAAhB,EAAsBH,GAAG,CAACJ,QAA1B,CAAnB;;UAEI,CAACK,UAAL,EAAiB;QACfD,GAAG,CAACI,MAAJ,GAAa,GAAb;cACM,IAAIC,KAAJ,CAAW,oBAAmBL,GAAG,CAACG,IAAK,EAAvC,CAAN;;;MAGFH,GAAG,CAACM,KAAJ,GAAYL,UAAZ;aAEOA,UAAU,CAACM,GAAX,CAAeP,GAAf,CAAP;KAVF;GAXF;;;;;"}