{"version":3,"sources":["../src/Manager.js"],"names":["MigrationsManager","findLastVersion","store","r","findOne","table","getField","created","then","row","version","addMigrationDone","migration","insertOne"],"mappings":";;;;;;AACA;;AAEe,MAAMA,iBAAN,+BAAgD;;AAG7DC,oBAAkB;AAChB,QAAI,KAAKC,KAAL,CAAWC,CAAf,EAAkB;AAChB,aAAO,KAAKD,KAAL,CAAWE,OAAX,CACL,KAAKF,KAAL,CAAWG,KAAX,GAAmBC,QAAnB,CAA4B,SAA5B,CADK,CAAP;AAGD,KAJD,MAIO;AACL,aAAO,KAAKJ,KAAL,CAAWE,OAAX,CAAmB,EAAnB,EAAuB,EAAEG,WAAF,EAAvB,EACJC,IADI,CACCC,OAAOA,OAAOA,IAAIC,OADnB,CAAP;AAED;AACF;;AAEDC,mBAAiBC,SAAjB,EAA4B;AAC1B,WAAO,KAAKV,KAAL,CAAWW,SAAX,CAAqBD,SAArB,CAAP;AACD;AAhB4D;kBAA1CZ,iB","file":"Manager.js","sourcesContent":["import MongoStore from 'liwi/mongo';\nimport { AbstractManager } from 'liwi';\n\nexport default class MigrationsManager extends AbstractManager {\n  store: MongoStore;\n\n  findLastVersion() {\n    if (this.store.r) {\n      return this.store.findOne(\n        this.store.table().getField('version'),\n      );\n    } else {\n      return this.store.findOne({}, { created: -1 })\n        .then(row => row && row.version);\n    }\n  }\n\n  addMigrationDone(migration) {\n    return this.store.insertOne(migration);\n  }\n}\n"]}